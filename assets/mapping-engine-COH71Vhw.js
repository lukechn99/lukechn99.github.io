function A1(h,a){for(var d=0;d<a.length;d++){const w=a[d];if(typeof w!="string"&&!Array.isArray(w)){for(const S in w)if(S!=="default"&&!(S in h)){const A=Object.getOwnPropertyDescriptor(w,S);A&&Object.defineProperty(h,S,A.get?A:{enumerable:!0,get:()=>w[S]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}function Dm(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Bh={exports:{}};var E1=Bh.exports,xy;function C1(){return xy||(xy=1,(function(h,a){(function(d,w){w(a)})(E1,(function(d){var w="1.9.4";function S(l){var _,P,k,V;for(P=1,k=arguments.length;P<k;P++){V=arguments[P];for(_ in V)l[_]=V[_]}return l}var A=Object.create||(function(){function l(){}return function(_){return l.prototype=_,new l}})();function b(l,_){var P=Array.prototype.slice;if(l.bind)return l.bind.apply(l,P.call(arguments,1));var k=P.call(arguments,2);return function(){return l.apply(_,k.length?k.concat(P.call(arguments)):arguments)}}var s=0;function F(l){return"_leaflet_id"in l||(l._leaflet_id=++s),l._leaflet_id}function $(l,_,P){var k,V,K,_e;return _e=function(){k=!1,V&&(K.apply(P,V),V=!1)},K=function(){k?V=arguments:(l.apply(P,arguments),setTimeout(_e,_),k=!0)},K}function Q(l,_,P){var k=_[1],V=_[0],K=k-V;return l===k&&P?l:((l-V)%K+K)%K+V}function oe(){return!1}function xe(l,_){if(_===!1)return l;var P=Math.pow(10,_===void 0?6:_);return Math.round(l*P)/P}function ge(l){return l.trim?l.trim():l.replace(/^\s+|\s+$/g,"")}function Me(l){return ge(l).split(/\s+/)}function be(l,_){Object.prototype.hasOwnProperty.call(l,"options")||(l.options=l.options?A(l.options):{});for(var P in _)l.options[P]=_[P];return l.options}function me(l,_,P){var k=[];for(var V in l)k.push(encodeURIComponent(P?V.toUpperCase():V)+"="+encodeURIComponent(l[V]));return(!_||_.indexOf("?")===-1?"?":"&")+k.join("&")}var nt=/\{ *([\w_ -]+) *\}/g;function Ke(l,_){return l.replace(nt,function(P,k){var V=_[k];if(V===void 0)throw new Error("No value provided for variable "+P);return typeof V=="function"&&(V=V(_)),V})}var Je=Array.isArray||function(l){return Object.prototype.toString.call(l)==="[object Array]"};function Ue(l,_){for(var P=0;P<l.length;P++)if(l[P]===_)return P;return-1}var ke="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function $e(l){return window["webkit"+l]||window["moz"+l]||window["ms"+l]}var ht=0;function wt(l){var _=+new Date,P=Math.max(0,16-(_-ht));return ht=_+P,window.setTimeout(l,P)}var Vt=window.requestAnimationFrame||$e("RequestAnimationFrame")||wt,Pt=window.cancelAnimationFrame||$e("CancelAnimationFrame")||$e("CancelRequestAnimationFrame")||function(l){window.clearTimeout(l)};function ei(l,_,P){if(P&&Vt===wt)l.call(_);else return Vt.call(window,b(l,_))}function mi(l){l&&Pt.call(window,l)}var Gr={__proto__:null,extend:S,create:A,bind:b,get lastId(){return s},stamp:F,throttle:$,wrapNum:Q,falseFn:oe,formatNum:xe,trim:ge,splitWords:Me,setOptions:be,getParamString:me,template:Ke,isArray:Je,indexOf:Ue,emptyImageUrl:ke,requestFn:Vt,cancelFn:Pt,requestAnimFrame:ei,cancelAnimFrame:mi};function Pr(){}Pr.extend=function(l){var _=function(){be(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=_.__super__=this.prototype,k=A(P);k.constructor=_,_.prototype=k;for(var V in this)Object.prototype.hasOwnProperty.call(this,V)&&V!=="prototype"&&V!=="__super__"&&(_[V]=this[V]);return l.statics&&S(_,l.statics),l.includes&&(lo(l.includes),S.apply(null,[k].concat(l.includes))),S(k,l),delete k.statics,delete k.includes,k.options&&(k.options=P.options?A(P.options):{},S(k.options,l.options)),k._initHooks=[],k.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var K=0,_e=k._initHooks.length;K<_e;K++)k._initHooks[K].call(this)}},_},Pr.include=function(l){var _=this.prototype.options;return S(this.prototype,l),l.options&&(this.prototype.options=_,this.mergeOptions(l.options)),this},Pr.mergeOptions=function(l){return S(this.prototype.options,l),this},Pr.addInitHook=function(l){var _=Array.prototype.slice.call(arguments,1),P=typeof l=="function"?l:function(){this[l].apply(this,_)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};function lo(l){if(!(typeof L>"u"||!L||!L.Mixin)){l=Je(l)?l:[l];for(var _=0;_<l.length;_++)l[_]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var gr={on:function(l,_,P){if(typeof l=="object")for(var k in l)this._on(k,l[k],_);else{l=Me(l);for(var V=0,K=l.length;V<K;V++)this._on(l[V],_,P)}return this},off:function(l,_,P){if(!arguments.length)delete this._events;else if(typeof l=="object")for(var k in l)this._off(k,l[k],_);else{l=Me(l);for(var V=arguments.length===1,K=0,_e=l.length;K<_e;K++)V?this._off(l[K]):this._off(l[K],_,P)}return this},_on:function(l,_,P,k){if(typeof _!="function"){console.warn("wrong listener type: "+typeof _);return}if(this._listens(l,_,P)===!1){P===this&&(P=void 0);var V={fn:_,ctx:P};k&&(V.once=!0),this._events=this._events||{},this._events[l]=this._events[l]||[],this._events[l].push(V)}},_off:function(l,_,P){var k,V,K;if(this._events&&(k=this._events[l],!!k)){if(arguments.length===1){if(this._firingCount)for(V=0,K=k.length;V<K;V++)k[V].fn=oe;delete this._events[l];return}if(typeof _!="function"){console.warn("wrong listener type: "+typeof _);return}var _e=this._listens(l,_,P);if(_e!==!1){var Ae=k[_e];this._firingCount&&(Ae.fn=oe,this._events[l]=k=k.slice()),k.splice(_e,1)}}},fire:function(l,_,P){if(!this.listens(l,P))return this;var k=S({},_,{type:l,target:this,sourceTarget:_&&_.sourceTarget||this});if(this._events){var V=this._events[l];if(V){this._firingCount=this._firingCount+1||1;for(var K=0,_e=V.length;K<_e;K++){var Ae=V[K],Ne=Ae.fn;Ae.once&&this.off(l,Ne,Ae.ctx),Ne.call(Ae.ctx||this,k)}this._firingCount--}}return P&&this._propagateEvent(k),this},listens:function(l,_,P,k){typeof l!="string"&&console.warn('"string" type argument expected');var V=_;typeof _!="function"&&(k=!!_,V=void 0,P=void 0);var K=this._events&&this._events[l];if(K&&K.length&&this._listens(l,V,P)!==!1)return!0;if(k){for(var _e in this._eventParents)if(this._eventParents[_e].listens(l,_,P,k))return!0}return!1},_listens:function(l,_,P){if(!this._events)return!1;var k=this._events[l]||[];if(!_)return!!k.length;P===this&&(P=void 0);for(var V=0,K=k.length;V<K;V++)if(k[V].fn===_&&k[V].ctx===P)return V;return!1},once:function(l,_,P){if(typeof l=="object")for(var k in l)this._on(k,l[k],_,!0);else{l=Me(l);for(var V=0,K=l.length;V<K;V++)this._on(l[V],_,P,!0)}return this},addEventParent:function(l){return this._eventParents=this._eventParents||{},this._eventParents[F(l)]=l,this},removeEventParent:function(l){return this._eventParents&&delete this._eventParents[F(l)],this},_propagateEvent:function(l){for(var _ in this._eventParents)this._eventParents[_].fire(l.type,S({layer:l.target,propagatedFrom:l.target},l),!0)}};gr.addEventListener=gr.on,gr.removeEventListener=gr.clearAllEventListeners=gr.off,gr.addOneTimeEventListener=gr.once,gr.fireEvent=gr.fire,gr.hasEventListeners=gr.listens;var hr=Pr.extend(gr);function It(l,_,P){this.x=P?Math.round(l):l,this.y=P?Math.round(_):_}var si=Math.trunc||function(l){return l>0?Math.floor(l):Math.ceil(l)};It.prototype={clone:function(){return new It(this.x,this.y)},add:function(l){return this.clone()._add(Et(l))},_add:function(l){return this.x+=l.x,this.y+=l.y,this},subtract:function(l){return this.clone()._subtract(Et(l))},_subtract:function(l){return this.x-=l.x,this.y-=l.y,this},divideBy:function(l){return this.clone()._divideBy(l)},_divideBy:function(l){return this.x/=l,this.y/=l,this},multiplyBy:function(l){return this.clone()._multiplyBy(l)},_multiplyBy:function(l){return this.x*=l,this.y*=l,this},scaleBy:function(l){return new It(this.x*l.x,this.y*l.y)},unscaleBy:function(l){return new It(this.x/l.x,this.y/l.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=si(this.x),this.y=si(this.y),this},distanceTo:function(l){l=Et(l);var _=l.x-this.x,P=l.y-this.y;return Math.sqrt(_*_+P*P)},equals:function(l){return l=Et(l),l.x===this.x&&l.y===this.y},contains:function(l){return l=Et(l),Math.abs(l.x)<=Math.abs(this.x)&&Math.abs(l.y)<=Math.abs(this.y)},toString:function(){return"Point("+xe(this.x)+", "+xe(this.y)+")"}};function Et(l,_,P){return l instanceof It?l:Je(l)?new It(l[0],l[1]):l==null?l:typeof l=="object"&&"x"in l&&"y"in l?new It(l.x,l.y):new It(l,_,P)}function li(l,_){if(l)for(var P=_?[l,_]:l,k=0,V=P.length;k<V;k++)this.extend(P[k])}li.prototype={extend:function(l){var _,P;if(!l)return this;if(l instanceof It||typeof l[0]=="number"||"x"in l)_=P=Et(l);else if(l=pr(l),_=l.min,P=l.max,!_||!P)return this;return!this.min&&!this.max?(this.min=_.clone(),this.max=P.clone()):(this.min.x=Math.min(_.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(_.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)),this},getCenter:function(l){return Et((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,l)},getBottomLeft:function(){return Et(this.min.x,this.max.y)},getTopRight:function(){return Et(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(l){var _,P;return typeof l[0]=="number"||l instanceof It?l=Et(l):l=pr(l),l instanceof li?(_=l.min,P=l.max):_=P=l,_.x>=this.min.x&&P.x<=this.max.x&&_.y>=this.min.y&&P.y<=this.max.y},intersects:function(l){l=pr(l);var _=this.min,P=this.max,k=l.min,V=l.max,K=V.x>=_.x&&k.x<=P.x,_e=V.y>=_.y&&k.y<=P.y;return K&&_e},overlaps:function(l){l=pr(l);var _=this.min,P=this.max,k=l.min,V=l.max,K=V.x>_.x&&k.x<P.x,_e=V.y>_.y&&k.y<P.y;return K&&_e},isValid:function(){return!!(this.min&&this.max)},pad:function(l){var _=this.min,P=this.max,k=Math.abs(_.x-P.x)*l,V=Math.abs(_.y-P.y)*l;return pr(Et(_.x-k,_.y-V),Et(P.x+k,P.y+V))},equals:function(l){return l?(l=pr(l),this.min.equals(l.getTopLeft())&&this.max.equals(l.getBottomRight())):!1}};function pr(l,_){return!l||l instanceof li?l:new li(l,_)}function _r(l,_){if(l)for(var P=_?[l,_]:l,k=0,V=P.length;k<V;k++)this.extend(P[k])}_r.prototype={extend:function(l){var _=this._southWest,P=this._northEast,k,V;if(l instanceof jt)k=l,V=l;else if(l instanceof _r){if(k=l._southWest,V=l._northEast,!k||!V)return this}else return l?this.extend(Bt(l)||Mi(l)):this;return!_&&!P?(this._southWest=new jt(k.lat,k.lng),this._northEast=new jt(V.lat,V.lng)):(_.lat=Math.min(k.lat,_.lat),_.lng=Math.min(k.lng,_.lng),P.lat=Math.max(V.lat,P.lat),P.lng=Math.max(V.lng,P.lng)),this},pad:function(l){var _=this._southWest,P=this._northEast,k=Math.abs(_.lat-P.lat)*l,V=Math.abs(_.lng-P.lng)*l;return new _r(new jt(_.lat-k,_.lng-V),new jt(P.lat+k,P.lng+V))},getCenter:function(){return new jt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new jt(this.getNorth(),this.getWest())},getSouthEast:function(){return new jt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(l){typeof l[0]=="number"||l instanceof jt||"lat"in l?l=Bt(l):l=Mi(l);var _=this._southWest,P=this._northEast,k,V;return l instanceof _r?(k=l.getSouthWest(),V=l.getNorthEast()):k=V=l,k.lat>=_.lat&&V.lat<=P.lat&&k.lng>=_.lng&&V.lng<=P.lng},intersects:function(l){l=Mi(l);var _=this._southWest,P=this._northEast,k=l.getSouthWest(),V=l.getNorthEast(),K=V.lat>=_.lat&&k.lat<=P.lat,_e=V.lng>=_.lng&&k.lng<=P.lng;return K&&_e},overlaps:function(l){l=Mi(l);var _=this._southWest,P=this._northEast,k=l.getSouthWest(),V=l.getNorthEast(),K=V.lat>_.lat&&k.lat<P.lat,_e=V.lng>_.lng&&k.lng<P.lng;return K&&_e},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(l,_){return l?(l=Mi(l),this._southWest.equals(l.getSouthWest(),_)&&this._northEast.equals(l.getNorthEast(),_)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Mi(l,_){return l instanceof _r?l:new _r(l,_)}function jt(l,_,P){if(isNaN(l)||isNaN(_))throw new Error("Invalid LatLng object: ("+l+", "+_+")");this.lat=+l,this.lng=+_,P!==void 0&&(this.alt=+P)}jt.prototype={equals:function(l,_){if(!l)return!1;l=Bt(l);var P=Math.max(Math.abs(this.lat-l.lat),Math.abs(this.lng-l.lng));return P<=(_===void 0?1e-9:_)},toString:function(l){return"LatLng("+xe(this.lat,l)+", "+xe(this.lng,l)+")"},distanceTo:function(l){return Ui.distance(this,Bt(l))},wrap:function(){return Ui.wrapLatLng(this)},toBounds:function(l){var _=180*l/40075017,P=_/Math.cos(Math.PI/180*this.lat);return Mi([this.lat-_,this.lng-P],[this.lat+_,this.lng+P])},clone:function(){return new jt(this.lat,this.lng,this.alt)}};function Bt(l,_,P){return l instanceof jt?l:Je(l)&&typeof l[0]!="object"?l.length===3?new jt(l[0],l[1],l[2]):l.length===2?new jt(l[0],l[1]):null:l==null?l:typeof l=="object"&&"lat"in l?new jt(l.lat,"lng"in l?l.lng:l.lon,l.alt):_===void 0?null:new jt(l,_,P)}var Mr={latLngToPoint:function(l,_){var P=this.projection.project(l),k=this.scale(_);return this.transformation._transform(P,k)},pointToLatLng:function(l,_){var P=this.scale(_),k=this.transformation.untransform(l,P);return this.projection.unproject(k)},project:function(l){return this.projection.project(l)},unproject:function(l){return this.projection.unproject(l)},scale:function(l){return 256*Math.pow(2,l)},zoom:function(l){return Math.log(l/256)/Math.LN2},getProjectedBounds:function(l){if(this.infinite)return null;var _=this.projection.bounds,P=this.scale(l),k=this.transformation.transform(_.min,P),V=this.transformation.transform(_.max,P);return new li(k,V)},infinite:!1,wrapLatLng:function(l){var _=this.wrapLng?Q(l.lng,this.wrapLng,!0):l.lng,P=this.wrapLat?Q(l.lat,this.wrapLat,!0):l.lat,k=l.alt;return new jt(P,_,k)},wrapLatLngBounds:function(l){var _=l.getCenter(),P=this.wrapLatLng(_),k=_.lat-P.lat,V=_.lng-P.lng;if(k===0&&V===0)return l;var K=l.getSouthWest(),_e=l.getNorthEast(),Ae=new jt(K.lat-k,K.lng-V),Ne=new jt(_e.lat-k,_e.lng-V);return new _r(Ae,Ne)}},Ui=S({},Mr,{wrapLng:[-180,180],R:6371e3,distance:function(l,_){var P=Math.PI/180,k=l.lat*P,V=_.lat*P,K=Math.sin((_.lat-l.lat)*P/2),_e=Math.sin((_.lng-l.lng)*P/2),Ae=K*K+Math.cos(k)*Math.cos(V)*_e*_e,Ne=2*Math.atan2(Math.sqrt(Ae),Math.sqrt(1-Ae));return this.R*Ne}}),Ro=6378137,dn={R:Ro,MAX_LATITUDE:85.0511287798,project:function(l){var _=Math.PI/180,P=this.MAX_LATITUDE,k=Math.max(Math.min(P,l.lat),-P),V=Math.sin(k*_);return new It(this.R*l.lng*_,this.R*Math.log((1+V)/(1-V))/2)},unproject:function(l){var _=180/Math.PI;return new jt((2*Math.atan(Math.exp(l.y/this.R))-Math.PI/2)*_,l.x*_/this.R)},bounds:(function(){var l=Ro*Math.PI;return new li([-l,-l],[l,l])})()};function ea(l,_,P,k){if(Je(l)){this._a=l[0],this._b=l[1],this._c=l[2],this._d=l[3];return}this._a=l,this._b=_,this._c=P,this._d=k}ea.prototype={transform:function(l,_){return this._transform(l.clone(),_)},_transform:function(l,_){return _=_||1,l.x=_*(this._a*l.x+this._b),l.y=_*(this._c*l.y+this._d),l},untransform:function(l,_){return _=_||1,new It((l.x/_-this._b)/this._a,(l.y/_-this._d)/this._c)}};function $r(l,_,P,k){return new ea(l,_,P,k)}var ta=S({},Ui,{code:"EPSG:3857",projection:dn,transformation:(function(){var l=.5/(Math.PI*dn.R);return $r(l,.5,-l,.5)})()}),yr=S({},ta,{code:"EPSG:900913"});function fn(l){return document.createElementNS("http://www.w3.org/2000/svg",l)}function zn(l,_){var P="",k,V,K,_e,Ae,Ne;for(k=0,K=l.length;k<K;k++){for(Ae=l[k],V=0,_e=Ae.length;V<_e;V++)Ne=Ae[V],P+=(V?"L":"M")+Ne.x+" "+Ne.y;P+=_?Fe.svg?"z":"x":""}return P||"M0 0"}var Li=document.documentElement.style,Dn="ActiveXObject"in window,ia=Dn&&!document.addEventListener,ra="msLaunchUri"in navigator&&!("documentMode"in document),Xn=tn("webkit"),In=tn("android"),na=tn("android 2")||tn("android 3"),Da=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),en=In&&tn("Google")&&Da<537&&!("AudioNode"in window),Pe=!!window.opera,H=!ra&&tn("chrome"),W=tn("gecko")&&!Xn&&!Pe&&!Dn,ee=!H&&tn("safari"),fe=tn("phantom"),ye="OTransition"in Li,Ee=navigator.platform.indexOf("Win")===0,Se=Dn&&"transition"in Li,we="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!na,De="MozPerspective"in Li,Xe=!window.L_DISABLE_3D&&(Se||we||De)&&!ye&&!fe,Ze=typeof orientation<"u"||tn("mobile"),ut=Ze&&Xn,_t=Ze&&we,At=!window.PointerEvent&&window.MSPointerEvent,ci=!!(window.PointerEvent||At),ti="ontouchstart"in window||!!window.TouchEvent,Le=!window.L_NO_TOUCH&&(ti||ci),vi=Ze&&Pe,Ir=Ze&&W,Ct=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,hi=(function(){var l=!1;try{var _=Object.defineProperty({},"passive",{get:function(){l=!0}});window.addEventListener("testPassiveEventSupport",oe,_),window.removeEventListener("testPassiveEventSupport",oe,_)}catch{}return l})(),Ar=(function(){return!!document.createElement("canvas").getContext})(),xi=!!(document.createElementNS&&fn("svg").createSVGRect),Zi=!!xi&&(function(){var l=document.createElement("div");return l.innerHTML="<svg/>",(l.firstChild&&l.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),bi=!xi&&(function(){try{var l=document.createElement("div");l.innerHTML='<v:shape adj="1"/>';var _=l.firstChild;return _.style.behavior="url(#default#VML)",_&&typeof _.adj=="object"}catch{return!1}})(),ir=navigator.platform.indexOf("Mac")===0,fs=navigator.platform.indexOf("Linux")===0;function tn(l){return navigator.userAgent.toLowerCase().indexOf(l)>=0}var Fe={ie:Dn,ielt9:ia,edge:ra,webkit:Xn,android:In,android23:na,androidStock:en,opera:Pe,chrome:H,gecko:W,safari:ee,phantom:fe,opera12:ye,win:Ee,ie3d:Se,webkit3d:we,gecko3d:De,any3d:Xe,mobile:Ze,mobileWebkit:ut,mobileWebkit3d:_t,msPointer:At,pointer:ci,touch:Le,touchNative:ti,mobileOpera:vi,mobileGecko:Ir,retina:Ct,passiveEvents:hi,canvas:Ar,svg:xi,vml:bi,inlineSvg:Zi,mac:ir,linux:fs},zr=Fe.msPointer?"MSPointerDown":"pointerdown",Dr=Fe.msPointer?"MSPointerMove":"pointermove",ms=Fe.msPointer?"MSPointerUp":"pointerup",mn=Fe.msPointer?"MSPointerCancel":"pointercancel",rt={touchstart:zr,touchmove:Dr,touchend:ms,touchcancel:mn},Ot={touchstart:_s,touchmove:co,touchend:co,touchcancel:co},kt={},rn=!1;function Js(l,_,P){return _==="touchstart"&&Qs(),Ot[_]?(P=Ot[_].bind(this,P),l.addEventListener(rt[_],P,!1),P):(console.warn("wrong event specified:",_),oe)}function uo(l,_,P){if(!rt[_]){console.warn("wrong event specified:",_);return}l.removeEventListener(rt[_],P,!1)}function Rt(l){kt[l.pointerId]=l}function gs(l){kt[l.pointerId]&&(kt[l.pointerId]=l)}function Ra(l){delete kt[l.pointerId]}function Qs(){rn||(document.addEventListener(zr,Rt,!0),document.addEventListener(Dr,gs,!0),document.addEventListener(ms,Ra,!0),document.addEventListener(mn,Ra,!0),rn=!0)}function co(l,_){if(_.pointerType!==(_.MSPOINTER_TYPE_MOUSE||"mouse")){_.touches=[];for(var P in kt)_.touches.push(kt[P]);_.changedTouches=[_],l(_)}}function _s(l,_){_.MSPOINTER_TYPE_TOUCH&&_.pointerType===_.MSPOINTER_TYPE_TOUCH&&Xt(_),co(l,_)}function Fa(l){var _={},P,k;for(k in l)P=l[k],_[k]=P&&P.bind?P.bind(l):P;return l=_,_.type="dblclick",_.detail=2,_.isTrusted=!1,_._simulated=!0,_}var ys=200;function qr(l,_){l.addEventListener("dblclick",_);var P=0,k;function V(K){if(K.detail!==1){k=K.detail;return}if(!(K.pointerType==="mouse"||K.sourceCapabilities&&!K.sourceCapabilities.firesTouchEvents)){var _e=Fn(K);if(!(_e.some(function(Ne){return Ne instanceof HTMLLabelElement&&Ne.attributes.for})&&!_e.some(function(Ne){return Ne instanceof HTMLInputElement||Ne instanceof HTMLSelectElement}))){var Ae=Date.now();Ae-P<=ys?(k++,k===2&&_(Fa(K))):k=1,P=Ae}}}return l.addEventListener("click",V),{dblclick:_,simDblclick:V}}function pi(l,_){l.removeEventListener("dblclick",_.dblclick),l.removeEventListener("click",_.simDblclick)}var Ba=Na(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Yn=Na(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Oa=Yn==="webkitTransition"||Yn==="OTransition"?Yn+"End":"transitionend";function Fo(l){return typeof l=="string"?document.getElementById(l):l}function Wr(l,_){var P=l.style[_]||l.currentStyle&&l.currentStyle[_];if((!P||P==="auto")&&document.defaultView){var k=document.defaultView.getComputedStyle(l,null);P=k?k[_]:null}return P==="auto"?null:P}function ri(l,_,P){var k=document.createElement(l);return k.className=_||"",P&&P.appendChild(k),k}function gi(l){var _=l.parentNode;_&&_.removeChild(l)}function oa(l){for(;l.firstChild;)l.removeChild(l.firstChild)}function wi(l){var _=l.parentNode;_&&_.lastChild!==l&&_.appendChild(l)}function aa(l){var _=l.parentNode;_&&_.firstChild!==l&&_.insertBefore(l,_.firstChild)}function el(l,_){if(l.classList!==void 0)return l.classList.contains(_);var P=vs(l);return P.length>0&&new RegExp("(^|\\s)"+_+"(\\s|$)").test(P)}function Nt(l,_){if(l.classList!==void 0)for(var P=Me(_),k=0,V=P.length;k<V;k++)l.classList.add(P[k]);else if(!el(l,_)){var K=vs(l);tl(l,(K?K+" ":"")+_)}}function Gi(l,_){l.classList!==void 0?l.classList.remove(_):tl(l,ge((" "+vs(l)+" ").replace(" "+_+" "," ")))}function tl(l,_){l.className.baseVal===void 0?l.className=_:l.className.baseVal=_}function vs(l){return l.correspondingElement&&(l=l.correspondingElement),l.className.baseVal===void 0?l.className:l.className.baseVal}function Hr(l,_){"opacity"in l.style?l.style.opacity=_:"filter"in l.style&&Dl(l,_)}function Dl(l,_){var P=!1,k="DXImageTransform.Microsoft.Alpha";try{P=l.filters.item(k)}catch{if(_===1)return}_=Math.round(_*100),P?(P.Enabled=_!==100,P.Opacity=_):l.style.filter+=" progid:"+k+"(opacity="+_+")"}function Na(l){for(var _=document.documentElement.style,P=0;P<l.length;P++)if(l[P]in _)return l[P];return!1}function ho(l,_,P){var k=_||new It(0,0);l.style[Ba]=(Fe.ie3d?"translate("+k.x+"px,"+k.y+"px)":"translate3d("+k.x+"px,"+k.y+"px,0)")+(P?" scale("+P+")":"")}function $i(l,_){l._leaflet_pos=_,Fe.any3d?ho(l,_):(l.style.left=_.x+"px",l.style.top=_.y+"px")}function sa(l){return l._leaflet_pos||new It(0,0)}var po,Bo,il;if("onselectstart"in document)po=function(){Tt(window,"selectstart",Xt)},Bo=function(){pt(window,"selectstart",Xt)};else{var Kn=Na(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);po=function(){if(Kn){var l=document.documentElement.style;il=l[Kn],l[Kn]="none"}},Bo=function(){Kn&&(document.documentElement.style[Kn]=il,il=void 0)}}function xs(){Tt(window,"dragstart",Xt)}function la(){pt(window,"dragstart",Xt)}var Rn,Oo;function Ft(l){for(;l.tabIndex===-1;)l=l.parentNode;l.style&&(ja(),Rn=l,Oo=l.style.outlineStyle,l.style.outlineStyle="none",Tt(window,"keydown",ja))}function ja(){Rn&&(Rn.style.outlineStyle=Oo,Rn=void 0,Oo=void 0,pt(window,"keydown",ja))}function Iu(l){do l=l.parentNode;while((!l.offsetWidth||!l.offsetHeight)&&l!==document.body);return l}function bs(l){var _=l.getBoundingClientRect();return{x:_.width/l.offsetWidth||1,y:_.height/l.offsetHeight||1,boundingClientRect:_}}var nn={__proto__:null,TRANSFORM:Ba,TRANSITION:Yn,TRANSITION_END:Oa,get:Fo,getStyle:Wr,create:ri,remove:gi,empty:oa,toFront:wi,toBack:aa,hasClass:el,addClass:Nt,removeClass:Gi,setClass:tl,getClass:vs,setOpacity:Hr,testProp:Na,setTransform:ho,setPosition:$i,getPosition:sa,get disableTextSelection(){return po},get enableTextSelection(){return Bo},disableImageDrag:xs,enableImageDrag:la,preventOutline:Ft,restoreOutline:ja,getSizedParentNode:Iu,getScale:bs};function Tt(l,_,P,k){if(_&&typeof _=="object")for(var V in _)Er(l,V,_[V],P);else{_=Me(_);for(var K=0,_e=_.length;K<_e;K++)Er(l,_[K],P,k)}return this}var ni="_leaflet_events";function pt(l,_,P,k){if(arguments.length===1)_i(l),delete l[ni];else if(_&&typeof _=="object")for(var V in _)Xr(l,V,_[V],P);else if(_=Me(_),arguments.length===2)_i(l,function(Ae){return Ue(_,Ae)!==-1});else for(var K=0,_e=_.length;K<_e;K++)Xr(l,_[K],P,k);return this}function _i(l,_){for(var P in l[ni]){var k=P.split(/\d/)[0];(!_||_(k))&&Xr(l,k,null,null,P)}}var Jn={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Er(l,_,P,k){var V=_+F(P)+(k?"_"+F(k):"");if(l[ni]&&l[ni][V])return this;var K=function(Ae){return P.call(k||l,Ae||window.event)},_e=K;!Fe.touchNative&&Fe.pointer&&_.indexOf("touch")===0?K=Js(l,_,K):Fe.touch&&_==="dblclick"?K=qr(l,K):"addEventListener"in l?_==="touchstart"||_==="touchmove"||_==="wheel"||_==="mousewheel"?l.addEventListener(Jn[_]||_,K,Fe.passiveEvents?{passive:!1}:!1):_==="mouseenter"||_==="mouseleave"?(K=function(Ae){Ae=Ae||window.event,Bn(l,Ae)&&_e(Ae)},l.addEventListener(Jn[_],K,!1)):l.addEventListener(_,_e,!1):l.attachEvent("on"+_,K),l[ni]=l[ni]||{},l[ni][V]=K}function Xr(l,_,P,k,V){V=V||_+F(P)+(k?"_"+F(k):"");var K=l[ni]&&l[ni][V];if(!K)return this;!Fe.touchNative&&Fe.pointer&&_.indexOf("touch")===0?uo(l,_,K):Fe.touch&&_==="dblclick"?pi(l,K):"removeEventListener"in l?l.removeEventListener(Jn[_]||_,K,!1):l.detachEvent("on"+_,K),l[ni][V]=null}function Yi(l){return l.stopPropagation?l.stopPropagation():l.originalEvent?l.originalEvent._stopped=!0:l.cancelBubble=!0,this}function No(l){return Er(l,"wheel",Yi),this}function An(l){return Tt(l,"mousedown touchstart dblclick contextmenu",Yi),l._leaflet_disable_click=!0,this}function Xt(l){return l.preventDefault?l.preventDefault():l.returnValue=!1,this}function gn(l){return Xt(l),Yi(l),this}function Fn(l){if(l.composedPath)return l.composedPath();for(var _=[],P=l.target;P;)_.push(P),P=P.parentNode;return _}function ws(l,_){if(!_)return new It(l.clientX,l.clientY);var P=bs(_),k=P.boundingClientRect;return new It((l.clientX-k.left)/P.x-_.clientLeft,(l.clientY-k.top)/P.y-_.clientTop)}var on=Fe.linux&&Fe.chrome?window.devicePixelRatio:Fe.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function jo(l){return Fe.edge?l.wheelDeltaY/2:l.deltaY&&l.deltaMode===0?-l.deltaY/on:l.deltaY&&l.deltaMode===1?-l.deltaY*20:l.deltaY&&l.deltaMode===2?-l.deltaY*60:l.deltaX||l.deltaZ?0:l.wheelDelta?(l.wheelDeltaY||l.wheelDelta)/2:l.detail&&Math.abs(l.detail)<32765?-l.detail*20:l.detail?l.detail/-32765*60:0}function Bn(l,_){var P=_.relatedTarget;if(!P)return!0;try{for(;P&&P!==l;)P=P.parentNode}catch{return!1}return P!==l}var Au={__proto__:null,on:Tt,off:pt,stopPropagation:Yi,disableScrollPropagation:No,disableClickPropagation:An,preventDefault:Xt,stop:gn,getPropagationPath:Fn,getMousePosition:ws,getWheelDelta:jo,isExternalTarget:Bn,addListener:Tt,removeListener:pt},rl=hr.extend({run:function(l,_,P,k){this.stop(),this._el=l,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(k||.5,.2),this._startPos=sa(l),this._offset=_.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=ei(this._animate,this),this._step()},_step:function(l){var _=+new Date-this._startTime,P=this._duration*1e3;_<P?this._runFrame(this._easeOut(_/P),l):(this._runFrame(1),this._complete())},_runFrame:function(l,_){var P=this._startPos.add(this._offset.multiplyBy(l));_&&P._round(),$i(this._el,P),this.fire("step")},_complete:function(){mi(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(l){return 1-Math.pow(1-l,this._easeOutPower)}}),$t=hr.extend({options:{crs:ta,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(l,_){_=be(this,_),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(l),this._initLayout(),this._onResize=b(this._onResize,this),this._initEvents(),_.maxBounds&&this.setMaxBounds(_.maxBounds),_.zoom!==void 0&&(this._zoom=this._limitZoom(_.zoom)),_.center&&_.zoom!==void 0&&this.setView(Bt(_.center),_.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Yn&&Fe.any3d&&!Fe.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Tt(this._proxy,Oa,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(l,_,P){if(_=_===void 0?this._zoom:this._limitZoom(_),l=this._limitCenter(Bt(l),_,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&P!==!0){P.animate!==void 0&&(P.zoom=S({animate:P.animate},P.zoom),P.pan=S({animate:P.animate,duration:P.duration},P.pan));var k=this._zoom!==_?this._tryAnimatedZoom&&this._tryAnimatedZoom(l,_,P.zoom):this._tryAnimatedPan(l,P.pan);if(k)return clearTimeout(this._sizeTimer),this}return this._resetView(l,_,P.pan&&P.pan.noMoveStart),this},setZoom:function(l,_){return this._loaded?this.setView(this.getCenter(),l,{zoom:_}):(this._zoom=l,this)},zoomIn:function(l,_){return l=l||(Fe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+l,_)},zoomOut:function(l,_){return l=l||(Fe.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-l,_)},setZoomAround:function(l,_,P){var k=this.getZoomScale(_),V=this.getSize().divideBy(2),K=l instanceof It?l:this.latLngToContainerPoint(l),_e=K.subtract(V).multiplyBy(1-1/k),Ae=this.containerPointToLatLng(V.add(_e));return this.setView(Ae,_,{zoom:P})},_getBoundsCenterZoom:function(l,_){_=_||{},l=l.getBounds?l.getBounds():Mi(l);var P=Et(_.paddingTopLeft||_.padding||[0,0]),k=Et(_.paddingBottomRight||_.padding||[0,0]),V=this.getBoundsZoom(l,!1,P.add(k));if(V=typeof _.maxZoom=="number"?Math.min(_.maxZoom,V):V,V===1/0)return{center:l.getCenter(),zoom:V};var K=k.subtract(P).divideBy(2),_e=this.project(l.getSouthWest(),V),Ae=this.project(l.getNorthEast(),V),Ne=this.unproject(_e.add(Ae).divideBy(2).add(K),V);return{center:Ne,zoom:V}},fitBounds:function(l,_){if(l=Mi(l),!l.isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(l,_);return this.setView(P.center,P.zoom,_)},fitWorld:function(l){return this.fitBounds([[-90,-180],[90,180]],l)},panTo:function(l,_){return this.setView(l,this._zoom,{pan:_})},panBy:function(l,_){if(l=Et(l).round(),_=_||{},!l.x&&!l.y)return this.fire("moveend");if(_.animate!==!0&&!this.getSize().contains(l))return this._resetView(this.unproject(this.project(this.getCenter()).add(l)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new rl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),_.noMoveStart||this.fire("movestart"),_.animate!==!1){Nt(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(l).round();this._panAnim.run(this._mapPane,P,_.duration||.25,_.easeLinearity)}else this._rawPanBy(l),this.fire("move").fire("moveend");return this},flyTo:function(l,_,P){if(P=P||{},P.animate===!1||!Fe.any3d)return this.setView(l,_,P);this._stop();var k=this.project(this.getCenter()),V=this.project(l),K=this.getSize(),_e=this._zoom;l=Bt(l),_=_===void 0?_e:_;var Ae=Math.max(K.x,K.y),Ne=Ae*this.getZoomScale(_e,_),Qe=V.distanceTo(k)||1,ft=1.42,Lt=ft*ft;function qt(Oi){var $o=Oi?-1:1,ml=Oi?Ne:Ae,qo=Ne*Ne-Ae*Ae+$o*Lt*Lt*Qe*Qe,ks=2*ml*Lt*Qe,wo=qo/ks,ya=Math.sqrt(wo*wo+1)-wo,Hu=ya<1e-9?-18:Math.log(ya);return Hu}function dr(Oi){return(Math.exp(Oi)-Math.exp(-Oi))/2}function Ji(Oi){return(Math.exp(Oi)+Math.exp(-Oi))/2}function xn(Oi){return dr(Oi)/Ji(Oi)}var Yr=qt(0);function ro(Oi){return Ae*(Ji(Yr)/Ji(Yr+ft*Oi))}function fl(Oi){return Ae*(Ji(Yr)*xn(Yr+ft*Oi)-dr(Yr))/Lt}function qu(Oi){return 1-Math.pow(1-Oi,1.5)}var Wu=Date.now(),Bi=(qt(1)-Yr)/ft,_a=P.duration?1e3*P.duration:1e3*Bi*.8;function bn(){var Oi=(Date.now()-Wu)/_a,$o=qu(Oi)*Bi;Oi<=1?(this._flyToFrame=ei(bn,this),this._move(this.unproject(k.add(V.subtract(k).multiplyBy(fl($o)/Qe)),_e),this.getScaleZoom(Ae/ro($o),_e),{flyTo:!0})):this._move(l,_)._moveEnd(!0)}return this._moveStart(!0,P.noMoveStart),bn.call(this),this},flyToBounds:function(l,_){var P=this._getBoundsCenterZoom(l,_);return this.flyTo(P.center,P.zoom,_)},setMaxBounds:function(l){return l=Mi(l),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),l.isValid()?(this.options.maxBounds=l,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(l){var _=this.options.minZoom;return this.options.minZoom=l,this._loaded&&_!==l&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(l):this},setMaxZoom:function(l){var _=this.options.maxZoom;return this.options.maxZoom=l,this._loaded&&_!==l&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(l):this},panInsideBounds:function(l,_){this._enforcingBounds=!0;var P=this.getCenter(),k=this._limitCenter(P,this._zoom,Mi(l));return P.equals(k)||this.panTo(k,_),this._enforcingBounds=!1,this},panInside:function(l,_){_=_||{};var P=Et(_.paddingTopLeft||_.padding||[0,0]),k=Et(_.paddingBottomRight||_.padding||[0,0]),V=this.project(this.getCenter()),K=this.project(l),_e=this.getPixelBounds(),Ae=pr([_e.min.add(P),_e.max.subtract(k)]),Ne=Ae.getSize();if(!Ae.contains(K)){this._enforcingBounds=!0;var Qe=K.subtract(Ae.getCenter()),ft=Ae.extend(K).getSize().subtract(Ne);V.x+=Qe.x<0?-ft.x:ft.x,V.y+=Qe.y<0?-ft.y:ft.y,this.panTo(this.unproject(V),_),this._enforcingBounds=!1}return this},invalidateSize:function(l){if(!this._loaded)return this;l=S({animate:!1,pan:!0},l===!0?{animate:!0}:l);var _=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),k=_.divideBy(2).round(),V=P.divideBy(2).round(),K=k.subtract(V);return!K.x&&!K.y?this:(l.animate&&l.pan?this.panBy(K):(l.pan&&this._rawPanBy(K),this.fire("move"),l.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(b(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:_,newSize:P}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(l){if(l=this._locateOptions=S({timeout:1e4,watch:!1},l),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var _=b(this._handleGeolocationResponse,this),P=b(this._handleGeolocationError,this);return l.watch?this._locationWatchId=navigator.geolocation.watchPosition(_,P,l):navigator.geolocation.getCurrentPosition(_,P,l),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(l){if(this._container._leaflet_id){var _=l.code,P=l.message||(_===1?"permission denied":_===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:_,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(l){if(this._container._leaflet_id){var _=l.coords.latitude,P=l.coords.longitude,k=new jt(_,P),V=k.toBounds(l.coords.accuracy*2),K=this._locateOptions;if(K.setView){var _e=this.getBoundsZoom(V);this.setView(k,K.maxZoom?Math.min(_e,K.maxZoom):_e)}var Ae={latlng:k,bounds:V,timestamp:l.timestamp};for(var Ne in l.coords)typeof l.coords[Ne]=="number"&&(Ae[Ne]=l.coords[Ne]);this.fire("locationfound",Ae)}},addHandler:function(l,_){if(!_)return this;var P=this[l]=new _(this);return this._handlers.push(P),this.options[l]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),gi(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(mi(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var l;for(l in this._layers)this._layers[l].remove();for(l in this._panes)gi(this._panes[l]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(l,_){var P="leaflet-pane"+(l?" leaflet-"+l.replace("Pane","")+"-pane":""),k=ri("div",P,_||this._mapPane);return l&&(this._panes[l]=k),k},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var l=this.getPixelBounds(),_=this.unproject(l.getBottomLeft()),P=this.unproject(l.getTopRight());return new _r(_,P)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(l,_,P){l=Mi(l),P=Et(P||[0,0]);var k=this.getZoom()||0,V=this.getMinZoom(),K=this.getMaxZoom(),_e=l.getNorthWest(),Ae=l.getSouthEast(),Ne=this.getSize().subtract(P),Qe=pr(this.project(Ae,k),this.project(_e,k)).getSize(),ft=Fe.any3d?this.options.zoomSnap:1,Lt=Ne.x/Qe.x,qt=Ne.y/Qe.y,dr=_?Math.max(Lt,qt):Math.min(Lt,qt);return k=this.getScaleZoom(dr,k),ft&&(k=Math.round(k/(ft/100))*(ft/100),k=_?Math.ceil(k/ft)*ft:Math.floor(k/ft)*ft),Math.max(V,Math.min(K,k))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new It(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(l,_){var P=this._getTopLeftPoint(l,_);return new li(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(l){return this.options.crs.getProjectedBounds(l===void 0?this.getZoom():l)},getPane:function(l){return typeof l=="string"?this._panes[l]:l},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(l,_){var P=this.options.crs;return _=_===void 0?this._zoom:_,P.scale(l)/P.scale(_)},getScaleZoom:function(l,_){var P=this.options.crs;_=_===void 0?this._zoom:_;var k=P.zoom(l*P.scale(_));return isNaN(k)?1/0:k},project:function(l,_){return _=_===void 0?this._zoom:_,this.options.crs.latLngToPoint(Bt(l),_)},unproject:function(l,_){return _=_===void 0?this._zoom:_,this.options.crs.pointToLatLng(Et(l),_)},layerPointToLatLng:function(l){var _=Et(l).add(this.getPixelOrigin());return this.unproject(_)},latLngToLayerPoint:function(l){var _=this.project(Bt(l))._round();return _._subtract(this.getPixelOrigin())},wrapLatLng:function(l){return this.options.crs.wrapLatLng(Bt(l))},wrapLatLngBounds:function(l){return this.options.crs.wrapLatLngBounds(Mi(l))},distance:function(l,_){return this.options.crs.distance(Bt(l),Bt(_))},containerPointToLayerPoint:function(l){return Et(l).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(l){return Et(l).add(this._getMapPanePos())},containerPointToLatLng:function(l){var _=this.containerPointToLayerPoint(Et(l));return this.layerPointToLatLng(_)},latLngToContainerPoint:function(l){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Bt(l)))},mouseEventToContainerPoint:function(l){return ws(l,this._container)},mouseEventToLayerPoint:function(l){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(l))},mouseEventToLatLng:function(l){return this.layerPointToLatLng(this.mouseEventToLayerPoint(l))},_initContainer:function(l){var _=this._container=Fo(l);if(_){if(_._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Tt(_,"scroll",this._onScroll,this),this._containerId=F(_)},_initLayout:function(){var l=this._container;this._fadeAnimated=this.options.fadeAnimation&&Fe.any3d,Nt(l,"leaflet-container"+(Fe.touch?" leaflet-touch":"")+(Fe.retina?" leaflet-retina":"")+(Fe.ielt9?" leaflet-oldie":"")+(Fe.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var _=Wr(l,"position");_!=="absolute"&&_!=="relative"&&_!=="fixed"&&_!=="sticky"&&(l.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var l=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),$i(this._mapPane,new It(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Nt(l.markerPane,"leaflet-zoom-hide"),Nt(l.shadowPane,"leaflet-zoom-hide"))},_resetView:function(l,_,P){$i(this._mapPane,new It(0,0));var k=!this._loaded;this._loaded=!0,_=this._limitZoom(_),this.fire("viewprereset");var V=this._zoom!==_;this._moveStart(V,P)._move(l,_)._moveEnd(V),this.fire("viewreset"),k&&this.fire("load")},_moveStart:function(l,_){return l&&this.fire("zoomstart"),_||this.fire("movestart"),this},_move:function(l,_,P,k){_===void 0&&(_=this._zoom);var V=this._zoom!==_;return this._zoom=_,this._lastCenter=l,this._pixelOrigin=this._getNewPixelOrigin(l),k?P&&P.pinch&&this.fire("zoom",P):((V||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(l){return l&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return mi(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(l){$i(this._mapPane,this._getMapPanePos().subtract(l))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(l){this._targets={},this._targets[F(this._container)]=this;var _=l?pt:Tt;_(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&_(window,"resize",this._onResize,this),Fe.any3d&&this.options.transform3DLimit&&(l?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){mi(this._resizeRequest),this._resizeRequest=ei(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var l=this._getMapPanePos();Math.max(Math.abs(l.x),Math.abs(l.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(l,_){for(var P=[],k,V=_==="mouseout"||_==="mouseover",K=l.target||l.srcElement,_e=!1;K;){if(k=this._targets[F(K)],k&&(_==="click"||_==="preclick")&&this._draggableMoved(k)){_e=!0;break}if(k&&k.listens(_,!0)&&(V&&!Bn(K,l)||(P.push(k),V))||K===this._container)break;K=K.parentNode}return!P.length&&!_e&&!V&&this.listens(_,!0)&&(P=[this]),P},_isClickDisabled:function(l){for(;l&&l!==this._container;){if(l._leaflet_disable_click)return!0;l=l.parentNode}},_handleDOMEvent:function(l){var _=l.target||l.srcElement;if(!(!this._loaded||_._leaflet_disable_events||l.type==="click"&&this._isClickDisabled(_))){var P=l.type;P==="mousedown"&&Ft(_),this._fireDOMEvent(l,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(l,_,P){if(l.type==="click"){var k=S({},l);k.type="preclick",this._fireDOMEvent(k,k.type,P)}var V=this._findEventTargets(l,_);if(P){for(var K=[],_e=0;_e<P.length;_e++)P[_e].listens(_,!0)&&K.push(P[_e]);V=K.concat(V)}if(V.length){_==="contextmenu"&&Xt(l);var Ae=V[0],Ne={originalEvent:l};if(l.type!=="keypress"&&l.type!=="keydown"&&l.type!=="keyup"){var Qe=Ae.getLatLng&&(!Ae._radius||Ae._radius<=10);Ne.containerPoint=Qe?this.latLngToContainerPoint(Ae.getLatLng()):this.mouseEventToContainerPoint(l),Ne.layerPoint=this.containerPointToLayerPoint(Ne.containerPoint),Ne.latlng=Qe?Ae.getLatLng():this.layerPointToLatLng(Ne.layerPoint)}for(_e=0;_e<V.length;_e++)if(V[_e].fire(_,Ne,!0),Ne.originalEvent._stopped||V[_e].options.bubblingMouseEvents===!1&&Ue(this._mouseEvents,_)!==-1)return}},_draggableMoved:function(l){return l=l.dragging&&l.dragging.enabled()?l:this,l.dragging&&l.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var l=0,_=this._handlers.length;l<_;l++)this._handlers[l].disable()},whenReady:function(l,_){return this._loaded?l.call(_||this,{target:this}):this.on("load",l,_),this},_getMapPanePos:function(){return sa(this._mapPane)||new It(0,0)},_moved:function(){var l=this._getMapPanePos();return l&&!l.equals([0,0])},_getTopLeftPoint:function(l,_){var P=l&&_!==void 0?this._getNewPixelOrigin(l,_):this.getPixelOrigin();return P.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(l,_){var P=this.getSize()._divideBy(2);return this.project(l,_)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(l,_,P){var k=this._getNewPixelOrigin(P,_);return this.project(l,_)._subtract(k)},_latLngBoundsToNewLayerBounds:function(l,_,P){var k=this._getNewPixelOrigin(P,_);return pr([this.project(l.getSouthWest(),_)._subtract(k),this.project(l.getNorthWest(),_)._subtract(k),this.project(l.getSouthEast(),_)._subtract(k),this.project(l.getNorthEast(),_)._subtract(k)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(l){return this.latLngToLayerPoint(l).subtract(this._getCenterLayerPoint())},_limitCenter:function(l,_,P){if(!P)return l;var k=this.project(l,_),V=this.getSize().divideBy(2),K=new li(k.subtract(V),k.add(V)),_e=this._getBoundsOffset(K,P,_);return Math.abs(_e.x)<=1&&Math.abs(_e.y)<=1?l:this.unproject(k.add(_e),_)},_limitOffset:function(l,_){if(!_)return l;var P=this.getPixelBounds(),k=new li(P.min.add(l),P.max.add(l));return l.add(this._getBoundsOffset(k,_))},_getBoundsOffset:function(l,_,P){var k=pr(this.project(_.getNorthEast(),P),this.project(_.getSouthWest(),P)),V=k.min.subtract(l.min),K=k.max.subtract(l.max),_e=this._rebound(V.x,-K.x),Ae=this._rebound(V.y,-K.y);return new It(_e,Ae)},_rebound:function(l,_){return l+_>0?Math.round(l-_)/2:Math.max(0,Math.ceil(l))-Math.max(0,Math.floor(_))},_limitZoom:function(l){var _=this.getMinZoom(),P=this.getMaxZoom(),k=Fe.any3d?this.options.zoomSnap:1;return k&&(l=Math.round(l/k)*k),Math.max(_,Math.min(P,l))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Gi(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(l,_){var P=this._getCenterOffset(l)._trunc();return(_&&_.animate)!==!0&&!this.getSize().contains(P)?!1:(this.panBy(P,_),!0)},_createAnimProxy:function(){var l=this._proxy=ri("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(l),this.on("zoomanim",function(_){var P=Ba,k=this._proxy.style[P];ho(this._proxy,this.project(_.center,_.zoom),this.getZoomScale(_.zoom,1)),k===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){gi(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var l=this.getCenter(),_=this.getZoom();ho(this._proxy,this.project(l,_),this.getZoomScale(_,1))},_catchTransitionEnd:function(l){this._animatingZoom&&l.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(l,_,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||P.animate===!1||this._nothingToAnimate()||Math.abs(_-this._zoom)>this.options.zoomAnimationThreshold)return!1;var k=this.getZoomScale(_),V=this._getCenterOffset(l)._divideBy(1-1/k);return P.animate!==!0&&!this.getSize().contains(V)?!1:(ei(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(l,_,!0)},this),!0)},_animateZoom:function(l,_,P,k){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=l,this._animateToZoom=_,Nt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:l,zoom:_,noUpdate:k}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(b(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Gi(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ti(l,_){return new $t(l,_)}var Rr=Pr.extend({options:{position:"topright"},initialize:function(l){be(this,l)},getPosition:function(){return this.options.position},setPosition:function(l){var _=this._map;return _&&_.removeControl(this),this.options.position=l,_&&_.addControl(this),this},getContainer:function(){return this._container},addTo:function(l){this.remove(),this._map=l;var _=this._container=this.onAdd(l),P=this.getPosition(),k=l._controlCorners[P];return Nt(_,"leaflet-control"),P.indexOf("bottom")!==-1?k.insertBefore(_,k.firstChild):k.appendChild(_),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(gi(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(l){this._map&&l&&l.screenX>0&&l.screenY>0&&this._map.getContainer().focus()}}),Zt=function(l){return new Rr(l)};$t.include({addControl:function(l){return l.addTo(this),this},removeControl:function(l){return l.remove(),this},_initControlPos:function(){var l=this._controlCorners={},_="leaflet-",P=this._controlContainer=ri("div",_+"control-container",this._container);function k(V,K){var _e=_+V+" "+_+K;l[V+K]=ri("div",_e,P)}k("top","left"),k("top","right"),k("bottom","left"),k("bottom","right")},_clearControlPos:function(){for(var l in this._controlCorners)gi(this._controlCorners[l]);gi(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Dt=Rr.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(l,_,P,k){return P<k?-1:k<P?1:0}},initialize:function(l,_,P){be(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var k in l)this._addLayer(l[k],k);for(k in _)this._addLayer(_[k],k,!0)},onAdd:function(l){this._initLayout(),this._update(),this._map=l,l.on("zoomend",this._checkDisabledLayers,this);for(var _=0;_<this._layers.length;_++)this._layers[_].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(l){return Rr.prototype.addTo.call(this,l),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(l,_){return this._addLayer(l,_),this._map?this._update():this},addOverlay:function(l,_){return this._addLayer(l,_,!0),this._map?this._update():this},removeLayer:function(l){l.off("add remove",this._onLayerChange,this);var _=this._getLayer(F(l));return _&&this._layers.splice(this._layers.indexOf(_),1),this._map?this._update():this},expand:function(){Nt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var l=this._map.getSize().y-(this._container.offsetTop+50);return l<this._section.clientHeight?(Nt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=l+"px"):Gi(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Gi(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var l="leaflet-control-layers",_=this._container=ri("div",l),P=this.options.collapsed;_.setAttribute("aria-haspopup",!0),An(_),No(_);var k=this._section=ri("section",l+"-list");P&&(this._map.on("click",this.collapse,this),Tt(_,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var V=this._layersLink=ri("a",l+"-toggle",_);V.href="#",V.title="Layers",V.setAttribute("role","button"),Tt(V,{keydown:function(K){K.keyCode===13&&this._expandSafely()},click:function(K){Xt(K),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=ri("div",l+"-base",k),this._separator=ri("div",l+"-separator",k),this._overlaysList=ri("div",l+"-overlays",k),_.appendChild(k)},_getLayer:function(l){for(var _=0;_<this._layers.length;_++)if(this._layers[_]&&F(this._layers[_].layer)===l)return this._layers[_]},_addLayer:function(l,_,P){this._map&&l.on("add remove",this._onLayerChange,this),this._layers.push({layer:l,name:_,overlay:P}),this.options.sortLayers&&this._layers.sort(b(function(k,V){return this.options.sortFunction(k.layer,V.layer,k.name,V.name)},this)),this.options.autoZIndex&&l.setZIndex&&(this._lastZIndex++,l.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;oa(this._baseLayersList),oa(this._overlaysList),this._layerControlInputs=[];var l,_,P,k,V=0;for(P=0;P<this._layers.length;P++)k=this._layers[P],this._addItem(k),_=_||k.overlay,l=l||!k.overlay,V+=k.overlay?0:1;return this.options.hideSingleBase&&(l=l&&V>1,this._baseLayersList.style.display=l?"":"none"),this._separator.style.display=_&&l?"":"none",this},_onLayerChange:function(l){this._handlingClick||this._update();var _=this._getLayer(F(l.target)),P=_.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;P&&this._map.fire(P,_)},_createRadioElement:function(l,_){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+l+'"'+(_?' checked="checked"':"")+"/>",k=document.createElement("div");return k.innerHTML=P,k.firstChild},_addItem:function(l){var _=document.createElement("label"),P=this._map.hasLayer(l.layer),k;l.overlay?(k=document.createElement("input"),k.type="checkbox",k.className="leaflet-control-layers-selector",k.defaultChecked=P):k=this._createRadioElement("leaflet-base-layers_"+F(this),P),this._layerControlInputs.push(k),k.layerId=F(l.layer),Tt(k,"click",this._onInputClick,this);var V=document.createElement("span");V.innerHTML=" "+l.name;var K=document.createElement("span");_.appendChild(K),K.appendChild(k),K.appendChild(V);var _e=l.overlay?this._overlaysList:this._baseLayersList;return _e.appendChild(_),this._checkDisabledLayers(),_},_onInputClick:function(){if(!this._preventClick){var l=this._layerControlInputs,_,P,k=[],V=[];this._handlingClick=!0;for(var K=l.length-1;K>=0;K--)_=l[K],P=this._getLayer(_.layerId).layer,_.checked?k.push(P):_.checked||V.push(P);for(K=0;K<V.length;K++)this._map.hasLayer(V[K])&&this._map.removeLayer(V[K]);for(K=0;K<k.length;K++)this._map.hasLayer(k[K])||this._map.addLayer(k[K]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var l=this._layerControlInputs,_,P,k=this._map.getZoom(),V=l.length-1;V>=0;V--)_=l[V],P=this._getLayer(_.layerId).layer,_.disabled=P.options.minZoom!==void 0&&k<P.options.minZoom||P.options.maxZoom!==void 0&&k>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var l=this._section;this._preventClick=!0,Tt(l,"click",Xt),this.expand();var _=this;setTimeout(function(){pt(l,"click",Xt),_._preventClick=!1})}}),Va=function(l,_,P){return new Dt(l,_,P)},Yt=Rr.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(l){var _="leaflet-control-zoom",P=ri("div",_+" leaflet-bar"),k=this.options;return this._zoomInButton=this._createButton(k.zoomInText,k.zoomInTitle,_+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(k.zoomOutText,k.zoomOutTitle,_+"-out",P,this._zoomOut),this._updateDisabled(),l.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(l){l.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(l){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(l.shiftKey?3:1))},_zoomOut:function(l){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(l.shiftKey?3:1))},_createButton:function(l,_,P,k,V){var K=ri("a",P,k);return K.innerHTML=l,K.href="#",K.title=_,K.setAttribute("role","button"),K.setAttribute("aria-label",_),An(K),Tt(K,"click",gn),Tt(K,"click",V,this),Tt(K,"click",this._refocusOnMap,this),K},_updateDisabled:function(){var l=this._map,_="leaflet-disabled";Gi(this._zoomInButton,_),Gi(this._zoomOutButton,_),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||l._zoom===l.getMinZoom())&&(Nt(this._zoomOutButton,_),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||l._zoom===l.getMaxZoom())&&(Nt(this._zoomInButton,_),this._zoomInButton.setAttribute("aria-disabled","true"))}});$t.mergeOptions({zoomControl:!0}),$t.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Yt,this.addControl(this.zoomControl))});var Ts=function(l){return new Yt(l)},_n=Rr.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(l){var _="leaflet-control-scale",P=ri("div",_),k=this.options;return this._addScales(k,_+"-line",P),l.on(k.updateWhenIdle?"moveend":"move",this._update,this),l.whenReady(this._update,this),P},onRemove:function(l){l.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(l,_,P){l.metric&&(this._mScale=ri("div",_,P)),l.imperial&&(this._iScale=ri("div",_,P))},_update:function(){var l=this._map,_=l.getSize().y/2,P=l.distance(l.containerPointToLatLng([0,_]),l.containerPointToLatLng([this.options.maxWidth,_]));this._updateScales(P)},_updateScales:function(l){this.options.metric&&l&&this._updateMetric(l),this.options.imperial&&l&&this._updateImperial(l)},_updateMetric:function(l){var _=this._getRoundNum(l),P=_<1e3?_+" m":_/1e3+" km";this._updateScale(this._mScale,P,_/l)},_updateImperial:function(l){var _=l*3.2808399,P,k,V;_>5280?(P=_/5280,k=this._getRoundNum(P),this._updateScale(this._iScale,k+" mi",k/P)):(V=this._getRoundNum(_),this._updateScale(this._iScale,V+" ft",V/_))},_updateScale:function(l,_,P){l.style.width=Math.round(this.options.maxWidth*P)+"px",l.innerHTML=_},_getRoundNum:function(l){var _=Math.pow(10,(Math.floor(l)+"").length-1),P=l/_;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:1,_*P}}),Ua=function(l){return new _n(l)},Vo='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',nl=Rr.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Fe.inlineSvg?Vo+" ":"")+"Leaflet</a>"},initialize:function(l){be(this,l),this._attributions={}},onAdd:function(l){l.attributionControl=this,this._container=ri("div","leaflet-control-attribution"),An(this._container);for(var _ in l._layers)l._layers[_].getAttribution&&this.addAttribution(l._layers[_].getAttribution());return this._update(),l.on("layeradd",this._addAttribution,this),this._container},onRemove:function(l){l.off("layeradd",this._addAttribution,this)},_addAttribution:function(l){l.layer.getAttribution&&(this.addAttribution(l.layer.getAttribution()),l.layer.once("remove",function(){this.removeAttribution(l.layer.getAttribution())},this))},setPrefix:function(l){return this.options.prefix=l,this._update(),this},addAttribution:function(l){return l?(this._attributions[l]||(this._attributions[l]=0),this._attributions[l]++,this._update(),this):this},removeAttribution:function(l){return l?(this._attributions[l]&&(this._attributions[l]--,this._update()),this):this},_update:function(){if(this._map){var l=[];for(var _ in this._attributions)this._attributions[_]&&l.push(_);var P=[];this.options.prefix&&P.push(this.options.prefix),l.length&&P.push(l.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});$t.mergeOptions({attributionControl:!0}),$t.addInitHook(function(){this.options.attributionControl&&new nl().addTo(this)});var Ss=function(l){return new nl(l)};Rr.Layers=Dt,Rr.Zoom=Yt,Rr.Scale=_n,Rr.Attribution=nl,Zt.layers=Va,Zt.zoom=Ts,Zt.scale=Ua,Zt.attribution=Ss;var En=Pr.extend({initialize:function(l){this._map=l},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});En.addTo=function(l,_){return l.addHandler(_,this),this};var Oc={Events:gr},Rl=Fe.touch?"touchstart mousedown":"mousedown",qi=hr.extend({options:{clickTolerance:3},initialize:function(l,_,P,k){be(this,k),this._element=l,this._dragStartTarget=_||l,this._preventOutline=P},enable:function(){this._enabled||(Tt(this._dragStartTarget,Rl,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(qi._dragging===this&&this.finishDrag(!0),pt(this._dragStartTarget,Rl,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(l){if(this._enabled&&(this._moved=!1,!el(this._element,"leaflet-zoom-anim"))){if(l.touches&&l.touches.length!==1){qi._dragging===this&&this.finishDrag();return}if(!(qi._dragging||l.shiftKey||l.which!==1&&l.button!==1&&!l.touches)&&(qi._dragging=this,this._preventOutline&&Ft(this._element),xs(),po(),!this._moving)){this.fire("down");var _=l.touches?l.touches[0]:l,P=Iu(this._element);this._startPoint=new It(_.clientX,_.clientY),this._startPos=sa(this._element),this._parentScale=bs(P);var k=l.type==="mousedown";Tt(document,k?"mousemove":"touchmove",this._onMove,this),Tt(document,k?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(l){if(this._enabled){if(l.touches&&l.touches.length>1){this._moved=!0;return}var _=l.touches&&l.touches.length===1?l.touches[0]:l,P=new It(_.clientX,_.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,Xt(l),this._moved||(this.fire("dragstart"),this._moved=!0,Nt(document.body,"leaflet-dragging"),this._lastTarget=l.target||l.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Nt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=l,this._updatePosition())}},_updatePosition:function(){var l={originalEvent:this._lastEvent};this.fire("predrag",l),$i(this._element,this._newPos),this.fire("drag",l)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(l){Gi(document.body,"leaflet-dragging"),this._lastTarget&&(Gi(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),pt(document,"mousemove touchmove",this._onMove,this),pt(document,"mouseup touchend touchcancel",this._onUp,this),la(),Bo();var _=this._moved&&this._moving;this._moving=!1,qi._dragging=!1,_&&this.fire("dragend",{noInertia:l,distance:this._newPos.distanceTo(this._startPos)})}});function On(l,_,P){var k,V=[1,4,2,8],K,_e,Ae,Ne,Qe,ft,Lt,qt;for(K=0,ft=l.length;K<ft;K++)l[K]._code=go(l[K],_);for(Ae=0;Ae<4;Ae++){for(Lt=V[Ae],k=[],K=0,ft=l.length,_e=ft-1;K<ft;_e=K++)Ne=l[K],Qe=l[_e],Ne._code&Lt?Qe._code&Lt||(qt=mo(Qe,Ne,Lt,_,P),qt._code=go(qt,_),k.push(qt)):(Qe._code&Lt&&(qt=mo(Qe,Ne,Lt,_,P),qt._code=go(qt,_),k.push(qt)),k.push(Ne));l=k}return l}function Ii(l,_){var P,k,V,K,_e,Ae,Ne,Qe,ft;if(!l||l.length===0)throw new Error("latlngs not passed");Cr(l)||(console.warn("latlngs are not flat! Only the first ring will be used"),l=l[0]);var Lt=Bt([0,0]),qt=Mi(l),dr=qt.getNorthWest().distanceTo(qt.getSouthWest())*qt.getNorthEast().distanceTo(qt.getNorthWest());dr<1700&&(Lt=fo(l));var Ji=l.length,xn=[];for(P=0;P<Ji;P++){var Yr=Bt(l[P]);xn.push(_.project(Bt([Yr.lat-Lt.lat,Yr.lng-Lt.lng])))}for(Ae=Ne=Qe=0,P=0,k=Ji-1;P<Ji;k=P++)V=xn[P],K=xn[k],_e=V.y*K.x-K.y*V.x,Ne+=(V.x+K.x)*_e,Qe+=(V.y+K.y)*_e,Ae+=_e*3;Ae===0?ft=xn[0]:ft=[Ne/Ae,Qe/Ae];var ro=_.unproject(Et(ft));return Bt([ro.lat+Lt.lat,ro.lng+Lt.lng])}function fo(l){for(var _=0,P=0,k=0,V=0;V<l.length;V++){var K=Bt(l[V]);_+=K.lat,P+=K.lng,k++}return Bt([_/k,P/k])}var Fl={__proto__:null,clipPolygon:On,polygonCenter:Ii,centroid:fo};function Za(l,_){if(!_||!l.length)return l.slice();var P=_*_;return l=Nc(l,P),l=Bl(l,P),l}function Di(l,_,P){return Math.sqrt(Qn(l,_,P,!0))}function Eu(l,_,P){return Qn(l,_,P)}function Bl(l,_){var P=l.length,k=typeof Uint8Array<"u"?Uint8Array:Array,V=new k(P);V[0]=V[P-1]=1,ol(l,V,_,0,P-1);var K,_e=[];for(K=0;K<P;K++)V[K]&&_e.push(l[K]);return _e}function ol(l,_,P,k,V){var K=0,_e,Ae,Ne;for(Ae=k+1;Ae<=V-1;Ae++)Ne=Qn(l[Ae],l[k],l[V],!0),Ne>K&&(_e=Ae,K=Ne);K>P&&(_[_e]=1,ol(l,_,P,k,_e),ol(l,_,P,_e,V))}function Nc(l,_){for(var P=[l[0]],k=1,V=0,K=l.length;k<K;k++)Ms(l[k],l[V])>_&&(P.push(l[k]),V=k);return V<K-1&&P.push(l[K-1]),P}var ua;function Ps(l,_,P,k,V){var K=k?ua:go(l,P),_e=go(_,P),Ae,Ne,Qe;for(ua=_e;;){if(!(K|_e))return[l,_];if(K&_e)return!1;Ae=K||_e,Ne=mo(l,_,Ae,P,V),Qe=go(Ne,P),Ae===K?(l=Ne,K=Qe):(_=Ne,_e=Qe)}}function mo(l,_,P,k,V){var K=_.x-l.x,_e=_.y-l.y,Ae=k.min,Ne=k.max,Qe,ft;return P&8?(Qe=l.x+K*(Ne.y-l.y)/_e,ft=Ne.y):P&4?(Qe=l.x+K*(Ae.y-l.y)/_e,ft=Ae.y):P&2?(Qe=Ne.x,ft=l.y+_e*(Ne.x-l.x)/K):P&1&&(Qe=Ae.x,ft=l.y+_e*(Ae.x-l.x)/K),new It(Qe,ft,V)}function go(l,_){var P=0;return l.x<_.min.x?P|=1:l.x>_.max.x&&(P|=2),l.y<_.min.y?P|=4:l.y>_.max.y&&(P|=8),P}function Ms(l,_){var P=_.x-l.x,k=_.y-l.y;return P*P+k*k}function Qn(l,_,P,k){var V=_.x,K=_.y,_e=P.x-V,Ae=P.y-K,Ne=_e*_e+Ae*Ae,Qe;return Ne>0&&(Qe=((l.x-V)*_e+(l.y-K)*Ae)/Ne,Qe>1?(V=P.x,K=P.y):Qe>0&&(V+=_e*Qe,K+=Ae*Qe)),_e=l.x-V,Ae=l.y-K,k?_e*_e+Ae*Ae:new It(V,K)}function Cr(l){return!Je(l[0])||typeof l[0][0]!="object"&&typeof l[0][0]<"u"}function Ki(l){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Cr(l)}function Ol(l,_){var P,k,V,K,_e,Ae,Ne,Qe;if(!l||l.length===0)throw new Error("latlngs not passed");Cr(l)||(console.warn("latlngs are not flat! Only the first ring will be used"),l=l[0]);var ft=Bt([0,0]),Lt=Mi(l),qt=Lt.getNorthWest().distanceTo(Lt.getSouthWest())*Lt.getNorthEast().distanceTo(Lt.getNorthWest());qt<1700&&(ft=fo(l));var dr=l.length,Ji=[];for(P=0;P<dr;P++){var xn=Bt(l[P]);Ji.push(_.project(Bt([xn.lat-ft.lat,xn.lng-ft.lng])))}for(P=0,k=0;P<dr-1;P++)k+=Ji[P].distanceTo(Ji[P+1])/2;if(k===0)Qe=Ji[0];else for(P=0,K=0;P<dr-1;P++)if(_e=Ji[P],Ae=Ji[P+1],V=_e.distanceTo(Ae),K+=V,K>k){Ne=(K-k)/V,Qe=[Ae.x-Ne*(Ae.x-_e.x),Ae.y-Ne*(Ae.y-_e.y)];break}var Yr=_.unproject(Et(Qe));return Bt([Yr.lat+ft.lat,Yr.lng+ft.lng])}var Ga={__proto__:null,simplify:Za,pointToSegmentDistance:Di,closestPointOnSegment:Eu,clipSegment:Ps,_getEdgeIntersection:mo,_getBitCode:go,_sqClosestPointOnSegment:Qn,isFlat:Cr,_flat:Ki,polylineCenter:Ol},ca={project:function(l){return new It(l.lng,l.lat)},unproject:function(l){return new jt(l.y,l.x)},bounds:new li([-180,-90],[180,90])},_o={R:6378137,R_MINOR:6356752314245179e-9,bounds:new li([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(l){var _=Math.PI/180,P=this.R,k=l.lat*_,V=this.R_MINOR/P,K=Math.sqrt(1-V*V),_e=K*Math.sin(k),Ae=Math.tan(Math.PI/4-k/2)/Math.pow((1-_e)/(1+_e),K/2);return k=-P*Math.log(Math.max(Ae,1e-10)),new It(l.lng*_*P,k)},unproject:function(l){for(var _=180/Math.PI,P=this.R,k=this.R_MINOR/P,V=Math.sqrt(1-k*k),K=Math.exp(-l.y/P),_e=Math.PI/2-2*Math.atan(K),Ae=0,Ne=.1,Qe;Ae<15&&Math.abs(Ne)>1e-7;Ae++)Qe=V*Math.sin(_e),Qe=Math.pow((1-Qe)/(1+Qe),V/2),Ne=Math.PI/2-2*Math.atan(K*Qe)-_e,_e+=Ne;return new jt(_e*_,l.x*_/P)}},jc={__proto__:null,LonLat:ca,Mercator:_o,SphericalMercator:dn},al=S({},Ui,{code:"EPSG:3395",projection:_o,transformation:(function(){var l=.5/(Math.PI*_o.R);return $r(l,.5,-l,.5)})()}),Cu=S({},Ui,{code:"EPSG:4326",projection:ca,transformation:$r(1/180,1,-1/180,.5)}),$a=S({},Mr,{projection:ca,transformation:$r(1,0,-1,0),scale:function(l){return Math.pow(2,l)},zoom:function(l){return Math.log(l)/Math.LN2},distance:function(l,_){var P=_.lng-l.lng,k=_.lat-l.lat;return Math.sqrt(P*P+k*k)},infinite:!0});Mr.Earth=Ui,Mr.EPSG3395=al,Mr.EPSG3857=ta,Mr.EPSG900913=yr,Mr.EPSG4326=Cu,Mr.Simple=$a;var an=hr.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(l){return l.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(l){return l&&l.removeLayer(this),this},getPane:function(l){return this._map.getPane(l?this.options[l]||l:this.options.pane)},addInteractiveTarget:function(l){return this._map._targets[F(l)]=this,this},removeInteractiveTarget:function(l){return delete this._map._targets[F(l)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(l){var _=l.target;if(_.hasLayer(this)){if(this._map=_,this._zoomAnimated=_._zoomAnimated,this.getEvents){var P=this.getEvents();_.on(P,this),this.once("remove",function(){_.off(P,this)},this)}this.onAdd(_),this.fire("add"),_.fire("layeradd",{layer:this})}}});$t.include({addLayer:function(l){if(!l._layerAdd)throw new Error("The provided object is not a Layer.");var _=F(l);return this._layers[_]?this:(this._layers[_]=l,l._mapToAdd=this,l.beforeAdd&&l.beforeAdd(this),this.whenReady(l._layerAdd,l),this)},removeLayer:function(l){var _=F(l);return this._layers[_]?(this._loaded&&l.onRemove(this),delete this._layers[_],this._loaded&&(this.fire("layerremove",{layer:l}),l.fire("remove")),l._map=l._mapToAdd=null,this):this},hasLayer:function(l){return F(l)in this._layers},eachLayer:function(l,_){for(var P in this._layers)l.call(_,this._layers[P]);return this},_addLayers:function(l){l=l?Je(l)?l:[l]:[];for(var _=0,P=l.length;_<P;_++)this.addLayer(l[_])},_addZoomLimit:function(l){(!isNaN(l.options.maxZoom)||!isNaN(l.options.minZoom))&&(this._zoomBoundLayers[F(l)]=l,this._updateZoomLevels())},_removeZoomLimit:function(l){var _=F(l);this._zoomBoundLayers[_]&&(delete this._zoomBoundLayers[_],this._updateZoomLevels())},_updateZoomLevels:function(){var l=1/0,_=-1/0,P=this._getZoomSpan();for(var k in this._zoomBoundLayers){var V=this._zoomBoundLayers[k].options;l=V.minZoom===void 0?l:Math.min(l,V.minZoom),_=V.maxZoom===void 0?_:Math.max(_,V.maxZoom)}this._layersMaxZoom=_===-1/0?void 0:_,this._layersMinZoom=l===1/0?void 0:l,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ha=an.extend({initialize:function(l,_){be(this,_),this._layers={};var P,k;if(l)for(P=0,k=l.length;P<k;P++)this.addLayer(l[P])},addLayer:function(l){var _=this.getLayerId(l);return this._layers[_]=l,this._map&&this._map.addLayer(l),this},removeLayer:function(l){var _=l in this._layers?l:this.getLayerId(l);return this._map&&this._layers[_]&&this._map.removeLayer(this._layers[_]),delete this._layers[_],this},hasLayer:function(l){var _=typeof l=="number"?l:this.getLayerId(l);return _ in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(l){var _=Array.prototype.slice.call(arguments,1),P,k;for(P in this._layers)k=this._layers[P],k[l]&&k[l].apply(k,_);return this},onAdd:function(l){this.eachLayer(l.addLayer,l)},onRemove:function(l){this.eachLayer(l.removeLayer,l)},eachLayer:function(l,_){for(var P in this._layers)l.call(_,this._layers[P]);return this},getLayer:function(l){return this._layers[l]},getLayers:function(){var l=[];return this.eachLayer(l.push,l),l},setZIndex:function(l){return this.invoke("setZIndex",l)},getLayerId:function(l){return F(l)}}),Lu=function(l,_){return new ha(l,_)},Nn=ha.extend({addLayer:function(l){return this.hasLayer(l)?this:(l.addEventParent(this),ha.prototype.addLayer.call(this,l),this.fire("layeradd",{layer:l}))},removeLayer:function(l){return this.hasLayer(l)?(l in this._layers&&(l=this._layers[l]),l.removeEventParent(this),ha.prototype.removeLayer.call(this,l),this.fire("layerremove",{layer:l})):this},setStyle:function(l){return this.invoke("setStyle",l)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var l=new _r;for(var _ in this._layers){var P=this._layers[_];l.extend(P.getBounds?P.getBounds():P.getLatLng())}return l}}),Nl=function(l,_){return new Nn(l,_)},Uo=Pr.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(l){be(this,l)},createIcon:function(l){return this._createIcon("icon",l)},createShadow:function(l){return this._createIcon("shadow",l)},_createIcon:function(l,_){var P=this._getIconUrl(l);if(!P){if(l==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var k=this._createImg(P,_&&_.tagName==="IMG"?_:null);return this._setIconStyles(k,l),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),k},_setIconStyles:function(l,_){var P=this.options,k=P[_+"Size"];typeof k=="number"&&(k=[k,k]);var V=Et(k),K=Et(_==="shadow"&&P.shadowAnchor||P.iconAnchor||V&&V.divideBy(2,!0));l.className="leaflet-marker-"+_+" "+(P.className||""),K&&(l.style.marginLeft=-K.x+"px",l.style.marginTop=-K.y+"px"),V&&(l.style.width=V.x+"px",l.style.height=V.y+"px")},_createImg:function(l,_){return _=_||document.createElement("img"),_.src=l,_},_getIconUrl:function(l){return Fe.retina&&this.options[l+"RetinaUrl"]||this.options[l+"Url"]}});function ku(l){return new Uo(l)}var qa=Uo.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(l){return typeof qa.imagePath!="string"&&(qa.imagePath=this._detectIconPath()),(this.options.imagePath||qa.imagePath)+Uo.prototype._getIconUrl.call(this,l)},_stripUrl:function(l){var _=function(P,k,V){var K=k.exec(P);return K&&K[V]};return l=_(l,/^url\((['"])?(.+)\1\)$/,2),l&&_(l,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var l=ri("div","leaflet-default-icon-path",document.body),_=Wr(l,"background-image")||Wr(l,"backgroundImage");if(document.body.removeChild(l),_=this._stripUrl(_),_)return _;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),jl=En.extend({initialize:function(l){this._marker=l},addHooks:function(){var l=this._marker._icon;this._draggable||(this._draggable=new qi(l,l,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Nt(l,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Gi(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(l){var _=this._marker,P=_._map,k=this._marker.options.autoPanSpeed,V=this._marker.options.autoPanPadding,K=sa(_._icon),_e=P.getPixelBounds(),Ae=P.getPixelOrigin(),Ne=pr(_e.min._subtract(Ae).add(V),_e.max._subtract(Ae).subtract(V));if(!Ne.contains(K)){var Qe=Et((Math.max(Ne.max.x,K.x)-Ne.max.x)/(_e.max.x-Ne.max.x)-(Math.min(Ne.min.x,K.x)-Ne.min.x)/(_e.min.x-Ne.min.x),(Math.max(Ne.max.y,K.y)-Ne.max.y)/(_e.max.y-Ne.max.y)-(Math.min(Ne.min.y,K.y)-Ne.min.y)/(_e.min.y-Ne.min.y)).multiplyBy(k);P.panBy(Qe,{animate:!1}),this._draggable._newPos._add(Qe),this._draggable._startPos._add(Qe),$i(_._icon,this._draggable._newPos),this._onDrag(l),this._panRequest=ei(this._adjustPan.bind(this,l))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(l){this._marker.options.autoPan&&(mi(this._panRequest),this._panRequest=ei(this._adjustPan.bind(this,l)))},_onDrag:function(l){var _=this._marker,P=_._shadow,k=sa(_._icon),V=_._map.layerPointToLatLng(k);P&&$i(P,k),_._latlng=V,l.latlng=V,l.oldLatLng=this._oldLatLng,_.fire("move",l).fire("drag",l)},_onDragEnd:function(l){mi(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",l)}}),eo=an.extend({options:{icon:new qa,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(l,_){be(this,_),this._latlng=Bt(l)},onAdd:function(l){this._zoomAnimated=this._zoomAnimated&&l.options.markerZoomAnimation,this._zoomAnimated&&l.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(l){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&l.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(l){var _=this._latlng;return this._latlng=Bt(l),this.update(),this.fire("move",{oldLatLng:_,latlng:this._latlng})},setZIndexOffset:function(l){return this.options.zIndexOffset=l,this.update()},getIcon:function(){return this.options.icon},setIcon:function(l){return this.options.icon=l,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var l=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(l)}return this},_initIcon:function(){var l=this.options,_="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=l.icon.createIcon(this._icon),k=!1;P!==this._icon&&(this._icon&&this._removeIcon(),k=!0,l.title&&(P.title=l.title),P.tagName==="IMG"&&(P.alt=l.alt||"")),Nt(P,_),l.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,l.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Tt(P,"focus",this._panOnFocus,this);var V=l.icon.createShadow(this._shadow),K=!1;V!==this._shadow&&(this._removeShadow(),K=!0),V&&(Nt(V,_),V.alt=""),this._shadow=V,l.opacity<1&&this._updateOpacity(),k&&this.getPane().appendChild(this._icon),this._initInteraction(),V&&K&&this.getPane(l.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&pt(this._icon,"focus",this._panOnFocus,this),gi(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&gi(this._shadow),this._shadow=null},_setPos:function(l){this._icon&&$i(this._icon,l),this._shadow&&$i(this._shadow,l),this._zIndex=l.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(l){this._icon&&(this._icon.style.zIndex=this._zIndex+l)},_animateZoom:function(l){var _=this._map._latLngToNewLayerPoint(this._latlng,l.zoom,l.center).round();this._setPos(_)},_initInteraction:function(){if(this.options.interactive&&(Nt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),jl)){var l=this.options.draggable;this.dragging&&(l=this.dragging.enabled(),this.dragging.disable()),this.dragging=new jl(this),l&&this.dragging.enable()}},setOpacity:function(l){return this.options.opacity=l,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var l=this.options.opacity;this._icon&&Hr(this._icon,l),this._shadow&&Hr(this._shadow,l)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var l=this._map;if(l){var _=this.options.icon.options,P=_.iconSize?Et(_.iconSize):Et(0,0),k=_.iconAnchor?Et(_.iconAnchor):Et(0,0);l.panInside(this._latlng,{paddingTopLeft:k,paddingBottomRight:P.subtract(k)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function zu(l,_){return new eo(l,_)}var to=an.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(l){this._renderer=l.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(l){return be(this,l),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&l&&Object.prototype.hasOwnProperty.call(l,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),yo=to.extend({options:{fill:!0,radius:10},initialize:function(l,_){be(this,_),this._latlng=Bt(l),this._radius=this.options.radius},setLatLng:function(l){var _=this._latlng;return this._latlng=Bt(l),this.redraw(),this.fire("move",{oldLatLng:_,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(l){return this.options.radius=this._radius=l,this.redraw()},getRadius:function(){return this._radius},setStyle:function(l){var _=l&&l.radius||this._radius;return to.prototype.setStyle.call(this,l),this.setRadius(_),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var l=this._radius,_=this._radiusY||l,P=this._clickTolerance(),k=[l+P,_+P];this._pxBounds=new li(this._point.subtract(k),this._point.add(k))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(l){return l.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Du(l,_){return new yo(l,_)}var Wa=yo.extend({initialize:function(l,_,P){if(typeof _=="number"&&(_=S({},P,{radius:_})),be(this,_),this._latlng=Bt(l),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(l){return this._mRadius=l,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var l=[this._radius,this._radiusY||this._radius];return new _r(this._map.layerPointToLatLng(this._point.subtract(l)),this._map.layerPointToLatLng(this._point.add(l)))},setStyle:to.prototype.setStyle,_project:function(){var l=this._latlng.lng,_=this._latlng.lat,P=this._map,k=P.options.crs;if(k.distance===Ui.distance){var V=Math.PI/180,K=this._mRadius/Ui.R/V,_e=P.project([_+K,l]),Ae=P.project([_-K,l]),Ne=_e.add(Ae).divideBy(2),Qe=P.unproject(Ne).lat,ft=Math.acos((Math.cos(K*V)-Math.sin(_*V)*Math.sin(Qe*V))/(Math.cos(_*V)*Math.cos(Qe*V)))/V;(isNaN(ft)||ft===0)&&(ft=K/Math.cos(Math.PI/180*_)),this._point=Ne.subtract(P.getPixelOrigin()),this._radius=isNaN(ft)?0:Ne.x-P.project([Qe,l-ft]).x,this._radiusY=Ne.y-_e.y}else{var Lt=k.unproject(k.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(Lt).x}this._updateBounds()}});function Vc(l,_,P){return new Wa(l,_,P)}var vo=to.extend({options:{smoothFactor:1,noClip:!1},initialize:function(l,_){be(this,_),this._setLatLngs(l)},getLatLngs:function(){return this._latlngs},setLatLngs:function(l){return this._setLatLngs(l),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(l){for(var _=1/0,P=null,k=Qn,V,K,_e=0,Ae=this._parts.length;_e<Ae;_e++)for(var Ne=this._parts[_e],Qe=1,ft=Ne.length;Qe<ft;Qe++){V=Ne[Qe-1],K=Ne[Qe];var Lt=k(l,V,K,!0);Lt<_&&(_=Lt,P=k(l,V,K))}return P&&(P.distance=Math.sqrt(_)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ol(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(l,_){return _=_||this._defaultShape(),l=Bt(l),_.push(l),this._bounds.extend(l),this.redraw()},_setLatLngs:function(l){this._bounds=new _r,this._latlngs=this._convertLatLngs(l)},_defaultShape:function(){return Cr(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(l){for(var _=[],P=Cr(l),k=0,V=l.length;k<V;k++)P?(_[k]=Bt(l[k]),this._bounds.extend(_[k])):_[k]=this._convertLatLngs(l[k]);return _},_project:function(){var l=new li;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,l),this._bounds.isValid()&&l.isValid()&&(this._rawPxBounds=l,this._updateBounds())},_updateBounds:function(){var l=this._clickTolerance(),_=new It(l,l);this._rawPxBounds&&(this._pxBounds=new li([this._rawPxBounds.min.subtract(_),this._rawPxBounds.max.add(_)]))},_projectLatlngs:function(l,_,P){var k=l[0]instanceof jt,V=l.length,K,_e;if(k){for(_e=[],K=0;K<V;K++)_e[K]=this._map.latLngToLayerPoint(l[K]),P.extend(_e[K]);_.push(_e)}else for(K=0;K<V;K++)this._projectLatlngs(l[K],_,P)},_clipPoints:function(){var l=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(l))){if(this.options.noClip){this._parts=this._rings;return}var _=this._parts,P,k,V,K,_e,Ae,Ne;for(P=0,V=0,K=this._rings.length;P<K;P++)for(Ne=this._rings[P],k=0,_e=Ne.length;k<_e-1;k++)Ae=Ps(Ne[k],Ne[k+1],l,k,!0),Ae&&(_[V]=_[V]||[],_[V].push(Ae[0]),(Ae[1]!==Ne[k+1]||k===_e-2)&&(_[V].push(Ae[1]),V++))}},_simplifyPoints:function(){for(var l=this._parts,_=this.options.smoothFactor,P=0,k=l.length;P<k;P++)l[P]=Za(l[P],_)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(l,_){var P,k,V,K,_e,Ae,Ne=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(l))return!1;for(P=0,K=this._parts.length;P<K;P++)for(Ae=this._parts[P],k=0,_e=Ae.length,V=_e-1;k<_e;V=k++)if(!(!_&&k===0)&&Di(l,Ae[V],Ae[k])<=Ne)return!0;return!1}});function Ru(l,_){return new vo(l,_)}vo._flat=Ki;var io=vo.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ii(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(l){var _=vo.prototype._convertLatLngs.call(this,l),P=_.length;return P>=2&&_[0]instanceof jt&&_[0].equals(_[P-1])&&_.pop(),_},_setLatLngs:function(l){vo.prototype._setLatLngs.call(this,l),Cr(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Cr(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var l=this._renderer._bounds,_=this.options.weight,P=new It(_,_);if(l=new li(l.min.subtract(P),l.max.add(P)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(l))){if(this.options.noClip){this._parts=this._rings;return}for(var k=0,V=this._rings.length,K;k<V;k++)K=On(this._rings[k],l,!0),K.length&&this._parts.push(K)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(l){var _=!1,P,k,V,K,_e,Ae,Ne,Qe;if(!this._pxBounds||!this._pxBounds.contains(l))return!1;for(K=0,Ne=this._parts.length;K<Ne;K++)for(P=this._parts[K],_e=0,Qe=P.length,Ae=Qe-1;_e<Qe;Ae=_e++)k=P[_e],V=P[Ae],k.y>l.y!=V.y>l.y&&l.x<(V.x-k.x)*(l.y-k.y)/(V.y-k.y)+k.x&&(_=!_);return _||vo.prototype._containsPoint.call(this,l,!0)}});function Fu(l,_){return new io(l,_)}var jn=Nn.extend({initialize:function(l,_){be(this,_),this._layers={},l&&this.addData(l)},addData:function(l){var _=Je(l)?l:l.features,P,k,V;if(_){for(P=0,k=_.length;P<k;P++)V=_[P],(V.geometries||V.geometry||V.features||V.coordinates)&&this.addData(V);return this}var K=this.options;if(K.filter&&!K.filter(l))return this;var _e=Is(l,K);return _e?(_e.feature=da(l),_e.defaultOptions=_e.options,this.resetStyle(_e),K.onEachFeature&&K.onEachFeature(l,_e),this.addLayer(_e)):this},resetStyle:function(l){return l===void 0?this.eachLayer(this.resetStyle,this):(l.options=S({},l.defaultOptions),this._setLayerStyle(l,this.options.style),this)},setStyle:function(l){return this.eachLayer(function(_){this._setLayerStyle(_,l)},this)},_setLayerStyle:function(l,_){l.setStyle&&(typeof _=="function"&&(_=_(l.feature)),l.setStyle(_))}});function Is(l,_){var P=l.type==="Feature"?l.geometry:l,k=P?P.coordinates:null,V=[],K=_&&_.pointToLayer,_e=_&&_.coordsToLatLng||yn,Ae,Ne,Qe,ft;if(!k&&!P)return null;switch(P.type){case"Point":return Ae=_e(k),As(K,l,Ae,_);case"MultiPoint":for(Qe=0,ft=k.length;Qe<ft;Qe++)Ae=_e(k[Qe]),V.push(As(K,l,Ae,_));return new Nn(V);case"LineString":case"MultiLineString":return Ne=pa(k,P.type==="LineString"?0:1,_e),new vo(Ne,_);case"Polygon":case"MultiPolygon":return Ne=pa(k,P.type==="Polygon"?1:2,_e),new io(Ne,_);case"GeometryCollection":for(Qe=0,ft=P.geometries.length;Qe<ft;Qe++){var Lt=Is({geometry:P.geometries[Qe],type:"Feature",properties:l.properties},_);Lt&&V.push(Lt)}return new Nn(V);case"FeatureCollection":for(Qe=0,ft=P.features.length;Qe<ft;Qe++){var qt=Is(P.features[Qe],_);qt&&V.push(qt)}return new Nn(V);default:throw new Error("Invalid GeoJSON object.")}}function As(l,_,P,k){return l?l(_,P):new eo(P,k&&k.markersInheritOptions&&k)}function yn(l){return new jt(l[1],l[0],l[2])}function pa(l,_,P){for(var k=[],V=0,K=l.length,_e;V<K;V++)_e=_?pa(l[V],_-1,P):(P||yn)(l[V]),k.push(_e);return k}function Es(l,_){return l=Bt(l),l.alt!==void 0?[xe(l.lng,_),xe(l.lat,_),xe(l.alt,_)]:[xe(l.lng,_),xe(l.lat,_)]}function Ha(l,_,P,k){for(var V=[],K=0,_e=l.length;K<_e;K++)V.push(_?Ha(l[K],Cr(l[K])?0:_-1,P,k):Es(l[K],k));return!_&&P&&V.length>0&&V.push(V[0].slice()),V}function Zo(l,_){return l.feature?S({},l.feature,{geometry:_}):da(_)}function da(l){return l.type==="Feature"||l.type==="FeatureCollection"?l:{type:"Feature",properties:{},geometry:l}}var xo={toGeoJSON:function(l){return Zo(this,{type:"Point",coordinates:Es(this.getLatLng(),l)})}};eo.include(xo),Wa.include(xo),yo.include(xo),vo.include({toGeoJSON:function(l){var _=!Cr(this._latlngs),P=Ha(this._latlngs,_?1:0,!1,l);return Zo(this,{type:(_?"Multi":"")+"LineString",coordinates:P})}}),io.include({toGeoJSON:function(l){var _=!Cr(this._latlngs),P=_&&!Cr(this._latlngs[0]),k=Ha(this._latlngs,P?2:_?1:0,!0,l);return _||(k=[k]),Zo(this,{type:(P?"Multi":"")+"Polygon",coordinates:k})}}),ha.include({toMultiPoint:function(l){var _=[];return this.eachLayer(function(P){_.push(P.toGeoJSON(l).geometry.coordinates)}),Zo(this,{type:"MultiPoint",coordinates:_})},toGeoJSON:function(l){var _=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(_==="MultiPoint")return this.toMultiPoint(l);var P=_==="GeometryCollection",k=[];return this.eachLayer(function(V){if(V.toGeoJSON){var K=V.toGeoJSON(l);if(P)k.push(K.geometry);else{var _e=da(K);_e.type==="FeatureCollection"?k.push.apply(k,_e.features):k.push(_e)}}}),P?Zo(this,{geometries:k,type:"GeometryCollection"}):{type:"FeatureCollection",features:k}}});function sl(l,_){return new jn(l,_)}var Uc=sl,Cs=an.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(l,_,P){this._url=l,this._bounds=Mi(_),be(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Nt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){gi(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(l){return this.options.opacity=l,this._image&&this._updateOpacity(),this},setStyle:function(l){return l.opacity&&this.setOpacity(l.opacity),this},bringToFront:function(){return this._map&&wi(this._image),this},bringToBack:function(){return this._map&&aa(this._image),this},setUrl:function(l){return this._url=l,this._image&&(this._image.src=l),this},setBounds:function(l){return this._bounds=Mi(l),this._map&&this._reset(),this},getEvents:function(){var l={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(l.zoomanim=this._animateZoom),l},setZIndex:function(l){return this.options.zIndex=l,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var l=this._url.tagName==="IMG",_=this._image=l?this._url:ri("img");if(Nt(_,"leaflet-image-layer"),this._zoomAnimated&&Nt(_,"leaflet-zoom-animated"),this.options.className&&Nt(_,this.options.className),_.onselectstart=oe,_.onmousemove=oe,_.onload=b(this.fire,this,"load"),_.onerror=b(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),l){this._url=_.src;return}_.src=this._url,_.alt=this.options.alt},_animateZoom:function(l){var _=this._map.getZoomScale(l.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,l.zoom,l.center).min;ho(this._image,P,_)},_reset:function(){var l=this._image,_=new li(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=_.getSize();$i(l,_.min),l.style.width=P.x+"px",l.style.height=P.y+"px"},_updateOpacity:function(){Hr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var l=this.options.errorOverlayUrl;l&&this._url!==l&&(this._url=l,this._image.src=l)},getCenter:function(){return this._bounds.getCenter()}}),Zc=function(l,_,P){return new Cs(l,_,P)},Bu=Cs.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var l=this._url.tagName==="VIDEO",_=this._image=l?this._url:ri("video");if(Nt(_,"leaflet-image-layer"),this._zoomAnimated&&Nt(_,"leaflet-zoom-animated"),this.options.className&&Nt(_,this.options.className),_.onselectstart=oe,_.onmousemove=oe,_.onloadeddata=b(this.fire,this,"load"),l){for(var P=_.getElementsByTagName("source"),k=[],V=0;V<P.length;V++)k.push(P[V].src);this._url=P.length>0?k:[_.src];return}Je(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(_.style,"objectFit")&&(_.style.objectFit="fill"),_.autoplay=!!this.options.autoplay,_.loop=!!this.options.loop,_.muted=!!this.options.muted,_.playsInline=!!this.options.playsInline;for(var K=0;K<this._url.length;K++){var _e=ri("source");_e.src=this._url[K],_.appendChild(_e)}}});function Ou(l,_,P){return new Bu(l,_,P)}var Nu=Cs.extend({_initImage:function(){var l=this._image=this._url;Nt(l,"leaflet-image-layer"),this._zoomAnimated&&Nt(l,"leaflet-zoom-animated"),this.options.className&&Nt(l,this.options.className),l.onselectstart=oe,l.onmousemove=oe}});function oi(l,_,P){return new Nu(l,_,P)}var vn=an.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(l,_){l&&(l instanceof jt||Je(l))?(this._latlng=Bt(l),be(this,_)):(be(this,l),this._source=_),this.options.content&&(this._content=this.options.content)},openOn:function(l){return l=arguments.length?l:this._source._map,l.hasLayer(this)||l.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(l){return this._map?this.close():(arguments.length?this._source=l:l=this._source,this._prepareOpen(),this.openOn(l._map)),this},onAdd:function(l){this._zoomAnimated=l._zoomAnimated,this._container||this._initLayout(),l._fadeAnimated&&Hr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),l._fadeAnimated&&Hr(this._container,1),this.bringToFront(),this.options.interactive&&(Nt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(l){l._fadeAnimated?(Hr(this._container,0),this._removeTimeout=setTimeout(b(gi,void 0,this._container),200)):gi(this._container),this.options.interactive&&(Gi(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(l){return this._latlng=Bt(l),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(l){return this._content=l,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var l={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(l.zoomanim=this._animateZoom),l},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&wi(this._container),this},bringToBack:function(){return this._map&&aa(this._container),this},_prepareOpen:function(l){var _=this._source;if(!_._map)return!1;if(_ instanceof Nn){_=null;var P=this._source._layers;for(var k in P)if(P[k]._map){_=P[k];break}if(!_)return!1;this._source=_}if(!l)if(_.getCenter)l=_.getCenter();else if(_.getLatLng)l=_.getLatLng();else if(_.getBounds)l=_.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(l),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var l=this._contentNode,_=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof _=="string")l.innerHTML=_;else{for(;l.hasChildNodes();)l.removeChild(l.firstChild);l.appendChild(_)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var l=this._map.latLngToLayerPoint(this._latlng),_=Et(this.options.offset),P=this._getAnchor();this._zoomAnimated?$i(this._container,l.add(P)):_=_.add(l).add(P);var k=this._containerBottom=-_.y,V=this._containerLeft=-Math.round(this._containerWidth/2)+_.x;this._container.style.bottom=k+"px",this._container.style.left=V+"px"}},_getAnchor:function(){return[0,0]}});$t.include({_initOverlay:function(l,_,P,k){var V=_;return V instanceof l||(V=new l(k).setContent(_)),P&&V.setLatLng(P),V}}),an.include({_initOverlay:function(l,_,P,k){var V=P;return V instanceof l?(be(V,k),V._source=this):(V=_&&!k?_:new l(k,this),V.setContent(P)),V}});var fa=vn.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(l){return l=arguments.length?l:this._source._map,!l.hasLayer(this)&&l._popup&&l._popup.options.autoClose&&l.removeLayer(l._popup),l._popup=this,vn.prototype.openOn.call(this,l)},onAdd:function(l){vn.prototype.onAdd.call(this,l),l.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof to||this._source.on("preclick",Yi))},onRemove:function(l){vn.prototype.onRemove.call(this,l),l.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof to||this._source.off("preclick",Yi))},getEvents:function(){var l=vn.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(l.preclick=this.close),this.options.keepInView&&(l.moveend=this._adjustPan),l},_initLayout:function(){var l="leaflet-popup",_=this._container=ri("div",l+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=ri("div",l+"-content-wrapper",_);if(this._contentNode=ri("div",l+"-content",P),An(_),No(this._contentNode),Tt(_,"contextmenu",Yi),this._tipContainer=ri("div",l+"-tip-container",_),this._tip=ri("div",l+"-tip",this._tipContainer),this.options.closeButton){var k=this._closeButton=ri("a",l+"-close-button",_);k.setAttribute("role","button"),k.setAttribute("aria-label","Close popup"),k.href="#close",k.innerHTML='<span aria-hidden="true">&#215;</span>',Tt(k,"click",function(V){Xt(V),this.close()},this)}},_updateLayout:function(){var l=this._contentNode,_=l.style;_.width="",_.whiteSpace="nowrap";var P=l.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),_.width=P+1+"px",_.whiteSpace="",_.height="";var k=l.offsetHeight,V=this.options.maxHeight,K="leaflet-popup-scrolled";V&&k>V?(_.height=V+"px",Nt(l,K)):Gi(l,K),this._containerWidth=this._container.offsetWidth},_animateZoom:function(l){var _=this._map._latLngToNewLayerPoint(this._latlng,l.zoom,l.center),P=this._getAnchor();$i(this._container,_.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var l=this._map,_=parseInt(Wr(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+_,k=this._containerWidth,V=new It(this._containerLeft,-P-this._containerBottom);V._add(sa(this._container));var K=l.layerPointToContainerPoint(V),_e=Et(this.options.autoPanPadding),Ae=Et(this.options.autoPanPaddingTopLeft||_e),Ne=Et(this.options.autoPanPaddingBottomRight||_e),Qe=l.getSize(),ft=0,Lt=0;K.x+k+Ne.x>Qe.x&&(ft=K.x+k-Qe.x+Ne.x),K.x-ft-Ae.x<0&&(ft=K.x-Ae.x),K.y+P+Ne.y>Qe.y&&(Lt=K.y+P-Qe.y+Ne.y),K.y-Lt-Ae.y<0&&(Lt=K.y-Ae.y),(ft||Lt)&&(this.options.keepInView&&(this._autopanning=!0),l.fire("autopanstart").panBy([ft,Lt]))}},_getAnchor:function(){return Et(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ll=function(l,_){return new fa(l,_)};$t.mergeOptions({closePopupOnClick:!0}),$t.include({openPopup:function(l,_,P){return this._initOverlay(fa,l,_,P).openOn(this),this},closePopup:function(l){return l=arguments.length?l:this._popup,l&&l.close(),this}}),an.include({bindPopup:function(l,_){return this._popup=this._initOverlay(fa,this._popup,l,_),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(l){return this._popup&&(this instanceof Nn||(this._popup._source=this),this._popup._prepareOpen(l||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(l){return this._popup&&this._popup.setContent(l),this},getPopup:function(){return this._popup},_openPopup:function(l){if(!(!this._popup||!this._map)){gn(l);var _=l.layer||l.target;if(this._popup._source===_&&!(_ instanceof to)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(l.latlng);return}this._popup._source=_,this.openPopup(l.latlng)}},_movePopup:function(l){this._popup.setLatLng(l.latlng)},_onKeyPress:function(l){l.originalEvent.keyCode===13&&this._openPopup(l)}});var Xa=vn.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(l){vn.prototype.onAdd.call(this,l),this.setOpacity(this.options.opacity),l.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(l){vn.prototype.onRemove.call(this,l),l.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var l=vn.prototype.getEvents.call(this);return this.options.permanent||(l.preclick=this.close),l},_initLayout:function(){var l="leaflet-tooltip",_=l+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ri("div",_),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+F(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(l){var _,P,k=this._map,V=this._container,K=k.latLngToContainerPoint(k.getCenter()),_e=k.layerPointToContainerPoint(l),Ae=this.options.direction,Ne=V.offsetWidth,Qe=V.offsetHeight,ft=Et(this.options.offset),Lt=this._getAnchor();Ae==="top"?(_=Ne/2,P=Qe):Ae==="bottom"?(_=Ne/2,P=0):Ae==="center"?(_=Ne/2,P=Qe/2):Ae==="right"?(_=0,P=Qe/2):Ae==="left"?(_=Ne,P=Qe/2):_e.x<K.x?(Ae="right",_=0,P=Qe/2):(Ae="left",_=Ne+(ft.x+Lt.x)*2,P=Qe/2),l=l.subtract(Et(_,P,!0)).add(ft).add(Lt),Gi(V,"leaflet-tooltip-right"),Gi(V,"leaflet-tooltip-left"),Gi(V,"leaflet-tooltip-top"),Gi(V,"leaflet-tooltip-bottom"),Nt(V,"leaflet-tooltip-"+Ae),$i(V,l)},_updatePosition:function(){var l=this._map.latLngToLayerPoint(this._latlng);this._setPosition(l)},setOpacity:function(l){this.options.opacity=l,this._container&&Hr(this._container,l)},_animateZoom:function(l){var _=this._map._latLngToNewLayerPoint(this._latlng,l.zoom,l.center);this._setPosition(_)},_getAnchor:function(){return Et(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ma=function(l,_){return new Xa(l,_)};$t.include({openTooltip:function(l,_,P){return this._initOverlay(Xa,l,_,P).openOn(this),this},closeTooltip:function(l){return l.close(),this}}),an.include({bindTooltip:function(l,_){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Xa,this._tooltip,l,_),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(l){if(!(!l&&this._tooltipHandlersAdded)){var _=l?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[_](P),this._tooltipHandlersAdded=!l}},openTooltip:function(l){return this._tooltip&&(this instanceof Nn||(this._tooltip._source=this),this._tooltip._prepareOpen(l)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(l){return this._tooltip&&this._tooltip.setContent(l),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(l){var _=typeof l.getElement=="function"&&l.getElement();_&&(Tt(_,"focus",function(){this._tooltip._source=l,this.openTooltip()},this),Tt(_,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(l){var _=typeof l.getElement=="function"&&l.getElement();_&&_.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(l){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var _=this;this._map.once("moveend",function(){_._openOnceFlag=!1,_._openTooltip(l)});return}this._tooltip._source=l.layer||l.target,this.openTooltip(this._tooltip.options.sticky?l.latlng:void 0)}},_moveTooltip:function(l){var _=l.latlng,P,k;this._tooltip.options.sticky&&l.originalEvent&&(P=this._map.mouseEventToContainerPoint(l.originalEvent),k=this._map.containerPointToLayerPoint(P),_=this._map.layerPointToLatLng(k)),this._tooltip.setLatLng(_)}});var Ya=Uo.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(l){var _=l&&l.tagName==="DIV"?l:document.createElement("div"),P=this.options;if(P.html instanceof Element?(oa(_),_.appendChild(P.html)):_.innerHTML=P.html!==!1?P.html:"",P.bgPos){var k=Et(P.bgPos);_.style.backgroundPosition=-k.x+"px "+-k.y+"px"}return this._setIconStyles(_,"icon"),_},createShadow:function(){return null}});function Ka(l){return new Ya(l)}Uo.Default=qa;var Fr=an.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Fe.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(l){be(this,l)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(l){l._addZoomLimit(this)},onRemove:function(l){this._removeAllTiles(),gi(this._container),l._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(wi(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(aa(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(l){return this.options.opacity=l,this._updateOpacity(),this},setZIndex:function(l){return this.options.zIndex=l,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var l=this._clampZoom(this._map.getZoom());l!==this._tileZoom&&(this._tileZoom=l,this._updateLevels()),this._update()}return this},getEvents:function(){var l={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=$(this._onMoveEnd,this.options.updateInterval,this)),l.move=this._onMove),this._zoomAnimated&&(l.zoomanim=this._animateZoom),l},createTile:function(){return document.createElement("div")},getTileSize:function(){var l=this.options.tileSize;return l instanceof It?l:new It(l,l)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(l){for(var _=this.getPane().children,P=-l(-1/0,1/0),k=0,V=_.length,K;k<V;k++)K=_[k].style.zIndex,_[k]!==this._container&&K&&(P=l(P,+K));isFinite(P)&&(this.options.zIndex=P+l(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Fe.ielt9){Hr(this._container,this.options.opacity);var l=+new Date,_=!1,P=!1;for(var k in this._tiles){var V=this._tiles[k];if(!(!V.current||!V.loaded)){var K=Math.min(1,(l-V.loaded)/200);Hr(V.el,K),K<1?_=!0:(V.active?P=!0:this._onOpaqueTile(V),V.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),_&&(mi(this._fadeFrame),this._fadeFrame=ei(this._updateOpacity,this))}},_onOpaqueTile:oe,_initContainer:function(){this._container||(this._container=ri("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var l=this._tileZoom,_=this.options.maxZoom;if(l!==void 0){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===l?(this._levels[P].el.style.zIndex=_-Math.abs(l-P),this._onUpdateLevel(P)):(gi(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var k=this._levels[l],V=this._map;return k||(k=this._levels[l]={},k.el=ri("div","leaflet-tile-container leaflet-zoom-animated",this._container),k.el.style.zIndex=_,k.origin=V.project(V.unproject(V.getPixelOrigin()),l).round(),k.zoom=l,this._setZoomTransform(k,V.getCenter(),V.getZoom()),oe(k.el.offsetWidth),this._onCreateLevel(k)),this._level=k,k}},_onUpdateLevel:oe,_onRemoveLevel:oe,_onCreateLevel:oe,_pruneTiles:function(){if(this._map){var l,_,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom){this._removeAllTiles();return}for(l in this._tiles)_=this._tiles[l],_.retain=_.current;for(l in this._tiles)if(_=this._tiles[l],_.current&&!_.active){var k=_.coords;this._retainParent(k.x,k.y,k.z,k.z-5)||this._retainChildren(k.x,k.y,k.z,k.z+2)}for(l in this._tiles)this._tiles[l].retain||this._removeTile(l)}},_removeTilesAtZoom:function(l){for(var _ in this._tiles)this._tiles[_].coords.z===l&&this._removeTile(_)},_removeAllTiles:function(){for(var l in this._tiles)this._removeTile(l)},_invalidateAll:function(){for(var l in this._levels)gi(this._levels[l].el),this._onRemoveLevel(Number(l)),delete this._levels[l];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(l,_,P,k){var V=Math.floor(l/2),K=Math.floor(_/2),_e=P-1,Ae=new It(+V,+K);Ae.z=+_e;var Ne=this._tileCoordsToKey(Ae),Qe=this._tiles[Ne];return Qe&&Qe.active?(Qe.retain=!0,!0):(Qe&&Qe.loaded&&(Qe.retain=!0),_e>k?this._retainParent(V,K,_e,k):!1)},_retainChildren:function(l,_,P,k){for(var V=2*l;V<2*l+2;V++)for(var K=2*_;K<2*_+2;K++){var _e=new It(V,K);_e.z=P+1;var Ae=this._tileCoordsToKey(_e),Ne=this._tiles[Ae];if(Ne&&Ne.active){Ne.retain=!0;continue}else Ne&&Ne.loaded&&(Ne.retain=!0);P+1<k&&this._retainChildren(V,K,P+1,k)}},_resetView:function(l){var _=l&&(l.pinch||l.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),_,_)},_animateZoom:function(l){this._setView(l.center,l.zoom,!0,l.noUpdate)},_clampZoom:function(l){var _=this.options;return _.minNativeZoom!==void 0&&l<_.minNativeZoom?_.minNativeZoom:_.maxNativeZoom!==void 0&&_.maxNativeZoom<l?_.maxNativeZoom:l},_setView:function(l,_,P,k){var V=Math.round(_);this.options.maxZoom!==void 0&&V>this.options.maxZoom||this.options.minZoom!==void 0&&V<this.options.minZoom?V=void 0:V=this._clampZoom(V);var K=this.options.updateWhenZooming&&V!==this._tileZoom;(!k||K)&&(this._tileZoom=V,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),V!==void 0&&this._update(l),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(l,_)},_setZoomTransforms:function(l,_){for(var P in this._levels)this._setZoomTransform(this._levels[P],l,_)},_setZoomTransform:function(l,_,P){var k=this._map.getZoomScale(P,l.zoom),V=l.origin.multiplyBy(k).subtract(this._map._getNewPixelOrigin(_,P)).round();Fe.any3d?ho(l.el,V,k):$i(l.el,V)},_resetGrid:function(){var l=this._map,_=l.options.crs,P=this._tileSize=this.getTileSize(),k=this._tileZoom,V=this._map.getPixelWorldBounds(this._tileZoom);V&&(this._globalTileRange=this._pxBoundsToTileRange(V)),this._wrapX=_.wrapLng&&!this.options.noWrap&&[Math.floor(l.project([0,_.wrapLng[0]],k).x/P.x),Math.ceil(l.project([0,_.wrapLng[1]],k).x/P.y)],this._wrapY=_.wrapLat&&!this.options.noWrap&&[Math.floor(l.project([_.wrapLat[0],0],k).y/P.x),Math.ceil(l.project([_.wrapLat[1],0],k).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(l){var _=this._map,P=_._animatingZoom?Math.max(_._animateToZoom,_.getZoom()):_.getZoom(),k=_.getZoomScale(P,this._tileZoom),V=_.project(l,this._tileZoom).floor(),K=_.getSize().divideBy(k*2);return new li(V.subtract(K),V.add(K))},_update:function(l){var _=this._map;if(_){var P=this._clampZoom(_.getZoom());if(l===void 0&&(l=_.getCenter()),this._tileZoom!==void 0){var k=this._getTiledPixelBounds(l),V=this._pxBoundsToTileRange(k),K=V.getCenter(),_e=[],Ae=this.options.keepBuffer,Ne=new li(V.getBottomLeft().subtract([Ae,-Ae]),V.getTopRight().add([Ae,-Ae]));if(!(isFinite(V.min.x)&&isFinite(V.min.y)&&isFinite(V.max.x)&&isFinite(V.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Qe in this._tiles){var ft=this._tiles[Qe].coords;(ft.z!==this._tileZoom||!Ne.contains(new It(ft.x,ft.y)))&&(this._tiles[Qe].current=!1)}if(Math.abs(P-this._tileZoom)>1){this._setView(l,P);return}for(var Lt=V.min.y;Lt<=V.max.y;Lt++)for(var qt=V.min.x;qt<=V.max.x;qt++){var dr=new It(qt,Lt);if(dr.z=this._tileZoom,!!this._isValidTile(dr)){var Ji=this._tiles[this._tileCoordsToKey(dr)];Ji?Ji.current=!0:_e.push(dr)}}if(_e.sort(function(Yr,ro){return Yr.distanceTo(K)-ro.distanceTo(K)}),_e.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var xn=document.createDocumentFragment();for(qt=0;qt<_e.length;qt++)this._addTile(_e[qt],xn);this._level.el.appendChild(xn)}}}},_isValidTile:function(l){var _=this._map.options.crs;if(!_.infinite){var P=this._globalTileRange;if(!_.wrapLng&&(l.x<P.min.x||l.x>P.max.x)||!_.wrapLat&&(l.y<P.min.y||l.y>P.max.y))return!1}if(!this.options.bounds)return!0;var k=this._tileCoordsToBounds(l);return Mi(this.options.bounds).overlaps(k)},_keyToBounds:function(l){return this._tileCoordsToBounds(this._keyToTileCoords(l))},_tileCoordsToNwSe:function(l){var _=this._map,P=this.getTileSize(),k=l.scaleBy(P),V=k.add(P),K=_.unproject(k,l.z),_e=_.unproject(V,l.z);return[K,_e]},_tileCoordsToBounds:function(l){var _=this._tileCoordsToNwSe(l),P=new _r(_[0],_[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(l){return l.x+":"+l.y+":"+l.z},_keyToTileCoords:function(l){var _=l.split(":"),P=new It(+_[0],+_[1]);return P.z=+_[2],P},_removeTile:function(l){var _=this._tiles[l];_&&(gi(_.el),delete this._tiles[l],this.fire("tileunload",{tile:_.el,coords:this._keyToTileCoords(l)}))},_initTile:function(l){Nt(l,"leaflet-tile");var _=this.getTileSize();l.style.width=_.x+"px",l.style.height=_.y+"px",l.onselectstart=oe,l.onmousemove=oe,Fe.ielt9&&this.options.opacity<1&&Hr(l,this.options.opacity)},_addTile:function(l,_){var P=this._getTilePos(l),k=this._tileCoordsToKey(l),V=this.createTile(this._wrapCoords(l),b(this._tileReady,this,l));this._initTile(V),this.createTile.length<2&&ei(b(this._tileReady,this,l,null,V)),$i(V,P),this._tiles[k]={el:V,coords:l,current:!0},_.appendChild(V),this.fire("tileloadstart",{tile:V,coords:l})},_tileReady:function(l,_,P){_&&this.fire("tileerror",{error:_,tile:P,coords:l});var k=this._tileCoordsToKey(l);P=this._tiles[k],P&&(P.loaded=+new Date,this._map._fadeAnimated?(Hr(P.el,0),mi(this._fadeFrame),this._fadeFrame=ei(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),_||(Nt(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:l})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Fe.ielt9||!this._map._fadeAnimated?ei(this._pruneTiles,this):setTimeout(b(this._pruneTiles,this),250)))},_getTilePos:function(l){return l.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(l){var _=new It(this._wrapX?Q(l.x,this._wrapX):l.x,this._wrapY?Q(l.y,this._wrapY):l.y);return _.z=l.z,_},_pxBoundsToTileRange:function(l){var _=this.getTileSize();return new li(l.min.unscaleBy(_).floor(),l.max.unscaleBy(_).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var l in this._tiles)if(!this._tiles[l].loaded)return!1;return!0}});function ju(l){return new Fr(l)}var ga=Fr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(l,_){this._url=l,_=be(this,_),_.detectRetina&&Fe.retina&&_.maxZoom>0?(_.tileSize=Math.floor(_.tileSize/2),_.zoomReverse?(_.zoomOffset--,_.minZoom=Math.min(_.maxZoom,_.minZoom+1)):(_.zoomOffset++,_.maxZoom=Math.max(_.minZoom,_.maxZoom-1)),_.minZoom=Math.max(0,_.minZoom)):_.zoomReverse?_.minZoom=Math.min(_.maxZoom,_.minZoom):_.maxZoom=Math.max(_.minZoom,_.maxZoom),typeof _.subdomains=="string"&&(_.subdomains=_.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(l,_){return this._url===l&&_===void 0&&(_=!0),this._url=l,_||this.redraw(),this},createTile:function(l,_){var P=document.createElement("img");return Tt(P,"load",b(this._tileOnLoad,this,_,P)),Tt(P,"error",b(this._tileOnError,this,_,P)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(P.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(l),P},getTileUrl:function(l){var _={r:Fe.retina?"@2x":"",s:this._getSubdomain(l),x:l.x,y:l.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-l.y;this.options.tms&&(_.y=P),_["-y"]=P}return Ke(this._url,S(_,this.options))},_tileOnLoad:function(l,_){Fe.ielt9?setTimeout(b(l,this,null,_),0):l(null,_)},_tileOnError:function(l,_,P){var k=this.options.errorTileUrl;k&&_.getAttribute("src")!==k&&(_.src=k),l(P,_)},_onTileRemove:function(l){l.tile.onload=null},_getZoomForUrl:function(){var l=this._tileZoom,_=this.options.maxZoom,P=this.options.zoomReverse,k=this.options.zoomOffset;return P&&(l=_-l),l+k},_getSubdomain:function(l){var _=Math.abs(l.x+l.y)%this.options.subdomains.length;return this.options.subdomains[_]},_abortLoading:function(){var l,_;for(l in this._tiles)if(this._tiles[l].coords.z!==this._tileZoom&&(_=this._tiles[l].el,_.onload=oe,_.onerror=oe,!_.complete)){_.src=ke;var P=this._tiles[l].coords;gi(_),delete this._tiles[l],this.fire("tileabort",{tile:_,coords:P})}},_removeTile:function(l){var _=this._tiles[l];if(_)return _.el.setAttribute("src",ke),Fr.prototype._removeTile.call(this,l)},_tileReady:function(l,_,P){if(!(!this._map||P&&P.getAttribute("src")===ke))return Fr.prototype._tileReady.call(this,l,_,P)}});function ul(l,_){return new ga(l,_)}var Go=ga.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(l,_){this._url=l;var P=S({},this.defaultWmsParams);for(var k in _)k in this.options||(P[k]=_[k]);_=be(this,_);var V=_.detectRetina&&Fe.retina?2:1,K=this.getTileSize();P.width=K.x*V,P.height=K.y*V,this.wmsParams=P},onAdd:function(l){this._crs=this.options.crs||l.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var _=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[_]=this._crs.code,ga.prototype.onAdd.call(this,l)},getTileUrl:function(l){var _=this._tileCoordsToNwSe(l),P=this._crs,k=pr(P.project(_[0]),P.project(_[1])),V=k.min,K=k.max,_e=(this._wmsVersion>=1.3&&this._crs===Cu?[V.y,V.x,K.y,K.x]:[V.x,V.y,K.x,K.y]).join(","),Ae=ga.prototype.getTileUrl.call(this,l);return Ae+me(this.wmsParams,Ae,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+_e},setParams:function(l,_){return S(this.wmsParams,l),_||this.redraw(),this}});function cl(l,_){return new Go(l,_)}ga.WMS=Go,ul.wms=cl;var Cn=an.extend({options:{padding:.1},initialize:function(l){be(this,l),F(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Nt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var l={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(l.zoomanim=this._onAnimZoom),l},_onAnimZoom:function(l){this._updateTransform(l.center,l.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(l,_){var P=this._map.getZoomScale(_,this._zoom),k=this._map.getSize().multiplyBy(.5+this.options.padding),V=this._map.project(this._center,_),K=k.multiplyBy(-P).add(V).subtract(this._map._getNewPixelOrigin(l,_));Fe.any3d?ho(this._container,K,P):$i(this._container,K)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var l in this._layers)this._layers[l]._reset()},_onZoomEnd:function(){for(var l in this._layers)this._layers[l]._project()},_updatePaths:function(){for(var l in this._layers)this._layers[l]._update()},_update:function(){var l=this.options.padding,_=this._map.getSize(),P=this._map.containerPointToLayerPoint(_.multiplyBy(-l)).round();this._bounds=new li(P,P.add(_.multiplyBy(1+l*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ja=Cn.extend({options:{tolerance:0},getEvents:function(){var l=Cn.prototype.getEvents.call(this);return l.viewprereset=this._onViewPreReset,l},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Cn.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var l=this._container=document.createElement("canvas");Tt(l,"mousemove",this._onMouseMove,this),Tt(l,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Tt(l,"mouseout",this._handleMouseOut,this),l._leaflet_disable_events=!0,this._ctx=l.getContext("2d")},_destroyContainer:function(){mi(this._redrawRequest),delete this._ctx,gi(this._container),pt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var l;this._redrawBounds=null;for(var _ in this._layers)l=this._layers[_],l._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Cn.prototype._update.call(this);var l=this._bounds,_=this._container,P=l.getSize(),k=Fe.retina?2:1;$i(_,l.min),_.width=k*P.x,_.height=k*P.y,_.style.width=P.x+"px",_.style.height=P.y+"px",Fe.retina&&this._ctx.scale(2,2),this._ctx.translate(-l.min.x,-l.min.y),this.fire("update")}},_reset:function(){Cn.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(l){this._updateDashArray(l),this._layers[F(l)]=l;var _=l._order={layer:l,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=_),this._drawLast=_,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(l){this._requestRedraw(l)},_removePath:function(l){var _=l._order,P=_.next,k=_.prev;P?P.prev=k:this._drawLast=k,k?k.next=P:this._drawFirst=P,delete l._order,delete this._layers[F(l)],this._requestRedraw(l)},_updatePath:function(l){this._extendRedrawBounds(l),l._project(),l._update(),this._requestRedraw(l)},_updateStyle:function(l){this._updateDashArray(l),this._requestRedraw(l)},_updateDashArray:function(l){if(typeof l.options.dashArray=="string"){var _=l.options.dashArray.split(/[, ]+/),P=[],k,V;for(V=0;V<_.length;V++){if(k=Number(_[V]),isNaN(k))return;P.push(k)}l.options._dashArray=P}else l.options._dashArray=l.options.dashArray},_requestRedraw:function(l){this._map&&(this._extendRedrawBounds(l),this._redrawRequest=this._redrawRequest||ei(this._redraw,this))},_extendRedrawBounds:function(l){if(l._pxBounds){var _=(l.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new li,this._redrawBounds.extend(l._pxBounds.min.subtract([_,_])),this._redrawBounds.extend(l._pxBounds.max.add([_,_]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var l=this._redrawBounds;if(l){var _=l.getSize();this._ctx.clearRect(l.min.x,l.min.y,_.x,_.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var l,_=this._redrawBounds;if(this._ctx.save(),_){var P=_.getSize();this._ctx.beginPath(),this._ctx.rect(_.min.x,_.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var k=this._drawFirst;k;k=k.next)l=k.layer,(!_||l._pxBounds&&l._pxBounds.intersects(_))&&l._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(l,_){if(this._drawing){var P,k,V,K,_e=l._parts,Ae=_e.length,Ne=this._ctx;if(Ae){for(Ne.beginPath(),P=0;P<Ae;P++){for(k=0,V=_e[P].length;k<V;k++)K=_e[P][k],Ne[k?"lineTo":"moveTo"](K.x,K.y);_&&Ne.closePath()}this._fillStroke(Ne,l)}}},_updateCircle:function(l){if(!(!this._drawing||l._empty())){var _=l._point,P=this._ctx,k=Math.max(Math.round(l._radius),1),V=(Math.max(Math.round(l._radiusY),1)||k)/k;V!==1&&(P.save(),P.scale(1,V)),P.beginPath(),P.arc(_.x,_.y/V,k,0,Math.PI*2,!1),V!==1&&P.restore(),this._fillStroke(P,l)}},_fillStroke:function(l,_){var P=_.options;P.fill&&(l.globalAlpha=P.fillOpacity,l.fillStyle=P.fillColor||P.color,l.fill(P.fillRule||"evenodd")),P.stroke&&P.weight!==0&&(l.setLineDash&&l.setLineDash(_.options&&_.options._dashArray||[]),l.globalAlpha=P.opacity,l.lineWidth=P.weight,l.strokeStyle=P.color,l.lineCap=P.lineCap,l.lineJoin=P.lineJoin,l.stroke())},_onClick:function(l){for(var _=this._map.mouseEventToLayerPoint(l),P,k,V=this._drawFirst;V;V=V.next)P=V.layer,P.options.interactive&&P._containsPoint(_)&&(!(l.type==="click"||l.type==="preclick")||!this._map._draggableMoved(P))&&(k=P);this._fireEvent(k?[k]:!1,l)},_onMouseMove:function(l){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var _=this._map.mouseEventToLayerPoint(l);this._handleMouseHover(l,_)}},_handleMouseOut:function(l){var _=this._hoveredLayer;_&&(Gi(this._container,"leaflet-interactive"),this._fireEvent([_],l,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(l,_){if(!this._mouseHoverThrottled){for(var P,k,V=this._drawFirst;V;V=V.next)P=V.layer,P.options.interactive&&P._containsPoint(_)&&(k=P);k!==this._hoveredLayer&&(this._handleMouseOut(l),k&&(Nt(this._container,"leaflet-interactive"),this._fireEvent([k],l,"mouseover"),this._hoveredLayer=k)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,l),this._mouseHoverThrottled=!0,setTimeout(b(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(l,_,P){this._map._fireDOMEvent(_,P||_.type,l)},_bringToFront:function(l){var _=l._order;if(_){var P=_.next,k=_.prev;if(P)P.prev=k;else return;k?k.next=P:P&&(this._drawFirst=P),_.prev=this._drawLast,this._drawLast.next=_,_.next=null,this._drawLast=_,this._requestRedraw(l)}},_bringToBack:function(l){var _=l._order;if(_){var P=_.next,k=_.prev;if(k)k.next=P;else return;P?P.prev=k:k&&(this._drawLast=k),_.prev=null,_.next=this._drawFirst,this._drawFirst.prev=_,this._drawFirst=_,this._requestRedraw(l)}}});function Ls(l){return Fe.canvas?new Ja(l):null}var Qa=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(l){return document.createElement("<lvml:"+l+' class="lvml">')}}catch{}return function(l){return document.createElement("<"+l+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),es={_initContainer:function(){this._container=ri("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Cn.prototype._update.call(this),this.fire("update"))},_initPath:function(l){var _=l._container=Qa("shape");Nt(_,"leaflet-vml-shape "+(this.options.className||"")),_.coordsize="1 1",l._path=Qa("path"),_.appendChild(l._path),this._updateStyle(l),this._layers[F(l)]=l},_addPath:function(l){var _=l._container;this._container.appendChild(_),l.options.interactive&&l.addInteractiveTarget(_)},_removePath:function(l){var _=l._container;gi(_),l.removeInteractiveTarget(_),delete this._layers[F(l)]},_updateStyle:function(l){var _=l._stroke,P=l._fill,k=l.options,V=l._container;V.stroked=!!k.stroke,V.filled=!!k.fill,k.stroke?(_||(_=l._stroke=Qa("stroke")),V.appendChild(_),_.weight=k.weight+"px",_.color=k.color,_.opacity=k.opacity,k.dashArray?_.dashStyle=Je(k.dashArray)?k.dashArray.join(" "):k.dashArray.replace(/( *, *)/g," "):_.dashStyle="",_.endcap=k.lineCap.replace("butt","flat"),_.joinstyle=k.lineJoin):_&&(V.removeChild(_),l._stroke=null),k.fill?(P||(P=l._fill=Qa("fill")),V.appendChild(P),P.color=k.fillColor||k.color,P.opacity=k.fillOpacity):P&&(V.removeChild(P),l._fill=null)},_updateCircle:function(l){var _=l._point.round(),P=Math.round(l._radius),k=Math.round(l._radiusY||P);this._setPath(l,l._empty()?"M0 0":"AL "+_.x+","+_.y+" "+P+","+k+" 0,"+65535*360)},_setPath:function(l,_){l._path.v=_},_bringToFront:function(l){wi(l._container)},_bringToBack:function(l){aa(l._container)}},bo=Fe.vml?Qa:fn,ts=Cn.extend({_initContainer:function(){this._container=bo("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=bo("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){gi(this._container),pt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Cn.prototype._update.call(this);var l=this._bounds,_=l.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(_))&&(this._svgSize=_,P.setAttribute("width",_.x),P.setAttribute("height",_.y)),$i(P,l.min),P.setAttribute("viewBox",[l.min.x,l.min.y,_.x,_.y].join(" ")),this.fire("update")}},_initPath:function(l){var _=l._path=bo("path");l.options.className&&Nt(_,l.options.className),l.options.interactive&&Nt(_,"leaflet-interactive"),this._updateStyle(l),this._layers[F(l)]=l},_addPath:function(l){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(l._path),l.addInteractiveTarget(l._path)},_removePath:function(l){gi(l._path),l.removeInteractiveTarget(l._path),delete this._layers[F(l)]},_updatePath:function(l){l._project(),l._update()},_updateStyle:function(l){var _=l._path,P=l.options;_&&(P.stroke?(_.setAttribute("stroke",P.color),_.setAttribute("stroke-opacity",P.opacity),_.setAttribute("stroke-width",P.weight),_.setAttribute("stroke-linecap",P.lineCap),_.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?_.setAttribute("stroke-dasharray",P.dashArray):_.removeAttribute("stroke-dasharray"),P.dashOffset?_.setAttribute("stroke-dashoffset",P.dashOffset):_.removeAttribute("stroke-dashoffset")):_.setAttribute("stroke","none"),P.fill?(_.setAttribute("fill",P.fillColor||P.color),_.setAttribute("fill-opacity",P.fillOpacity),_.setAttribute("fill-rule",P.fillRule||"evenodd")):_.setAttribute("fill","none"))},_updatePoly:function(l,_){this._setPath(l,zn(l._parts,_))},_updateCircle:function(l){var _=l._point,P=Math.max(Math.round(l._radius),1),k=Math.max(Math.round(l._radiusY),1)||P,V="a"+P+","+k+" 0 1,0 ",K=l._empty()?"M0 0":"M"+(_.x-P)+","+_.y+V+P*2+",0 "+V+-P*2+",0 ";this._setPath(l,K)},_setPath:function(l,_){l._path.setAttribute("d",_)},_bringToFront:function(l){wi(l._path)},_bringToBack:function(l){aa(l._path)}});Fe.vml&&ts.include(es);function hl(l){return Fe.svg||Fe.vml?new ts(l):null}$t.include({getRenderer:function(l){var _=l.options.renderer||this._getPaneRenderer(l.options.pane)||this.options.renderer||this._renderer;return _||(_=this._renderer=this._createRenderer()),this.hasLayer(_)||this.addLayer(_),_},_getPaneRenderer:function(l){if(l==="overlayPane"||l===void 0)return!1;var _=this._paneRenderers[l];return _===void 0&&(_=this._createRenderer({pane:l}),this._paneRenderers[l]=_),_},_createRenderer:function(l){return this.options.preferCanvas&&Ls(l)||hl(l)}});var Gt=io.extend({initialize:function(l,_){io.prototype.initialize.call(this,this._boundsToLatLngs(l),_)},setBounds:function(l){return this.setLatLngs(this._boundsToLatLngs(l))},_boundsToLatLngs:function(l){return l=Mi(l),[l.getSouthWest(),l.getNorthWest(),l.getNorthEast(),l.getSouthEast()]}});function pl(l,_){return new Gt(l,_)}ts.create=bo,ts.pointsToPath=zn,jn.geometryToLayer=Is,jn.coordsToLatLng=yn,jn.coordsToLatLngs=pa,jn.latLngToCoords=Es,jn.latLngsToCoords=Ha,jn.getFeature=Zo,jn.asFeature=da,$t.mergeOptions({boxZoom:!0});var Vu=En.extend({initialize:function(l){this._map=l,this._container=l._container,this._pane=l._panes.overlayPane,this._resetStateTimeout=0,l.on("unload",this._destroy,this)},addHooks:function(){Tt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){pt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){gi(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(l){if(!l.shiftKey||l.which!==1&&l.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),po(),xs(),this._startPoint=this._map.mouseEventToContainerPoint(l),Tt(document,{contextmenu:gn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(l){this._moved||(this._moved=!0,this._box=ri("div","leaflet-zoom-box",this._container),Nt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(l);var _=new li(this._point,this._startPoint),P=_.getSize();$i(this._box,_.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(gi(this._box),Gi(this._container,"leaflet-crosshair")),Bo(),la(),pt(document,{contextmenu:gn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(l){if(!(l.which!==1&&l.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(b(this._resetState,this),0);var _=new _r(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(_).fire("boxzoomend",{boxZoomBounds:_})}},_onKeyDown:function(l){l.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});$t.addInitHook("addHandler","boxZoom",Vu),$t.mergeOptions({doubleClickZoom:!0});var Vl=En.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(l){var _=this._map,P=_.getZoom(),k=_.options.zoomDelta,V=l.originalEvent.shiftKey?P-k:P+k;_.options.doubleClickZoom==="center"?_.setZoom(V):_.setZoomAround(l.containerPoint,V)}});$t.addInitHook("addHandler","doubleClickZoom",Vl),$t.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var is=En.extend({addHooks:function(){if(!this._draggable){var l=this._map;this._draggable=new qi(l._mapPane,l._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),l.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),l.on("zoomend",this._onZoomEnd,this),l.whenReady(this._onZoomEnd,this))}Nt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Gi(this._map._container,"leaflet-grab"),Gi(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var l=this._map;if(l._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var _=Mi(this._map.options.maxBounds);this._offsetLimit=pr(this._map.latLngToContainerPoint(_.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(_.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;l.fire("movestart").fire("dragstart"),l.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(l){if(this._map.options.inertia){var _=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(_),this._prunePositions(_)}this._map.fire("move",l).fire("drag",l)},_prunePositions:function(l){for(;this._positions.length>1&&l-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var l=this._map.getSize().divideBy(2),_=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=_.subtract(l).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(l,_){return l-(l-_)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var l=this._draggable._newPos.subtract(this._draggable._startPos),_=this._offsetLimit;l.x<_.min.x&&(l.x=this._viscousLimit(l.x,_.min.x)),l.y<_.min.y&&(l.y=this._viscousLimit(l.y,_.min.y)),l.x>_.max.x&&(l.x=this._viscousLimit(l.x,_.max.x)),l.y>_.max.y&&(l.y=this._viscousLimit(l.y,_.max.y)),this._draggable._newPos=this._draggable._startPos.add(l)}},_onPreDragWrap:function(){var l=this._worldWidth,_=Math.round(l/2),P=this._initialWorldOffset,k=this._draggable._newPos.x,V=(k-_+P)%l+_-P,K=(k+_+P)%l-_-P,_e=Math.abs(V+P)<Math.abs(K+P)?V:K;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=_e},_onDragEnd:function(l){var _=this._map,P=_.options,k=!P.inertia||l.noInertia||this._times.length<2;if(_.fire("dragend",l),k)_.fire("moveend");else{this._prunePositions(+new Date);var V=this._lastPos.subtract(this._positions[0]),K=(this._lastTime-this._times[0])/1e3,_e=P.easeLinearity,Ae=V.multiplyBy(_e/K),Ne=Ae.distanceTo([0,0]),Qe=Math.min(P.inertiaMaxSpeed,Ne),ft=Ae.multiplyBy(Qe/Ne),Lt=Qe/(P.inertiaDeceleration*_e),qt=ft.multiplyBy(-Lt/2).round();!qt.x&&!qt.y?_.fire("moveend"):(qt=_._limitOffset(qt,_.options.maxBounds),ei(function(){_.panBy(qt,{duration:Lt,easeLinearity:_e,noMoveStart:!0,animate:!0})}))}}});$t.addInitHook("addHandler","dragging",is),$t.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Uu=En.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(l){this._map=l,this._setPanDelta(l.options.keyboardPanDelta),this._setZoomDelta(l.options.zoomDelta)},addHooks:function(){var l=this._map._container;l.tabIndex<=0&&(l.tabIndex="0"),Tt(l,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),pt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var l=document.body,_=document.documentElement,P=l.scrollTop||_.scrollTop,k=l.scrollLeft||_.scrollLeft;this._map._container.focus(),window.scrollTo(k,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(l){var _=this._panKeys={},P=this.keyCodes,k,V;for(k=0,V=P.left.length;k<V;k++)_[P.left[k]]=[-1*l,0];for(k=0,V=P.right.length;k<V;k++)_[P.right[k]]=[l,0];for(k=0,V=P.down.length;k<V;k++)_[P.down[k]]=[0,l];for(k=0,V=P.up.length;k<V;k++)_[P.up[k]]=[0,-1*l]},_setZoomDelta:function(l){var _=this._zoomKeys={},P=this.keyCodes,k,V;for(k=0,V=P.zoomIn.length;k<V;k++)_[P.zoomIn[k]]=l;for(k=0,V=P.zoomOut.length;k<V;k++)_[P.zoomOut[k]]=-l},_addHooks:function(){Tt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){pt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(l){if(!(l.altKey||l.ctrlKey||l.metaKey)){var _=l.keyCode,P=this._map,k;if(_ in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(k=this._panKeys[_],l.shiftKey&&(k=Et(k).multiplyBy(3)),P.options.maxBounds&&(k=P._limitOffset(Et(k),P.options.maxBounds)),P.options.worldCopyJump){var V=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(k)));P.panTo(V)}else P.panBy(k)}else if(_ in this._zoomKeys)P.setZoom(P.getZoom()+(l.shiftKey?3:1)*this._zoomKeys[_]);else if(_===27&&P._popup&&P._popup.options.closeOnEscapeKey)P.closePopup();else return;gn(l)}}});$t.addInitHook("addHandler","keyboard",Uu),$t.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Zu=En.extend({addHooks:function(){Tt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){pt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(l){var _=jo(l),P=this._map.options.wheelDebounceTime;this._delta+=_,this._lastMousePos=this._map.mouseEventToContainerPoint(l),this._startTime||(this._startTime=+new Date);var k=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(b(this._performZoom,this),k),gn(l)},_performZoom:function(){var l=this._map,_=l.getZoom(),P=this._map.options.zoomSnap||0;l._stop();var k=this._delta/(this._map.options.wheelPxPerZoomLevel*4),V=4*Math.log(2/(1+Math.exp(-Math.abs(k))))/Math.LN2,K=P?Math.ceil(V/P)*P:V,_e=l._limitZoom(_+(this._delta>0?K:-K))-_;this._delta=0,this._startTime=null,_e&&(l.options.scrollWheelZoom==="center"?l.setZoom(_+_e):l.setZoomAround(this._lastMousePos,_+_e))}});$t.addInitHook("addHandler","scrollWheelZoom",Zu);var Gu=600;$t.mergeOptions({tapHold:Fe.touchNative&&Fe.safari&&Fe.mobile,tapTolerance:15});var $u=En.extend({addHooks:function(){Tt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){pt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(l){if(clearTimeout(this._holdTimeout),l.touches.length===1){var _=l.touches[0];this._startPos=this._newPos=new It(_.clientX,_.clientY),this._holdTimeout=setTimeout(b(function(){this._cancel(),this._isTapValid()&&(Tt(document,"touchend",Xt),Tt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",_))},this),Gu),Tt(document,"touchend touchcancel contextmenu",this._cancel,this),Tt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function l(){pt(document,"touchend",Xt),pt(document,"touchend touchcancel",l)},_cancel:function(){clearTimeout(this._holdTimeout),pt(document,"touchend touchcancel contextmenu",this._cancel,this),pt(document,"touchmove",this._onMove,this)},_onMove:function(l){var _=l.touches[0];this._newPos=new It(_.clientX,_.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(l,_){var P=new MouseEvent(l,{bubbles:!0,cancelable:!0,view:window,screenX:_.screenX,screenY:_.screenY,clientX:_.clientX,clientY:_.clientY});P._simulated=!0,_.target.dispatchEvent(P)}});$t.addInitHook("addHandler","tapHold",$u),$t.mergeOptions({touchZoom:Fe.touch,bounceAtZoomLimits:!0});var dl=En.extend({addHooks:function(){Nt(this._map._container,"leaflet-touch-zoom"),Tt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Gi(this._map._container,"leaflet-touch-zoom"),pt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(l){var _=this._map;if(!(!l.touches||l.touches.length!==2||_._animatingZoom||this._zooming)){var P=_.mouseEventToContainerPoint(l.touches[0]),k=_.mouseEventToContainerPoint(l.touches[1]);this._centerPoint=_.getSize()._divideBy(2),this._startLatLng=_.containerPointToLatLng(this._centerPoint),_.options.touchZoom!=="center"&&(this._pinchStartLatLng=_.containerPointToLatLng(P.add(k)._divideBy(2))),this._startDist=P.distanceTo(k),this._startZoom=_.getZoom(),this._moved=!1,this._zooming=!0,_._stop(),Tt(document,"touchmove",this._onTouchMove,this),Tt(document,"touchend touchcancel",this._onTouchEnd,this),Xt(l)}},_onTouchMove:function(l){if(!(!l.touches||l.touches.length!==2||!this._zooming)){var _=this._map,P=_.mouseEventToContainerPoint(l.touches[0]),k=_.mouseEventToContainerPoint(l.touches[1]),V=P.distanceTo(k)/this._startDist;if(this._zoom=_.getScaleZoom(V,this._startZoom),!_.options.bounceAtZoomLimits&&(this._zoom<_.getMinZoom()&&V<1||this._zoom>_.getMaxZoom()&&V>1)&&(this._zoom=_._limitZoom(this._zoom)),_.options.touchZoom==="center"){if(this._center=this._startLatLng,V===1)return}else{var K=P._add(k)._divideBy(2)._subtract(this._centerPoint);if(V===1&&K.x===0&&K.y===0)return;this._center=_.unproject(_.project(this._pinchStartLatLng,this._zoom).subtract(K),this._zoom)}this._moved||(_._moveStart(!0,!1),this._moved=!0),mi(this._animRequest);var _e=b(_._move,_,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ei(_e,this,!0),Xt(l)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,mi(this._animRequest),pt(document,"touchmove",this._onTouchMove,this),pt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});$t.addInitHook("addHandler","touchZoom",dl),$t.BoxZoom=Vu,$t.DoubleClickZoom=Vl,$t.Drag=is,$t.Keyboard=Uu,$t.ScrollWheelZoom=Zu,$t.TapHold=$u,$t.TouchZoom=dl,d.Bounds=li,d.Browser=Fe,d.CRS=Mr,d.Canvas=Ja,d.Circle=Wa,d.CircleMarker=yo,d.Class=Pr,d.Control=Rr,d.DivIcon=Ya,d.DivOverlay=vn,d.DomEvent=Au,d.DomUtil=nn,d.Draggable=qi,d.Evented=hr,d.FeatureGroup=Nn,d.GeoJSON=jn,d.GridLayer=Fr,d.Handler=En,d.Icon=Uo,d.ImageOverlay=Cs,d.LatLng=jt,d.LatLngBounds=_r,d.Layer=an,d.LayerGroup=ha,d.LineUtil=Ga,d.Map=$t,d.Marker=eo,d.Mixin=Oc,d.Path=to,d.Point=It,d.PolyUtil=Fl,d.Polygon=io,d.Polyline=vo,d.Popup=fa,d.PosAnimation=rl,d.Projection=jc,d.Rectangle=Gt,d.Renderer=Cn,d.SVG=ts,d.SVGOverlay=Nu,d.TileLayer=ga,d.Tooltip=Xa,d.Transformation=ea,d.Util=Gr,d.VideoOverlay=Bu,d.bind=b,d.bounds=pr,d.canvas=Ls,d.circle=Vc,d.circleMarker=Du,d.control=Zt,d.divIcon=Ka,d.extend=S,d.featureGroup=Nl,d.geoJSON=sl,d.geoJson=Uc,d.gridLayer=ju,d.icon=ku,d.imageOverlay=Zc,d.latLng=Bt,d.latLngBounds=Mi,d.layerGroup=Lu,d.map=Ti,d.marker=zu,d.point=Et,d.polygon=Fu,d.polyline=Ru,d.popup=ll,d.rectangle=pl,d.setOptions=be,d.stamp=F,d.svg=hl,d.svgOverlay=oi,d.tileLayer=ul,d.tooltip=ma,d.transformation=$r,d.version=w,d.videoOverlay=Ou;var rs=window.L;d.noConflict=function(){return window.L=rs,this},window.L=d}))})(Bh,Bh.exports)),Bh.exports}var Cv=C1();const tr=Dm(Cv),pP=A1({__proto__:null,default:tr},[Cv]);var ld={exports:{}};var L1=ld.exports,by;function k1(){return by||(by=1,(function(h,a){(function(d,w){h.exports=w()})(L1,(function(){var d={},w={};function S(b,s,F){if(w[b]=F,b==="index"){var $="var sharedModule = {}; ("+w.shared+")(sharedModule); ("+w.worker+")(sharedModule);",Q={};return w.shared(Q),w.index(d,Q),typeof window<"u"&&d.setWorkerUrl(window.URL.createObjectURL(new Blob([$],{type:"text/javascript"}))),d}}S("shared",["exports"],(function(b){function s(r,e,i,o){return new(i||(i=Promise))((function(c,f){function m(I){try{T(o.next(I))}catch(C){f(C)}}function v(I){try{T(o.throw(I))}catch(C){f(C)}}function T(I){var C;I.done?c(I.value):(C=I.value,C instanceof i?C:new i((function(D){D(C)}))).then(m,v)}T((o=o.apply(r,e||[])).next())}))}function F(r,e){this.x=r,this.y=e}function $(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Q,oe;typeof SuppressedError=="function"&&SuppressedError,F.prototype={clone(){return new F(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(r,e){const i=Math.cos(r),o=Math.sin(r),c=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:F},F.convert=function(r){if(r instanceof F)return r;if(Array.isArray(r))return new F(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new F(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};var xe=(function(){if(oe)return Q;function r(e,i,o,c){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=c}return oe=1,Q=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,c=0;c<8;c++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=f/m}var v=0,T=1;for(o=e,c=0;c<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));c++)e>f?v=o:T=o,o=.5*(T-v)+v;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Q})(),ge=$(xe);let Me,be;function me(){return Me==null&&(Me=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Me}function nt(){if(be==null&&(be=!1,me())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const c=4*o;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){be=!0;break}}}return be||!1}var Ke=1e-6,Je=typeof Float32Array<"u"?Float32Array:Array;function Ue(){var r=new Je(9);return Je!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ke(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function $e(){var r=new Je(3);return Je!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function ht(r){var e=r[0],i=r[1],o=r[2];return Math.sqrt(e*e+i*i+o*o)}function wt(r,e,i){var o=new Je(3);return o[0]=r,o[1]=e,o[2]=i,o}function Vt(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function Pt(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function ei(r,e,i){var o=e[0],c=e[1],f=e[2],m=i[0],v=i[1],T=i[2];return r[0]=c*T-f*v,r[1]=f*m-o*T,r[2]=o*v-c*m,r}var mi,Gr=ht;function Pr(r,e,i){var o=e[0],c=e[1],f=e[2],m=e[3];return r[0]=i[0]*o+i[4]*c+i[8]*f+i[12]*m,r[1]=i[1]*o+i[5]*c+i[9]*f+i[13]*m,r[2]=i[2]*o+i[6]*c+i[10]*f+i[14]*m,r[3]=i[3]*o+i[7]*c+i[11]*f+i[15]*m,r}function lo(){var r=new Je(4);return Je!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function gr(r,e,i,o){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",f=Math.PI/360;e*=f,o*=f,i*=f;var m=Math.sin(e),v=Math.cos(e),T=Math.sin(i),I=Math.cos(i),C=Math.sin(o),D=Math.cos(o);switch(c){case"xyz":r[0]=m*I*D+v*T*C,r[1]=v*T*D-m*I*C,r[2]=v*I*C+m*T*D,r[3]=v*I*D-m*T*C;break;case"xzy":r[0]=m*I*D-v*T*C,r[1]=v*T*D-m*I*C,r[2]=v*I*C+m*T*D,r[3]=v*I*D+m*T*C;break;case"yxz":r[0]=m*I*D+v*T*C,r[1]=v*T*D-m*I*C,r[2]=v*I*C-m*T*D,r[3]=v*I*D+m*T*C;break;case"yzx":r[0]=m*I*D+v*T*C,r[1]=v*T*D+m*I*C,r[2]=v*I*C-m*T*D,r[3]=v*I*D-m*T*C;break;case"zxy":r[0]=m*I*D-v*T*C,r[1]=v*T*D+m*I*C,r[2]=v*I*C+m*T*D,r[3]=v*I*D-m*T*C;break;case"zyx":r[0]=m*I*D-v*T*C,r[1]=v*T*D+m*I*C,r[2]=v*I*C-m*T*D,r[3]=v*I*D+m*T*C;break;default:throw new Error("Unknown angle order "+c)}return r}function hr(){var r=new Je(2);return Je!=Float32Array&&(r[0]=0,r[1]=0),r}function It(r,e){var i=new Je(2);return i[0]=r,i[1]=e,i}$e(),mi=new Je(4),Je!=Float32Array&&(mi[0]=0,mi[1]=0,mi[2]=0,mi[3]=0),$e(),wt(1,0,0),wt(0,1,0),lo(),lo(),Ue(),hr();const si=8192;function Et(r,e,i){return e*(si/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}function li(r,e){return(r%e+e)%e}function pr(r,e,i){return r*(1-i)+e*i}function _r(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Mi(r,e,i,o){const c=new ge(r,e,i,o);return f=>c.solve(f)}const jt=Mi(.25,.1,.25,1);function Bt(r,e,i){return Math.min(i,Math.max(e,r))}function Mr(r,e,i){const o=i-e,c=((r-e)%o+o)%o+e;return c===e?i:c}function Ui(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}let Ro=1;function dn(r,e,i){const o={};for(const c in r)o[c]=e.call(this,r[c],c,r);return o}function ea(r,e,i){const o={};for(const c in r)e.call(this,r[c],c,r)&&(o[c]=r[c]);return o}function $r(r){return Array.isArray(r)?r.map($r):typeof r=="object"&&r?dn(r,$r):r}const ta={};function yr(r){ta[r]||(typeof console<"u"&&console.warn(r),ta[r]=!0)}function fn(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function zn(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Li=null;function Dn(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const ia="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ra(r,e,i,o,c){return s(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(r,{timestamp:0});try{const m=f?.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const v=m.startsWith("BGR"),T=new Uint8ClampedArray(o*c*4);if(yield f.copyTo(T,(function(I,C,D,B,O){const U=4*Math.max(-C,0),Z=(Math.max(0,D)-D)*B*4+U,q=4*B,Y=Math.max(0,C),le=Math.max(0,D);return{rect:{x:Y,y:le,width:Math.min(I.width,C+B)-Y,height:Math.min(I.height,D+O)-le},layout:[{offset:Z,stride:q}]}})(r,e,i,o,c)),v)for(let I=0;I<T.length;I+=4){const C=T[I];T[I]=T[I+2],T[I+2]=C}return T}finally{f.close()}}))}let Xn,In;function na(r,e,i,o){return r.addEventListener(e,i,o),{unsubscribe:()=>{r.removeEventListener(e,i,o)}}}function Da(r){return r*Math.PI/180}function en(r){return r/Math.PI*180}const Pe={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},H={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},W="AbortError";class ee extends Error{constructor(e=W){super(e instanceof Error?e.message:e),this.name=W,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function fe(r){return r.name===W}const ye={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ee(r){return ye.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Se="global-dispatcher";class we extends Error{constructor(e,i,o,c){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=c}}const De=()=>zn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Xe=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=Ee(r.url);if(o)return o(r,e);if(zn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:Se},e)}if(!(/^file:/.test(i=r.url)||/^file:/.test(De())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,c){return s(this,void 0,void 0,(function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:De(),signal:c.signal});let m,v;o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{m=yield fetch(f)}catch(I){throw fe(I)?I:new we(0,I.message,o.url,new Blob)}if(!m.ok){const I=yield m.blob();throw new we(m.status,m.statusText,o.url,I)}v=o.type==="arrayBuffer"||o.type==="image"?m.arrayBuffer():o.type==="json"?m.json():m.text();const T=yield v;return c.signal.throwIfAborted(),{data:T,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}}))})(r,e);if(zn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:Se},e)}var i;return(function(o,c){return new Promise(((f,m)=>{var v;const T=new XMLHttpRequest;T.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(T.responseType="arraybuffer");for(const I in o.headers)T.setRequestHeader(I,o.headers[I]);o.type==="json"&&(T.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=o.credentials==="include",T.onerror=()=>{m(new Error(T.statusText))},T.onload=()=>{if(!c.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(o.type==="json")try{I=JSON.parse(T.response)}catch(C){return void m(C)}f({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});m(new we(T.status,T.statusText,o.url,I))}},c.signal.addEventListener("abort",(()=>{T.abort(),m(new ee(c.signal.reason))})),T.send(o.body)}))})(r,e)};function Ze(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function ut(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function _t(r,e,i){if(i&&i[r]){const o=i[r].indexOf(e);o!==-1&&i[r].splice(o,1)}}class At{constructor(e,i={}){Ui(this,i),this.type=e}}class ci extends At{constructor(e,i={}){super("error",Ui({error:e},i))}}class ti{on(e,i){return this._listeners=this._listeners||{},ut(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return _t(e,i,this._listeners),_t(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},ut(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new At(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of c)v.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of f)_t(o,v,this._oneTimeListeners),v.call(this,e);const m=this._eventedParent;m&&(Ui(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof ci&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const vi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ir(r,e){const i={};for(const o in r)o!=="ref"&&(i[o]=r[o]);return vi.forEach((o=>{o in e&&(i[o]=e[o])})),i}function Ct(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!Ct(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!Ct(r[i],e[i]))return!1;return!0}return r===e}function hi(r,e){r.push(e)}function Ar(r,e,i){hi(i,{command:"addSource",args:[r,e[r]]})}function xi(r,e,i){hi(e,{command:"removeSource",args:[r]}),i[r]=!0}function Zi(r,e,i,o){xi(r,i,o),Ar(r,e,i)}function bi(r,e,i){let o;for(o in r[i])if(Object.prototype.hasOwnProperty.call(r[i],o)&&o!=="data"&&!Ct(r[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!Ct(r[i][o],e[i][o]))return!1;return!0}function ir(r,e,i,o,c,f){r=r||{},e=e||{};for(const m in r)Object.prototype.hasOwnProperty.call(r,m)&&(Ct(r[m],e[m])||i.push({command:f,args:[o,m,e[m],c]}));for(const m in e)Object.prototype.hasOwnProperty.call(e,m)&&!Object.prototype.hasOwnProperty.call(r,m)&&(Ct(r[m],e[m])||i.push({command:f,args:[o,m,e[m],c]}))}function fs(r){return r.id}function tn(r,e){return r[e.id]=e,r}class Fe{constructor(e,i,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function zr(r,...e){for(const i of e)for(const o in i)r[o]=i[o];return r}class Dr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ms{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,c]of i)this.bindings[o]=c}concat(e){return new ms(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const mn={kind:"null"},rt={kind:"number"},Ot={kind:"string"},kt={kind:"boolean"},rn={kind:"color"},Js={kind:"projectionDefinition"},uo={kind:"object"},Rt={kind:"value"},gs={kind:"collator"},Ra={kind:"formatted"},Qs={kind:"padding"},co={kind:"colorArray"},_s={kind:"numberArray"},Fa={kind:"resolvedImage"},ys={kind:"variableAnchorOffsetCollection"};function qr(r,e){return{kind:"array",itemType:r,N:e}}function pi(r){if(r.kind==="array"){const e=pi(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Ba=[mn,rt,Ot,kt,rn,Js,Ra,uo,qr(Rt),Qs,_s,co,Fa,ys];function Yn(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Yn(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Ba)if(!Yn(i,e))return null}}return`Expected ${pi(r)} but found ${pi(e)} instead.`}function Oa(r,e){return e.some((i=>i.kind===r.kind))}function Fo(r,e){return e.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function Wr(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const ri=.96422,gi=.82521,oa=4/29,wi=6/29,aa=3*wi*wi,el=wi*wi*wi,Nt=Math.PI/180,Gi=180/Math.PI;function tl(r){return(r%=360)<0&&(r+=360),r}function vs([r,e,i,o]){let c,f;const m=Dl((.2225045*(r=Hr(r))+.7168786*(e=Hr(e))+.0606169*(i=Hr(i)))/1);r===e&&e===i?c=f=m:(c=Dl((.4360747*r+.3850649*e+.1430804*i)/ri),f=Dl((.0139322*r+.0971045*e+.7141733*i)/gi));const v=116*m-16;return[v<0?0:v,500*(c-m),200*(m-f),o]}function Hr(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Dl(r){return r>el?Math.pow(r,1/3):r/aa+oa}function Na([r,e,i,o]){let c=(r+16)/116,f=isNaN(e)?c:c+e/500,m=isNaN(i)?c:c-i/200;return c=1*$i(c),f=ri*$i(f),m=gi*$i(m),[ho(3.1338561*f-1.6168667*c-.4906146*m),ho(-.9787684*f+1.9161415*c+.033454*m),ho(.0719453*f-.2289914*c+1.4052427*m),o]}function ho(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function $i(r){return r>wi?r*r*r:aa*(r-oa)}const sa=Object.hasOwn||function(r,e){return Object.prototype.hasOwnProperty.call(r,e)};function po(r,e){return sa(r,e)?r[e]:void 0}function Bo(r){return parseInt(r.padEnd(2,r),16)/255}function il(r,e){return Kn(e?r/100:r,0,1)}function Kn(r,e,i){return Math.min(Math.max(e,r),i)}function xs(r){return!r.some(Number.isNaN)}const la={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Rn(r,e,i){return r+i*(e-r)}function Oo(r,e,i){return r.map(((o,c)=>Rn(o,e[c],i)))}class Ft{constructor(e,i,o,c=1,f=!0){this.r=e,this.g=i,this.b=o,this.a=c,f||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,i,o,c]))}static parse(e){if(e instanceof Ft)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=po(la,o);if(c){const[m,v,T]=c;return[m/255,v/255,T/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let v=1;return[Bo(o.slice(v,v+=m)),Bo(o.slice(v,v+=m)),Bo(o.slice(v,v+=m)),Bo(o.slice(v,v+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[v,T,I,C,D,B,O,U,Z,q,Y,le]=m,J=[C||" ",O||" ",q].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const te=[I,B,Z].join(""),ue=te==="%%%"?100:te===""?255:0;if(ue){const pe=[Kn(+T/ue,0,1),Kn(+D/ue,0,1),Kn(+U/ue,0,1),Y?il(+Y,le):1];if(xs(pe))return pe}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,v,T,I,C,D,B,O,U]=f,Z=[T||" ",C||" ",B].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const q=[+v,Kn(+I,0,100),Kn(+D,0,100),O?il(+O,U):1];if(xs(q))return(function([Y,le,J,te]){function ue(pe){const Ie=(pe+Y/30)%12,Ge=le*Math.min(J,1-J);return J-Ge*Math.max(-1,Math.min(Ie-3,9-Ie,1))}return Y=tl(Y),le/=100,J/=100,[ue(0),ue(8),ue(4),te]})(q)}}})(e);return i?new Ft(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:c}=this,f=c||1/0;return this.overwriteGetter("rgb",[e/f,i/f,o/f,c])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,c,f]=vs(e),m=Math.sqrt(o*o+c*c);return[Math.round(1e4*m)?tl(Math.atan2(c,o)*Gi):NaN,m,i,f]})(this.rgb))}get lab(){return this.overwriteGetter("lab",vs(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,c]=this.rgb;return`rgba(${[e,i,o].map((f=>Math.round(255*f))).join(",")},${c})`}static interpolate(e,i,o,c="rgb"){switch(c){case"rgb":{const[f,m,v,T]=Oo(e.rgb,i.rgb,o);return new Ft(f,m,v,T,!1)}case"hcl":{const[f,m,v,T]=e.hcl,[I,C,D,B]=i.hcl;let O,U;if(isNaN(f)||isNaN(I))isNaN(f)?isNaN(I)?O=NaN:(O=I,v!==1&&v!==0||(U=C)):(O=f,D!==1&&D!==0||(U=m));else{let J=I-f;I>f&&J>180?J-=360:I<f&&f-I>180&&(J+=360),O=f+o*J}const[Z,q,Y,le]=(function([J,te,ue,pe]){return J=isNaN(J)?0:J*Nt,Na([ue,Math.cos(J)*te,Math.sin(J)*te,pe])})([O,U??Rn(m,C,o),Rn(v,D,o),Rn(T,B,o)]);return new Ft(Z,q,Y,le,!1)}case"lab":{const[f,m,v,T]=Na(Oo(e.lab,i.lab,o));return new Ft(f,m,v,T,!1)}}}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);class ja{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Iu=["bottom","center","top"];class bs{constructor(e,i,o,c,f,m){this.text=e,this.image=i,this.scale=o,this.fontStack=c,this.textColor=f,this.verticalAlign=m}}class nn{constructor(e){this.sections=e}static fromString(e){return new nn([new bs(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof nn?e:nn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Tt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Tt)return e;if(typeof e=="number")return new Tt([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Tt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Tt(Oo(e.values,i.values,o))}}class ni{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ni)return e;if(typeof e=="number")return new ni([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new ni(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new ni(Oo(e.values,i.values,o))}}class pt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof pt)return e;if(typeof e=="string"){const o=Ft.parse(e);return o?new pt([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const c=Ft.parse(o);if(!c)return;i.push(c)}return new pt(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,c="rgb"){const f=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let m=0;m<e.values.length;m++)f.push(Ft.interpolate(e.values[m],i.values[m],o,c));return new pt(f)}}class _i extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Jn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Er{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Er)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],c=e[i+1];if(typeof o!="string"||!Jn.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Er(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const c=e.values,f=i.values;if(c.length!==f.length)throw new _i(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const m=[];for(let v=0;v<c.length;v+=2){if(c[v]!==f[v])throw new _i(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${c[v]}, to[${v}]: ${f[v]}`);m.push(c[v]);const[T,I]=c[v+1],[C,D]=f[v+1];m.push([Rn(T,C,o),Rn(I,D,o)])}return new Er(m)}}class Xr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Xr({name:e,available:!1}):null}}class Yi{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new Yi(e,i,o)}static parse(e){return e instanceof Yi?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Yi(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Yi(e.from,e.to,e.transition):typeof e=="string"?new Yi(e,e,1):void 0}}function No(r,e,i,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,i,o]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function An(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Yi||r instanceof Ft||r instanceof ja||r instanceof nn||r instanceof Tt||r instanceof ni||r instanceof pt||r instanceof Er||r instanceof Xr)return!0;if(Array.isArray(r)){for(const e of r)if(!An(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!An(r[e]))return!1;return!0}return!1}function Xt(r){if(r===null)return mn;if(typeof r=="string")return Ot;if(typeof r=="boolean")return kt;if(typeof r=="number")return rt;if(r instanceof Ft)return rn;if(r instanceof Yi)return Js;if(r instanceof ja)return gs;if(r instanceof nn)return Ra;if(r instanceof Tt)return Qs;if(r instanceof ni)return _s;if(r instanceof pt)return co;if(r instanceof Er)return ys;if(r instanceof Xr)return Fa;if(Array.isArray(r)){const e=r.length;let i;for(const o of r){const c=Xt(o);if(i){if(i===c)continue;i=Rt;break}i=c}return qr(i||Rt,e)}return uo}function gn(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Ft||r instanceof Yi||r instanceof nn||r instanceof Tt||r instanceof ni||r instanceof pt||r instanceof Er||r instanceof Xr?r.toString():JSON.stringify(r)}class Fn{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!An(e[1]))return i.error("invalid value");const o=e[1];let c=Xt(o);const f=i.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new Fn(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ws={string:Ot,number:rt,boolean:kt,object:uo};class on{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,c=1;const f=e[0];if(f==="array"){let v,T;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in ws)||I==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=ws[I],c++}else v=Rt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=e[2],c++}o=qr(v,T)}else{if(!ws[f])throw new Error(`Types doesn't contain name = ${f}`);o=ws[f]}const m=[];for(;c<e.length;c++){const v=i.parse(e[c],c,Rt);if(!v)return null;m.push(v)}return new on(o,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Yn(this.type,Xt(o)))return o;if(i===this.args.length-1)throw new _i(`Expected value to be of type ${pi(this.type)}, but found ${pi(Xt(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const jo={"to-boolean":kt,"to-color":rn,"to-number":rt,"to-string":Ot};class Bn{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!jo[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=jo[o],f=[];for(let m=1;m<e.length;m++){const v=i.parse(e[m],m,Rt);if(!v)return null;f.push(v)}return new Bn(c,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const c of this.args){if(i=c.evaluate(e),o=null,i instanceof Ft)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:No(i[0],i[1],i[2],i[3]),!o))return new Ft(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new _i(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const c=Tt.parse(i);if(c)return c}throw new _i(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const c=ni.parse(i);if(c)return c}throw new _i(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const c=pt.parse(i);if(c)return c}throw new _i(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const c=Er.parse(i);if(c)return c}throw new _i(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new _i(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return nn.fromString(gn(this.args[0].evaluate(e)));case"resolvedImage":return Xr.fromString(gn(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return gn(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Au=["Unknown","Point","LineString","Polygon"];class rl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Au[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Ft.parse(e),this._parseColorCache.set(e,i)),i}}class $t{constructor(e,i,o=[],c,f=new ms,m=[]){this.registry=e,this.path=o,this.key=o.map((v=>`[${v}]`)).join(""),this.scope=f,this.errors=m,this.expectedType=c,this._isConstant=i}parse(e,i,o,c,f={}){return i?this.concat(i,o,c)._parse(e,f):this._parse(e,f)}_parse(e,i){function o(c,f,m){return m==="assert"?new on(f,[c]):m==="coerce"?new Bn(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const v=this.expectedType,T=m.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||T.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(T.kind)||v.kind==="colorArray"&&["value","string","array"].includes(T.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))m=o(m,v,i.typeAnnotation||"coerce");else if(this.checkSubtype(v,T))return null}else m=o(m,v,i.typeAnnotation||"assert")}if(!(m instanceof Fn)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const v=new rl;try{m=new Fn(m.type,m.evaluate(v))}catch(T){return this.error(T.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const c=typeof e=="number"?this.path.concat(e):this.path,f=o?this.scope.concat(o):this.scope;return new $t(this.registry,this._isConstant,c,i||null,f,this.errors)}error(e,...i){const o=`${this.key}${i.map((c=>`[${c}]`)).join("")}`;this.errors.push(new Dr(o,e))}checkSubtype(e,i){const o=Yn(e,i);return o&&this.error(o),o}}class Ti{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const v=i.parse(e[f+1],f+1);if(!v)return null;o.push([m,v])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return c?new Ti(o,c):null}outputDefined(){return this.result.outputDefined()}}class Rr{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Rr(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Zt{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,rt),c=i.parse(e[2],2,qr(i.expectedType||Rt));return o&&c?new Zt(c.type.itemType,o,c):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new _i(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new _i(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new _i(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Dt{constructor(e,i){this.type=kt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Rt),c=i.parse(e[2],2,Rt);return o&&c?Oa(o.type,[kt,Ot,rt,mn,Rt])?new Dt(o,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Fo(i,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${pi(Xt(i))} instead.`);if(!Fo(o,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${pi(Xt(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Va{constructor(e,i,o){this.type=rt,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Rt),c=i.parse(e[2],2,Rt);if(!o||!c)return null;if(!Oa(o.type,[kt,Ot,rt,mn,Rt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,rt);return f?new Va(o,c,f):null}return new Va(o,c)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Fo(i,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${pi(Xt(i))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(e)),Fo(o,["string"])){const f=o.indexOf(i,c);return f===-1?-1:[...o.slice(0,f)].length}if(Fo(o,["array"]))return o.indexOf(i,c);throw new _i(`Expected second argument to be of type array or string, but found ${pi(Xt(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Yt{constructor(e,i,o,c,f,m){this.inputType=e,this.type=i,this.input=o,this.cases=c,this.outputs=f,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const f={},m=[];for(let I=2;I<e.length-1;I+=2){let C=e[I];const D=e[I+1];Array.isArray(C)||(C=[C]);const B=i.concat(I);if(C.length===0)return B.error("Expected at least one branch label.");for(const U of C){if(typeof U!="number"&&typeof U!="string")return B.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,Xt(U)))return null}else o=Xt(U);if(f[String(U)]!==void 0)return B.error("Branch labels must be unique.");f[String(U)]=m.length}const O=i.parse(D,I,c);if(!O)return null;c=c||O.type,m.push(O)}const v=i.parse(e[1],1,Rt);if(!v)return null;const T=i.parse(e[e.length-1],e.length-1,c);return T?v.type.kind!=="value"&&i.concat(1).checkSubtype(o,v.type)?null:new Yt(o,c,v,f,m,T):null}evaluate(e){const i=this.input.evaluate(e);return(Xt(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Ts{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const v=i.parse(e[m],m,kt);if(!v)return null;const T=i.parse(e[m+1],m+1,o);if(!T)return null;c.push([v,T]),o=o||T.type}const f=i.parse(e[e.length-1],e.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new Ts(o,c,f)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class _n{constructor(e,i,o,c){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Rt),c=i.parse(e[2],2,rt);if(!o||!c)return null;if(!Oa(o.type,[qr(Rt),Ot,Rt]))return i.error(`Expected first argument to be of type array or string, but found ${pi(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,rt);return f?new _n(o.type,o,c,f):null}return new _n(o.type,o,c)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let c;if(this.endIndex&&(c=this.endIndex.evaluate(e)),Fo(i,["string"]))return[...i].slice(o,c).join("");if(Fo(i,["array"]))return i.slice(o,c);throw new _i(`Expected first argument to be of type array or string, but found ${pi(Xt(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Ua(r,e){const i=r.length-1;let o,c,f=0,m=i,v=0;for(;f<=m;)if(v=Math.floor((f+m)/2),o=r[v],c=r[v+1],o<=e){if(v===i||e<c)return v;f=v+1}else{if(!(o>e))throw new _i("Input is not a number.");m=v-1}return 0}class Vo{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,f]of o)this.labels.push(c),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,rt);if(!o)return null;const c=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<e.length;m+=2){const v=m===1?-1/0:e[m],T=e[m+1],I=m,C=m+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(c.length&&c[c.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const D=i.parse(T,C,f);if(!D)return null;f=f||D.type,c.push([v,D])}return new Vo(f,o,c)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const f=i.length;return c>=i[f-1]?o[f-1].evaluate(e):o[Ua(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function nl(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ss,En,Oc=(function(){if(En)return Ss;function r(e,i,o,c){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=c}return En=1,Ss=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,c=0;c<8;c++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=f/m}var v=0,T=1;for(o=e,c=0;c<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));c++)e>f?v=o:T=o,o=.5*(T-v)+v;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Ss})(),Rl=nl(Oc);class qi{constructor(e,i,o,c,f){this.type=e,this.operator=i,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[m,v]of f)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(e,i,o,c){let f=0;if(e.name==="exponential")f=On(i,e.base,o,c);else if(e.name==="linear")f=On(i,1,o,c);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new Rl(m[0],m[1],m[2],m[3]).solve(On(i,1,o,c))}return f}static parse(e,i){let[o,c,f,...m]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const I=c[1];if(typeof I!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:I}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const I=c.slice(1);if(I.length!==4||I.some((C=>typeof C!="number"||C<0||C>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,rt),!f)return null;const v=[];let T=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==co?i.expectedType&&i.expectedType.kind!=="value"&&(T=i.expectedType):T=rn;for(let I=0;I<m.length;I+=2){const C=m[I],D=m[I+1],B=I+3,O=I+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(v.length&&v[v.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const U=i.parse(D,O,T);if(!U)return null;T=T||U.type,v.push([C,U])}return Wr(T,rt)||Wr(T,Js)||Wr(T,rn)||Wr(T,Qs)||Wr(T,_s)||Wr(T,co)||Wr(T,ys)||Wr(T,qr(rt))?new qi(T,o,c,f,v):i.error(`Type ${pi(T)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const f=i.length;if(c>=i[f-1])return o[f-1].evaluate(e);const m=Ua(i,c),v=qi.interpolationFactor(this.interpolation,c,i[m],i[m+1]),T=o[m].evaluate(e),I=o[m+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Rn(T,I,v);case"color":return Ft.interpolate(T,I,v);case"padding":return Tt.interpolate(T,I,v);case"colorArray":return pt.interpolate(T,I,v);case"numberArray":return ni.interpolate(T,I,v);case"variableAnchorOffsetCollection":return Er.interpolate(T,I,v);case"array":return Oo(T,I,v);case"projectionDefinition":return Yi.interpolate(T,I,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ft.interpolate(T,I,v,"hcl");case"colorArray":return pt.interpolate(T,I,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ft.interpolate(T,I,v,"lab");case"colorArray":return pt.interpolate(T,I,v,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function On(r,e,i,o){const c=o-i,f=r-i;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}const Ii={color:Ft.interpolate,number:Rn,padding:Tt.interpolate,numberArray:ni.interpolate,colorArray:pt.interpolate,variableAnchorOffsetCollection:Er.interpolate,array:Oo};class fo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const c=i.expectedType;c&&c.kind!=="value"&&(o=c);const f=[];for(const v of e.slice(1)){const T=i.parse(v,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!T)return null;o=o||T.type,f.push(T)}if(!o)throw new Error("No output type");const m=c&&f.some((v=>Yn(c,v.type)));return new fo(m?Rt:o,f)}evaluate(e){let i,o=null,c=0;for(const f of this.args)if(c++,o=f.evaluate(e),o&&o instanceof Xr&&!o.available&&(i||(i=o.name),o=null,c===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Fl(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Za(r,e,i,o){return o.compare(e,i)===0}function Di(r,e,i){const o=r!=="=="&&r!=="!=";return class Lv{constructor(f,m,v){this.type=kt,this.lhs=f,this.rhs=m,this.collator=v,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const v=f[0];let T=m.parse(f[1],1,Rt);if(!T)return null;if(!Fl(v,T.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${pi(T.type)}'.`);let I=m.parse(f[2],2,Rt);if(!I)return null;if(!Fl(v,I.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${pi(I.type)}'.`);if(T.type.kind!==I.type.kind&&T.type.kind!=="value"&&I.type.kind!=="value")return m.error(`Cannot compare types '${pi(T.type)}' and '${pi(I.type)}'.`);o&&(T.type.kind==="value"&&I.type.kind!=="value"?T=new on(I.type,[T]):T.type.kind!=="value"&&I.type.kind==="value"&&(I=new on(T.type,[I])));let C=null;if(f.length===4){if(T.type.kind!=="string"&&I.type.kind!=="string"&&T.type.kind!=="value"&&I.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(C=m.parse(f[3],3,gs),!C)return null}return new Lv(T,I,C)}evaluate(f){const m=this.lhs.evaluate(f),v=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const T=Xt(m),I=Xt(v);if(T.kind!==I.kind||T.kind!=="string"&&T.kind!=="number")throw new _i(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${T.kind}, ${I.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const T=Xt(m),I=Xt(v);if(T.kind!=="string"||I.kind!=="string")return e(f,m,v)}return this.collator?i(f,m,v,this.collator.evaluate(f)):e(f,m,v)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Eu=Di("==",(function(r,e,i){return e===i}),Za),Bl=Di("!=",(function(r,e,i){return e!==i}),(function(r,e,i,o){return!Za(0,e,i,o)})),ol=Di("<",(function(r,e,i){return e<i}),(function(r,e,i,o){return o.compare(e,i)<0})),Nc=Di(">",(function(r,e,i){return e>i}),(function(r,e,i,o){return o.compare(e,i)>0})),ua=Di("<=",(function(r,e,i){return e<=i}),(function(r,e,i,o){return o.compare(e,i)<=0})),Ps=Di(">=",(function(r,e,i){return e>=i}),(function(r,e,i,o){return o.compare(e,i)>=0}));class mo{constructor(e,i,o){this.type=gs,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const c=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,kt);if(!c)return null;const f=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,kt);if(!f)return null;let m=null;return o.locale&&(m=i.parse(o.locale,1,Ot),!m)?null:new mo(c,f,m)}evaluate(e){return new ja(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class go{constructor(e,i,o,c,f){this.type=Ot,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,rt);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=i.parse(c.locale,1,Ot),!f))return null;let m=null;if(c.currency&&(m=i.parse(c.currency,1,Ot),!m))return null;let v=null;if(c["min-fraction-digits"]&&(v=i.parse(c["min-fraction-digits"],1,rt),!v))return null;let T=null;return c["max-fraction-digits"]&&(T=i.parse(c["max-fraction-digits"],1,rt),!T)?null:new go(o,f,m,v,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ms{constructor(e){this.type=Ra,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const c=[];let f=!1;for(let m=1;m<=e.length-1;++m){const v=e[m];if(f&&typeof v=="object"&&!Array.isArray(v)){f=!1;let T=null;if(v["font-scale"]&&(T=i.parse(v["font-scale"],1,rt),!T))return null;let I=null;if(v["text-font"]&&(I=i.parse(v["text-font"],1,qr(Ot)),!I))return null;let C=null;if(v["text-color"]&&(C=i.parse(v["text-color"],1,rn),!C))return null;let D=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!Iu.includes(v["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(D=i.parse(v["vertical-align"],1,Ot),!D)return null}const B=c[c.length-1];B.scale=T,B.font=I,B.textColor=C,B.verticalAlign=D}else{const T=i.parse(e[m],1,Rt);if(!T)return null;const I=T.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ms(c)}evaluate(e){return new nn(this.sections.map((i=>{const o=i.content.evaluate(e);return Xt(o)===Fa?new bs("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new bs(gn(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class Qn{constructor(e){this.type=Fa,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Ot);return o?new Qn(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=Xr.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Cr{constructor(e){this.type=rt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${pi(o.type)} instead.`):new Cr(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new _i(`Expected value to be of type string or array, but found ${pi(Xt(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ki=8192;function Ol(r,e){const i=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*Ki),Math.round(o*c*Ki)]}function Ga(r,e){const i=Math.pow(2,e.z);return[(c=(r[0]/Ki+e.x)/i,360*c-180),(o=(r[1]/Ki+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function ca(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function _o(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function jc(r,e,i){const o=r[0]-e[0],c=r[1]-e[1],f=r[0]-i[0],m=r[1]-i[1];return o*m-f*c==0&&o*f<=0&&c*m<=0}function al(r,e,i,o){return(c=[o[0]-i[0],o[1]-i[1]])[0]*(f=[e[0]-r[0],e[1]-r[1]])[1]-c[1]*f[0]!=0&&!(!Nn(r,e,i,o)||!Nn(i,o,r,e));var c,f}function Cu(r,e,i){for(const o of i)for(let c=0;c<o.length-1;++c)if(al(r,e,o[c],o[c+1]))return!0;return!1}function $a(r,e,i=!1){let o=!1;for(const v of e)for(let T=0;T<v.length-1;T++){if(jc(r,v[T],v[T+1]))return i;(f=v[T])[1]>(c=r)[1]!=(m=v[T+1])[1]>c[1]&&c[0]<(m[0]-f[0])*(c[1]-f[1])/(m[1]-f[1])+f[0]&&(o=!o)}var c,f,m;return o}function an(r,e){for(const i of e)if($a(r,i))return!0;return!1}function ha(r,e){for(const i of r)if(!$a(i,e))return!1;for(let i=0;i<r.length-1;++i)if(Cu(r[i],r[i+1],e))return!1;return!0}function Lu(r,e){for(const i of e)if(ha(r,i))return!0;return!1}function Nn(r,e,i,o){const c=o[0]-i[0],f=o[1]-i[1],m=(r[0]-i[0])*f-c*(r[1]-i[1]),v=(e[0]-i[0])*f-c*(e[1]-i[1]);return m>0&&v<0||m<0&&v>0}function Nl(r,e,i){const o=[];for(let c=0;c<r.length;c++){const f=[];for(let m=0;m<r[c].length;m++){const v=Ol(r[c][m],i);ca(e,v),f.push(v)}o.push(f)}return o}function Uo(r,e,i){const o=[];for(let c=0;c<r.length;c++){const f=Nl(r[c],e,i);o.push(f)}return o}function ku(r,e,i,o){if(r[0]<i[0]||r[0]>i[2]){const c=.5*o;let f=r[0]-i[0]>c?-o:i[0]-r[0]>c?o:0;f===0&&(f=r[0]-i[2]>c?-o:i[2]-r[0]>c?o:0),r[0]+=f}ca(e,r)}function qa(r,e,i,o){const c=Math.pow(2,o.z)*Ki,f=[o.x*Ki,o.y*Ki],m=[];for(const v of r)for(const T of v){const I=[T.x+f[0],T.y+f[1]];ku(I,e,i,c),m.push(I)}return m}function jl(r,e,i,o){const c=Math.pow(2,o.z)*Ki,f=[o.x*Ki,o.y*Ki],m=[];for(const T of r){const I=[];for(const C of T){const D=[C.x+f[0],C.y+f[1]];ca(e,D),I.push(D)}m.push(I)}if(e[2]-e[0]<=c/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const T of m)for(const I of T)ku(I,e,i,c)}var v;return m}class eo{constructor(e,i){this.type=kt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(An(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const c=[];for(const f of o.features){const{type:m,coordinates:v}=f.geometry;m==="Polygon"&&c.push(v),m==="MultiPolygon"&&c.push(...v)}if(c.length)return new eo(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new eo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new eo(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(o.type==="Polygon"){const v=Nl(o.coordinates,f,m),T=qa(i.geometry(),c,f,m);if(!_o(c,f))return!1;for(const I of T)if(!$a(I,v))return!1}if(o.type==="MultiPolygon"){const v=Uo(o.coordinates,f,m),T=qa(i.geometry(),c,f,m);if(!_o(c,f))return!1;for(const I of T)if(!an(I,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(o.type==="Polygon"){const v=Nl(o.coordinates,f,m),T=jl(i.geometry(),c,f,m);if(!_o(c,f))return!1;for(const I of T)if(!ha(I,v))return!1}if(o.type==="MultiPolygon"){const v=Uo(o.coordinates,f,m),T=jl(i.geometry(),c,f,m);if(!_o(c,f))return!1;for(const I of T)if(!Lu(I,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let zu=class{constructor(r=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:e,compare:i}=this,o=e[r];for(;r>0;){const c=r-1>>1,f=e[c];if(i(o,f)>=0)break;e[r]=f,r=c}e[r]=o}_down(r){const{data:e,compare:i}=this,o=this.length>>1,c=e[r];for(;r<o;){let f=1+(r<<1);const m=f+1;if(m<this.length&&i(e[m],e[f])<0&&(f=m),i(e[f],c)>=0)break;e[r]=e[f],r=f}e[r]=c}};function to(r,e,i=0,o=r.length-1,c=Du){for(;o>i;){if(o-i>600){const T=o-i+1,I=e-i+1,C=Math.log(T),D=.5*Math.exp(2*C/3),B=.5*Math.sqrt(C*D*(T-D)/T)*(I-T/2<0?-1:1);to(r,e,Math.max(i,Math.floor(e-I*D/T+B)),Math.min(o,Math.floor(e+(T-I)*D/T+B)),c)}const f=r[e];let m=i,v=o;for(yo(r,i,e),c(r[o],f)>0&&yo(r,i,o);m<v;){for(yo(r,m,v),m++,v--;c(r[m],f)<0;)m++;for(;c(r[v],f)>0;)v--}c(r[i],f)===0?yo(r,i,v):(v++,yo(r,v,o)),v<=e&&(i=v+1),e<=v&&(o=v-1)}}function yo(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}function Du(r,e){return r<e?-1:r>e?1:0}function Wa(r,e){if(r.length<=1)return[r];const i=[];let o,c;for(const f of r){const m=vo(f);m!==0&&(f.area=Math.abs(m),c===void 0&&(c=m<0),c===m<0?(o&&i.push(o),o=[f]):o.push(f))}if(o&&i.push(o),e>1)for(let f=0;f<i.length;f++)i[f].length<=e||(to(i[f],e,1,i[f].length-1,Vc),i[f]=i[f].slice(0,e));return i}function Vc(r,e){return e.area-r.area}function vo(r){let e=0;for(let i,o,c=0,f=r.length,m=f-1;c<f;m=c++)i=r[c],o=r[m],e+=(o.x-i.x)*(i.y+o.y);return e}const Ru=1/298.257223563,io=Ru*(2-Ru),Fu=Math.PI/180;class jn{constructor(e){const i=6378.137*Fu*1e3,o=Math.cos(e*Fu),c=1/(1-io*(1-o*o)),f=Math.sqrt(c);this.kx=i*f*o,this.ky=i*f*c*(1-io)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(e,i){let o,c,f,m,v=1/0;for(let T=0;T<e.length-1;T++){let I=e[T][0],C=e[T][1],D=this.wrap(e[T+1][0]-I)*this.kx,B=(e[T+1][1]-C)*this.ky,O=0;D===0&&B===0||(O=(this.wrap(i[0]-I)*this.kx*D+(i[1]-C)*this.ky*B)/(D*D+B*B),O>1?(I=e[T+1][0],C=e[T+1][1]):O>0&&(I+=D/this.kx*O,C+=B/this.ky*O)),D=this.wrap(i[0]-I)*this.kx,B=(i[1]-C)*this.ky;const U=D*D+B*B;U<v&&(v=U,o=I,c=C,f=T,m=O)}return{point:[o,c],index:f,t:Math.max(0,Math.min(1,m))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Is(r,e){return e[0]-r[0]}function As(r){return r[1]-r[0]+1}function yn(r,e){return r[1]>=r[0]&&r[1]<e}function pa(r,e){if(r[0]>r[1])return[null,null];const i=As(r);if(e){if(i===2)return[r,null];const c=Math.floor(i/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(i===1)return[r,null];const o=Math.floor(i/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function Es(r,e){if(!yn(e,r.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)ca(i,r[o]);return i}function Ha(r){const e=[1/0,1/0,-1/0,-1/0];for(const i of r)for(const o of i)ca(e,o);return e}function Zo(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function da(r,e,i){if(!Zo(r)||!Zo(e))return NaN;let o=0,c=0;return r[2]<e[0]&&(o=e[0]-r[2]),r[0]>e[2]&&(o=r[0]-e[2]),r[1]>e[3]&&(c=r[1]-e[3]),r[3]<e[1]&&(c=e[1]-r[3]),i.distance([0,0],[o,c])}function xo(r,e,i){const o=i.pointOnLine(e,r);return i.distance(r,o.point)}function sl(r,e,i,o,c){const f=Math.min(xo(r,[i,o],c),xo(e,[i,o],c)),m=Math.min(xo(i,[r,e],c),xo(o,[r,e],c));return Math.min(f,m)}function Uc(r,e,i,o,c){if(!yn(e,r.length)||!yn(o,i.length))return 1/0;let f=1/0;for(let m=e[0];m<e[1];++m){const v=r[m],T=r[m+1];for(let I=o[0];I<o[1];++I){const C=i[I],D=i[I+1];if(al(v,T,C,D))return 0;f=Math.min(f,sl(v,T,C,D,c))}}return f}function Cs(r,e,i,o,c){if(!yn(e,r.length)||!yn(o,i.length))return NaN;let f=1/0;for(let m=e[0];m<=e[1];++m)for(let v=o[0];v<=o[1];++v)if(f=Math.min(f,c.distance(r[m],i[v])),f===0)return f;return f}function Zc(r,e,i){if($a(r,e,!0))return 0;let o=1/0;for(const c of e){const f=c[0],m=c[c.length-1];if(f!==m&&(o=Math.min(o,xo(r,[m,f],i)),o===0))return o;const v=i.pointOnLine(c,r);if(o=Math.min(o,i.distance(r,v.point)),o===0)return o}return o}function Bu(r,e,i,o){if(!yn(e,r.length))return NaN;for(let f=e[0];f<=e[1];++f)if($a(r[f],i,!0))return 0;let c=1/0;for(let f=e[0];f<e[1];++f){const m=r[f],v=r[f+1];for(const T of i)for(let I=0,C=T.length,D=C-1;I<C;D=I++){const B=T[D],O=T[I];if(al(m,v,B,O))return 0;c=Math.min(c,sl(m,v,B,O,o))}}return c}function Ou(r,e){for(const i of r)for(const o of i)if($a(o,e,!0))return!0;return!1}function Nu(r,e,i,o=1/0){const c=Ha(r),f=Ha(e);if(o!==1/0&&da(c,f,i)>=o)return o;if(_o(c,f)){if(Ou(r,e))return 0}else if(Ou(e,r))return 0;let m=1/0;for(const v of r)for(let T=0,I=v.length,C=I-1;T<I;C=T++){const D=v[C],B=v[T];for(const O of e)for(let U=0,Z=O.length,q=Z-1;U<Z;q=U++){const Y=O[q],le=O[U];if(al(D,B,Y,le))return 0;m=Math.min(m,sl(D,B,Y,le,i))}}return m}function oi(r,e,i,o,c,f){if(!f)return;const m=da(Es(o,f),c,i);m<e&&r.push([m,f,[0,0]])}function vn(r,e,i,o,c,f,m){if(!f||!m)return;const v=da(Es(o,f),Es(c,m),i);v<e&&r.push([v,f,m])}function fa(r,e,i,o,c=1/0){let f=Math.min(o.distance(r[0],i[0][0]),c);if(f===0)return f;const m=new zu([[0,[0,r.length-1],[0,0]]],Is),v=Ha(i);for(;m.length>0;){const T=m.pop();if(T[0]>=f)continue;const I=T[1],C=e?50:100;if(As(I)<=C){if(!yn(I,r.length))return NaN;if(e){const D=Bu(r,I,i,o);if(isNaN(D)||D===0)return D;f=Math.min(f,D)}else for(let D=I[0];D<=I[1];++D){const B=Zc(r[D],i,o);if(f=Math.min(f,B),f===0)return 0}}else{const D=pa(I,e);oi(m,f,o,r,v,D[0]),oi(m,f,o,r,v,D[1])}}return f}function ll(r,e,i,o,c,f=1/0){let m=Math.min(f,c.distance(r[0],i[0]));if(m===0)return m;const v=new zu([[0,[0,r.length-1],[0,i.length-1]]],Is);for(;v.length>0;){const T=v.pop();if(T[0]>=m)continue;const I=T[1],C=T[2],D=e?50:100,B=o?50:100;if(As(I)<=D&&As(C)<=B){if(!yn(I,r.length)&&yn(C,i.length))return NaN;let O;if(e&&o)O=Uc(r,I,i,C,c),m=Math.min(m,O);else if(e&&!o){const U=r.slice(I[0],I[1]+1);for(let Z=C[0];Z<=C[1];++Z)if(O=xo(i[Z],U,c),m=Math.min(m,O),m===0)return m}else if(!e&&o){const U=i.slice(C[0],C[1]+1);for(let Z=I[0];Z<=I[1];++Z)if(O=xo(r[Z],U,c),m=Math.min(m,O),m===0)return m}else O=Cs(r,I,i,C,c),m=Math.min(m,O)}else{const O=pa(I,e),U=pa(C,o);vn(v,m,c,r,i,O[0],U[0]),vn(v,m,c,r,i,O[0],U[1]),vn(v,m,c,r,i,O[1],U[0]),vn(v,m,c,r,i,O[1],U[1])}}return m}function Xa(r){return r.type==="MultiPolygon"?r.coordinates.map((e=>({type:"Polygon",coordinates:e}))):r.type==="MultiLineString"?r.coordinates.map((e=>({type:"LineString",coordinates:e}))):r.type==="MultiPoint"?r.coordinates.map((e=>({type:"Point",coordinates:e}))):[r]}class ma{constructor(e,i){this.type=rt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(An(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new ma(o,o.features.map((c=>Xa(c.geometry))).flat());if(o.type==="Feature")return new ma(o,Xa(o.geometry));if("type"in o&&"coordinates"in o)return new ma(o,Xa(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const c=i.geometry(),f=c.flat().map((T=>Ga([T.x,T.y],i.canonical)));if(c.length===0)return NaN;const m=new jn(f[0][1]);let v=1/0;for(const T of o){switch(T.type){case"Point":v=Math.min(v,ll(f,!1,[T.coordinates],!1,m,v));break;case"LineString":v=Math.min(v,ll(f,!1,T.coordinates,!0,m,v));break;case"Polygon":v=Math.min(v,fa(f,!1,T.coordinates,m,v))}if(v===0)return v}return v})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const c=i.geometry(),f=c.flat().map((T=>Ga([T.x,T.y],i.canonical)));if(c.length===0)return NaN;const m=new jn(f[0][1]);let v=1/0;for(const T of o){switch(T.type){case"Point":v=Math.min(v,ll(f,!0,[T.coordinates],!1,m,v));break;case"LineString":v=Math.min(v,ll(f,!0,T.coordinates,!0,m,v));break;case"Polygon":v=Math.min(v,fa(f,!0,T.coordinates,m,v))}if(v===0)return v}return v})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const c=i.geometry();if(c.length===0||c[0].length===0)return NaN;const f=Wa(c,0).map((T=>T.map((I=>I.map((C=>Ga([C.x,C.y],i.canonical))))))),m=new jn(f[0][0][0][1]);let v=1/0;for(const T of o)for(const I of f){switch(T.type){case"Point":v=Math.min(v,fa([T.coordinates],!1,I,m,v));break;case"LineString":v=Math.min(v,fa(T.coordinates,!0,I,m,v));break;case"Polygon":v=Math.min(v,Nu(I,T.coordinates,m,v))}if(v===0)return v}return v})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ya{constructor(e){this.type=Rt,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Ya(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?po(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Ka={"==":Eu,"!=":Bl,">":Nc,"<":ol,">=":Ps,"<=":ua,array:on,at:Zt,boolean:on,case:Ts,coalesce:fo,collator:mo,format:Ms,image:Qn,in:Dt,"index-of":Va,interpolate:qi,"interpolate-hcl":qi,"interpolate-lab":qi,length:Cr,let:Ti,literal:Fn,match:Yt,number:on,"number-format":go,object:on,slice:_n,step:Vo,string:on,"to-boolean":Bn,"to-color":Bn,"to-number":Bn,"to-string":Bn,var:Rr,within:eo,distance:ma,"global-state":Ya};class Fr{constructor(e,i,o,c){this.name=e,this.type=i,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],c=Fr.definitions[o];if(!c)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,v=m.filter((([I])=>!Array.isArray(I)||I.length===e.length-1));let T=null;for(const[I,C]of v){T=new $t(i.registry,cl,i.path,null,i.scope);const D=[];let B=!1;for(let O=1;O<e.length;O++){const U=e[O],Z=Array.isArray(I)?I[O-1]:I.type,q=T.parse(U,1+D.length,Z);if(!q){B=!0;break}D.push(q)}if(!B)if(Array.isArray(I)&&I.length!==D.length)T.error(`Expected ${I.length} arguments, but found ${D.length} instead.`);else{for(let O=0;O<D.length;O++){const U=Array.isArray(I)?I[O]:I.type,Z=D[O];T.concat(O+1).checkSubtype(U,Z.type)}if(T.errors.length===0)return new Fr(o,f,C,D)}}if(v.length===1)i.errors.push(...T.errors);else{const I=(v.length?v:m).map((([D])=>{return B=D,Array.isArray(B)?`(${B.map(pi).join(", ")})`:`(${pi(B.type)}...)`;var B})).join(" | "),C=[];for(let D=1;D<e.length;D++){const B=i.parse(e[D],1+C.length);if(!B)return null;C.push(pi(B.type))}i.error(`Expected arguments of type ${I}, but found (${C.join(", ")}) instead.`)}return null}static register(e,i){Fr.definitions=i;for(const o in i)e[o]=Fr}}function ju(r,[e,i,o,c]){e=e.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const f=c?c.evaluate(r):1,m=No(e,i,o,f);if(m)throw new _i(m);return new Ft(e/255,i/255,o/255,f,!1)}function ga(r,e){return r in e}function ul(r,e){const i=e[r];return i===void 0?null:i}function Go(r){return{type:r}}function cl(r){if(r instanceof Rr)return cl(r.boundExpression);if(r instanceof Fr&&r.name==="error"||r instanceof mo||r instanceof eo||r instanceof ma||r instanceof Ya)return!1;const e=r instanceof Bn||r instanceof on;let i=!0;return r.eachChild((o=>{i=e?i&&cl(o):i&&o instanceof Fn})),!!i&&Cn(r)&&Ls(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Cn(r){if(r instanceof Fr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof eo||r instanceof ma)return!1;let e=!0;return r.eachChild((i=>{e&&!Cn(i)&&(e=!1)})),e}function Ja(r){if(r instanceof Fr&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((i=>{e&&!Ja(i)&&(e=!1)})),e}function Ls(r,e){if(r instanceof Fr&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((o=>{i&&!Ls(o,e)&&(i=!1)})),i}function Qa(r){return{result:"success",value:r}}function es(r){return{result:"error",value:r}}function bo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function ts(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function hl(r){return!!r.expression&&r.expression.interpolated}function Gt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function pl(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Xt(r)===uo}function Vu(r){return r}function Vl(r,e){const i=r.stops&&typeof r.stops[0][0]=="object",o=i||!(i||r.property!==void 0),c=r.type||(hl(e)?"exponential":"interval"),f=(function(C){switch(C.type){case"color":return Ft.parse;case"padding":return Tt.parse;case"numberArray":return ni.parse;case"colorArray":return pt.parse;default:return null}})(e);if(f&&((r=zr({},r)).stops&&(r.stops=r.stops.map((C=>[C[0],f(C[1])]))),r.default=f(r.default?r.default:e.default)),r.colorSpace&&(m=r.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var m;const v=(function(C){switch(C){case"exponential":return Gu;case"interval":return Zu;case"categorical":return Uu;case"identity":return $u;default:throw new Error(`Unknown function type "${C}"`)}})(c);let T,I;if(c==="categorical"){T=Object.create(null);for(const C of r.stops)T[C[0]]=C[1];I=typeof r.stops[0][0]}if(i){const C={},D=[];for(let U=0;U<r.stops.length;U++){const Z=r.stops[U],q=Z[0].zoom;C[q]===void 0&&(C[q]={zoom:q,type:r.type,property:r.property,default:r.default,stops:[]},D.push(q)),C[q].stops.push([Z[0].value,Z[1]])}const B=[];for(const U of D)B.push([C[U].zoom,Vl(C[U],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:qi.interpolationFactor.bind(void 0,O),zoomStops:B.map((U=>U[0])),evaluate:({zoom:U},Z)=>Gu({stops:B,base:r.base},e,U).evaluate(U,Z)}}if(o){const C=c==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:qi.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map((D=>D[0])),evaluate:({zoom:D})=>v(r,e,D,T,I)}}return{kind:"source",evaluate(C,D){const B=D&&D.properties?D.properties[r.property]:void 0;return B===void 0?is(r.default,e.default):v(r,e,B,T,I)}}}function is(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function Uu(r,e,i,o,c){return is(typeof i===c?o[i]:void 0,r.default,e.default)}function Zu(r,e,i){if(Gt(i)!=="number")return is(r.default,e.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const c=Ua(r.stops.map((f=>f[0])),i);return r.stops[c][1]}function Gu(r,e,i){const o=r.base!==void 0?r.base:1;if(Gt(i)!=="number")return is(r.default,e.default);const c=r.stops.length;if(c===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[c-1][0])return r.stops[c-1][1];const f=Ua(r.stops.map((C=>C[0])),i),m=(function(C,D,B,O){const U=O-B,Z=C-B;return U===0?0:D===1?Z/U:(Math.pow(D,Z)-1)/(Math.pow(D,U)-1)})(i,o,r.stops[f][0],r.stops[f+1][0]),v=r.stops[f][1],T=r.stops[f+1][1],I=Ii[e.type]||Vu;return typeof v.evaluate=="function"?{evaluate(...C){const D=v.evaluate.apply(void 0,C),B=T.evaluate.apply(void 0,C);if(D!==void 0&&B!==void 0)return I(D,B,m,r.colorSpace)}}:I(v,T,m,r.colorSpace)}function $u(r,e,i){switch(e.type){case"color":i=Ft.parse(i);break;case"formatted":i=nn.fromString(i.toString());break;case"resolvedImage":i=Xr.fromString(i.toString());break;case"padding":i=Tt.parse(i);break;case"colorArray":i=pt.parse(i);break;case"numberArray":i=ni.parse(i);break;default:Gt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return is(i,r.default,e.default)}Fr.register(Ka,{error:[{kind:"error"},[Ot],(r,[e])=>{throw new _i(e.evaluate(r))}],typeof:[Ot,[Rt],(r,[e])=>pi(Xt(e.evaluate(r)))],"to-rgba":[qr(rt,4),[rn],(r,[e])=>{const[i,o,c,f]=e.evaluate(r).rgb;return[255*i,255*o,255*c,f]}],rgb:[rn,[rt,rt,rt],ju],rgba:[rn,[rt,rt,rt,rt],ju],has:{type:kt,overloads:[[[Ot],(r,[e])=>ga(e.evaluate(r),r.properties())],[[Ot,uo],(r,[e,i])=>ga(e.evaluate(r),i.evaluate(r))]]},get:{type:Rt,overloads:[[[Ot],(r,[e])=>ul(e.evaluate(r),r.properties())],[[Ot,uo],(r,[e,i])=>ul(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Rt,[Ot],(r,[e])=>ul(e.evaluate(r),r.featureState||{})],properties:[uo,[],r=>r.properties()],"geometry-type":[Ot,[],r=>r.geometryType()],id:[Rt,[],r=>r.id()],zoom:[rt,[],r=>r.globals.zoom],"heatmap-density":[rt,[],r=>r.globals.heatmapDensity||0],elevation:[rt,[],r=>r.globals.elevation||0],"line-progress":[rt,[],r=>r.globals.lineProgress||0],accumulated:[Rt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[rt,Go(rt),(r,e)=>{let i=0;for(const o of e)i+=o.evaluate(r);return i}],"*":[rt,Go(rt),(r,e)=>{let i=1;for(const o of e)i*=o.evaluate(r);return i}],"-":{type:rt,overloads:[[[rt,rt],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[rt],(r,[e])=>-e.evaluate(r)]]},"/":[rt,[rt,rt],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[rt,[rt,rt],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[rt,[rt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[rt,[rt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[rt,[rt],(r,[e])=>Math.log(e.evaluate(r))],log2:[rt,[rt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[rt,[rt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[rt,[rt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[rt,[rt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[rt,[rt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[rt,[rt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[rt,[rt],(r,[e])=>Math.atan(e.evaluate(r))],min:[rt,Go(rt),(r,e)=>Math.min(...e.map((i=>i.evaluate(r))))],max:[rt,Go(rt),(r,e)=>Math.max(...e.map((i=>i.evaluate(r))))],abs:[rt,[rt],(r,[e])=>Math.abs(e.evaluate(r))],round:[rt,[rt],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[rt,[rt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[rt,[rt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[kt,[Ot,Rt],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[kt,[Rt],(r,[e])=>r.id()===e.value],"filter-type-==":[kt,[Ot],(r,[e])=>r.geometryType()===e.value],"filter-<":[kt,[Ot,Rt],(r,[e,i])=>{const o=r.properties()[e.value],c=i.value;return typeof o==typeof c&&o<c}],"filter-id-<":[kt,[Rt],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[kt,[Ot,Rt],(r,[e,i])=>{const o=r.properties()[e.value],c=i.value;return typeof o==typeof c&&o>c}],"filter-id->":[kt,[Rt],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[kt,[Ot,Rt],(r,[e,i])=>{const o=r.properties()[e.value],c=i.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[kt,[Rt],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[kt,[Ot,Rt],(r,[e,i])=>{const o=r.properties()[e.value],c=i.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[kt,[Rt],(r,[e])=>{const i=r.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[kt,[Rt],(r,[e])=>e.value in r.properties()],"filter-has-id":[kt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[kt,[qr(Ot)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[kt,[qr(Rt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[kt,[Ot,qr(Rt)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[kt,[Ot,qr(Rt)],(r,[e,i])=>(function(o,c,f,m){for(;f<=m;){const v=f+m>>1;if(c[v]===o)return!0;c[v]>o?m=v-1:f=v+1}return!1})(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:kt,overloads:[[[kt,kt],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Go(kt),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Go(kt),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[kt,[kt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[kt,[Ot],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Ot,[Ot],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Ot,[Ot],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Ot,Go(Rt),(r,e)=>e.map((i=>gn(i.evaluate(r)))).join("")],"resolved-locale":[Ot,[gs],(r,[e])=>e.evaluate(r).resolvedLocale()]});class dl{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new rl,this._defaultValue=i?(function(c){if(c.type==="color"&&pl(c.default))return new Ft(0,0,0,0);switch(c.type){case"color":return Ft.parse(c.default)||null;case"padding":return Tt.parse(c.default)||null;case"numberArray":return ni.parse(c.default)||null;case"colorArray":return pt.parse(c.default)||null;case"variableAnchorOffsetCollection":return Er.parse(c.default)||null;case"projectionDefinition":return Yi.parse(c.default)||null;default:return c.default===void 0?null:c.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,c,f,m){return this._globalState&&(e=Ae(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,c,f,m){this._globalState&&(e=Ae(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function rs(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Ka}function l(r,e,i){const o=new $t(Ka,cl,[],e?(function(f){const m={color:rn,string:Ot,number:rt,enum:Ot,boolean:kt,formatted:Ra,padding:Qs,numberArray:_s,colorArray:co,projectionDefinition:Js,resolvedImage:Fa,variableAnchorOffsetCollection:ys};return f.type==="array"?qr(m[f.value]||Rt,f.length):m[f.type]})(e):void 0),c=o.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Qa(new dl(c,e,i)):es(o.errors)}class _{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Ja(i.expression),this.globalStateRefs=_e(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,c,f,m){return this._globalState&&(e=Ae(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,f,m)}evaluate(e,i,o,c,f,m){return this._globalState&&(e=Ae(e,this._globalState)),this._styleExpression.evaluate(e,i,o,c,f,m)}}class P{constructor(e,i,o,c,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Ja(i.expression),this.globalStateRefs=_e(i.expression),this.interpolationType=c,this._globalState=f}evaluateWithoutErrorHandling(e,i,o,c,f,m){return this._globalState&&(e=Ae(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,f,m)}evaluate(e,i,o,c,f,m){return this._globalState&&(e=Ae(e,this._globalState)),this._styleExpression.evaluate(e,i,o,c,f,m)}interpolationFactor(e,i,o){return this.interpolationType?qi.interpolationFactor(this.interpolationType,e,i,o):0}}function k(r,e,i){const o=l(r,e,i);if(o.result==="error")return o;const c=o.value.expression,f=Cn(c);if(!f&&!bo(e))return es([new Dr("","data expressions not supported")]);const m=Ls(c,["zoom"]);if(!m&&!ts(e))return es([new Dr("","zoom expressions not supported")]);const v=K(c);return v||m?v instanceof Dr?es([v]):v instanceof qi&&!hl(e)?es([new Dr("",'"interpolate" expressions cannot be used with this property')]):Qa(v?new P(f?"camera":"composite",o.value,v.labels,v instanceof qi?v.interpolation:void 0,i):new _(f?"constant":"source",o.value,i)):es([new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class V{constructor(e,i){this._parameters=e,this._specification=i,zr(this,Vl(this._parameters,this._specification))}static deserialize(e){return new V(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function K(r){let e=null;if(r instanceof Ti)e=K(r.result);else if(r instanceof fo){for(const i of r.args)if(e=K(i),e)break}else(r instanceof Vo||r instanceof qi)&&r.input instanceof Fr&&r.input.name==="zoom"&&(e=r);return e instanceof Dr||r.eachChild((i=>{const o=K(i);o instanceof Dr?e=o:!e&&o?e=new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function _e(r,e=new Set){return r instanceof Ya&&e.add(r.key),r.eachChild((i=>{_e(i,e)})),e}function Ae(r,e){const{zoom:i,heatmapDensity:o,elevation:c,lineProgress:f,isSupportedScript:m,accumulated:v}=r??{};return{zoom:i,heatmapDensity:o,elevation:c,lineProgress:f,isSupportedScript:m,accumulated:v,globalState:e}}function Ne(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Ne(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Qe={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ft(r,e){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ne(r)||(r=dr(r));const i=l(r,Qe,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,c,f)=>i.value.evaluate(o,c,{},f),needGeometry:qt(r),getGlobalStateRefs:()=>_e(i.value.expression)}}function Lt(r,e){return r<e?-1:r>e?1:0}function qt(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(qt(r[e]))return!0;return!1}function dr(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Ji(r[1],r[2],"=="):e==="!="?ro(Ji(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ji(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(dr))):e==="all"?["all"].concat(r.slice(1).map(dr)):e==="none"?["all"].concat(r.slice(1).map(dr).map(ro)):e==="in"?xn(r[1],r.slice(2)):e==="!in"?ro(xn(r[1],r.slice(2))):e==="has"?Yr(r[1]):e!=="!has"||ro(Yr(r[1]));var i}function Ji(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function xn(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(Lt)]]:["filter-in-small",r,["literal",e]]}}function Yr(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function ro(r){return["!",r]}function fl(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const f of r)c+=`${fl(f)},`;return`${c}]`}const i=Object.keys(r).sort();let o="{";for(let c=0;c<i.length;c++)o+=`${JSON.stringify(i[c])}:${fl(r[i[c]])},`;return`${o}}`}function qu(r){let e="";for(const i of vi)e+=`/${fl(r[i])}`;return e}function Wu(r){const e=r.value;return e?[new Fe(r.key,e,"constants have been deprecated as of v8")]:[]}function Bi(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function _a(r){if(Array.isArray(r))return r.map(_a);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=_a(r[i]);return e}return Bi(r)}function bn(r){const e=r.key,i=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},f=r.style,m=r.styleSpec,v=r.validateSpec;let T=[];const I=Gt(i);if(I!=="object")return[new Fe(e,i,`object expected, ${I} found`)];for(const C in i){const D=C.split(".")[0],B=po(o,D)||o["*"];let O;if(po(c,D))O=c[D];else if(po(o,D))O=v;else if(c["*"])O=c["*"];else{if(!o["*"]){T.push(new Fe(e,i[C],`unknown property "${C}"`));continue}O=v}T=T.concat(O({key:(e&&`${e}.`)+C,value:i[C],valueSpec:B,style:f,styleSpec:m,object:i,objectKey:C,validateSpec:v},i))}for(const C in o)c[C]||o[C].required&&o[C].default===void 0&&i[C]===void 0&&T.push(new Fe(e,i,`missing required property "${C}"`));return T}function Oi(r){const e=r.value,i=r.valueSpec,o=r.style,c=r.styleSpec,f=r.key,m=r.arrayElementValidator||r.validateSpec;if(Gt(e)!=="array")return[new Fe(f,e,`array expected, ${Gt(e)} found`)];if(i.length&&e.length!==i.length)return[new Fe(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Fe(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let v={type:i.value,values:i.values};c.$version<7&&(v.function=i.function),Gt(i.value)==="object"&&(v=i.value);let T=[];for(let I=0;I<e.length;I++)T=T.concat(m({array:e,arrayIndex:I,value:e[I],valueSpec:v,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${f}[${I}]`}));return T}function $o(r){const e=r.key,i=r.value,o=r.valueSpec;let c=Gt(i);return c==="number"&&i!=i&&(c="NaN"),c!=="number"?[new Fe(e,i,`number expected, ${c} found`)]:"minimum"in o&&i<o.minimum?[new Fe(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new Fe(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function ml(r){const e=r.valueSpec,i=Bi(r.value.type);let o,c,f,m={};const v=i!=="categorical"&&r.value.property===void 0,T=!v,I=Gt(r.value.stops)==="array"&&Gt(r.value.stops[0])==="array"&&Gt(r.value.stops[0][0])==="object",C=bn({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(O){if(i==="identity")return[new Fe(O.key,O.value,'identity function may not have a "stops" property')];let U=[];const Z=O.value;return U=U.concat(Oi({key:O.key,value:Z,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:D})),Gt(Z)==="array"&&Z.length===0&&U.push(new Fe(O.key,Z,"array must have at least one stop")),U},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return i==="identity"&&v&&C.push(new Fe(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||C.push(new Fe(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!hl(r.valueSpec)&&C.push(new Fe(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(T&&!bo(r.valueSpec)?C.push(new Fe(r.key,r.value,"property functions not supported")):v&&!ts(r.valueSpec)&&C.push(new Fe(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!I||r.value.property!==void 0||C.push(new Fe(r.key,r.value,'"property" property is required')),C;function D(O){let U=[];const Z=O.value,q=O.key;if(Gt(Z)!=="array")return[new Fe(q,Z,`array expected, ${Gt(Z)} found`)];if(Z.length!==2)return[new Fe(q,Z,`array length 2 expected, length ${Z.length} found`)];if(I){if(Gt(Z[0])!=="object")return[new Fe(q,Z,`object expected, ${Gt(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Fe(q,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Fe(q,Z,"object stop key must have value")];if(f&&f>Bi(Z[0].zoom))return[new Fe(q,Z[0].zoom,"stop zoom values must appear in ascending order")];Bi(Z[0].zoom)!==f&&(f=Bi(Z[0].zoom),c=void 0,m={}),U=U.concat(bn({key:`${q}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:$o,value:B}}))}else U=U.concat(B({key:`${q}[0]`,value:Z[0],validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},Z));return rs(_a(Z[1]))?U.concat([new Fe(`${q}[1]`,Z[1],"expressions are not allowed in function stops.")]):U.concat(O.validateSpec({key:`${q}[1]`,value:Z[1],valueSpec:e,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function B(O,U){const Z=Gt(O.value),q=Bi(O.value),Y=O.value!==null?O.value:U;if(o){if(Z!==o)return[new Fe(O.key,Y,`${Z} stop domain type must match previous stop domain type ${o}`)]}else o=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Fe(O.key,Y,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&i!=="categorical"){let le=`number expected, ${Z} found`;return bo(e)&&i===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(O.key,Y,le)]}return i!=="categorical"||Z!=="number"||isFinite(q)&&Math.floor(q)===q?i!=="categorical"&&Z==="number"&&c!==void 0&&q<c?[new Fe(O.key,Y,"stop domain values must appear in ascending order")]:(c=q,i==="categorical"&&q in m?[new Fe(O.key,Y,"stop domain values must be unique")]:(m[q]=!0,[])):[new Fe(O.key,Y,`integer expected, found ${q}`)]}}function qo(r){const e=(r.expressionContext==="property"?k:l)(_a(r.value),r.valueSpec);if(e.result==="error")return e.value.map((o=>new Fe(`${r.key}${o.key}`,r.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new Fe(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ja(i))return[new Fe(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ja(i))return[new Fe(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Ls(i,["zoom","feature-state"]))return[new Fe(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Cn(i))return[new Fe(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ks(r){const e=r.key,i=r.value,o=Gt(i);return o!=="string"?[new Fe(e,i,`color expected, ${o} found`)]:Ft.parse(String(i))?[]:[new Fe(e,i,`color expected, "${i}" found`)]}function wo(r){const e=r.key,i=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(Bi(i))===-1&&c.push(new Fe(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(Bi(i))===-1&&c.push(new Fe(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function ya(r){return Ne(_a(r.value))?qo(zr({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Hu(r)}function Hu(r){const e=r.value,i=r.key;if(Gt(e)!=="array")return[new Fe(i,e,`array expected, ${Gt(e)} found`)];const o=r.styleSpec;let c,f=[];if(e.length<1)return[new Fe(i,e,"filter array must have at least 1 element")];switch(f=f.concat(wo({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),Bi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Bi(e[1])==="$type"&&f.push(new Fe(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Fe(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Gt(e[1]),c!=="string"&&f.push(new Fe(`${i}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=Gt(e[m]),Bi(e[1])==="$type"?f=f.concat(wo({key:`${i}[${m}]`,value:e[m],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new Fe(`${i}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(Hu({key:`${i}[${m}]`,value:e[m],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Gt(e[1]),e.length!==2?f.push(new Fe(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new Fe(`${i}[1]`,e[1],`string expected, ${c} found`))}return f}function sp(r,e){const i=r.key,o=r.validateSpec,c=r.style,f=r.styleSpec,m=r.value,v=r.objectKey,T=f[`${e}_${r.layerType}`];if(!T)return[];const I=v.match(/^(.*)-transition$/);if(e==="paint"&&I&&T[I[1]]&&T[I[1]].transition)return o({key:i,value:m,valueSpec:f.transition,style:c,styleSpec:f});const C=r.valueSpec||T[v];if(!C)return[new Fe(i,m,`unknown property "${v}"`)];let D;if(Gt(m)==="string"&&bo(C)&&!C.tokens&&(D=/^{([^}]+)}$/.exec(m)))return[new Fe(i,m,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const B=[];return r.layerType==="symbol"&&v==="text-font"&&pl(_a(m))&&Bi(m.type)==="identity"&&B.push(new Fe(i,m,'"text-font" does not support identity functions')),B.concat(o({key:r.key,value:m,valueSpec:C,style:c,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:v}))}function lp(r){return sp(r,"paint")}function up(r){return sp(r,"layout")}function cp(r){let e=[];const i=r.value,o=r.key,c=r.style,f=r.styleSpec;if(Gt(i)!=="object")return[new Fe(o,i,`object expected, ${Gt(i)} found`)];i.type||i.ref||e.push(new Fe(o,i,'either "type" or "ref" is required'));let m=Bi(i.type);const v=Bi(i.ref);if(i.id){const T=Bi(i.id);for(let I=0;I<r.arrayIndex;I++){const C=c.layers[I];Bi(C.id)===T&&e.push(new Fe(o,i.id,`duplicate layer id "${i.id}", previously used at line ${C.id.__line__}`))}}if("ref"in i){let T;["type","source","source-layer","filter","layout"].forEach((I=>{I in i&&e.push(new Fe(o,i[I],`"${I}" is prohibited for ref layers`))})),c.layers.forEach((I=>{Bi(I.id)===v&&(T=I)})),T?T.ref?e.push(new Fe(o,i.ref,"ref cannot reference another ref layer")):m=Bi(T.type):e.push(new Fe(o,i.ref,`ref layer "${v}" not found`))}else if(m!=="background")if(i.source){const T=c.sources&&c.sources[i.source],I=T&&Bi(T.type);T?I==="vector"&&m==="raster"?e.push(new Fe(o,i.source,`layer "${i.id}" requires a raster source`)):I!=="raster-dem"&&m==="hillshade"||I!=="raster-dem"&&m==="color-relief"?e.push(new Fe(o,i.source,`layer "${i.id}" requires a raster-dem source`)):I==="raster"&&m!=="raster"?e.push(new Fe(o,i.source,`layer "${i.id}" requires a vector source`)):I!=="vector"||i["source-layer"]?I==="raster-dem"&&m!=="hillshade"&&m!=="color-relief"?e.push(new Fe(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]||I==="geojson"&&T.lineMetrics||e.push(new Fe(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Fe(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Fe(o,i.source,`source "${i.source}" not found`))}else e.push(new Fe(o,i,'missing required property "source"'));return e=e.concat(bn({key:o,value:i,valueSpec:f.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:i.type,valueSpec:f.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:i,objectKey:"type"}),filter:ya,layout:T=>bn({layer:i,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":I=>up(zr({layerType:m},I))}}),paint:T=>bn({layer:i,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":I=>lp(zr({layerType:m},I))}})}})),e}function zs(r){const e=r.value,i=r.key,o=Gt(e);return o!=="string"?[new Fe(i,e,`string expected, ${o} found`)]:[]}const Gc={promoteId:function({key:r,value:e}){if(Gt(e)==="string")return zs({key:r,value:e});{const i=[];for(const o in e)i.push(...zs({key:`${r}.${o}`,value:e[o]}));return i}}};function $c(r){const e=r.value,i=r.key,o=r.styleSpec,c=r.style,f=r.validateSpec;if(!e.type)return[new Fe(i,e,'"type" is required')];const m=Bi(e.type);let v;switch(m){case"vector":case"raster":return v=bn({key:i,value:e,valueSpec:o[`source_${m.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:Gc,validateSpec:f}),v;case"raster-dem":return v=(function(T){var I;const C=(I=T.sourceName)!==null&&I!==void 0?I:"",D=T.value,B=T.styleSpec,O=B.source_raster_dem,U=T.style;let Z=[];const q=Gt(D);if(D===void 0)return Z;if(q!=="object")return Z.push(new Fe("source_raster_dem",D,`object expected, ${q} found`)),Z;const Y=Bi(D.encoding)==="custom",le=["redFactor","greenFactor","blueFactor","baseShift"],J=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const te in D)!Y&&le.includes(te)?Z.push(new Fe(te,D[te],`In "${C}": "${te}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):O[te]?Z=Z.concat(T.validateSpec({key:te,value:D[te],valueSpec:O[te],validateSpec:T.validateSpec,style:U,styleSpec:B})):Z.push(new Fe(te,D[te],`unknown property "${te}"`));return Z})({sourceName:i,value:e,style:r.style,styleSpec:o,validateSpec:f}),v;case"geojson":if(v=bn({key:i,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:f,objectElementValidators:Gc}),e.cluster)for(const T in e.clusterProperties){const[I,C]=e.clusterProperties[T],D=typeof I=="string"?[I,["accumulated"],["get",T]]:I;v.push(...qo({key:`${i}.${T}.map`,value:C,expressionContext:"cluster-map"})),v.push(...qo({key:`${i}.${T}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return v;case"video":return bn({key:i,value:e,valueSpec:o.source_video,style:c,validateSpec:f,styleSpec:o});case"image":return bn({key:i,value:e,valueSpec:o.source_image,style:c,validateSpec:f,styleSpec:o});case"canvas":return[new Fe(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wo({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ul(r){const e=r.value,i=r.styleSpec,o=i.light,c=r.style;let f=[];const m=Gt(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new Fe("light",e,`object expected, ${m} found`)]),f;for(const v in e){const T=v.match(/^(.*)-transition$/);f=f.concat(T&&o[T[1]]&&o[T[1]].transition?r.validateSpec({key:v,value:e[v],valueSpec:i.transition,validateSpec:r.validateSpec,style:c,styleSpec:i}):o[v]?r.validateSpec({key:v,value:e[v],valueSpec:o[v],validateSpec:r.validateSpec,style:c,styleSpec:i}):[new Fe(v,e[v],`unknown property "${v}"`)])}return f}function hp(r){const e=r.value,i=r.styleSpec,o=i.sky,c=r.style,f=Gt(e);if(e===void 0)return[];if(f!=="object")return[new Fe("sky",e,`object expected, ${f} found`)];let m=[];for(const v in e)m=m.concat(o[v]?r.validateSpec({key:v,value:e[v],valueSpec:o[v],style:c,styleSpec:i}):[new Fe(v,e[v],`unknown property "${v}"`)]);return m}function qc(r){const e=r.value,i=r.styleSpec,o=i.terrain,c=r.style;let f=[];const m=Gt(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new Fe("terrain",e,`object expected, ${m} found`)]),f;for(const v in e)f=f.concat(o[v]?r.validateSpec({key:v,value:e[v],valueSpec:o[v],validateSpec:r.validateSpec,style:c,styleSpec:i}):[new Fe(v,e[v],`unknown property "${v}"`)]);return f}function Wc(r){let e=[];const i=r.value,o=r.key;if(Array.isArray(i)){const c=[],f=[];for(const m in i)i[m].id&&c.includes(i[m].id)&&e.push(new Fe(o,i,`all the sprites' ids must be unique, but ${i[m].id} is duplicated`)),c.push(i[m].id),i[m].url&&f.includes(i[m].url)&&e.push(new Fe(o,i,`all the sprites' URLs must be unique, but ${i[m].url} is duplicated`)),f.push(i[m].url),e=e.concat(bn({key:`${o}[${m}]`,value:i[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return zs({key:o,value:i})}function pp(r){return e=r.value,e&&e.constructor===Object?[]:[new Fe(r.key,r.value,`object expected, ${Gt(r.value)} found`)];var e}const Hc={"*":()=>[],array:Oi,boolean:function(r){const e=r.value,i=r.key,o=Gt(e);return o!=="boolean"?[new Fe(i,e,`boolean expected, ${o} found`)]:[]},number:$o,color:ks,constants:Wu,enum:wo,filter:ya,function:ml,layer:cp,object:bn,source:$c,light:Ul,sky:hp,terrain:qc,projection:function(r){const e=r.value,i=r.styleSpec,o=i.projection,c=r.style,f=Gt(e);if(e===void 0)return[];if(f!=="object")return[new Fe("projection",e,`object expected, ${f} found`)];let m=[];for(const v in e)m=m.concat(o[v]?r.validateSpec({key:v,value:e[v],valueSpec:o[v],style:c,styleSpec:i}):[new Fe(v,e[v],`unknown property "${v}"`)]);return m},projectionDefinition:function(r){const e=r.key;let i=r.value;i=i instanceof String?i.valueOf():i;const o=Gt(i);return o!=="array"||(function(c){return Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"})(i)||(function(c){return!!["interpolate","step","literal"].includes(c[0])})(i)?["array","string"].includes(o)?[]:[new Fe(e,i,`projection expected, invalid type "${o}" found`)]:[new Fe(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:zs,formatted:function(r){return zs(r).length===0?[]:qo(r)},resolvedImage:function(r){return zs(r).length===0?[]:qo(r)},padding:function(r){const e=r.key,i=r.value;if(Gt(i)==="array"){if(i.length<1||i.length>4)return[new Fe(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let c=[];for(let f=0;f<i.length;f++)c=c.concat(r.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:r.validateSpec,valueSpec:o}));return c}return $o({key:e,value:i,valueSpec:{}})},numberArray:function(r){const e=r.key,i=r.value;if(Gt(i)==="array"){const o={type:"number"};if(i.length<1)return[new Fe(e,i,"array length at least 1 expected, length 0 found")];let c=[];for(let f=0;f<i.length;f++)c=c.concat(r.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:r.validateSpec,valueSpec:o}));return c}return $o({key:e,value:i,valueSpec:{}})},colorArray:function(r){const e=r.key,i=r.value;if(Gt(i)==="array"){if(i.length<1)return[new Fe(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let c=0;c<i.length;c++)o=o.concat(ks({key:`${e}[${c}]`,value:i[c]}));return o}return ks({key:e,value:i})},variableAnchorOffsetCollection:function(r){const e=r.key,i=r.value,o=Gt(i),c=r.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new Fe(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<i.length;m+=2)f=f.concat(wo({key:`${e}[${m}]`,value:i[m],valueSpec:c.layout_symbol["text-anchor"]})),f=f.concat(Oi({key:`${e}[${m+1}]`,value:i[m+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return f},sprite:Wc,state:pp};function Zl(r){const e=r.value,i=r.valueSpec,o=r.styleSpec;return r.validateSpec=Zl,i.expression&&pl(Bi(e))?ml(r):i.expression&&rs(_a(e))?qo(r):i.type&&Hc[i.type]?Hc[i.type](r):bn(zr({},r,{valueSpec:i.type?o[i.type]:i}))}function gl(r){const e=r.value,i=r.key,o=zs(r);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Fe(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Fe(i,e,'"glyphs" url must include a "{range}" token'))),o}function no(r,e=Le){let i=[];return i=i.concat(Zl({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:Zl,objectElementValidators:{glyphs:gl,"*":()=>[]}})),r.constants&&(i=i.concat(Wu({key:"constants",value:r.constants}))),dp(i)}function To(r){return function(e){return r(Object.assign({},e,{validateSpec:Zl}))}}function dp(r){return[].concat(r).sort(((e,i)=>e.line-i.line))}function So(r){return function(...e){return dp(r.apply(this,e))}}no.source=So(To($c)),no.sprite=So(To(Wc)),no.glyphs=So(To(gl)),no.light=So(To(Ul)),no.sky=So(To(hp)),no.terrain=So(To(qc)),no.state=So(To(pp)),no.layer=So(To(cp)),no.filter=So(To(ya)),no.paintProperty=So(To(lp)),no.layoutProperty=So(To(up));const Gd=Le,_l=no,Gl=_l.light,$l=_l.sky,Vn=_l.paintProperty,ql=_l.layoutProperty;function Xc(r,e){let i=!1;if(e&&e.length)for(const o of e)r.fire(new ci(new Error(o.message))),i=!0;return i}class Wl{constructor(e,i,o){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const m=new Int32Array(this.arrayBuffer);e=m[0],this.d=(i=m[1])+2*(o=m[2]);for(let T=0;T<this.d*this.d;T++){const I=m[3+T],C=m[3+T+1];c.push(I===C?null:m.subarray(I,C))}const v=m[3+c.length+1];this.keys=m.subarray(m[3+c.length],v),this.bboxes=m.subarray(v),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let m=0;m<this.d*this.d;m++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const f=o/i*e;this.min=-f,this.max=e+f}insert(e,i,o,c,f){this._forEachCell(i,o,c,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,c,f,m){this.cells[f].push(m)}query(e,i,o,c,f){const m=this.min,v=this.max;if(e<=m&&i<=m&&v<=o&&v<=c&&!f)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(e,i,o,c,this._queryCell,T,{},f),T}}_queryCell(e,i,o,c,f,m,v,T){const I=this.cells[f];if(I!==null){const C=this.keys,D=this.bboxes;for(let B=0;B<I.length;B++){const O=I[B];if(v[O]===void 0){const U=4*O;(T?T(D[U+0],D[U+1],D[U+2],D[U+3]):e<=D[U+2]&&i<=D[U+3]&&o>=D[U+0]&&c>=D[U+1])?(v[O]=!0,m.push(C[O])):v[O]=!1}}}}_forEachCell(e,i,o,c,f,m,v,T){const I=this._convertToCellCoord(e),C=this._convertToCellCoord(i),D=this._convertToCellCoord(o),B=this._convertToCellCoord(c);for(let O=I;O<=D;O++)for(let U=C;U<=B;U++){const Z=this.d*U+O;if((!T||T(this._convertFromCellCoord(O),this._convertFromCellCoord(U),this._convertFromCellCoord(O+1),this._convertFromCellCoord(U+1)))&&f.call(this,e,i,o,c,Z,m,v,T))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const c=new Int32Array(i+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let f=i;for(let m=0;m<e.length;m++){const v=e[m];c[3+m]=f,c.set(v,f),f+=v.length}return c[3+e.length]=f,c.set(this.keys,f),f+=this.keys.length,c[3+e.length+1]=f,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new Wl(e.buffer)}}const va={};function st(r,e,i={}){if(va[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),va[r]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}st("Object",Object),st("Set",Set),st("TransferableGridIndex",Wl),st("Color",Ft),st("Error",Error),st("AJAXError",we),st("ResolvedImage",Xr),st("StylePropertyFunction",V),st("StyleExpression",dl,{omit:["_evaluator"]}),st("ZoomDependentExpression",P),st("ZoomConstantExpression",_),st("CompoundExpression",Fr,{omit:["_evaluate"]});for(const r in Ka)Ka[r]._classRegistryKey||st(`Expression_${r}`,Ka[r]);function Yc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Hl(r){return r.$name||r.constructor._classRegistryKey}function fp(r){return!(function(e){if(e===null||typeof e!="object")return!1;const i=Hl(e);return!(!i||i==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Yc(r)||Dn(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Ds(r,e){if(fp(r))return(Yc(r)||Dn(r))&&e&&e.push(r),ArrayBuffer.isView(r)&&e&&e.push(r.buffer),r instanceof ImageData&&e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const f=[];for(const m of r)f.push(Ds(m,e));return f}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const i=Hl(r);if(!i)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!va[i])throw new Error(`${i} is not registered.`);const{klass:o}=va[i],c=o.serialize?o.serialize(r,e):{};if(o.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in r){if(!r.hasOwnProperty(f)||va[i].omit.indexOf(f)>=0)continue;const m=r[f];c[f]=va[i].shallow.indexOf(f)>=0?m:Ds(m,e)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(c.$name=i),c}function Xl(r){if(fp(r))return r;if(Array.isArray(r))return r.map(Xl);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const e=Hl(r)||"Object";if(!va[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=va[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(r);const o=Object.create(i.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const f=r[c];o[c]=va[e].shallow.indexOf(c)>=0?f:Xl(f)}return o}class Rs{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function $d(r){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function Kc(r){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function mp(r){return/\s/u.test(String.fromCodePoint(r))}function Fs(r){for(const e of r)if(Kc(e.codePointAt(0)))return!0;return!1}function qd(r){for(const e of r)if(!Wd(e.codePointAt(0)))return!1;return!0}function gp(r){const e=r.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const Xu=gp(["Arab","Dupl","Mong","Ougr","Syrc"]);function Wd(r){return!Xu.test(String.fromCodePoint(r))}function Yu(r){return!(Kc(r)||(e=r,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Ku=gp(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Jc(r){return Ku.test(String.fromCodePoint(r))}function _p(r,e){return!(!e&&Jc(r)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(r)))}function yp(r){for(const e of r)if(Jc(e.codePointAt(0)))return!0;return!1}const xa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(xa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,e){return s(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const i=r.pluginURL,o=new Promise((f=>{this.loadScriptResolve=f}));e(i);const c=new Promise((f=>setTimeout((()=>f()),this.TIMEOUT)));if(yield Promise.race([o,c]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:i};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class Si{constructor(e,i){this.isSupportedScript=vp,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new Rs,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Rs,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function vp(r){return(function(e,i){for(const o of e)if(!_p(o.codePointAt(0),i))return!1;return!0})(r,xa.getRTLTextPluginStatus()==="loaded")}const Ju="-transition";class Yl{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(c,f,m){if(pl(c))return new V(c,f);if(rs(c)){const v=k(c,f,m);if(v.result==="error")throw new Error(v.value.map((T=>`${T.key}: ${T.message}`)).join(", "));return v.value}{let v=c;return f.type==="color"&&typeof c=="string"?v=Ft.parse(c):f.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?f.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?f.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?v=Er.parse(c):f.type==="projectionDefinition"&&typeof c=="string"&&(v=Yi.parse(c)):v=pt.parse(c):v=ni.parse(c):v=Tt.parse(c),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>v}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Qc{constructor(e,i){this.property=e,this.value=new Yl(e,void 0,i)}transitioned(e,i){return new xp(this.property,this.value,i,Ui({},e.transition,this.transition),e.now)}untransitioned(){return new xp(this.property,this.value,null,{},0)}}class eh{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return $r(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Qc(this._values[e].property,this._globalState)),this._values[e].value=new Yl(this._values[e].property,i===null?void 0:$r(i),this._globalState)}getTransition(e){return $r(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Qc(this._values[e].property,this._globalState)),this._values[e].transition=$r(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const c=this.getTransition(i);c!==void 0&&(e[`${i}${Ju}`]=c)}return e}transitioned(e,i){const o=new th(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,i._values[c]);return o}untransitioned(){const e=new th(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class xp{constructor(e,i,o,c,f){this.property=e,this.value=i,this.begin=f+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const c=e.now||0,f=this.value.possiblyEvaluate(e,i,o),m=this.prior;if(m){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return m.possiblyEvaluate(e,i,o);{const v=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,o),f,_r(v))}}return f}}class th{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const c=new Qu(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,i,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class bp{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return $r(this._values[e].value)}setValue(e,i){this._values[e]=new Yl(this._values[e].property,i===null?void 0:$r(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const c=new Qu(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,i,o);return c}}class Wo{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,c){return this.property.evaluate(this.value,this.parameters,e,i,o,c)}}class Qu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class yt{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const c=Ii[this.specification.type];return c?c(e,i,o):e}}class St{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,c){return new Wo(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,c)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Wo(this,{kind:"constant",value:void 0},e.parameters);const c=Ii[this.specification.type];if(c){const f=c(e.value.value,i.value.value,o);return new Wo(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,i,o,c,f,m){return e.kind==="constant"?e.value:e.evaluate(i,o,c,f,m)}}class yl extends St{possiblyEvaluate(e,i,o,c){if(e.value===void 0)return new Wo(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,c),m=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,v=this._calculate(m,m,m,i);return new Wo(this,{kind:"constant",value:v},i)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Wo(this,{kind:"constant",value:f},i)}return new Wo(this,e.expression,i)}evaluate(e,i,o,c,f,m){if(e.kind==="source"){const v=e.evaluate(i,o,c,f,m);return this._calculate(v,v,v,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,c),e.evaluate({zoom:Math.floor(i.zoom)},o,c),e.evaluate({zoom:Math.floor(i.zoom)+1},o,c),i):e.value}_calculate(e,i,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class ih{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,c);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new Si(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Si(Math.floor(i.zoom),i)),e.expression.evaluate(new Si(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class Bs{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){return!!e.expression.evaluate(i,null,{},o,c)}interpolate(){return!1}}class wn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const c=this.defaultPropertyValues[i]=new Yl(o,void 0,void 0),f=this.defaultTransitionablePropertyValues[i]=new Qc(o,void 0);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=c.possiblyEvaluate({})}}}st("DataDrivenProperty",St),st("DataConstantProperty",yt),st("CrossFadedDataDrivenProperty",yl),st("CrossFadedProperty",ih),st("ColorRampProperty",Bs);class Un extends ti{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=ft(e.filter,o)),i.layout&&(this._unevaluatedLayout=new bp(i.layout,o)),i.paint)){this._transitionablePaint=new eh(i.paint,o);for(const c in e.paint)this.setPaintProperty(c,e.paint[c],{validate:!1});for(const c in e.layout)this.setLayoutProperty(c,e.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qu(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=ft(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const c of o.getGlobalStateRefs())e.add(c)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const c=this._transitionablePaint._values[o].value;for(const f of c.getGlobalStateRefs()){const m=(e=i.get(f))!==null&&e!==void 0?e:[];m.push({name:o,value:c.value}),i.set(f,m)}}return i}setLayoutProperty(e,i,o={}){i!=null&&this._validate(ql,`layers.${this.id}.layout.${e}`,e,i,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return e.endsWith(Ju)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Vn,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(Ju))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const c=this._transitionablePaint._values[e],f=c.property.specification["property-type"]==="cross-faded-data-driven",m=c.value.isDataDriven(),v=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(e,v,T)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ea(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,c,f={}){return(!f||f.validate!==!1)&&Xc(this,e.call(_l,{key:i,layerType:this.type,objectKey:o,value:c,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Wo&&bo(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let wp;var Hd={get paint(){return wp=wp||new wn({"raster-opacity":new yt(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new yt(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yt(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yt(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new yt(Le.paint_raster["raster-saturation"]),"raster-contrast":new yt(Le.paint_raster["raster-contrast"]),"raster-resampling":new yt(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new yt(Le.paint_raster["raster-fade-duration"])})}};class Tp extends Un{constructor(e,i){super(e,Hd,i)}}const Sp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vl{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function rr(r,e=1){let i=0,o=0;return{members:r.map((c=>{const f=Sp[c.type].BYTES_PER_ELEMENT,m=i=Pp(i,Math.max(e,f)),v=c.components||1;return o=Math.max(o,f),i+=f*v,{name:c.name,type:c.type,components:v,offset:m}})),size:Pp(i,Math.max(o,e)),alignment:e}}function Pp(r,e){return Math.ceil(r/e)*e}class Kl extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=o,e}}Kl.prototype.bytesPerElement=4,st("StructArrayLayout2i4",Kl);class ec extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=c,e}}ec.prototype.bytesPerElement=6,st("StructArrayLayout3i6",ec);class ns extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,c)}emplace(e,i,o,c,f){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=o,this.int16[m+2]=c,this.int16[m+3]=f,e}}ns.prototype.bytesPerElement=8,st("StructArrayLayout4i8",ns);class rh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,c,f,m)}emplace(e,i,o,c,f,m,v){const T=6*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=f,this.int16[T+4]=m,this.int16[T+5]=v,e}}rh.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",rh);class nh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,c,f,m)}emplace(e,i,o,c,f,m,v){const T=4*e,I=8*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.uint8[I+4]=c,this.uint8[I+5]=f,this.uint8[I+6]=m,this.uint8[I+7]=v,e}}nh.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",nh);class Jl extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=o,e}}Jl.prototype.bytesPerElement=8,st("StructArrayLayout2f8",Jl);class tc extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m,v,T,I,C){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,o,c,f,m,v,T,I,C)}emplace(e,i,o,c,f,m,v,T,I,C,D){const B=10*e;return this.uint16[B+0]=i,this.uint16[B+1]=o,this.uint16[B+2]=c,this.uint16[B+3]=f,this.uint16[B+4]=m,this.uint16[B+5]=v,this.uint16[B+6]=T,this.uint16[B+7]=I,this.uint16[B+8]=C,this.uint16[B+9]=D,e}}tc.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",tc);class oh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m,v,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,o,c,f,m,v,T)}emplace(e,i,o,c,f,m,v,T,I){const C=8*e;return this.uint16[C+0]=i,this.uint16[C+1]=o,this.uint16[C+2]=c,this.uint16[C+3]=f,this.uint16[C+4]=m,this.uint16[C+5]=v,this.uint16[C+6]=T,this.uint16[C+7]=I,e}}oh.prototype.bytesPerElement=16,st("StructArrayLayout8ui16",oh);class ah extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m,v,T,I,C,D,B){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,o,c,f,m,v,T,I,C,D,B)}emplace(e,i,o,c,f,m,v,T,I,C,D,B,O){const U=12*e;return this.int16[U+0]=i,this.int16[U+1]=o,this.int16[U+2]=c,this.int16[U+3]=f,this.uint16[U+4]=m,this.uint16[U+5]=v,this.uint16[U+6]=T,this.uint16[U+7]=I,this.int16[U+8]=C,this.int16[U+9]=D,this.int16[U+10]=B,this.int16[U+11]=O,e}}ah.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",ah);class ba extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=c,e}}ba.prototype.bytesPerElement=12,st("StructArrayLayout3f12",ba);class ic extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ic.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",ic);class Ql extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m,v,T,I){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,c,f,m,v,T,I)}emplace(e,i,o,c,f,m,v,T,I,C){const D=10*e,B=5*e;return this.int16[D+0]=i,this.int16[D+1]=o,this.int16[D+2]=c,this.int16[D+3]=f,this.int16[D+4]=m,this.int16[D+5]=v,this.uint32[B+3]=T,this.uint16[D+8]=I,this.uint16[D+9]=C,e}}Ql.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",Ql);class rc extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,c,f,m)}emplace(e,i,o,c,f,m,v){const T=6*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+3]=f,this.int16[T+4]=m,this.int16[T+5]=v,e}}rc.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",rc);class eu extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c,f)}emplace(e,i,o,c,f,m){const v=4*e,T=8*e;return this.float32[v+0]=i,this.float32[v+1]=o,this.float32[v+2]=c,this.int16[T+6]=f,this.int16[T+7]=m,e}}eu.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",eu);class sh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,c,f,m)}emplace(e,i,o,c,f,m,v){const T=16*e,I=4*e,C=8*e;return this.uint8[T+0]=i,this.uint8[T+1]=o,this.float32[I+1]=c,this.float32[I+2]=f,this.int16[C+6]=m,this.int16[C+7]=v,e}}sh.prototype.bytesPerElement=16,st("StructArrayLayout2ub2f2i16",sh);class Os extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=c,e}}Os.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",Os);class Ns extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m,v,T,I,C,D,B,O,U,Z,q,Y){const le=this.length;return this.resize(le+1),this.emplace(le,e,i,o,c,f,m,v,T,I,C,D,B,O,U,Z,q,Y)}emplace(e,i,o,c,f,m,v,T,I,C,D,B,O,U,Z,q,Y,le){const J=24*e,te=12*e,ue=48*e;return this.int16[J+0]=i,this.int16[J+1]=o,this.uint16[J+2]=c,this.uint16[J+3]=f,this.uint32[te+2]=m,this.uint32[te+3]=v,this.uint32[te+4]=T,this.uint16[J+10]=I,this.uint16[J+11]=C,this.uint16[J+12]=D,this.float32[te+7]=B,this.float32[te+8]=O,this.uint8[ue+36]=U,this.uint8[ue+37]=Z,this.uint8[ue+38]=q,this.uint32[te+10]=Y,this.int16[J+22]=le,e}}Ns.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ns);class lh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,m,v,T,I,C,D,B,O,U,Z,q,Y,le,J,te,ue,pe,Ie,Ge,je,qe,tt,Ye){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,e,i,o,c,f,m,v,T,I,C,D,B,O,U,Z,q,Y,le,J,te,ue,pe,Ie,Ge,je,qe,tt,Ye)}emplace(e,i,o,c,f,m,v,T,I,C,D,B,O,U,Z,q,Y,le,J,te,ue,pe,Ie,Ge,je,qe,tt,Ye,Ve){const Be=32*e,ct=16*e;return this.int16[Be+0]=i,this.int16[Be+1]=o,this.int16[Be+2]=c,this.int16[Be+3]=f,this.int16[Be+4]=m,this.int16[Be+5]=v,this.int16[Be+6]=T,this.int16[Be+7]=I,this.uint16[Be+8]=C,this.uint16[Be+9]=D,this.uint16[Be+10]=B,this.uint16[Be+11]=O,this.uint16[Be+12]=U,this.uint16[Be+13]=Z,this.uint16[Be+14]=q,this.uint16[Be+15]=Y,this.uint16[Be+16]=le,this.uint16[Be+17]=J,this.uint16[Be+18]=te,this.uint16[Be+19]=ue,this.uint16[Be+20]=pe,this.uint16[Be+21]=Ie,this.uint16[Be+22]=Ge,this.uint32[ct+12]=je,this.float32[ct+13]=qe,this.float32[ct+14]=tt,this.uint16[Be+30]=Ye,this.uint16[Be+31]=Ve,e}}lh.prototype.bytesPerElement=64,st("StructArrayLayout8i15ui1ul2f2ui64",lh);class tu extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}tu.prototype.bytesPerElement=4,st("StructArrayLayout1f4",tu);class js extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=3*e;return this.uint16[6*e+0]=i,this.float32[f+1]=o,this.float32[f+2]=c,e}}js.prototype.bytesPerElement=12,st("StructArrayLayout1ui2f12",js);class uh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=4*e;return this.uint32[2*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=c,e}}uh.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",uh);class ch extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=o,e}}ch.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",ch);class nc extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}nc.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",nc);class hh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,c)}emplace(e,i,o,c,f){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=o,this.float32[m+2]=c,this.float32[m+3]=f,e}}hh.prototype.bytesPerElement=16,st("StructArrayLayout4f16",hh);class g extends vl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new F(this.anchorPointX,this.anchorPointY)}}g.prototype.size=20;class t extends Ql{get(e){return new g(this,e)}}st("CollisionBoxArray",t);class n extends vl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}n.prototype.size=48;class u extends Ns{get(e){return new n(this,e)}}st("PlacedSymbolArray",u);class p extends vl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class y extends lh{get(e){return new p(this,e)}}st("SymbolInstanceArray",y);class x extends tu{getoffsetX(e){return this.float32[1*e+0]}}st("GlyphOffsetArray",x);class M extends ec{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}st("SymbolLineVertexArray",M);class E extends vl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}E.prototype.size=12;class z extends js{get(e){return new E(this,e)}}st("TextAnchorOffsetArray",z);class R extends vl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}R.prototype.size=8;class j extends uh{get(e){return new R(this,e)}}st("FeatureIndexArray",j);class N extends Kl{}class G extends Kl{}class X extends Kl{}class ie extends rh{}class ne extends nh{}class re extends Jl{}class ae extends tc{}class he extends oh{}class se extends ah{}class de extends ba{}class ve extends ic{}class ce extends rc{}class Te extends sh{}class Re extends Os{}class Ce extends ch{}const ze=rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Oe}=ze;class He{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,c){const f=this.segments[this.segments.length-1];return e>He.MAX_VERTEX_ARRAY_LENGTH&&yr(`Max vertices per segment is ${He.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${He.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+e>He.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c?this.createNewSegment(i,o,c):f}createNewSegment(e,i,o){const c={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(c.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(c),c}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,c){return new He([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function et(r,e){return 256*(r=Bt(Math.floor(r),0,255))+Bt(Math.floor(e),0,255)}He.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",He);const We=rr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),gt=rr([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var zt,di,ki,yi={exports:{}},Ni={exports:{}},Ai={exports:{}},Lr=(function(){if(ki)return yi.exports;ki=1;var r=(zt||(zt=1,Ni.exports=function(i,o){var c,f,m,v,T,I,C,D;for(f=i.length-(c=3&i.length),m=o,T=3432918353,I=461845907,D=0;D<f;)C=255&i.charCodeAt(D)|(255&i.charCodeAt(++D))<<8|(255&i.charCodeAt(++D))<<16|(255&i.charCodeAt(++D))<<24,++D,m=27492+(65535&(v=5*(65535&(m=(m^=C=(65535&(C=(C=(65535&C)*T+(((C>>>16)*T&65535)<<16)&4294967295)<<15|C>>>17))*I+(((C>>>16)*I&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(C=0,c){case 3:C^=(255&i.charCodeAt(D+2))<<16;case 2:C^=(255&i.charCodeAt(D+1))<<8;case 1:m^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(D)))*T+(((C>>>16)*T&65535)<<16)&4294967295)<<15|C>>>17))*I+(((C>>>16)*I&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Ni.exports),e=(di||(di=1,Ai.exports=function(i,o){for(var c,f=i.length,m=o^f,v=0;f>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:m^=(255&i.charCodeAt(v+2))<<16;case 2:m^=(255&i.charCodeAt(v+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(v)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Ai.exports);return yi.exports=r,yi.exports.murmur3=r,yi.exports.murmur2=e,yi.exports})(),Ri=$(Lr);class vr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,c){this.ids.push(nr(e)),this.positions.push(i,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=nr(e);let o=0,c=this.ids.length-1;for(;o<c;){const m=o+c>>1;this.ids[m]>=i?c=m:o=m+1}const f=[];for(;this.ids[o]===i;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(e,i){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return or(o,c,0,o.length-1),i&&i.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const i=new vr;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function nr(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Ri(String(r))}function or(r,e,i,o){for(;i<o;){const c=r[i+o>>1];let f=i-1,m=o+1;for(;;){do f++;while(r[f]<c);do m--;while(r[m]>c);if(f>=m)break;Kr(r,f,m),Kr(e,3*f,3*m),Kr(e,3*f+1,3*m+1),Kr(e,3*f+2,3*m+2)}m-i<o-m?(or(r,e,i,m),i=m+1):(or(r,e,m+1,o),o=m)}}function Kr(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}st("FeaturePositionMap",vr);class Tn{constructor(e,i){this.gl=e.gl,this.location=i}}class Ho extends Tn{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class os extends Tn{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Vs extends Tn{constructor(e,i){super(e,i),this.current=Ft.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const oc=new Float32Array(16);function xl(r){return[et(255*r.r,255*r.g),et(255*r.b,255*r.a)]}class Xo{constructor(e,i,o){this.value=e,this.uniformNames=i.map((c=>`u_${c}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Vs(e,i):new Ho(e,i)}}class Br{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,c){let f=null;c==="u_pattern_to"?f=this.patternTo:c==="u_pattern_from"?f=this.patternFrom:c==="u_dasharray_to"?f=this.dashTo:c==="u_dasharray_from"?f=this.dashFrom:c==="u_pixel_ratio_to"?f=this.pixelRatioTo:c==="u_pixel_ratio_from"&&(f=this.pixelRatioFrom),f!==null&&e.set(f)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new os(e,i):new Ho(e,i)}}class sn{constructor(e,i,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(e,i,o){const c=this.paintVertexArray.length,f=this.expression.evaluate(new Si(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(c,e,f)}updatePaintArray(e,i,o,c,f){const m=this.expression.evaluate(new Si(0,f),o,c);this._setPaintValue(e,i,m)}_setPaintValue(e,i,o){if(this.type==="color"){const c=xl(o);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jr{constructor(e,i,o,c,f,m){this.expression=e,this.uniformNames=i.map((v=>`u_${v}_t`)),this.type=o,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map((v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(e,i,o){const c=this.expression.evaluate(new Si(this.zoom,o),i,{},o.canonical,[],o.formattedSection),f=this.expression.evaluate(new Si(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,c,f)}updatePaintArray(e,i,o,c,f){const m=this.expression.evaluate(new Si(this.zoom,f),o,c),v=this.expression.evaluate(new Si(this.zoom+1,f),o,c);this._setPaintValue(e,i,m,v)}_setPaintValue(e,i,o,c){if(this.type==="color"){const f=xl(o),m=xl(c);for(let v=e;v<i;v++)this.paintVertexArray.emplace(v,f[0],f[1],m[0],m[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,c=Bt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,i,o){return new Ho(e,i)}}class oo{constructor(e,i,o,c,f,m){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,i,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,c,f){this._setPaintValues(e,i,this.getPositionIds(o),f)}_setPaintValues(e,i,o,c){const f=this.getPositions(c);if(!f||!o)return;const m=f[o.min],v=f[o.mid],T=f[o.max];if(m&&v&&T)for(let I=e;I<i;I++)this.emplace(this.zoomInPaintVertexArray,I,v,m),this.emplace(this.zoomOutPaintVertexArray,I,v,T)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class xr extends oo{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return We.members}emplace(e,i,o,c){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],c.tlbr[0],c.tlbr[1],c.tlbr[2],c.tlbr[3],o.pixelRatio,c.pixelRatio)}}class kr extends oo{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return gt.members}emplace(e,i,o,c){e.emplace(i,0,o.y,o.height,o.width,0,c.y,c.height,c.width)}}class Zn{constructor(e,i,o){this.binders={},this._buffers=[];const c=[];for(const f in e.paint._values){if(!o(f))continue;const m=e.paint.get(f);if(!(m instanceof Wo&&bo(m.property.specification)))continue;const v=Xd(f,e.type),T=m.value,I=m.property.specification.type,C=m.property.useIntegerZoom,D=m.property.specification["property-type"],B=D==="cross-faded"||D==="cross-faded-data-driven";if(T.kind==="constant")this.binders[f]=B?new Br(T.value,v):new Xo(T.value,v,I),c.push(`/u_${f}`);else if(T.kind==="source"||B){const O=Mp(f,I,"source");this.binders[f]=B?f==="line-dasharray"?new kr(T,I,C,i,O,e.id):new xr(T,I,C,i,O,e.id):new sn(T,v,I,O),c.push(`/a_${f}`)}else{const O=Mp(f,I,"composite");this.binders[f]=new Jr(T,v,I,C,i,O),c.push(`/z_${f}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof sn||i instanceof Jr?i.maxValue:0}populatePaintArrays(e,i,o){for(const c in this.binders){const f=this.binders[c];(f instanceof sn||f instanceof Jr||f instanceof oo)&&f.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const c=this.binders[o];c instanceof Br&&c.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const c=this.binders[o];c instanceof Br&&c.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,c,f){let m=!1;for(const v in e){const T=i.getPositions(v);for(const I of T){const C=o.feature(I.index);for(const D in this.binders){const B=this.binders[D];if((B instanceof sn||B instanceof Jr||B instanceof oo)&&B.expression.isStateDependent===!0){const O=c.paint.get(D);B.expression=O.value,B.updatePaintArray(I.start,I.end,C,e[v],f),m=!0}}}}return m}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Xo||o instanceof Br)&&e.push(...o.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof sn||o instanceof Jr)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof oo){const c=o.getVertexAttributes();for(const f of c)e.push(f.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Xo||o instanceof Br||o instanceof Jr)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Xo||f instanceof Br||f instanceof Jr){for(const m of f.uniformNames)if(i[m]){const v=f.getBinding(e,i[m],m);o.push({name:m,property:c,binding:v})}}}return o}setUniforms(e,i,o,c){for(const{name:f,property:m,binding:v}of i)this.binders[m].setUniform(v,c,o.get(m),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof oo){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof sn||o instanceof Jr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof sn||o instanceof Jr||o instanceof oo)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof sn||i instanceof Jr||i instanceof oo)&&i.destroy()}}}class Hi{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Zn(c,i,o);this.needsUpload=!1,this._featureMap=new vr,this._bufferOffset=0}populatePaintArrays(e,i,o,c){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,i,c);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,c){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Xd(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Mp(r,e,i){const o={color:{source:Jl,composite:hh},number:{source:tu,composite:Jl}},c=(function(f){return{"line-pattern":{source:ae,composite:ae},"fill-pattern":{source:ae,composite:ae},"fill-extrusion-pattern":{source:ae,composite:ae},"line-dasharray":{source:he,composite:he}}[f]})(r);return c&&c[i]||o[e][i]}st("ConstantBinder",Xo),st("CrossFadedConstantBinder",Br),st("SourceExpressionBinder",sn),st("CrossFadedPatternBinder",xr),st("CrossFadedDasharrayBinder",kr),st("CompositeExpressionBinder",Jr),st("ProgramConfiguration",Zn,{omit:["_buffers"]}),st("ProgramConfigurationSet",Hi);const ph=Math.pow(2,14)-1,Ip=-ph-1;function Us(r){const e=si/r.extent,i=r.loadGeometry();for(let o=0;o<i.length;o++){const c=i[o];for(let f=0;f<c.length;f++){const m=c[f],v=Math.round(m.x*e),T=Math.round(m.y*e);m.x=Bt(v,Ip,ph),m.y=Bt(T,Ip,ph),(v<m.x||v>m.x+1||T<m.y||T>m.y+1)&&yr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Zs(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Us(r):[]}}const as=-32768;function Ap(r,e,i,o,c){r.emplaceBack(as+8*e+o,as+8*i+c)}class ac{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new G,this.indexArray=new Re,this.segments=new He,this.programConfigurations=new Hi(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const c=this.layers[0],f=[];let m=null,v=!1,T=c.type==="heatmap";if(c.type==="circle"){const C=c;m=C.layout.get("circle-sort-key"),v=!m.isConstant(),T=T||C.paint.get("circle-pitch-alignment")==="map"}const I=T?i.subdivisionGranularity.circle:1;for(const{feature:C,id:D,index:B,sourceLayerIndex:O}of e){const U=this.layers[0]._featureFilter.needGeometry,Z=Zs(C,U);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),Z,o))continue;const q=v?m.evaluate(Z,{},o):void 0,Y={id:D,properties:C.properties,type:C.type,sourceLayerIndex:O,index:B,geometry:U?Z.geometry:Us(C),patterns:{},sortKey:q};f.push(Y)}v&&f.sort(((C,D)=>C.sortKey-D.sortKey));for(const C of f){const{geometry:D,index:B,sourceLayerIndex:O}=C,U=e[B].feature;this.addFeature(C,D,B,o,I),i.featureIndex.insert(U,D,B,O,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Oe),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,c,f=1){let m;switch(f){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const v=m.length;for(const T of i)for(const I of T){const C=I.x,D=I.y;if(C<0||C>=si||D<0||D>=si)continue;const B=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,e.sortKey),O=B.vertexLength;for(let U=0;U<v;U++)for(let Z=0;Z<v;Z++)Ap(this.layoutVertexArray,C,D,m[Z],m[U]);for(let U=0;U<v-1;U++)for(let Z=0;Z<v-1;Z++){const q=O+U*v+Z,Y=O+(U+1)*v+Z;this.indexArray.emplaceBack(q,Y+1,q+1),this.indexArray.emplaceBack(q,Y,Y+1)}B.vertexLength+=v*v,B.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:c})}}function dh(r,e){for(let i=0;i<r.length;i++)if(sc(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(sc(r,e[i]))return!0;return!!Yd(r,e)}function bl(r,e,i){return!!sc(r,e)||!!Kd(e,r,i)}function fh(r,e){if(r.length===1)return hg(e,r[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let c=0;c<o.length;c++)if(sc(r,o[c]))return!0}for(let i=0;i<r.length;i++)if(hg(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Yd(r,e[i]))return!0;return!1}function mh(r,e,i){if(r.length>1){if(Yd(r,e))return!0;for(let o=0;o<e.length;o++)if(Kd(e[o],r,i))return!0}for(let o=0;o<r.length;o++)if(Kd(r[o],e,i))return!0;return!1}function Yd(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const o=r[i],c=r[i+1];for(let f=0;f<e.length-1;f++)if(ox(o,c,e[f],e[f+1]))return!0}return!1}function ox(r,e,i,o){return fn(r,i,o)!==fn(e,i,o)&&fn(r,e,i)!==fn(r,e,o)}function Kd(r,e,i){const o=i*i;if(e.length===1)return r.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(cg(r,e[c-1],e[c])<o)return!0;return!1}function cg(r,e,i){const o=e.distSqr(i);if(o===0)return r.distSqr(e);const c=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/o;return r.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function hg(r,e){let i,o,c,f=!1;for(let m=0;m<r.length;m++){i=r[m];for(let v=0,T=i.length-1;v<i.length;T=v++)o=i[v],c=i[T],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(f=!f)}return f}function sc(r,e){let i=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const f=r[o],m=r[c];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function ax(r,e,i){const o=i[0],c=i[2];if(r.x<o.x&&e.x<o.x||r.x>c.x&&e.x>c.x||r.y<o.y&&e.y<o.y||r.y>c.y&&e.y>c.y)return!1;const f=fn(r,e,i[0]);return f!==fn(r,e,i[1])||f!==fn(r,e,i[2])||f!==fn(r,e,i[3])}function lc(r,e,i){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(r)}function Ep(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Cp(r,e,i,o,c){if(!e[0]&&!e[1])return r;const f=F.convert(e)._mult(c);i==="viewport"&&f._rotate(-o);const m=[];for(let v=0;v<r.length;v++)m.push(r[v].sub(f));return m}function sx(r){const e=[];for(let i=0;i<r.length;i++){const o=r[i],c=e.at(-1);(i===0||c&&!o.equals(c))&&e.push(o)}return e}function lx({queryGeometry:r,size:e},i){return bl(r,i,e)}function ux({queryGeometry:r,size:e,transform:i,unwrappedTileID:o,getElevation:c},f){return bl(r,f,e*(i.projectTileCoordinates(f.x,f.y,o,c).signedDistanceFromCamera/i.cameraToCenterDistance))}function cx({queryGeometry:r,size:e,transform:i,unwrappedTileID:o,getElevation:c},f){const m=i.projectTileCoordinates(f.x,f.y,o,c).signedDistanceFromCamera,v=e*(i.cameraToCenterDistance/m);return bl(r,Jd(f,i,o,c),v)}function hx({queryGeometry:r,size:e,transform:i,unwrappedTileID:o,getElevation:c},f){return bl(r,Jd(f,i,o,c),e)}function pg({queryGeometry:r,size:e,transform:i,unwrappedTileID:o,getElevation:c,pitchAlignment:f="map",pitchScale:m="map"},v){const T=f==="map"?m==="map"?lx:ux:m==="map"?cx:hx,I={queryGeometry:r,size:e,transform:i,unwrappedTileID:o,getElevation:c};for(const C of v)for(const D of C)if(T(I,D))return!0;return!1}function Jd(r,e,i,o){const c=e.projectTileCoordinates(r.x,r.y,i,o).point;return new F((.5*c.x+.5)*e.width,(.5*-c.y+.5)*e.height)}let dg,fg;st("CircleBucket",ac,{omit:["layers"]});var px={get paint(){return fg=fg||new wn({"circle-radius":new St(Le.paint_circle["circle-radius"]),"circle-color":new St(Le.paint_circle["circle-color"]),"circle-blur":new St(Le.paint_circle["circle-blur"]),"circle-opacity":new St(Le.paint_circle["circle-opacity"]),"circle-translate":new yt(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new yt(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yt(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yt(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Le.paint_circle["circle-stroke-opacity"])})},get layout(){return dg=dg||new wn({"circle-sort-key":new St(Le.layout_circle["circle-sort-key"])})}};class dx extends Un{constructor(e,i){super(e,px,i)}createBucket(e){return new ac(e)}queryRadius(e){const i=e;return lc("circle-radius",this,i)+lc("circle-stroke-width",this,i)+Ep(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:c,transform:f,pixelsToTileUnits:m,unwrappedTileID:v,getElevation:T}){const I=Cp(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,m),C=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),D=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let O,U;return B==="map"?(O=I,U=C*m):(O=(function(Z,q,Y,le){return Z.map((J=>Jd(J,q,Y,le)))})(I,f,v,T),U=C),pg({queryGeometry:O,size:U,transform:f,unwrappedTileID:v,getElevation:T,pitchAlignment:B,pitchScale:D},c)}}class mg extends ac{}let gg;st("HeatmapBucket",mg,{omit:["layers"]});var fx={get paint(){return gg=gg||new wn({"heatmap-radius":new St(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yt(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bs(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yt(Le.paint_heatmap["heatmap-opacity"])})}};function Qd(r,{width:e,height:i},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*i*o}`)}else c=new Uint8Array(e*i*o);return r.width=e,r.height=i,r.data=c,r}function _g(r,{width:e,height:i},o){if(e===r.width&&i===r.height)return;const c=Qd({},{width:e,height:i},o);ef(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,i)},o),r.width=e,r.height=i,r.data=c.data}function ef(r,e,i,o,c,f){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||i.x>r.width-c.width||i.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=r.data,v=e.data;if(m===v)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<c.height;T++){const I=((i.y+T)*r.width+i.x)*f,C=((o.y+T)*e.width+o.x)*f;for(let D=0;D<c.width*f;D++)v[C+D]=m[I+D]}return e}class gh{constructor(e,i){Qd(this,e,1,i)}resize(e){_g(this,e,1)}clone(){return new gh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,f){ef(e,i,o,c,f,1)}}class Gn{constructor(e,i){Qd(this,e,4,i)}resize(e){_g(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Gn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,f){ef(e,i,o,c,f,4)}setPixel(e,i,o){const c=4*(e*this.width+i);this.data[c+0]=Math.round(255*o.r/o.a),this.data[c+1]=Math.round(255*o.g/o.a),this.data[c+2]=Math.round(255*o.b/o.a),this.data[c+3]=Math.round(255*o.a)}}function yg(r){const e={},i=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new Gn({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const f=(m,v,T)=>{e[r.evaluationKey]=T;const I=r.expression.evaluate(e);c.setPixel(m/4/i,v/4,I)};if(r.clips)for(let m=0,v=0;m<o;++m,v+=4*i)for(let T=0,I=0;T<i;T++,I+=4){const C=T/(i-1),{start:D,end:B}=r.clips[m];f(v,I,D*(1-C)+B*C)}else for(let m=0,v=0;m<i;m++,v+=4)f(0,v,m/(i-1));return c}st("AlphaImage",gh),st("RGBAImage",Gn);const tf="big-fb";class mx extends Un{createBucket(e){return new mg(e)}constructor(e,i){super(e,fx,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(tf)&&this.heatmapFbos.delete(tf)}queryRadius(e){return lc("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:c,transform:f,pixelsToTileUnits:m,unwrappedTileID:v,getElevation:T}){return pg({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*m,transform:f,unwrappedTileID:v,getElevation:T},c)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let vg;var gx={get paint(){return vg=vg||new wn({"hillshade-illumination-direction":new yt(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new yt(Le.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new yt(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yt(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yt(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yt(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yt(Le.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new yt(Le.paint_hillshade["hillshade-method"])})}};class _x extends Un{constructor(e,i){super(e,gx,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,c=this.paint.get("hillshade-shadow-color").values;const f=Math.max(e.length,i.length,o.length,c.length);e=e.concat(Array(f-e.length).fill(e.at(-1))),i=i.concat(Array(f-i.length).fill(i.at(-1))),o=o.concat(Array(f-o.length).fill(o.at(-1))),c=c.concat(Array(f-c.length).fill(c.at(-1)));const m=i.map(Da);return{directionRadians:e.map(Da),altitudeRadians:m,shadowColor:c,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let xg;var yx={get paint(){return xg=xg||new wn({"color-relief-opacity":new yt(Le["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Bs(Le["paint_color-relief"]["color-relief-color"])})}};class rf{constructor(e,i,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,o){const{width:c,height:f}=e,m=!(this.size&&this.size[0]===c&&this.size[1]===f||o),{context:v}=this,{gl:T}=v;if(this.useMipmap=!!(i&&i.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!i||i.premultiply!==!1)),m)this.size=[c,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Dn(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,c,f,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:I,y:C}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Dn(e)?T.texSubImage2D(T.TEXTURE_2D,0,I,C,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,I,C,c,f,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),o!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class bg{constructor(e,i,o,c=1,f=1,m=1,v=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void yr(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const T=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=f,this.blueFactor=m,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<T;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(T,I)]=this.data[this._idx(T-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,T)]=this.data[this._idx(I,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<T;I++)for(let C=0;C<T;C++){const D=this.get(I,C);D>this.max&&(this.max=D),D<this.min&&(this.min=D)}}get(e,i){const o=new Uint8Array(this.data.buffer),c=4*this._idx(e,i);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return wg(e,this.getUnpackVector())}getPixels(){return new Gn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,f=i*this.dim+this.dim,m=o*this.dim,v=o*this.dim+this.dim;switch(i){case-1:c=f-1;break;case 1:f=c+1}switch(o){case-1:m=v-1;break;case 1:v=m+1}const T=-i*this.dim,I=-o*this.dim;for(let C=m;C<v;C++)for(let D=c;D<f;D++)this.data[this._idx(D,C)]=e.data[this._idx(D+T,C+I)]}}function wg(r,e){const i=e[0],o=e[1],c=e[2],f=e[3],m=Math.min(i,o,c),v=Math.round((r+f)/m);return{r:Math.floor(v*m/i)%256,g:Math.floor(v*m/o)%256,b:Math.floor(v*m/c)%256}}st("DEMData",bg);class vx extends Un{constructor(e,i){super(e,yx,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof _&&o._styleExpression.expression instanceof qi){this.colorRampExpression=o;const m=o._styleExpression.expression;i.elevationStops=m.labels,i.colorStops=[];for(const v of i.elevationStops)i.colorStops.push(m.evaluate({globals:{elevation:v}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Ft.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const c={elevationStops:[],colorStops:[]},f=(i.elevationStops.length-1)/(e-1);for(let m=0;m<i.elevationStops.length-.5;m+=f)c.elevationStops.push(i.elevationStops[Math.round(m)]),c.colorStops.push(i.colorStops[Math.round(m)]);return yr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),c}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const c=this._createColorRamp(i),f=new Gn({width:c.colorStops.length,height:1}),m=new Gn({width:c.colorStops.length,height:1});for(let v=0;v<c.elevationStops.length;v++){const T=wg(c.elevationStops[v],o);m.setPixel(0,v,new Ft(T.r/255,T.g/255,T.b/255,1)),f.setPixel(0,v,c.colorStops[v])}return this.colorRampTextures={elevationTexture:new rf(e,m,e.gl.RGBA),colorTexture:new rf(e,f,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const xx=rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:bx}=xx;function Lp(r,e,i){const o=i.patternDependencies;let c=!1;for(const f of e){const m=f.paint.get(`${r}-pattern`);m.isConstant()||(c=!0);const v=m.constantOr(null);v&&(c=!0,o[v.to]=!0,o[v.from]=!0)}return c}function nf(r,e,i,o,c){const{zoom:f}=o,m=c.patternDependencies;for(const v of e){const T=v.paint.get(`${r}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:f-1},i,{},c.availableImages),C=T.evaluate({zoom:f},i,{},c.availableImages),D=T.evaluate({zoom:f+1},i,{},c.availableImages);I=I&&I.name?I.name:I,C=C&&C.name?C.name:C,D=D&&D.name?D.name:D,m[I]=!0,m[C]=!0,m[D]=!0,i.patterns[v.id]={min:I,mid:C,max:D}}}return i}function Tg(r,e,i,o,c){let f;if(c===(function(m,v,T,I){let C=0;for(let D=v,B=T-I;D<T;D+=I)C+=(m[B]-m[D])*(m[D+1]+m[B+1]),B=D;return C})(r,e,i,o)>0)for(let m=e;m<i;m+=o)f=Ig(m/o|0,r[m],r[m+1],f);else for(let m=i-o;m>=e;m-=o)f=Ig(m/o|0,r[m],r[m+1],f);return f&&uc(f,f.next)&&(xh(f),f=f.next),f}function iu(r,e){if(!r)return r;e||(e=r);let i,o=r;do if(i=!1,o.steiner||!uc(o,o.next)&&fr(o.prev,o,o.next)!==0)o=o.next;else{if(xh(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function _h(r,e,i,o,c,f,m){if(!r)return;!m&&f&&(function(T,I,C,D){let B=T;do B.z===0&&(B.z=of(B.x,B.y,I,C,D)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==T);B.prevZ.nextZ=null,B.prevZ=null,(function(O){let U,Z=1;do{let q,Y=O;O=null;let le=null;for(U=0;Y;){U++;let J=Y,te=0;for(let pe=0;pe<Z&&(te++,J=J.nextZ,J);pe++);let ue=Z;for(;te>0||ue>0&&J;)te!==0&&(ue===0||!J||Y.z<=J.z)?(q=Y,Y=Y.nextZ,te--):(q=J,J=J.nextZ,ue--),le?le.nextZ=q:O=q,q.prevZ=le,le=q;Y=J}le.nextZ=null,Z*=2}while(U>1)})(B)})(r,o,c,f);let v=r;for(;r.prev!==r.next;){const T=r.prev,I=r.next;if(f?Tx(r,o,c,f):wx(r))e.push(T.i,r.i,I.i),xh(r),r=I.next,v=I.next;else if((r=I)===v){m?m===1?_h(r=Sx(iu(r),e),e,i,o,c,f,2):m===2&&Px(r,e,i,o,c,f):_h(iu(r),e,i,o,c,f,1);break}}}function wx(r){const e=r.prev,i=r,o=r.next;if(fr(e,i,o)>=0)return!1;const c=e.x,f=i.x,m=o.x,v=e.y,T=i.y,I=o.y,C=Math.min(c,f,m),D=Math.min(v,T,I),B=Math.max(c,f,m),O=Math.max(v,T,I);let U=o.next;for(;U!==e;){if(U.x>=C&&U.x<=B&&U.y>=D&&U.y<=O&&yh(c,v,f,T,m,I,U.x,U.y)&&fr(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Tx(r,e,i,o){const c=r.prev,f=r,m=r.next;if(fr(c,f,m)>=0)return!1;const v=c.x,T=f.x,I=m.x,C=c.y,D=f.y,B=m.y,O=Math.min(v,T,I),U=Math.min(C,D,B),Z=Math.max(v,T,I),q=Math.max(C,D,B),Y=of(O,U,e,i,o),le=of(Z,q,e,i,o);let J=r.prevZ,te=r.nextZ;for(;J&&J.z>=Y&&te&&te.z<=le;){if(J.x>=O&&J.x<=Z&&J.y>=U&&J.y<=q&&J!==c&&J!==m&&yh(v,C,T,D,I,B,J.x,J.y)&&fr(J.prev,J,J.next)>=0||(J=J.prevZ,te.x>=O&&te.x<=Z&&te.y>=U&&te.y<=q&&te!==c&&te!==m&&yh(v,C,T,D,I,B,te.x,te.y)&&fr(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;J&&J.z>=Y;){if(J.x>=O&&J.x<=Z&&J.y>=U&&J.y<=q&&J!==c&&J!==m&&yh(v,C,T,D,I,B,J.x,J.y)&&fr(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;te&&te.z<=le;){if(te.x>=O&&te.x<=Z&&te.y>=U&&te.y<=q&&te!==c&&te!==m&&yh(v,C,T,D,I,B,te.x,te.y)&&fr(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function Sx(r,e){let i=r;do{const o=i.prev,c=i.next.next;!uc(o,c)&&Pg(o,i,i.next,c)&&vh(o,c)&&vh(c,o)&&(e.push(o.i,i.i,c.i),xh(i),xh(i.next),i=r=c),i=i.next}while(i!==r);return iu(i)}function Px(r,e,i,o,c,f){let m=r;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&Cx(m,v)){let T=Mg(m,v);return m=iu(m,m.next),T=iu(T,T.next),_h(m,e,i,o,c,f,0),void _h(T,e,i,o,c,f,0)}v=v.next}m=m.next}while(m!==r)}function Mx(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function Ix(r,e){const i=(function(c,f){let m=f;const v=c.x,T=c.y;let I,C=-1/0;if(uc(c,m))return m;do{if(uc(c,m.next))return m.next;if(T<=m.y&&T>=m.next.y&&m.next.y!==m.y){const Z=m.x+(T-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(Z<=v&&Z>C&&(C=Z,I=m.x<m.next.x?m:m.next,Z===v))return I}m=m.next}while(m!==f);if(!I)return null;const D=I,B=I.x,O=I.y;let U=1/0;m=I;do{if(v>=m.x&&m.x>=B&&v!==m.x&&Sg(T<O?v:C,T,B,O,T<O?C:v,T,m.x,m.y)){const Z=Math.abs(T-m.y)/(v-m.x);vh(m,c)&&(Z<U||Z===U&&(m.x>I.x||m.x===I.x&&Ax(I,m)))&&(I=m,U=Z)}m=m.next}while(m!==D);return I})(r,e);if(!i)return e;const o=Mg(i,r);return iu(o,o.next),iu(i,i.next)}function Ax(r,e){return fr(r.prev,r,e.prev)<0&&fr(e.next,r,r.next)<0}function of(r,e,i,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ex(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Sg(r,e,i,o,c,f,m,v){return(c-m)*(e-v)>=(r-m)*(f-v)&&(r-m)*(o-v)>=(i-m)*(e-v)&&(i-m)*(f-v)>=(c-m)*(o-v)}function yh(r,e,i,o,c,f,m,v){return!(r===m&&e===v)&&Sg(r,e,i,o,c,f,m,v)}function Cx(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(i,o){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==o.i&&c.next.i!==o.i&&Pg(c,c.next,i,o))return!0;c=c.next}while(c!==i);return!1})(r,e)&&(vh(r,e)&&vh(e,r)&&(function(i,o){let c=i,f=!1;const m=(i.x+o.x)/2,v=(i.y+o.y)/2;do c.y>v!=c.next.y>v&&c.next.y!==c.y&&m<(c.next.x-c.x)*(v-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==i);return f})(r,e)&&(fr(r.prev,r,e.prev)||fr(r,e.prev,e))||uc(r,e)&&fr(r.prev,r,r.next)>0&&fr(e.prev,e,e.next)>0)}function fr(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function uc(r,e){return r.x===e.x&&r.y===e.y}function Pg(r,e,i,o){const c=zp(fr(r,e,i)),f=zp(fr(r,e,o)),m=zp(fr(i,o,r)),v=zp(fr(i,o,e));return c!==f&&m!==v||!(c!==0||!kp(r,i,e))||!(f!==0||!kp(r,o,e))||!(m!==0||!kp(i,r,o))||!(v!==0||!kp(i,e,o))}function kp(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function zp(r){return r>0?1:r<0?-1:0}function vh(r,e){return fr(r.prev,r,r.next)<0?fr(r,e,r.next)>=0&&fr(r,r.prev,e)>=0:fr(r,e,r.prev)<0||fr(r,r.next,e)<0}function Mg(r,e){const i=af(r.i,r.x,r.y),o=af(e.i,e.x,e.y),c=r.next,f=e.prev;return r.next=e,e.prev=r,i.next=c,c.prev=i,o.next=i,i.prev=o,f.next=o,o.prev=f,o}function Ig(r,e,i,o){const c=af(r,e,i);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function xh(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function af(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class cc{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Dp{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Dp.noSubdivision=new Dp({fill:new cc(0,0),line:new cc(0,0),tile:new cc(0,0),stencil:new cc(0,0),circle:1}),st("SubdivisionGranularityExpression",cc),st("SubdivisionGranularitySetting",Dp);const hc=-32768,bh=32767;class Lx{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=si/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),c=0|Math.round(i),f=this._getKey(o,c);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,m),this._vertexBuffer.push(o,c),m}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(c,f){const m=[];for(let v=0;v<f.length;v+=3){const T=f[v],I=f[v+1],C=f[v+2],D=c[2*T],B=c[2*T+1];(c[2*I]-D)*(c[2*C+1]-B)-(c[2*I+1]-B)*(c[2*C]-D)>0?(m.push(T),m.push(C),m.push(I)):(m.push(T),m.push(I),m.push(C))}return m})(this._vertexBuffer,e);const i=[],o=e.length;for(let c=0;c<o;c+=3){const f=[e[c+0],e[c+1],e[c+2]],m=[this._vertexBuffer[2*e[c+0]+0],this._vertexBuffer[2*e[c+0]+1],this._vertexBuffer[2*e[c+1]+0],this._vertexBuffer[2*e[c+1]+1],this._vertexBuffer[2*e[c+2]+0],this._vertexBuffer[2*e[c+2]+1]];let v=1/0,T=1/0,I=-1/0,C=-1/0;for(let Z=0;Z<3;Z++){const q=m[2*Z],Y=m[2*Z+1];v=Math.min(v,q),I=Math.max(I,q),T=Math.min(T,Y),C=Math.max(C,Y)}if(v===I||T===C)continue;const D=Math.floor(v/this._granularityCellSize),B=Math.ceil(I/this._granularityCellSize),O=Math.floor(T/this._granularityCellSize),U=Math.ceil(C/this._granularityCellSize);if(D!==B||O!==U)for(let Z=O;Z<U;Z++){const q=this._scanlineGenerateVertexRingForCellRow(Z,m,f);kx(this._vertexBuffer,q,i)}else i.push(...f)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const c=e*this._granularityCellSize,f=c+this._granularityCellSize,m=[];for(let v=0;v<3;v++){const T=i[2*v],I=i[2*v+1],C=i[2*(v+1)%6],D=i[(2*(v+1)+1)%6],B=i[2*(v+2)%6],O=i[(2*(v+2)+1)%6],U=C-T,Z=D-I,q=U===0,Y=Z===0,le=(c-I)/Z,J=(f-I)/Z,te=Math.min(le,J),ue=Math.max(le,J);if(!Y&&(te>=1||ue<=0)||Y&&(I<c||I>f)){D>=c&&D<=f&&m.push(o[(v+1)%3]);continue}!Y&&te>0&&m.push(this._vertexToIndex(T+U*te,I+Z*te));const pe=T+U*Math.max(te,0),Ie=T+U*Math.min(ue,1);q||this._generateIntraEdgeVertices(m,T,I,C,D,pe,Ie),!Y&&ue<1&&m.push(this._vertexToIndex(T+U*ue,I+Z*ue)),(Y||D>=c&&D<=f)&&m.push(o[(v+1)%3]),!Y&&(D<=c||D>=f)&&this._generateInterEdgeVertices(m,T,I,C,D,B,O,Ie,c,f)}return m}_generateIntraEdgeVertices(e,i,o,c,f,m,v){const T=c-i,I=f-o,C=I===0,D=C?Math.min(i,c):Math.min(m,v),B=C?Math.max(i,c):Math.max(m,v),O=Math.floor(D/this._granularityCellSize)+1,U=Math.ceil(B/this._granularityCellSize)-1;if(C?i<c:m<v)for(let Z=O;Z<=U;Z++){const q=Z*this._granularityCellSize;e.push(this._vertexToIndex(q,o+I*(q-i)/T))}else for(let Z=U;Z>=O;Z--){const q=Z*this._granularityCellSize;e.push(this._vertexToIndex(q,o+I*(q-i)/T))}}_generateInterEdgeVertices(e,i,o,c,f,m,v,T,I,C){const D=f-o,B=m-c,O=v-f,U=(I-f)/O,Z=(C-f)/O,q=Math.min(U,Z),Y=Math.max(U,Z),le=c+B*q;let J=Math.floor(Math.min(le,T)/this._granularityCellSize)+1,te=Math.ceil(Math.max(le,T)/this._granularityCellSize)-1,ue=T<le;const pe=O===0;if(pe&&(v===I||v===C))return;if(pe||q>=1||Y<=0){const Ge=o-v,je=m+(i-m)*Math.min((I-v)/Ge,(C-v)/Ge);J=Math.floor(Math.min(je,T)/this._granularityCellSize)+1,te=Math.ceil(Math.max(je,T)/this._granularityCellSize)-1,ue=T<je}const Ie=D>0?C:I;if(ue)for(let Ge=J;Ge<=te;Ge++)e.push(this._vertexToIndex(Ge*this._granularityCellSize,Ie));else for(let Ge=te;Ge>=J;Ge--)e.push(this._vertexToIndex(Ge*this._granularityCellSize,Ie))}_generateOutline(e){const i=[];for(const o of e){const c=ru(o,this._granularity,!0),f=this._pointArrayToIndices(c),m=[];for(let v=1;v<f.length;v++)m.push(f[v-1]),m.push(f[v]);i.push(m)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===hc&&(e[i+1]=-32767),o===bh&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,c,f,m){c>f!=(m===hc)?(e.push(i),e.push(o),e.push(this._vertexToIndex(c,m)),e.push(o),e.push(this._vertexToIndex(f,m)),e.push(this._vertexToIndex(c,m))):(e.push(o),e.push(i),e.push(this._vertexToIndex(c,m)),e.push(this._vertexToIndex(f,m)),e.push(o),e.push(this._vertexToIndex(c,m)))}_fillPoles(e,i,o){const c=this._vertexBuffer,f=si,m=e.length;for(let v=2;v<m;v+=3){const T=e[v-2],I=e[v-1],C=e[v],D=c[2*T],B=c[2*T+1],O=c[2*I],U=c[2*I+1],Z=c[2*C],q=c[2*C+1];i&&(B===0&&U===0&&this._generatePoleQuad(e,T,I,D,O,hc),U===0&&q===0&&this._generatePoleQuad(e,I,C,O,Z,hc),q===0&&B===0&&this._generatePoleQuad(e,C,T,Z,D,hc)),o&&(B===f&&U===f&&this._generatePoleQuad(e,T,I,D,O,bh),U===f&&q===f&&this._generatePoleQuad(e,I,C,O,Z,bh),q===f&&B===f&&this._generatePoleQuad(e,C,T,Z,D,bh))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:c}=(function(v){const T=[],I=[];for(const C of v)if(C.length!==0){C!==v[0]&&T.push(I.length/2);for(let D=0;D<C.length;D++)I.push(C[D].x),I.push(C[D].y)}return{flattened:I,holeIndices:T}})(e);let f;this._initializeVertices(o);try{const v=(function(I,C,D=2){const B=C&&C.length,O=B?C[0]*D:I.length;let U=Tg(I,0,O,D,!0);const Z=[];if(!U||U.next===U.prev)return Z;let q,Y,le;if(B&&(U=(function(J,te,ue,pe){const Ie=[];for(let Ge=0,je=te.length;Ge<je;Ge++){const qe=Tg(J,te[Ge]*pe,Ge<je-1?te[Ge+1]*pe:J.length,pe,!1);qe===qe.next&&(qe.steiner=!0),Ie.push(Ex(qe))}Ie.sort(Mx);for(let Ge=0;Ge<Ie.length;Ge++)ue=Ix(Ie[Ge],ue);return ue})(I,C,U,D)),I.length>80*D){q=I[0],Y=I[1];let J=q,te=Y;for(let ue=D;ue<O;ue+=D){const pe=I[ue],Ie=I[ue+1];pe<q&&(q=pe),Ie<Y&&(Y=Ie),pe>J&&(J=pe),Ie>te&&(te=Ie)}le=Math.max(J-q,te-Y),le=le!==0?32767/le:0}return _h(U,Z,D,q,Y,le,0),Z})(o,c),T=this._convertIndices(o,v);f=this._subdivideTrianglesScanline(T)}catch(v){console.error(v)}let m=[];return i&&(m=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:m}}_convertIndices(e,i){const o=[];for(let c=0;c<i.length;c++)o.push(this._vertexToIndex(e[2*i[c]],e[2*i[c]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const c=e[o];i.push(this._vertexToIndex(c.x,c.y))}return i}}function Ag(r,e,i,o=!0){return new Lx(i,e).subdividePolygonInternal(r,o)}function ru(r,e,i=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const o=r[0],c=r[r.length-1],f=i&&(o.x!==c.x||o.y!==c.y);if(e<2)return f?[...r,r[0]]:[...r];const m=Math.floor(si/e),v=[];v.push(new F(r[0].x,r[0].y));const T=r.length,I=f?T:T-1;for(let C=0;C<I;C++){const D=r[C],B=C<T-1?r[C+1]:r[0],O=D.x,U=D.y,Z=B.x,q=B.y,Y=O!==Z,le=U!==q;if(!Y&&!le)continue;const J=Z-O,te=q-U,ue=Math.abs(J),pe=Math.abs(te);let Ie=O,Ge=U;for(;;){const qe=J>0?(Math.floor(Ie/m)+1)*m:(Math.ceil(Ie/m)-1)*m,tt=te>0?(Math.floor(Ge/m)+1)*m:(Math.ceil(Ge/m)-1)*m,Ye=Math.abs(Ie-qe),Ve=Math.abs(Ge-tt),Be=Math.abs(Ie-Z),ct=Math.abs(Ge-q),at=Y?Ye/ue:Number.POSITIVE_INFINITY,dt=le?Ve/pe:Number.POSITIVE_INFINITY;if((Be<=Ye||!Y)&&(ct<=Ve||!le))break;if(at<dt&&Y||!le){Ie=qe,Ge+=te*at;const ot=new F(Ie,Math.round(Ge));v[v.length-1].x===ot.x&&v[v.length-1].y===ot.y||v.push(ot)}else{Ie+=J*dt,Ge=tt;const ot=new F(Math.round(Ie),Ge);v[v.length-1].x===ot.x&&v[v.length-1].y===ot.y||v.push(ot)}}const je=new F(Z,q);v[v.length-1].x===je.x&&v[v.length-1].y===je.y||v.push(je)}return v}function kx(r,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,c=r[2*e[0]];for(let T=1;T<e.length;T++){const I=r[2*e[T]];I<c&&(c=I,o=T)}const f=e.length;let m=o,v=(m+1)%f;for(;;){const T=m-1>=0?m-1:f-1,I=(v+1)%f,C=r[2*e[T]],D=r[2*e[I]],B=r[2*e[m]],O=r[2*e[m]+1],U=r[2*e[v]+1];let Z=!1;if(C<D)Z=!0;else if(C>D)Z=!1;else{const q=U-O,Y=-(r[2*e[v]]-B),le=O<U?1:-1;((C-B)*q+(r[2*e[T]+1]-O)*Y)*le>((D-B)*q+(r[2*e[I]+1]-O)*Y)*le&&(Z=!0)}if(Z){const q=e[T],Y=e[m],le=e[v];q!==Y&&q!==le&&Y!==le&&i.push(le,Y,q),m--,m<0&&(m=f-1)}else{const q=e[I],Y=e[m],le=e[v];q!==Y&&q!==le&&Y!==le&&i.push(le,Y,q),v++,v>=f&&(v=0)}if(T===I)break}}function Eg(r,e,i,o,c,f,m,v,T){const I=c.length/2,C=m&&v&&T;if(I<He.MAX_VERTEX_ARRAY_LENGTH){const D=e.prepareSegment(I,i,o),B=D.vertexLength;for(let Z=0;Z<f.length;Z+=3)o.emplaceBack(B+f[Z],B+f[Z+1],B+f[Z+2]);let O,U;D.vertexLength+=I,D.primitiveLength+=f.length/3,C&&(U=m.prepareSegment(I,i,v),O=U.vertexLength,U.vertexLength+=I);for(let Z=0;Z<c.length;Z+=2)r(c[Z],c[Z+1]);if(C)for(let Z=0;Z<T.length;Z++){const q=T[Z];for(let Y=1;Y<q.length;Y+=2)v.emplaceBack(O+q[Y-1],O+q[Y]);U.primitiveLength+=q.length/2}}else(function(D,B,O,U,Z,q){const Y=[];for(let pe=0;pe<U.length/2;pe++)Y.push(-1);const le={count:0};let J=0,te=D.getOrCreateLatestSegment(B,O),ue=te.vertexLength;for(let pe=2;pe<Z.length;pe+=3){const Ie=Z[pe-2],Ge=Z[pe-1],je=Z[pe];let qe=Y[Ie]<J,tt=Y[Ge]<J,Ye=Y[je]<J;te.vertexLength+((qe?1:0)+(tt?1:0)+(Ye?1:0))>He.MAX_VERTEX_ARRAY_LENGTH&&(te=D.createNewSegment(B,O),J=le.count,qe=!0,tt=!0,Ye=!0,ue=0);const Ve=wh(Y,U,q,le,Ie,qe,te),Be=wh(Y,U,q,le,Ge,tt,te),ct=wh(Y,U,q,le,je,Ye,te);O.emplaceBack(ue+Ve-J,ue+Be-J,ue+ct-J),te.primitiveLength++}})(e,i,o,c,f,r),C&&(function(D,B,O,U,Z,q){const Y=[];for(let pe=0;pe<U.length/2;pe++)Y.push(-1);const le={count:0};let J=0,te=D.getOrCreateLatestSegment(B,O),ue=te.vertexLength;for(let pe=0;pe<Z.length;pe++){const Ie=Z[pe];for(let Ge=1;Ge<Z[pe].length;Ge+=2){const je=Ie[Ge-1],qe=Ie[Ge];let tt=Y[je]<J,Ye=Y[qe]<J;te.vertexLength+((tt?1:0)+(Ye?1:0))>He.MAX_VERTEX_ARRAY_LENGTH&&(te=D.createNewSegment(B,O),J=le.count,tt=!0,Ye=!0,ue=0);const Ve=wh(Y,U,q,le,je,tt,te),Be=wh(Y,U,q,le,qe,Ye,te);O.emplaceBack(ue+Ve-J,ue+Be-J),te.primitiveLength++}}})(m,i,v,c,T,r),e.forceNewSegmentOnNextPrepare(),m?.forceNewSegmentOnNextPrepare()}function wh(r,e,i,o,c,f,m){if(f){const v=o.count;return i(e[2*c],e[2*c+1]),r[c]=o.count,o.count++,m.vertexLength++,v}return r[c]}class sf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new X,this.indexArray=new Re,this.indexArray2=new Ce,this.programConfigurations=new Hi(e.layers,e.zoom),this.segments=new He,this.segments2=new He,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Lp("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),f=!c.isConstant(),m=[];for(const{feature:v,id:T,index:I,sourceLayerIndex:C}of e){const D=this.layers[0]._featureFilter.needGeometry,B=Zs(v,D);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),B,o))continue;const O=f?c.evaluate(B,{},o,i.availableImages):void 0,U={id:T,properties:v.properties,type:v.type,sourceLayerIndex:C,index:I,geometry:D?B.geometry:Us(v),patterns:{},sortKey:O};m.push(U)}f&&m.sort(((v,T)=>v.sortKey-T.sortKey));for(const v of m){const{geometry:T,index:I,sourceLayerIndex:C}=v;if(this.hasDependencies){const D=nf("fill",this.layers,v,{zoom:this.zoom},i);this.patternFeatures.push(D)}else this.addFeature(v,T,I,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[I].feature,T,I,C,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,c,f,m){for(const v of Wa(i,500)){const T=Ag(v,c,m.fill.getGranularityForZoomLevel(c.z)),I=this.layoutVertexArray;Eg(((C,D)=>{I.emplaceBack(C,D)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:c})}}let Cg,Lg;st("FillBucket",sf,{omit:["layers","patternFeatures"]});var zx={get paint(){return Lg=Lg||new wn({"fill-antialias":new yt(Le.paint_fill["fill-antialias"]),"fill-opacity":new St(Le.paint_fill["fill-opacity"]),"fill-color":new St(Le.paint_fill["fill-color"]),"fill-outline-color":new St(Le.paint_fill["fill-outline-color"]),"fill-translate":new yt(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new yt(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new yl(Le.paint_fill["fill-pattern"])})},get layout(){return Cg=Cg||new wn({"fill-sort-key":new St(Le.layout_fill["fill-sort-key"])})}};class Dx extends Un{constructor(e,i){super(e,zx,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new sf(e)}queryRadius(){return Ep(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:c}){return fh(Cp(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,c),i)}isTileClipped(){return!0}}const Rx=rr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Fx=rr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Bx}=Rx;class Th{constructor(e,i,o,c,f){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=f,e.readFields(Ox,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let c,f=1,m=0,v=0,T=0;for(;e.pos<i;){if(m<=0){const I=e.readVarint();f=7&I,m=I>>3}if(m--,f===1||f===2)v+=e.readSVarint(),T+=e.readSVarint(),f===1&&(c&&o.push(c),c=[]),c&&c.push(new F(v,T));else{if(f!==7)throw new Error(`unknown command ${f}`);c&&c.push(c[0].clone())}}return c&&o.push(c),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,c=0,f=0,m=0,v=1/0,T=-1/0,I=1/0,C=-1/0;for(;e.pos<i;){if(c<=0){const D=e.readVarint();o=7&D,c=D>>3}if(c--,o===1||o===2)f+=e.readSVarint(),m+=e.readSVarint(),f<v&&(v=f),f>T&&(T=f),m<I&&(I=m),m>C&&(C=m);else if(o!==7)throw new Error(`unknown command ${o}`)}return[v,I,T,C]}toGeoJSON(e,i,o){const c=this.extent*Math.pow(2,o),f=this.extent*e,m=this.extent*i,v=this.loadGeometry();function T(B){return[360*(B.x+f)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+m)/c)*Math.PI))-90]}function I(B){return B.map(T)}let C;if(this.type===1){const B=[];for(const U of v)B.push(U[0]);const O=I(B);C=B.length===1?{type:"Point",coordinates:O[0]}:{type:"MultiPoint",coordinates:O}}else if(this.type===2){const B=v.map(I);C=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=kg(v),O=[];for(const U of B)O.push(U.map(I));C=O.length===1?{type:"Polygon",coordinates:O[0]}:{type:"MultiPolygon",coordinates:O}}}const D={type:"Feature",geometry:C,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function Ox(r,e,i){r===1?e.id=i.readVarint():r===2?(function(o,c){const f=o.readVarint()+o.pos;for(;o.pos<f;){const m=c._keys[o.readVarint()],v=c._values[o.readVarint()];c.properties[m]=v}})(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function kg(r){const e=r.length;if(e<=1)return[r];const i=[];let o,c;for(let f=0;f<e;f++){const m=Nx(r[f]);m!==0&&(c===void 0&&(c=m<0),c===m<0?(o&&i.push(o),o=[r[f]]):o&&o.push(r[f]))}return o&&i.push(o),i}function Nx(r){let e=0;for(let i,o,c=0,f=r.length,m=f-1;c<f;m=c++)i=r[c],o=r[m],e+=(o.x-i.x)*(i.y+o.y);return e}Th.types=["Unknown","Point","LineString","Polygon"];class jx{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Vx,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Th(this._pbf,i,this.extent,this._keys,this._values)}}function Vx(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push((function(o){let c=null;const f=o.readVarint()+o.pos;for(;o.pos<f;){const m=o.readVarint()>>3;c=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c})(i))}class zg{constructor(e,i){this.layers=e.readFields(Ux,{},i)}}function Ux(r,e,i){if(r===3){const o=new jx(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const lf=Math.pow(2,13);function Sh(r,e,i,o,c,f,m,v){r.emplaceBack(e,i,2*Math.floor(o*lf)+m,c*lf*2,f*lf*2,Math.round(v))}class uf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ie,this.centroidVertexArray=new N,this.indexArray=new Re,this.programConfigurations=new Hi(e.layers,e.zoom),this.segments=new He,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=Lp("fill-extrusion",this.layers,i);for(const{feature:c,id:f,index:m,sourceLayerIndex:v}of e){const T=this.layers[0]._featureFilter.needGeometry,I=Zs(c,T);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),I,o))continue;const C={id:f,sourceLayerIndex:v,index:m,geometry:T?I.geometry:Us(c),properties:c.properties,type:c.type,patterns:{}};this.hasDependencies?this.features.push(nf("fill-extrusion",this.layers,C,{zoom:this.zoom},i)):this.addFeature(C,C.geometry,m,o,{},i.subdivisionGranularity),i.featureIndex.insert(c,C.geometry,m,v,this.index,!0)}}addFeatures(e,i,o){for(const c of this.features){const{geometry:f}=c;this.addFeature(c,f,c.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bx),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Fx.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,c,f,m){for(const v of Wa(i,500)){const T={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(T,c,e,v,m);const C=this.layoutVertexArray.length-I,D=Math.floor(T.x/T.sampleCount),B=Math.floor(T.y/T.sampleCount);for(let O=0;O<C;O++)this.centroidVertexArray.emplaceBack(D,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:c})}processPolygon(e,i,o,c,f){if(c.length<1||Dg(c[0]))return;for(const D of c)D.length!==0&&Zx(e,D);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=f.fill.getGranularityForZoomLevel(i.z),T=Th.types[o.type]==="Polygon";for(const D of c){if(D.length===0||Dg(D))continue;const B=ru(D,v,T);this._generateSideFaces(B,m)}if(!T)return;const I=Ag(c,i,v,!1),C=this.layoutVertexArray;Eg(((D,B)=>{Sh(C,D,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let c=1;c<e.length;c++){const f=e[c],m=e[c-1];if(Gx(f,m))continue;i.segment.vertexLength+4>He.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=f.sub(m)._perp()._unit(),T=m.dist(f);o+T>32768&&(o=0),Sh(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,0,o),Sh(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,1,o),o+=T,Sh(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,0,o),Sh(this.layoutVertexArray,m.x,m.y,v.x,v.y,0,1,o);const I=i.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function Zx(r,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(r.x+=o.x,r.y+=o.y,r.sampleCount++)}}function Gx(r,e){return r.x===e.x&&(r.x<0||r.x>si)||r.y===e.y&&(r.y<0||r.y>si)}function Dg(r){return r.every((e=>e.x<0))||r.every((e=>e.x>si))||r.every((e=>e.y<0))||r.every((e=>e.y>si))}let Rg;st("FillExtrusionBucket",uf,{omit:["layers","features"]});var $x={get paint(){return Rg=Rg||new wn({"fill-extrusion-opacity":new yt(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yt(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yt(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yl(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new St(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new yt(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qx extends Un{constructor(e,i){super(e,$x,i)}createBucket(e){return new uf(e)}queryRadius(){return Ep(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:c,transform:f,pixelsToTileUnits:m,pixelPosMatrix:v}){const T=Cp(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,m),I=this.paint.get("fill-extrusion-height").evaluate(i,o),C=this.paint.get("fill-extrusion-base").evaluate(i,o),D=(function(O,U){const Z=[];for(const q of O){const Y=[q.x,q.y,0,1];Pr(Y,Y,U),Z.push(new F(Y[0]/Y[3],Y[1]/Y[3]))}return Z})(T,v),B=(function(O,U,Z,q){const Y=[],le=[],J=q[8]*U,te=q[9]*U,ue=q[10]*U,pe=q[11]*U,Ie=q[8]*Z,Ge=q[9]*Z,je=q[10]*Z,qe=q[11]*Z;for(const tt of O){const Ye=[],Ve=[];for(const Be of tt){const ct=Be.x,at=Be.y,dt=q[0]*ct+q[4]*at+q[12],ot=q[1]*ct+q[5]*at+q[13],vt=q[2]*ct+q[6]*at+q[14],ii=q[3]*ct+q[7]*at+q[15],Wt=vt+ue,ji=ii+pe,cn=dt+Ie,br=ot+Ge,Vi=vt+je,Fi=ii+qe,fi=new F((dt+J)/ji,(ot+te)/ji);fi.z=Wt/ji,Ye.push(fi);const Qi=new F(cn/Fi,br/Fi);Qi.z=Vi/Fi,Ve.push(Qi)}Y.push(Ye),le.push(Ve)}return[Y,le]})(c,C,I,v);return(function(O,U,Z){let q=1/0;fh(Z,U)&&(q=Fg(Z,U[0]));for(let Y=0;Y<U.length;Y++){const le=U[Y],J=O[Y];for(let te=0;te<le.length-1;te++){const ue=le[te],pe=[ue,le[te+1],J[te+1],J[te],ue];dh(Z,pe)&&(q=Math.min(q,Fg(Z,pe)))}}return q!==1/0&&q})(B[0],B[1],D)}}function Ph(r,e){return r.x*e.x+r.y*e.y}function Fg(r,e){if(r.length===1){let i=0;const o=e[i++];let c;for(;!c||o.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const f=e[i],m=r[0],v=c.sub(o),T=f.sub(o),I=m.sub(o),C=Ph(v,v),D=Ph(v,T),B=Ph(T,T),O=Ph(I,v),U=Ph(I,T),Z=C*B-D*D,q=(B*O-D*U)/Z,Y=(C*U-D*O)/Z,le=o.z*(1-q-Y)+c.z*q+f.z*Y;if(isFinite(le))return le}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const Wx=rr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Hx}=Wx,Xx=rr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Yx}=Xx,Kx=Math.cos(Math.PI/180*37.5),Bg=Math.pow(2,14)/.5;class cf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new ne,this.layoutVertexArray2=new re,this.indexArray=new Re,this.programConfigurations=new Hi(e.layers,e.zoom),this.segments=new He,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Lp("line",this.layers,i)||this.hasLineDasharray(this.layers);const c=this.layers[0].layout.get("line-sort-key"),f=!c.isConstant(),m=[];for(const{feature:v,id:T,index:I,sourceLayerIndex:C}of e){const D=this.layers[0]._featureFilter.needGeometry,B=Zs(v,D);if(!this.layers[0]._featureFilter.filter(new Si(this.zoom),B,o))continue;const O=f?c.evaluate(B,{},o):void 0,U={id:T,properties:v.properties,type:v.type,sourceLayerIndex:C,index:I,geometry:D?B.geometry:Us(v),patterns:{},dashes:{},sortKey:O};m.push(U)}f&&m.sort(((v,T)=>v.sortKey-T.sortKey));for(const v of m){const{geometry:T,index:I,sourceLayerIndex:C}=v;this.hasDependencies?(Lp("line",this.layers,i)?nf("line",this.layers,v,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,v,this.zoom,i),this.patternFeatures.push(v)):this.addFeature(v,T,I,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[I].feature,T,I,C,this.index)}}update(e,i,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:c})}addFeatures(e,i,o,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,o,c,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Yx)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,c,f,m,v){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),C=T.get("line-cap"),D=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const O of i)this.addLine(O,e,I,C,D,B,c,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,dashPositions:m,canonical:c})}addLine(e,i,o,c,f,m,v,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=ru(e,v?T.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=Th.types[i.type]==="Polygon";let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let D=0;for(;D<C-1&&e[D].equals(e[D+1]);)D++;if(C<(I?3:2))return;o==="bevel"&&(f=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let U,Z,q,Y,le;this.e1=this.e2=-1,I&&(U=e[C-2],le=e[D].sub(U)._unit()._perp());for(let J=D;J<C;J++){if(q=J===C-1?I?e[D+1]:void 0:e[J+1],q&&e[J].equals(q))continue;le&&(Y=le),U&&(Z=U),U=e[J],le=q?q.sub(U)._unit()._perp():Y,Y=Y||le;let te=Y.add(le);te.x===0&&te.y===0||te._unit();const ue=Y.x*le.x+Y.y*le.y,pe=te.x*le.x+te.y*le.y,Ie=pe!==0?1/pe:1/0,Ge=2*Math.sqrt(2-2*pe),je=pe<Kx&&Z&&q,qe=Y.x*le.y-Y.y*le.x>0;if(je&&J>D){const Ve=U.dist(Z);if(Ve>2*B){const Be=U.sub(U.sub(Z)._mult(B/Ve)._round());this.updateDistance(Z,Be),this.addCurrentVertex(Be,Y,0,0,O),Z=Be}}const tt=Z&&q;let Ye=tt?o:I?"butt":c;if(tt&&Ye==="round"&&(Ie<m?Ye="miter":Ie<=2&&(Ye="fakeround")),Ye==="miter"&&Ie>f&&(Ye="bevel"),Ye==="bevel"&&(Ie>2&&(Ye="flipbevel"),Ie<f&&(Ye="miter")),Z&&this.updateDistance(Z,U),Ye==="miter")te._mult(Ie),this.addCurrentVertex(U,te,0,0,O);else if(Ye==="flipbevel"){if(Ie>100)te=le.mult(-1);else{const Ve=Ie*Y.add(le).mag()/Y.sub(le).mag();te._perp()._mult(Ve*(qe?-1:1))}this.addCurrentVertex(U,te,0,0,O),this.addCurrentVertex(U,te.mult(-1),0,0,O)}else if(Ye==="bevel"||Ye==="fakeround"){const Ve=-Math.sqrt(Ie*Ie-1),Be=qe?Ve:0,ct=qe?0:Ve;if(Z&&this.addCurrentVertex(U,Y,Be,ct,O),Ye==="fakeround"){const at=Math.round(180*Ge/Math.PI/20);for(let dt=1;dt<at;dt++){let ot=dt/at;if(ot!==.5){const ii=ot-.5;ot+=ot*ii*(ot-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*ii*ii+(.848013+ue*(.215638*ue-1.06021)))}const vt=le.sub(Y)._mult(ot)._add(Y)._unit()._mult(qe?-1:1);this.addHalfVertex(U,vt.x,vt.y,!1,qe,0,O)}}q&&this.addCurrentVertex(U,le,-Be,-ct,O)}else if(Ye==="butt")this.addCurrentVertex(U,te,0,0,O);else if(Ye==="square"){const Ve=Z?1:-1;this.addCurrentVertex(U,te,Ve,Ve,O)}else Ye==="round"&&(Z&&(this.addCurrentVertex(U,Y,0,0,O),this.addCurrentVertex(U,Y,1,1,O,!0)),q&&(this.addCurrentVertex(U,le,-1,-1,O,!0),this.addCurrentVertex(U,le,0,0,O)));if(je&&J<C-1){const Ve=U.dist(q);if(Ve>2*B){const Be=U.add(q.sub(U)._mult(B/Ve)._round());this.updateDistance(U,Be),this.addCurrentVertex(Be,le,0,0,O),U=Be}}}}addCurrentVertex(e,i,o,c,f,m=!1){const v=i.y*c-i.x,T=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,m,!1,o,f),this.addHalfVertex(e,v,T,m,!0,-c,f),this.distance>Bg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,c,f,m))}addHalfVertex({x:e,y:i},o,c,f,m,v,T){const I=.5*(this.lineClips?this.scaledDistance*(Bg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(v===0?0:v<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,C,this.e2),T.primitiveLength++),m?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,c){for(const f of e){const m=f.paint.get("line-dasharray");if(!m||m.value.kind==="constant")continue;const v=f.layout.get("line-cap")==="round",T={dasharray:m.value.evaluate({zoom:o-1},i,{}),round:v},I={dasharray:m.value.evaluate({zoom:o},i,{}),round:v},C={dasharray:m.value.evaluate({zoom:o+1},i,{}),round:v},D=`${T.dasharray.join(",")},${T.round}`,B=`${I.dasharray.join(",")},${I.round}`,O=`${C.dasharray.join(",")},${C.round}`;c.dashDependencies[D]=T,c.dashDependencies[B]=I,c.dashDependencies[O]=C,i.dashes[f.id]={min:D,mid:B,max:O}}}}let Og,Ng;st("LineBucket",cf,{omit:["layers","patternFeatures"]});var jg={get paint(){return Ng=Ng||new wn({"line-opacity":new St(Le.paint_line["line-opacity"]),"line-color":new St(Le.paint_line["line-color"]),"line-translate":new yt(Le.paint_line["line-translate"]),"line-translate-anchor":new yt(Le.paint_line["line-translate-anchor"]),"line-width":new St(Le.paint_line["line-width"]),"line-gap-width":new St(Le.paint_line["line-gap-width"]),"line-offset":new St(Le.paint_line["line-offset"]),"line-blur":new St(Le.paint_line["line-blur"]),"line-dasharray":new yl(Le.paint_line["line-dasharray"]),"line-pattern":new yl(Le.paint_line["line-pattern"]),"line-gradient":new Bs(Le.paint_line["line-gradient"])})},get layout(){return Og=Og||new wn({"line-cap":new yt(Le.layout_line["line-cap"]),"line-join":new St(Le.layout_line["line-join"]),"line-miter-limit":new yt(Le.layout_line["line-miter-limit"]),"line-round-limit":new yt(Le.layout_line["line-round-limit"]),"line-sort-key":new St(Le.layout_line["line-sort-key"])})}};class Jx extends St{possiblyEvaluate(e,i){return i=new Si(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,c){return i=Ui({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,c)}}let Rp;class Qx extends Un{constructor(e,i){super(e,jg,i),this.gradientVersion=0,Rp||(Rp=new Jx(jg.paint.properties["line-width"].specification),Rp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof Vo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=Rp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new cf(e)}queryRadius(e){const i=e,o=Vg(lc("line-width",this,i),lc("line-gap-width",this,i)),c=lc("line-offset",this,i);return o/2+Math.abs(c)+Ep(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:c,transform:f,pixelsToTileUnits:m}){const v=Cp(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,m),T=m/2*Vg(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),I=this.paint.get("line-offset").evaluate(i,o);return I&&(c=(function(C,D){const B=[];for(let O=0;O<C.length;O++){const U=sx(C[O]),Z=[];for(let q=0;q<U.length;q++){const Y=U[q],le=U[q-1],J=U[q+1],te=q===0?new F(0,0):Y.sub(le)._unit()._perp(),ue=q===U.length-1?new F(0,0):J.sub(Y)._unit()._perp(),pe=te._add(ue)._unit(),Ie=pe.x*ue.x+pe.y*ue.y;Ie!==0&&pe._mult(1/Ie),Z.push(pe._mult(D)._add(Y))}B.push(Z)}return B})(c,I*m)),(function(C,D,B){for(let O=0;O<D.length;O++){const U=D[O];if(C.length>=3){for(let Z=0;Z<U.length;Z++)if(sc(C,U[Z]))return!0}if(mh(C,U,B))return!0}return!1})(v,c,T)}isTileClipped(){return!0}}function Vg(r,e){return e>0?e+2*r:r}const eb=rr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tb=rr([{name:"a_projected_pos",components:3,type:"Float32"}],4);rr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ib=rr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);rr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ug=rr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rb=rr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function nb(r,e,i){return r.sections.forEach((o=>{o.text=(function(c,f,m){const v=f.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?c=c.toLocaleUpperCase():v==="lowercase"&&(c=c.toLocaleLowerCase()),xa.applyArabicShaping&&(c=xa.applyArabicShaping(c)),c})(o.text,e,i)})),r}rr([{name:"triangle",components:3,type:"Uint16"}]),rr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),rr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),rr([{type:"Float32",name:"offsetX"}]),rr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),rr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Or=24;const Mh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},ob={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ab={40:!0};function Zg(r,e,i,o,c,f){if("fontStack"in e){const m=i[e.fontStack],v=m&&m[r];return v?v.metrics.advance*e.scale+c:0}{const m=o[e.imageName];return m?m.displaySize[0]*e.scale*Or/f+c:0}}function Gg(r,e,i,o){const c=Math.pow(r-e,2);return o?r<e?c/2:2*c:c+Math.abs(i)*i}function sb(r,e,i){let o=0;return r===10&&(o-=1e4),i&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function $g(r,e,i,o,c,f){let m=null,v=Gg(e,i,c,f);for(const T of o){const I=Gg(e-T.x,i,c,f)+T.badness;I<=v&&(m=T,v=I)}return{index:r,x:e,priorBreak:m,badness:v}}function qg(r){return r?qg(r.priorBreak).concat(r.index):[]}class pc{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new pc;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?o.addImageSection(f):o.addTextSection(f,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const c=e[Symbol.iterator]();let f=c.next();const m=e[Symbol.iterator]();m.next();let v=m.next();for(;!f.done;)i+=!v.done&&Yu(v.value.codePointAt(0))&&!Mh[v.value]||!o.premature&&Yu(o.value.codePointAt(0))&&!Mh[o.value]||!Mh[f.value]?f.value:Mh[f.value],o={value:f.value,premature:!1},f=c.next(),v=m.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),c=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-c),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-c)}substring(e,i){const o=[...this.text].slice(e,i).join(""),c=this.sectionIndex.slice(e,i);return new pc(o,this.sections,c)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let c=0;c<this.length();c++){const f=this.getSection(c);if("imageName"in f){const m=e[f.imageName];if(!m)continue;const v=m.displaySize;i=Math.max(i,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void yr("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):yr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,c,f){const m=[],v=this.determineAverageLineWidth(e,i,o,c,f),T=this.hasZeroWidthSpaces();let I=0,C=0;const D=this.text[Symbol.iterator]();let B=D.next();const O=this.text[Symbol.iterator]();O.next();let U=O.next();const Z=this.text[Symbol.iterator]();Z.next(),Z.next();let q=Z.next();for(;!B.done;){const Y=this.getSection(C),le=B.value.codePointAt(0);if(mp(le)||(I+=Zg(le,Y,o,c,e,f)),!U.done){const J=$d(le),te=U.value.codePointAt(0);(ob[le]||J||"imageName"in Y||!q.done&&ab[te])&&m.push($g(C+1,I,v,m,sb(le,te,J&&T),!1))}C++,B=D.next(),U=O.next(),q=Z.next()}return qg($g(this.length(),I,v,m,0,!0))}determineAverageLineWidth(e,i,o,c,f){let m=0,v=0;for(const T of this.text){const I=this.getSection(v);m+=Zg(T.codePointAt(0),I,o,c,e,f),v++}return m/Math.max(1,Math.ceil(m/i))}}const hf=4294967296,Wg=1/hf,Hg=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Fp{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const c=this.readVarint(),f=c>>3,m=this.pos;this.type=7&c,e(f,i,this),this.pos===m&&this.skip(c)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*hf;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*hf;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,c;return c=i[this.pos++],o=127&c,c<128?o:(c=i[this.pos++],o|=(127&c)<<7,c<128?o:(c=i[this.pos++],o|=(127&c)<<14,c<128?o:(c=i[this.pos++],o|=(127&c)<<21,c<128?o:(c=i[this.pos],o|=(15&c)<<28,(function(f,m,v){const T=v.buf;let I,C;if(C=T[v.pos++],I=(112&C)>>4,C<128||(C=T[v.pos++],I|=(127&C)<<3,C<128)||(C=T[v.pos++],I|=(127&C)<<10,C<128)||(C=T[v.pos++],I|=(127&C)<<17,C<128)||(C=T[v.pos++],I|=(127&C)<<24,C<128)||(C=T[v.pos++],I|=(1&C)<<31,C<128))return dc(f,I,m);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&Hg?Hg.decode(this.buf.subarray(i,e)):(function(o,c,f){let m="",v=c;for(;v<f;){const T=o[v];let I,C,D,B=null,O=T>239?4:T>223?3:T>191?2:1;if(v+O>f)break;O===1?T<128&&(B=T):O===2?(I=o[v+1],(192&I)==128&&(B=(31&T)<<6|63&I,B<=127&&(B=null))):O===3?(I=o[v+1],C=o[v+2],(192&I)==128&&(192&C)==128&&(B=(15&T)<<12|(63&I)<<6|63&C,(B<=2047||B>=55296&&B<=57343)&&(B=null))):O===4&&(I=o[v+1],C=o[v+2],D=o[v+3],(192&I)==128&&(192&C)==128&&(192&D)==128&&(B=(15&T)<<18|(63&I)<<12|(63&C)<<6|63&D,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,O=1):B>65535&&(B-=65536,m+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),m+=String.fromCharCode(B),v+=O}return m})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Wg),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Wg),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let c,f;if(i>=0?(c=i%4294967296|0,f=i/4294967296|0):(c=~(-i%4294967296),f=~(-i/4294967296),4294967295^c?c=c+1|0:(c=0,f=f+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(m,v,T){T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,T.buf[T.pos]=127&(m>>>=7)})(c,0,o),(function(m,v){const T=(7&m)<<4;v.buf[v.pos++]|=T|((m>>>=3)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m)))))})(f,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(c,f,m){for(let v,T,I=0;I<f.length;I++){if(v=f.charCodeAt(I),v>55295&&v<57344){if(!T){v>56319||I+1===f.length?(c[m++]=239,c[m++]=191,c[m++]=189):T=v;continue}if(v<56320){c[m++]=239,c[m++]=191,c[m++]=189,T=v;continue}v=T-55296<<10|v-56320|65536,T=null}else T&&(c[m++]=239,c[m++]=191,c[m++]=189,T=null);v<128?c[m++]=v:(v<2048?c[m++]=v>>6|192:(v<65536?c[m++]=v>>12|224:(c[m++]=v>>18|240,c[m++]=v>>12&63|128),c[m++]=v>>6&63|128),c[m++]=63&v|128)}return m})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&Xg(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const c=this.pos-o;c>=128&&Xg(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,lb,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,ub,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,pb,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,cb,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,hb,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,db,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,fb,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,mb,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,gb,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function dc(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Xg(r,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let c=i.pos-1;c>=r;c--)i.buf[c+o]=i.buf[c]}function lb(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function ub(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function cb(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function hb(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function pb(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function db(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function fb(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function mb(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function gb(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}function _b(r,e,i){r===1&&i.readMessage(yb,e)}function yb(r,e,i){if(r===3){const{id:o,bitmap:c,width:f,height:m,left:v,top:T,advance:I}=i.readMessage(vb,{});e.push({id:o,bitmap:new gh({width:f+6,height:m+6},c),metrics:{width:f,height:m,left:v,top:T,advance:I}})}}function vb(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}function Yg(r){let e=0,i=0;for(const m of r)e+=m.w*m.h,i=Math.max(i,m.w);r.sort(((m,v)=>v.h-m.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,f=0;for(const m of r)for(let v=o.length-1;v>=0;v--){const T=o[v];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,f=Math.max(f,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===T.w&&m.h===T.h){const I=o.pop();I&&v<o.length&&(o[v]=I)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(o.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}class pf{constructor(e,{pixelRatio:i,version:o,stretchX:c,stretchY:f,content:m,textFitWidth:v,textFitHeight:T}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=f,this.content=m,this.version=o,this.textFitWidth=v,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Kg{constructor(e,i){const o={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,o,f),this.addImages(i,c,f);const{w:m,h:v}=Yg(f),T=new Gn({width:m||1,height:v||1});for(const I in e){const C=e[I],D=o[I].paddedRect;Gn.copy(C.data,T,{x:0,y:0},{x:D.x+1,y:D.y+1},C.data)}for(const I in i){const C=i[I],D=c[I].paddedRect,B=D.x+1,O=D.y+1,U=C.data.width,Z=C.data.height;Gn.copy(C.data,T,{x:0,y:0},{x:B,y:O},C.data),Gn.copy(C.data,T,{x:0,y:Z-1},{x:B,y:O-1},{width:U,height:1}),Gn.copy(C.data,T,{x:0,y:0},{x:B,y:O+Z},{width:U,height:1}),Gn.copy(C.data,T,{x:U-1,y:0},{x:B-1,y:O},{width:1,height:Z}),Gn.copy(C.data,T,{x:0,y:0},{x:B+U,y:O},{width:1,height:Z})}this.image=T,this.iconPositions=o,this.patternPositions=c}addImages(e,i,o){for(const c in e){const f=e[c],m={x:0,y:0,w:f.data.width+2,h:f.data.height+2};o.push(m),i[c]=new pf(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,f]=e.tl;o.update(i.data,void 0,{x:c,y:f})}}var wl;function Bp(r,e,i,o,c,f,m,v,T,I,C,D,B,O,U){const Z=pc.fromFeature(r,c);let q;D===b.aA.vertical&&Z.verticalizePunctuation();let Y=Z.determineLineBreaks(I,f,e,o,O);const{processBidirectionalText:le,processStyledBidirectionalText:J}=xa;if(le&&Z.sections.length===1){q=[],Y=Y.map((Ie=>Z.toCodeUnitIndex(Ie)));const pe=le(Z.toString(),Y);for(const Ie of pe){const Ge=[...Ie].map((()=>0));q.push(new pc(Ie,Z.sections,Ge))}}else if(J){q=[],Y=Y.map((je=>Z.toCodeUnitIndex(je)));let pe=0;const Ie=[];for(const je of Z.text)Ie.push(...Array(je.length).fill(Z.sectionIndex[pe])),pe++;const Ge=J(Z.text,Ie,Y);for(const je of Ge){const qe=[];let tt="";for(const Ye of je[0])qe.push(je[1][tt.length]),tt+=Ye;q.push(new pc(je[0],Z.sections,qe))}}else q=(function(pe,Ie){const Ge=[];let je=0;for(const qe of Ie)Ge.push(pe.substring(je,qe)),je=qe;return je<pe.length()&&Ge.push(pe.substring(je,pe.length())),Ge})(Z,Y);const te=[],ue={positionedLines:te,text:Z.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:D,iconsInText:!1,verticalizable:!1};return(function(pe,Ie,Ge,je,qe,tt,Ye,Ve,Be,ct,at,dt){let ot=0,vt=0,ii=0,Wt=0;const ji=Ve==="right"?1:Ve==="left"?0:.5,cn=Or/dt;let br=0;for(const fi of qe){fi.trim();const Qi=fi.getMaxScale(),ar={positionedGlyphs:[],lineOffset:0};pe.positionedLines[br]=ar;const zi=ar.positionedGlyphs;let $n=0;if(!fi.length()){vt+=tt,++br;continue}const hn=xb(je,fi,cn);let qn=0;for(const Vr of fi.text){const Xi=fi.getSection(qn),wr=Vr.codePointAt(0),er=bb(Be,at,wr),Ur={glyph:wr,imageName:null,x:ot,y:vt+-17,vertical:er,scale:1,fontStack:"",sectionIndex:fi.getSectionIndex(qn),metrics:null,rect:null};let qs;if("fontStack"in Xi){if(qs=wb(Xi,wr,er,hn,Ie,Ge),!qs)continue;Ur.fontStack=Xi.fontStack}else{if(pe.iconsInText=!0,Xi.scale*=cn,qs=Tb(Xi,er,Qi,hn,je),!qs)continue;$n=Math.max($n,qs.imageOffset),Ur.imageName=Xi.imageName}const{rect:Sa,metrics:Dh,baselineOffset:Il}=qs;Ur.y+=Il,Ur.scale=Xi.scale,Ur.metrics=Dh,Ur.rect=Sa,zi.push(Ur),er?(pe.verticalizable=!0,ot+=("imageName"in Xi?Dh.advance:Or)*Xi.scale+ct):ot+=Dh.advance*Xi.scale+ct,qn++}zi.length!==0&&(ii=Math.max(ot-ct,ii),Sb(zi,0,zi.length-1,ji)),ot=0,ar.lineOffset=Math.max($n,(Qi-1)*Or);const Yo=tt*Qi+$n;vt+=Yo,Wt=Math.max(Yo,Wt),++br}const{horizontalAlign:Vi,verticalAlign:Fi}=df(Ye);(function(fi,Qi,ar,zi,$n,hn,qn,Yo,Vr){const Xi=(Qi-ar)*$n;let wr=0;wr=hn!==qn?-Yo*zi- -17:-zi*Vr*qn+.5*qn;for(const er of fi)for(const Ur of er.positionedGlyphs)Ur.x+=Xi,Ur.y+=wr})(pe.positionedLines,ji,Vi,Fi,ii,Wt,tt,vt,qe.length),pe.top+=-Fi*vt,pe.bottom=pe.top+vt,pe.left+=-Vi*ii,pe.right=pe.left+ii})(ue,e,i,o,q,m,v,T,D,I,B,U),!(function(pe){for(const Ie of pe)if(Ie.positionedGlyphs.length!==0)return!1;return!0})(te)&&ue}function df(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function xb(r,e,i){const o=e.getMaxScale()*Or,{maxImageWidth:c,maxImageHeight:f}=e.getMaxImageSize(r),m=Math.max(o,f*i);return{verticalLineContentWidth:Math.max(o,c*i),horizontalLineContentHeight:m}}function Jg(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function bb(r,e,i){return!(r===b.aA.horizontal||!e&&!Kc(i)||e&&(mp(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function wb(r,e,i,o,c,f){const m=f[r.fontStack],v=(function(I,C,D,B){if(I&&I.rect)return I;const O=C[D.fontStack],U=O&&O[B];return U?{rect:null,metrics:U.metrics}:null})(m&&m[e],c,r,e);if(v===null)return null;let T;if(i)T=o.verticalLineContentWidth-r.scale*Or;else{const I=Jg(r.verticalAlign);T=(o.horizontalLineContentHeight-r.scale*Or)*I}return{rect:v.rect,metrics:v.metrics,baselineOffset:T}}function Tb(r,e,i,o,c){const f=c[r.imageName];if(!f)return null;const m=f.paddedRect,v=f.displaySize,T={width:v[0],height:v[1],left:1,top:-3,advance:e?v[1]:v[0]};let I;if(e)I=o.verticalLineContentWidth-v[1]*r.scale;else{const C=Jg(r.verticalAlign);I=(o.horizontalLineContentHeight-v[1]*r.scale)*C}return{rect:m,metrics:T,baselineOffset:I,imageOffset:(e?v[0]:v[1])*r.scale-Or*i}}function Sb(r,e,i,o){if(o===0)return;const c=r[i],f=(r[i].x+c.metrics.advance*c.scale)*o;for(let m=e;m<=i;m++)r[m].x-=f}function Pb(r,e,i){const{horizontalAlign:o,verticalAlign:c}=df(i),f=e[0]-r.displaySize[0]*o,m=e[1]-r.displaySize[1]*c;return{image:r,top:m,bottom:m+r.displaySize[1],left:f,right:f+r.displaySize[0]}}function Qg(r){var e,i;let o=r.left,c=r.top,f=r.right-o,m=r.bottom-c;const v=(e=r.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",T=(i=r.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",I=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(T==="proportional"){if(v==="stretchOnly"&&f/m<I||v==="proportional"){const C=Math.ceil(m*I);o*=C/f,f=C}}else if(v==="proportional"&&T==="stretchOnly"&&I!==0&&f/m>I){const C=Math.ceil(f/I);c*=C/m,m=C}return{x1:o,y1:c,x2:o+f,y2:c+m}}function e_(r,e,i,o,c,f){const m=r.image;let v;if(m.content){const q=m.content,Y=m.pixelRatio||1;v=[q[0]/Y,q[1]/Y,m.displaySize[0]-q[2]/Y,m.displaySize[1]-q[3]/Y]}const T=e.left*f,I=e.right*f;let C,D,B,O;i==="width"||i==="both"?(O=c[0]+T-o[3],D=c[0]+I+o[1]):(O=c[0]+(T+I-m.displaySize[0])/2,D=O+m.displaySize[0]);const U=e.top*f,Z=e.bottom*f;return i==="height"||i==="both"?(C=c[1]+U-o[0],B=c[1]+Z+o[2]):(C=c[1]+(U+Z-m.displaySize[1])/2,B=C+m.displaySize[1]),{image:m,top:C,right:D,bottom:B,left:O,collisionPadding:v}}st("ImagePosition",pf),st("ImageAtlas",Kg),b.aA=void 0,(wl=b.aA||(b.aA={}))[wl.none=0]="none",wl[wl.horizontal=1]="horizontal",wl[wl.vertical=2]="vertical",wl[wl.horizontalOnly=3]="horizontalOnly";const Gs=128,Tl=32640;function t_(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Si(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=i;let f=0;for(;f<o.length&&o[f]<=r;)f++;f=Math.max(0,f-1);let m=f;for(;m<o.length&&o[m]<r+1;)m++;m=Math.min(o.length-1,m);const v=o[f],T=o[m];return i.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:T,interpolationType:c}:{kind:"camera",minZoom:v,maxZoom:T,minSize:i.evaluate(new Si(v)),maxSize:i.evaluate(new Si(T)),interpolationType:c}}}function ff(r,e,i){let o="never";const c=r.get(e);return c?o=c:r.get(i)&&(o="always"),o}const Mb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Op(r,e,i,o,c,f,m,v,T,I,C,D,B){const O=v?Math.min(Tl,Math.round(v[0])):0,U=v?Math.min(Tl,Math.round(v[1])):0;r.emplaceBack(e,i,Math.round(32*o),Math.round(32*c),f,m,(O<<1)+(T?1:0),U,16*I,16*C,256*D,256*B)}function mf(r,e,i){r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i)}function Ib(r){for(const e of r.sections)if(yp(e.text))return!0;return!1}class gf{constructor(e){this.layoutVertexArray=new se,this.indexArray=new Re,this.programConfigurations=e,this.segments=new He,this.dynamicLayoutVertexArray=new de,this.opacityVertexArray=new ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new u}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,eb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,tb.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Mb,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",gf);class _f{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new He,this.collisionVertexArray=new Te}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ib.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",_f);class fc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((m=>m.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=t_(this.zoom,i["text-size"]),this.iconSizeData=t_(this.zoom,i["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=ff(o,"text-overlap","text-allow-overlap")!=="never"||ff(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((m=>b.aA[m]))),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=e.sourceID}createArrays(){this.text=new gf(new Hi(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new gf(new Hi(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new x,this.lineVertexArray=new M,this.symbolInstances=new y,this.textAnchorOffsets=new z}calculateGlyphDependencies(e,i,o,c,f){for(const m of e)if(i[m.codePointAt(0)]=!0,(o||c)&&f){const v=Mh[m];v&&(i[v.codePointAt(0)]=!0)}}populate(e,i,o){const c=this.layers[0],f=c.layout,m=f.get("text-font"),v=f.get("text-field"),T=f.get("icon-image"),I=(v.value.kind!=="constant"||v.value.value instanceof nn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),C=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,D=f.get("symbol-sort-key");if(this.features=[],!I&&!C)return;const B=i.iconDependencies,O=i.glyphDependencies,U=i.availableImages,Z=new Si(this.zoom);for(const{feature:q,id:Y,index:le,sourceLayerIndex:J}of e){const te=c._featureFilter.needGeometry,ue=Zs(q,te);if(!c._featureFilter.filter(Z,ue,o))continue;let pe,Ie;if(te||(ue.geometry=Us(q)),I){const je=c.getValueAndResolveTokens("text-field",ue,o,U),qe=nn.factory(je),tt=this.hasRTLText=this.hasRTLText||Ib(qe);(!tt||xa.getRTLTextPluginStatus()==="unavailable"||tt&&xa.isParsed())&&(pe=nb(qe,c,ue))}if(C){const je=c.getValueAndResolveTokens("icon-image",ue,o,U);Ie=je instanceof Xr?je:Xr.fromString(je)}if(!pe&&!Ie)continue;const Ge=this.sortFeaturesByKey?D.evaluate(ue,{},o):void 0;if(this.features.push({id:Y,text:pe,icon:Ie,index:le,sourceLayerIndex:J,geometry:ue.geometry,properties:q.properties,type:Th.types[q.type],sortKey:Ge}),Ie&&(B[Ie.name]=!0),pe){const je=m.evaluate(ue,{},o).join(","),qe=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.aA.vertical)>=0;for(const tt of pe.sections)if(tt.image)B[tt.image.name]=!0;else{const Ye=Fs(pe.toString()),Ve=tt.fontStack||je,Be=O[Ve]=O[Ve]||{};this.calculateGlyphDependencies(tt.text,Be,qe,this.allowVerticalPlacement,Ye)}}}f.get("symbol-placement")==="line"&&(this.features=(function(q){const Y={},le={},J=[];let te=0;function ue(je){J.push(q[je]),te++}function pe(je,qe,tt){const Ye=le[je];return delete le[je],le[qe]=Ye,J[Ye].geometry[0].pop(),J[Ye].geometry[0]=J[Ye].geometry[0].concat(tt[0]),Ye}function Ie(je,qe,tt){const Ye=Y[qe];return delete Y[qe],Y[je]=Ye,J[Ye].geometry[0].shift(),J[Ye].geometry[0]=tt[0].concat(J[Ye].geometry[0]),Ye}function Ge(je,qe,tt){const Ye=tt?qe[0][qe[0].length-1]:qe[0][0];return`${je}:${Ye.x}:${Ye.y}`}for(let je=0;je<q.length;je++){const qe=q[je],tt=qe.geometry,Ye=qe.text?qe.text.toString():null;if(!Ye){ue(je);continue}const Ve=Ge(Ye,tt),Be=Ge(Ye,tt,!0);if(Ve in le&&Be in Y&&le[Ve]!==Y[Be]){const ct=Ie(Ve,Be,tt),at=pe(Ve,Be,J[ct].geometry);delete Y[Ve],delete le[Be],le[Ge(Ye,J[at].geometry,!0)]=at,J[ct].geometry=null}else Ve in le?pe(Ve,Be,tt):Be in Y?Ie(Ve,Be,tt):(ue(je),Y[Ve]=te-1,le[Be]=te-1)}return J.filter((je=>je.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((q,Y)=>q.sortKey-Y.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const m={};for(let v=e.segment+1;v<i.length;v++)m[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:c},v<i.length-1&&(c+=i[v+1].dist(i[v]));for(let v=e.segment||0;v>=0;v--)m[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:f},v>0&&(f+=i[v-1].dist(i[v]));for(let v=0;v<i.length;v++){const T=m[v];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,c,f,m,v,T,I,C,D,B){const O=e.indexArray,U=e.layoutVertexArray,Z=e.segments.prepareSegment(4*i.length,U,O,this.canOverlap?m.sortKey:void 0),q=this.glyphOffsetArray.length,Y=Z.vertexLength,le=this.allowVerticalPlacement&&v===b.aA.vertical?Math.PI/2:0,J=m.text&&m.text.sections;for(let te=0;te<i.length;te++){const{tl:ue,tr:pe,bl:Ie,br:Ge,tex:je,pixelOffsetTL:qe,pixelOffsetBR:tt,minFontScaleX:Ye,minFontScaleY:Ve,glyphOffset:Be,isSDF:ct,sectionIndex:at}=i[te],dt=Z.vertexLength,ot=Be[1];Op(U,T.x,T.y,ue.x,ot+ue.y,je.x,je.y,o,ct,qe.x,qe.y,Ye,Ve),Op(U,T.x,T.y,pe.x,ot+pe.y,je.x+je.w,je.y,o,ct,tt.x,qe.y,Ye,Ve),Op(U,T.x,T.y,Ie.x,ot+Ie.y,je.x,je.y+je.h,o,ct,qe.x,tt.y,Ye,Ve),Op(U,T.x,T.y,Ge.x,ot+Ge.y,je.x+je.w,je.y+je.h,o,ct,tt.x,tt.y,Ye,Ve),mf(e.dynamicLayoutVertexArray,T,le),O.emplaceBack(dt,dt+2,dt+1),O.emplaceBack(dt+1,dt+2,dt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Be[0]),te!==i.length-1&&at===i[te+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,m,m.index,{imagePositions:{},canonical:B,formattedSection:J&&J[at]})}e.placedSymbolArray.emplaceBack(T.x,T.y,q,this.glyphOffsetArray.length-q,Y,I,C,T.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],v,0,!1,0,D)}_addCollisionDebugVertex(e,i,o,c,f,m){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(e,i,o,c,f,m,v){const T=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),I=T.vertexLength,C=f.layoutVertexArray,D=f.collisionVertexArray,B=v.anchorX,O=v.anchorY;this._addCollisionDebugVertex(C,D,m,B,O,new F(e,i)),this._addCollisionDebugVertex(C,D,m,B,O,new F(o,i)),this._addCollisionDebugVertex(C,D,m,B,O,new F(o,c)),this._addCollisionDebugVertex(C,D,m,B,O,new F(e,c)),T.vertexLength+=4;const U=f.indexArray;U.emplaceBack(I,I+1),U.emplaceBack(I+1,I+2),U.emplaceBack(I+2,I+3),U.emplaceBack(I+3,I),T.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,c){for(let f=e;f<i;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _f(ce,Ug.members,Ce),this.iconCollisionBox=new _f(ce,Ug.members,Ce);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,c,f,m,v,T,I){const C={};for(let D=i;D<o;D++){const B=e.get(D);C.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},C.textFeatureIndex=B.featureIndex;break}for(let D=c;D<f;D++){const B=e.get(D);C.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},C.verticalTextFeatureIndex=B.featureIndex;break}for(let D=m;D<v;D++){const B=e.get(D);C.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},C.iconFeatureIndex=B.featureIndex;break}for(let D=T;D<I;D++){const B=e.get(D);C.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},C.verticalIconFeatureIndex=B.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),c=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+2,f+1),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),c=[],f=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const T=this.symbolInstances.get(v);c.push(0|Math.round(i*T.anchorX+o*T.anchorY)),f.push(T.featureIndex)}return m.sort(((v,T)=>c[v]-c[T]||f[T]-f[v])),m}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((c,f,m)=>{c>=0&&m.indexOf(c)===f&&this.addIndicesForPlacedSymbol(this.text,c)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let i_,r_;st("SymbolBucket",fc,{omit:["layers","collisionBoxArray","features","compareText"]}),fc.MAX_GLYPHS=65535,fc.addDynamicAttributes=mf;var yf={get paint(){return r_=r_||new wn({"icon-opacity":new St(Le.paint_symbol["icon-opacity"]),"icon-color":new St(Le.paint_symbol["icon-color"]),"icon-halo-color":new St(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new yt(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new yt(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new St(Le.paint_symbol["text-opacity"]),"text-color":new St(Le.paint_symbol["text-color"],{runtimeType:rn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new St(Le.paint_symbol["text-halo-color"]),"text-halo-width":new St(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Le.paint_symbol["text-halo-blur"]),"text-translate":new yt(Le.paint_symbol["text-translate"]),"text-translate-anchor":new yt(Le.paint_symbol["text-translate-anchor"])})},get layout(){return i_=i_||new wn({"symbol-placement":new yt(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new yt(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yt(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yt(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new yt(Le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new yt(Le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new yt(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new yt(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yt(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Le.layout_symbol["icon-size"]),"icon-text-fit":new yt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Le.layout_symbol["icon-image"]),"icon-rotate":new St(Le.layout_symbol["icon-rotate"]),"icon-padding":new St(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new yt(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Le.layout_symbol["icon-offset"]),"icon-anchor":new St(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yt(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yt(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yt(Le.layout_symbol["text-rotation-alignment"]),"text-field":new St(Le.layout_symbol["text-field"]),"text-font":new St(Le.layout_symbol["text-font"]),"text-size":new St(Le.layout_symbol["text-size"]),"text-max-width":new St(Le.layout_symbol["text-max-width"]),"text-line-height":new yt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Le.layout_symbol["text-letter-spacing"]),"text-justify":new St(Le.layout_symbol["text-justify"]),"text-radial-offset":new St(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yt(Le.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new St(Le.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new St(Le.layout_symbol["text-anchor"]),"text-max-angle":new yt(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new yt(Le.layout_symbol["text-writing-mode"]),"text-rotate":new St(Le.layout_symbol["text-rotate"]),"text-padding":new yt(Le.layout_symbol["text-padding"]),"text-keep-upright":new yt(Le.layout_symbol["text-keep-upright"]),"text-transform":new St(Le.layout_symbol["text-transform"]),"text-offset":new St(Le.layout_symbol["text-offset"]),"text-allow-overlap":new yt(Le.layout_symbol["text-allow-overlap"]),"text-overlap":new yt(Le.layout_symbol["text-overlap"]),"text-ignore-placement":new yt(Le.layout_symbol["text-ignore-placement"]),"text-optional":new yt(Le.layout_symbol["text-optional"])})}};class n_{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:mn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",n_,{omit:["defaultValue"]});class Np extends Un{constructor(e,i){super(e,yf,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const f of o)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,c){const f=this.layout.get(e).evaluate(i,{},o,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||rs(m.value)||!f?f:(function(v,T){return T.replace(/{([^{}]+)}/g,((I,C)=>v&&C in v?String(v[C]):""))})(i.properties,f)}createBucket(e){return new fc(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of yf.paint.overridableProperties){if(!Np.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new n_(i),c=new dl(o,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new _("source",c):new P("composite",c,i.value.zoomStops),this.paint._values[e]=new Wo(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Np.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),c=yf.paint.properties[i];let f=!1;const m=v=>{for(const T of v)if(c.overrides&&c.overrides.hasOverride(T))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof nn)m(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const v=I=>{f||(I instanceof Fn&&Xt(I.value)===Ra?m(I.value.sections):I instanceof Ms?m(I.sections):I.eachChild(v))},T=o.value;T._styleExpression&&v(T._styleExpression.expression)}return f}}let o_;var Ab={get paint(){return o_=o_||new wn({"background-color":new yt(Le.paint_background["background-color"]),"background-pattern":new ih(Le.paint_background["background-pattern"]),"background-opacity":new yt(Le.paint_background["background-opacity"])})}};class Eb extends Un{constructor(e,i){super(e,Ab,i)}}class Cb extends Un{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Lb{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const kb={once:!0},vf=63710088e-1;class Sl{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sl(Mr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,c=e.lat*i,f=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return vf*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof Sl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Sl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Sl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const a_=2*Math.PI*vf;function s_(r){return a_*Math.cos(r*Math.PI/180)}function l_(r){return(180+r)/360}function u_(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function c_(r,e){return r/s_(e)}function h_(r){return 360*r-180}function jp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function p_(r,e){return r*s_(jp(e))}class Ih{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Sl.convert(e);return new Ih(l_(o.lng),u_(o.lat),c_(i,o.lat))}toLngLat(){return new Sl(h_(this.x),jp(this.y))}toAltitude(){return p_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/a_*(e=jp(this.y),1/Math.cos(e*Math.PI/180));var e}}function d_(r,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[r*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class xf{constructor(e,i,o){if(!(function(c,f,m){return!(c<0||c>25||m<0||m>=Math.pow(2,c)||f<0||f>=Math.pow(2,c))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=mc(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const c=(function(m,v,T){var I=d_(256*m,256*(v=Math.pow(2,T)-v-1),T),C=d_(256*(m+1),256*(v+1),T);return I[0]+","+I[1]+","+C[0]+","+C[1]})(this.x,this.y,this.z),f=(function(m,v,T){let I,C="";for(let D=m;D>0;D--)I=1<<D-1,C+=(v&I?1:0)+(T&I?2:0);return C})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,f).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new F((e.x*i-this.x)*si,(e.y*i-this.y)*si)}toString(){return`${this.z}/${this.x}/${this.y}`}}class f_{constructor(e,i){this.wrap=e,this.canonical=i,this.key=mc(e,i.z,i.z,i.x,i.y)}}class Po{constructor(e,i,o,c,f){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new xf(o,+c,+f),this.key=mc(i,e,o,c,f)}clone(){return new Po(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new Po(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Po(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?mc(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):mc(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Po(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new Po(i,this.wrap,i,o,c),new Po(i,this.wrap,i,o+1,c),new Po(i,this.wrap,i,o,c+1),new Po(i,this.wrap,i,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Po(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Po(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new f_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ih(e.x-this.wrap,e.y))}}function mc(r,e,i,o,c){(r*=2)<0&&(r=-1*r-1);const f=1<<i;return(f*f*r+f*c+o).toString(36)+i.toString(36)+e.toString(36)}function Ah(r,e){return e?r.properties[e]:r.id}function zb(r,e){const i={id:r.id};if(e.removeAllProperties&&(delete r.removeProperties,delete r.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const c=r.addOrUpdateProperties.findIndex((f=>f.key===o));c>-1&&r.addOrUpdateProperties.splice(c,1)}return(r.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(r.removeProperties||e.removeProperties)&&(i.removeProperties=[...r.removeProperties||[],...e.removeProperties||[]]),(r.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...r.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(r.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||r.newGeometry),i}function m_(r){var e,i;if(!r)return{};const o={};return o.removeAll=r.removeAll,o.remove=new Set(r.remove||[]),o.add=new Map((e=r.add)===null||e===void 0?void 0:e.map((c=>[c.id,c]))),o.update=new Map((i=r.update)===null||i===void 0?void 0:i.map((c=>[c.id,c]))),o}st("CanonicalTileID",xf),st("OverscaledTileID",Po,{omit:["terrainRttPosMatrix32f"]});class g_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class __{constructor(e,i,o,c,f){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=c,this._z=i,this.properties=e.properties,this.id=f}projectPoint(e,i,o,c){return[360*(e.x+i)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/c)*Math.PI))-90]}projectLine(e,i,o,c){return e.map((f=>this.projectPoint(f,i,o,c)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,c=e.extent*this._y,f=e.loadGeometry();switch(e.type){case 1:{const m=[];for(const T of f)m.push(T[0]);const v=this.projectLine(m,o,c,i);this._geometry=m.length===1?{type:"Point",coordinates:v[0]}:{type:"MultiPoint",coordinates:v};break}case 2:{const m=f.map((v=>this.projectLine(v,o,c,i)));this._geometry=m.length===1?{type:"LineString",coordinates:m[0]}:{type:"MultiLineString",coordinates:m};break}case 3:{const m=kg(f),v=[];for(const T of m)v.push(T.map((I=>this.projectLine(I,o,c,i))));this._geometry=v.length===1?{type:"Polygon",coordinates:v[0]}:{type:"MultiPolygon",coordinates:v};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class gc{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Vp extends gc{}class bf extends Vp{getValueFromBuffer(e){return this.dataBuffer[e]}}class wf extends Vp{getValueFromBuffer(e){return this.dataBuffer[e]}}class y_ extends gc{delta;constructor(e,i,o,c){super(e,i,c),this.delta=o}}class Tf extends y_{constructor(e,i,o,c){super(e,Int32Array.of(i),o,c)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Sf extends gc{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Db{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,c,f=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=c,this._extent=f}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const c=e?.next().value,f={};for(const m of this.propertyVectors){if(!m)continue;const v=m.name,T=m.getValue(i);T!==null&&(f[v]=T)}i++,yield{id:o,geometry:c,properties:f}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let c;this.idVector&&(c=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const f={coordinates:i[o],type:this.geometryVector.geometryType(o)},m={};for(const v of this.propertyVectors){if(!v)continue;const T=v.name,I=v.getValue(o);I!==null&&(m[T]=I)}e.push({id:c,geometry:f,properties:m})}return e}containsMaxSaveIntegerValues(e){return e instanceof bf||e instanceof Sf&&e instanceof Tf||e instanceof wf}}class Rb{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Kt,$s,ln,wa,nu,ao,Nr,jr,v_,Mo;function Qr(r,e,i){const o=new Int32Array(i);let c=0,f=e.get();for(let m=0;m<o.length;m++){let v=r[f++],T=127&v;v<128||(v=r[f++],T|=(127&v)<<7,v<128||(v=r[f++],T|=(127&v)<<14,v<128||(v=r[f++],T|=(127&v)<<21,v<128||(v=r[f++],T|=(15&v)<<28)))),o[c++]=T}return e.set(f),o}function Up(r,e,i){const o=new BigInt64Array(i);for(let c=0;c<o.length;c++)o[c]=Bb(r,e);return o}function Fb(r,e){let i,o;return o=r[e.get()],e.increment(),i=127&o,o<128?i:(o=r[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=r[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=r[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=r[e.get()],i|=(15&o)<<28,(function(c,f,m){let v,T;if(T=f[m.get()],m.increment(),v=(112&T)>>4,T<128||(T=f[m.get()],m.increment(),v|=(127&T)<<3,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<10,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<17,T<128)||(T=f[m.get()],m.increment(),v|=(127&T)<<24,T<128)||(T=f[m.get()],m.increment(),v|=(1&T)<<31,T<128))return 4294967296*v+(c>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,r,e)))))}function x_(r,e,i,o){throw new Error("FastPFor is not implemented yet.")}function ou(r){return r>>>1^-(1&r)}function _c(r){return r>>1n^-(1n&r)}function Bb(r,e){let i=0n,o=0,c=e.get();for(;c<r.length;){const f=r[c++];if(i|=BigInt(127&f)<<BigInt(o),!(128&f))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(c),i}function b_(r,e,i){const o=new Int32Array(i);let c=0;for(let f=0;f<e;f++){const m=r[f];o.fill(r[f+e],c,c+m),c+=m}return o}function w_(r,e,i){const o=new BigInt64Array(i);let c=0;for(let f=0;f<e;f++){const m=Number(r[f]);o.fill(r[f+e],c,c+m),c+=m}return o}function T_(r,e,i){const o=new Float64Array(i);let c=0;for(let f=0;f<e;f++){const m=r[f];o.fill(r[f+e],c,c+m),c+=m}return o}function Pf(r){const e=r.length/4*4;let i=1;if(e>=4)for(let o=r[0];i<e-4;i+=4)o=r[i]+=o,o=r[i+1]+=o,o=r[i+2]+=o,o=r[i+3]+=o;for(;i!=r.length;)r[i]+=r[i-1],++i}function S_(r){r[0]=r[0]>>>1^-(1&r[0]),r[1]=r[1]>>>1^-(1&r[1]);const e=r.length/4*4;let i=2;if(e>=4)for(;i<e-4;i+=4){const o=r[i],c=r[i+1],f=r[i+2],m=r[i+3];r[i]=(o>>>1^-(1&o))+r[i-2],r[i+1]=(c>>>1^-(1&c))+r[i-1],r[i+2]=(f>>>1^-(1&f))+r[i],r[i+3]=(m>>>1^-(1&m))+r[i+1]}for(;i!=r.length;i+=2)r[i]=(r[i]>>>1^-(1&r[i]))+r[i-2],r[i+1]=(r[i+1]>>>1^-(1&r[i+1]))+r[i-1]}(function(r){r.NONE="NONE",r.DELTA="DELTA",r.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",r.RLE="RLE",r.MORTON="MORTON",r.PDE="PDE"})(Kt||(Kt={})),(function(r){r.NONE="NONE",r.FAST_PFOR="FAST_PFOR",r.VARINT="VARINT",r.ALP="ALP"})($s||($s={})),(function(r){r.PRESENT="PRESENT",r.DATA="DATA",r.OFFSET="OFFSET",r.LENGTH="LENGTH"})(ln||(ln={}));class Mf{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ln(r,e){const i=(function(o,c){const f=o[c.get()],m=Object.values(ln)[f>>4];let v=null;switch(m){case ln.DATA:v=new Mf(Object.values(wa)[15&f]);break;case ln.OFFSET:v=new Mf(null,Object.values(nu)[15&f]);break;case ln.LENGTH:v=new Mf(null,null,Object.values(ao)[15&f])}c.increment();const T=o[c.get()],I=Object.values(Kt)[T>>5],C=Object.values(Kt)[T>>2&7],D=Object.values($s)[3&T];c.increment();const B=Qr(o,c,2),O=B[0];return{physicalStreamType:m,logicalStreamType:v,logicalLevelTechnique1:I,logicalLevelTechnique2:C,physicalLevelTechnique:D,numValues:O,byteLength:B[1],decompressedCount:O}})(r,e);return i.logicalLevelTechnique1===Kt.MORTON?(function(o,c,f){const m=Qr(c,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:m[0],coordinateShift:m[1]}})(i,r,e):Kt.RLE!==i.logicalLevelTechnique1&&Kt.RLE!==i.logicalLevelTechnique2||$s.NONE===i.physicalLevelTechnique?i:(function(o,c,f){const m=Qr(c,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:m[1],runs:m[0],numRleValues:m[1]}})(i,r,e)}(function(r){r.NONE="NONE",r.SINGLE="SINGLE",r.SHARED="SHARED",r.VERTEX="VERTEX",r.MORTON="MORTON",r.FSST="FSST"})(wa||(wa={})),(function(r){r.VERTEX="VERTEX",r.INDEX="INDEX",r.STRING="STRING",r.KEY="KEY"})(nu||(nu={})),(function(r){r.VAR_BINARY="VAR_BINARY",r.GEOMETRIES="GEOMETRIES",r.PARTS="PARTS",r.RINGS="RINGS",r.TRIANGLES="TRIANGLES",r.SYMBOL="SYMBOL",r.DICTIONARY="DICTIONARY"})(ao||(ao={})),(function(r){r[r.FLAT=0]="FLAT",r[r.CONST=1]="CONST",r[r.SEQUENCE=2]="SEQUENCE",r[r.DICTIONARY=3]="DICTIONARY",r[r.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Nr||(Nr={}));class Ta{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function kn(r,e,i,o,c){return(function(f,m,v){switch(m.logicalLevelTechnique1){case Kt.DELTA:return m.logicalLevelTechnique2===Kt.RLE?(function(T,I,C){const D=new Int32Array(C);let B=0,O=0;for(let U=0;U<I;U++){const Z=T[U],q=ou(T[U+I]);for(let Y=0;Y<Z;Y++)O+=q,D[B++]=O}return D})(f,m.runs,m.numRleValues):((function(T){T[0]=T[0]>>>1^-(1&T[0]);const I=T.length/4*4;let C=1;if(I>=4)for(;C<I-4;C+=4){const D=T[C],B=T[C+1],O=T[C+2],U=T[C+3];T[C]=(D>>>1^-(1&D))+T[C-1],T[C+1]=(B>>>1^-(1&B))+T[C],T[C+2]=(O>>>1^-(1&O))+T[C+1],T[C+3]=(U>>>1^-(1&U))+T[C+2]}for(;C!=T.length;++C)T[C]=(T[C]>>>1^-(1&T[C]))+T[C-1]})(f),f);case Kt.RLE:return(function(T,I,C){return C?(function(D,B,O){const U=new Int32Array(O);let Z=0;for(let q=0;q<B;q++){const Y=D[q];let le=D[q+B];le=le>>>1^-(1&le),U.fill(le,Z,Z+Y),Z+=Y}return U})(T,I.runs,I.numRleValues):b_(T,I.runs,I.numRleValues)})(f,m,v);case Kt.MORTON:return Pf(f),f;case Kt.COMPONENTWISE_DELTA:return S_(f),f;case Kt.NONE:return v&&(function(T){for(let I=0;I<T.length;I++){const C=T[I];T[I]=C>>>1^-(1&C)}})(f),f;default:throw new Error(`The specified Logical level technique is not supported: ${m.logicalLevelTechnique1}`)}})(Zp(r,e,i),i,o)}function Pl(r,e,i){return(function(o,c){if(c.logicalLevelTechnique1===Kt.DELTA&&c.logicalLevelTechnique2===Kt.NONE)return(function(m){const v=new Int32Array(m.length+1);v[0]=0,v[1]=ou(m[0]);let T=v[1],I=2;for(;I!=v.length;++I){const C=m[I-1];T+=C>>>1^-(1&C),v[I]=v[I-1]+T}return v})(o);if(c.logicalLevelTechnique1===Kt.RLE&&c.logicalLevelTechnique2===Kt.NONE)return(function(m,v,T){const I=new Int32Array(T+1);I[0]=0;let C=1,D=I[0];for(let B=0;B<v;B++){const O=m[B],U=m[B+v];for(let Z=C;Z<C+O;Z++)I[Z]=U+D,D=I[Z];C+=O}return I})(o,c.runs,c.numRleValues);if(c.logicalLevelTechnique1===Kt.NONE&&c.logicalLevelTechnique2===Kt.NONE){(function(m){let v=0;for(let T=0;T<m.length;T++)m[T]+=v,v=m[T]})(o);const f=new Int32Array(c.numValues+1);return f[0]=0,f.set(o,1),f}if(c.logicalLevelTechnique1===Kt.DELTA&&c.logicalLevelTechnique2===Kt.RLE){const f=(function(m,v,T){const I=new Int32Array(T+1);I[0]=0;let C=1,D=I[0];for(let B=0;B<v;B++){const O=m[B];let U=m[B+v];U=U>>>1^-(1&U);for(let Z=C;Z<C+O;Z++)I[Z]=U+D,D=I[Z];C+=O}return I})(o,c.runs,c.numRleValues);return Pf(f),f}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Zp(r,e,i),i)}function Zp(r,e,i){const o=i.physicalLevelTechnique;if(o===$s.FAST_PFOR)return x_();if(o===$s.VARINT)return Qr(r,e,i.numValues);if(o===$s.NONE){const c=e.get();e.add(i.byteLength);const f=r.subarray(c,e.get());return new Int32Array(f)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function If(r,e,i,o){const c=Zp(r,e,i);if(c.length===1){const f=c[0];return o?ou(f):f}return o?(function(f){return ou(f[1])})(c):(function(f){return f[1]})(c)}function P_(r,e,i){return(function(o){if(o.length==2){const c=ou(o[1]);return[c,c]}return[ou(o[2]),ou(o[3])]})(Zp(r,e,i))}function M_(r,e,i){return(function(o){if(o.length==2){const c=_c(o[1]);return[c,c]}return[_c(o[2]),_c(o[3])]})(Up(r,e,i.numValues))}function I_(r,e,i,o){return(function(c,f,m){switch(f.logicalLevelTechnique1){case Kt.DELTA:return f.logicalLevelTechnique2===Kt.RLE?(function(v,T,I){const C=new BigInt64Array(I);let D=0,B=0n;for(let O=0;O<T;O++){const U=Number(v[O]),Z=_c(v[O+T]);for(let q=0;q<U;q++)B+=Z,C[D++]=B}return C})(c,f.runs,f.numRleValues):((function(v){v[0]=v[0]>>1n^-(1n&v[0]);const T=v.length/4*4;let I=1;if(T>=4)for(;I<T-4;I+=4){const C=v[I],D=v[I+1],B=v[I+2],O=v[I+3];v[I]=(C>>1n^-(1n&C))+v[I-1],v[I+1]=(D>>1n^-(1n&D))+v[I],v[I+2]=(B>>1n^-(1n&B))+v[I+1],v[I+3]=(O>>1n^-(1n&O))+v[I+2]}for(;I!=v.length;++I)v[I]=(v[I]>>1n^-(1n&v[I]))+v[I-1]})(c),c);case Kt.RLE:return(function(v,T,I){return I?(function(C,D,B){const O=new BigInt64Array(B);let U=0;for(let Z=0;Z<D;Z++){const q=Number(C[Z]);let Y=C[Z+D];Y=Y>>1n^-(1n&Y),O.fill(Y,U,U+q),U+=q}return O})(v,T.runs,T.numRleValues):w_(v,T.runs,T.numRleValues)})(c,f,m);case Kt.NONE:return m&&(function(v){for(let T=0;T<v.length;T++){const I=v[T];v[T]=I>>1n^-(1n&I)}})(c),c;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}})(Up(r,e,i.numValues),i,o)}function A_(r,e,i,o){const c=Up(r,e,i.numValues);if(c.length===1){const f=c[0];return o?_c(f):f}return o?(function(f){return _c(f[1])})(c):(function(f){return f[1]})(c)}function Af(r,e,i,o,c){return(function(f,m,v,T){switch(m.logicalLevelTechnique1){case Kt.DELTA:return m.logicalLevelTechnique2===Kt.RLE&&(f=b_(f,m.runs,m.numRleValues)),(function(I,C){const D=new Int32Array(I.size());let B=0;I.get(0)?(D[0]=I.get(0)?C[0]>>>1^-(1&C[0]):0,B=1):D[0]=0;let O=1;for(;O!=D.length;++O)D[O]=I.get(O)?D[O-1]+(C[B]>>>1^-(1&C[B++])):D[O-1];return D})(T,f);case Kt.RLE:return(function(I,C,D,B){const O=C;return D?(function(U,Z,q){const Y=new Int32Array(U.size());let le=0;for(let J=0;J<q;J++){const te=Z[J];let ue=Z[J+q];ue=ue>>>1^-(1&ue);for(let pe=le;pe<le+te;pe++)U.get(pe)?Y[pe]=ue:(Y[pe]=0,le++);le+=te}return Y})(B,I,O.runs):(function(U,Z,q){const Y=new Int32Array(U.size());let le=0;for(let J=0;J<q;J++){const te=Z[J],ue=Z[J+q];for(let pe=le;pe<le+te;pe++)U.get(pe)?Y[pe]=ue:(Y[pe]=0,le++);le+=te}return Y})(B,I,O.runs)})(f,m,v,T);case Kt.MORTON:return Pf(f),f;case Kt.COMPONENTWISE_DELTA:return S_(f),f;case Kt.NONE:return f=v?(function(I,C){const D=new Int32Array(I.size());let B=0,O=0;for(;O!=D.length;++O)if(I.get(O)){const U=C[B++];D[O]=U>>>1^-(1&U)}else D[O]=0;return D})(T,f):(function(I,C){const D=new Int32Array(I.size());let B=0,O=0;for(;O!=D.length;++O)D[O]=I.get(O)?C[B++]:0;return D})(T,f),f;default:throw new Error("The specified Logical level technique is not supported")}})(i.physicalLevelTechnique===$s.FAST_PFOR?x_():Qr(r,e,i.numValues),i,o,c)}function Gp(r,e,i,o){const c=r.logicalLevelTechnique1;if(c===Kt.RLE)return r.runs===1?Nr.CONST:Nr.FLAT;const f=e instanceof Ta?e.size():e;if(c===Kt.DELTA&&r.logicalLevelTechnique2===Kt.RLE){const m=r.runs,v=2;if(r.numRleValues!==f)return Nr.FLAT;if(m===1)return Nr.SEQUENCE;if(m===2){const T=o.get();let I;if(r.physicalLevelTechnique===$s.VARINT)I=Qr(i,o,4);else{const C=o.get();I=new Int32Array(i.buffer,i.byteOffset+C,4)}if(o.set(T),I[2]===v&&I[3]===v)return Nr.SEQUENCE}}return r.numValues===1?Nr.CONST:Nr.FLAT}class E_ extends Vp{getValueFromBuffer(e){return this.dataBuffer[e]}}class C_ extends y_{constructor(e,i,o,c){super(e,BigInt64Array.of(i),o,c)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class yc{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Ef(r,e,i){return{x:L_(r,e)-i,y:L_(r>>1,e)-i}}function L_(r,e){let i=0;for(let o=0;o<e;o++)i|=(r&1<<2*o)>>o;return i}(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON",r[r.MULTIPOINT=3]="MULTIPOINT",r[r.MULTILINESTRING=4]="MULTILINESTRING",r[r.MULTIPOLYGON=5]="MULTIPOLYGON"})(jr||(jr={})),(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON"})(v_||(v_={})),(function(r){r[r.MORTON=0]="MORTON",r[r.VEC_2=1]="VEC_2",r[r.VEC_3=2]="VEC_3"})(Mo||(Mo={}));class Ob{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function k_(r){const e=new Array(r.numGeometries);let i=1,o=1,c=1,f=0;const m=new Ob;let v=0,T=0;const I=r.mortonSettings,C=r.topologyVector,D=C.geometryOffsets,B=C.partOffsets,O=C.ringOffsets,U=r.vertexOffsets,Z=r.containsPolygonGeometry(),q=r.vertexBuffer;for(let Y=0;Y<r.numGeometries;Y++){const le=r.geometryType(Y);if(le===jr.POINT){if(U&&U.length!==0)if(r.vertexBufferType===Mo.VEC_2){const J=2*U[T++],te=new F(q[J],q[J+1]);e[f++]=m.createPoint(te)}else{const J=Ef(q[U[T++]],I.numBits,I.coordinateShift),te=new F(J.x,J.y);e[f++]=m.createPoint(te)}else{const J=new F(q[v++],q[v++]);e[f++]=m.createPoint(J)}D&&c++,B&&i++,O&&o++}else if(le===jr.MULTIPOINT){const J=D[c]-D[c-1];c++;const te=new Array(J);if(U&&U.length!==0){for(let ue=0;ue<J;ue++){const pe=2*U[T++];te[ue]=new F(q[pe],q[pe+1])}e[f++]=m.createMultiPoint(te)}else{for(let ue=0;ue<J;ue++){const pe=q[v++],Ie=q[v++];te[ue]=new F(pe,Ie)}e[f++]=m.createMultiPoint(te)}}else if(le===jr.LINESTRING){let J,te=0;Z?(te=O[o]-O[o-1],o++):te=B[i]-B[i-1],i++,U&&U.length!==0?(J=r.vertexBufferType===Mo.VEC_2?Lf(q,U,T,te,!1):kf(q,U,T,te,!1,I),T+=te):(J=Cf(q,v,te,!1),v+=2*te),e[f++]=m.createLineString(J),D&&c++}else if(le===jr.POLYGON){const J=B[i]-B[i-1];i++;const te=new Array(J-1);let ue=O[o]-O[o-1];if(o++,U&&U.length!==0){const pe=r.vertexBufferType===Mo.VEC_2?qp(q,U,T,ue):Wp(q,U,T,ue,0,I);T+=ue;for(let Ie=0;Ie<te.length;Ie++)ue=O[o]-O[o-1],o++,te[Ie]=r.vertexBufferType===Mo.VEC_2?qp(q,U,T,ue):Wp(q,U,T,ue,0,I),T+=ue;e[f++]=m.createPolygon(pe,te)}else{const pe=$p(q,v,ue);v+=2*ue;for(let Ie=0;Ie<te.length;Ie++)ue=O[o]-O[o-1],o++,te[Ie]=$p(q,v,ue),v+=2*ue;e[f++]=m.createPolygon(pe,te)}D&&c++}else if(le===jr.MULTILINESTRING){const J=D[c]-D[c-1];c++;const te=new Array(J);if(U&&U.length!==0){for(let ue=0;ue<J;ue++){let pe=0;Z?(pe=O[o]-O[o-1],o++):pe=B[i]-B[i-1],i++;const Ie=r.vertexBufferType===Mo.VEC_2?Lf(q,U,T,pe,!1):kf(q,U,T,pe,!1,I);te[ue]=Ie,T+=pe}e[f++]=m.createMultiLineString(te)}else{for(let ue=0;ue<J;ue++){let pe=0;Z?(pe=O[o]-O[o-1],o++):pe=B[i]-B[i-1],i++,te[ue]=Cf(q,v,pe,!1),v+=2*pe}e[f++]=m.createMultiLineString(te)}}else{if(le!==jr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const J=D[c]-D[c-1];c++;const te=new Array(J);let ue=0;if(U&&U.length!==0){for(let pe=0;pe<J;pe++){const Ie=B[i]-B[i-1];i++;const Ge=new Array(Ie-1);ue=O[o]-O[o-1],o++;const je=r.vertexBufferType===Mo.VEC_2?qp(q,U,T,ue):Wp(q,U,T,ue,0,I);T+=ue;for(let qe=0;qe<Ge.length;qe++)ue=O[o]-O[o-1],o++,Ge[qe]=r.vertexBufferType===Mo.VEC_2?qp(q,U,T,ue):Wp(q,U,T,ue,0,I),T+=ue;te[pe]=m.createPolygon(je,Ge)}e[f++]=m.createMultiPolygon(te)}else{for(let pe=0;pe<J;pe++){const Ie=B[i]-B[i-1];i++;const Ge=new Array(Ie-1);ue=O[o]-O[o-1],o++;const je=$p(q,v,ue);v+=2*ue;for(let qe=0;qe<Ge.length;qe++){const tt=O[o]-O[o-1];o++,Ge[qe]=$p(q,v,tt),v+=2*tt}te[pe]=m.createPolygon(je,Ge)}e[f++]=m.createMultiPolygon(te)}}}}return e}function $p(r,e,i){return Cf(r,e,i,!0)}function qp(r,e,i,o){return Lf(r,e,i,o,!0)}function Wp(r,e,i,o,c,f){return kf(r,e,i,o,!0,f)}function Cf(r,e,i,o){const c=new Array(o?i+1:i);for(let f=0;f<2*i;f+=2)c[f/2]=new F(r[e+f],r[e+f+1]);return o&&(c[c.length-1]=c[0]),c}function Lf(r,e,i,o,c){const f=new Array(c?o+1:o);for(let m=0;m<2*o;m+=2){const v=2*e[i+m/2];f[m/2]=new F(r[v],r[v+1])}return c&&(f[f.length-1]=f[0]),f}function kf(r,e,i,o,c,f){const m=new Array(c?o+1:o);for(let v=0;v<o;v++){const T=Ef(r[e[i+v]],f.numBits,f.coordinateShift);m[v]=new F(T.x,T.y)}return c&&(m[m.length-1]=m[0]),m}class z_{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,c,f){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=c,this._mortonSettings=f}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=k_(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=Ef(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return k_(this)}get mortonSettings(){return this._mortonSettings}}class D_ extends z_{_numGeometries;_geometryType;constructor(e,i,o,c,f,m,v){super(o,c,f,m,v),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===jr.POLYGON||this._geometryType===jr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class R_ extends z_{_geometryTypes;constructor(e,i,o,c,f,m){super(e,o,c,f,m),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===jr.POLYGON||this.geometryType(e)===jr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class F_{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,c){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=c}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,c=i.ringOffsets,f=i.geometryOffsets;let m=0,v=1,T=1,I=1;for(let C=0;C<this.numGeometries;C++)switch(this.geometryType(C)){case jr.POLYGON:{const D=o[v]-o[v-1];v++;const B=[];for(let O=0;O<D;O++){const U=c[T]-c[T-1];T++;const Z=[];for(let q=0;q<U;q++){const Y=this._vertexBuffer[m++],le=this._vertexBuffer[m++];Z.push(new F(Y,le))}Z.length>0&&Z.push(Z[0]),B.push(Z)}e[C]=B,f&&I++}break;case jr.MULTIPOLYGON:{const D=f[I]-f[I-1];I++;const B=[];for(let O=0;O<D;O++){const U=o[v]-o[v-1];v++;for(let Z=0;Z<U;Z++){const q=c[T]-c[T-1];T++;const Y=[];for(let le=0;le<q;le++){const J=this._vertexBuffer[m++],te=this._vertexBuffer[m++];Y.push(new F(J,te))}Y.length>0&&Y.push(Y[0]),B.push(Y)}}e[C]=B}}return e}[Symbol.iterator](){return null}}function B_(r,e,i,o,c,f){return new Nb(r,e,i,o,c,f)}class Nb extends F_{_numGeometries;_geometryType;constructor(e,i,o,c,f,m){super(o,c,f,m),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function O_(r,e,i,o,c){return new jb(r,e,i,o,c)}class jb extends F_{_geometryTypes;constructor(e,i,o,c,f){super(i,o,c,f),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Vb(r,e,i,o,c){const f=Ln(r,i);let m=null,v=null,T=null,I=null,C=null,D=null,B=null,O=null;if(Gp(f,o,r,i)===Nr.CONST){const Z=If(r,i,f,!1);for(let q=0;q<e-1;q++){const Y=Ln(r,i);switch(Y.physicalStreamType){case ln.LENGTH:switch(Y.logicalStreamType.lengthType){case ao.GEOMETRIES:m=Pl(r,i,Y);break;case ao.PARTS:v=Pl(r,i,Y);break;case ao.RINGS:T=Pl(r,i,Y);break;case ao.TRIANGLES:B=Pl(r,i,Y)}break;case ln.OFFSET:switch(Y.logicalStreamType.offsetType){case nu.VERTEX:I=kn(r,i,Y,!1);break;case nu.INDEX:O=kn(r,i,Y,!1)}break;case ln.DATA:wa.VERTEX===Y.logicalStreamType.dictionaryType?C=kn(r,i,Y,!0):(D={numBits:Y.numBits,coordinateShift:Y.coordinateShift},C=kn(r,i,Y,!1))}}return O!==null?m!=null||v!=null?B_(o,Z,B,O,C,new yc(m,v,T)):B_(o,Z,B,O,C):D===null?(function(q,Y,le,J,te){return new D_(q,Y,Mo.VEC_2,le,J,te)})(o,Z,new yc(m,v,T),I,C):(function(q,Y,le,J,te,ue){return new D_(q,Y,Mo.MORTON,le,J,te,ue)})(o,Z,new yc(m,v,T),I,C,D)}const U=kn(r,i,f,!1);for(let Z=0;Z<e-1;Z++){const q=Ln(r,i);switch(q.physicalStreamType){case ln.LENGTH:switch(q.logicalStreamType.lengthType){case ao.GEOMETRIES:m=kn(r,i,q,!1);break;case ao.PARTS:v=kn(r,i,q,!1);break;case ao.RINGS:T=kn(r,i,q,!1);break;case ao.TRIANGLES:B=Pl(r,i,q)}break;case ln.OFFSET:switch(q.logicalStreamType.offsetType){case nu.VERTEX:I=kn(r,i,q,!1);break;case nu.INDEX:O=kn(r,i,q,!1)}break;case ln.DATA:wa.VERTEX===q.logicalStreamType.dictionaryType?C=kn(r,i,q,!0):(D={numBits:q.numBits,coordinateShift:q.coordinateShift},C=kn(r,i,q,!1))}}return O!==null&&v===null?O_(U,B,O,C):(m!==null?(m=zf(U,m,2),v!==null&&T!==null?(v=N_(U,m,v,!1),T=(function(Z,q,Y,le){const J=new Int32Array(Y[Y.length-1]+1);let te=0;J[0]=te;let ue=1,pe=1,Ie=0;for(let Ge=0;Ge<Z.length;Ge++){const je=Z[Ge],qe=q[Ge+1]-q[Ge];if(je!==0&&je!==3)for(let tt=0;tt<qe;tt++){const Ye=Y[ue]-Y[ue-1];ue++;for(let Ve=0;Ve<Ye;Ve++)te=J[pe++]=te+le[Ie++]}else for(let tt=0;tt<qe;tt++)J[pe++]=++te,ue++}return J})(U,m,v,T)):v!==null&&(v=(function(Z,q,Y){const le=new Int32Array(q[q.length-1]+1);let J=0;le[0]=J;let te=1,ue=0;for(let pe=0;pe<Z.length;pe++){const Ie=Z[pe],Ge=q[pe+1]-q[pe];if(Ie===4||Ie===1)for(let je=0;je<Ge;je++)J=le[te++]=J+Y[ue++];else for(let je=0;je<Ge;je++)le[te++]=++J}return le})(U,m,v))):v!==null&&T!==null?(v=zf(U,v,1),T=N_(U,v,T,!0)):v!==null&&(v=zf(U,v,0)),O!==null?O_(U,B,O,C,new yc(m,v,T)):D===null?(function(Z,q,Y,le){return new R_(Mo.VEC_2,Z,q,Y,le)})(U,new yc(m,v,T),I,C):(function(Z,q,Y,le,J){return new R_(Mo.MORTON,Z,q,Y,le,J)})(U,new yc(m,v,T),I,C,D))}function zf(r,e,i){const o=new Int32Array(r.length+1);let c=0;o[0]=c;let f=0;for(let m=0;m<r.length;m++)c=o[m+1]=c+(r[m]>i?e[f++]:1);return o}function N_(r,e,i,o){const c=new Int32Array(e[e.length-1]+1);let f=0;c[0]=f;let m=1,v=0;for(let T=0;T<r.length;T++){const I=r[T],C=e[T+1]-e[T];if(I===5||I===2||o&&(I===4||I===1))for(let D=0;D<C;D++)f=c[m++]=f+i[v++];else for(let D=0;D<C;D++)c[m++]=++f}return c}class Ub extends gc{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class Zb extends Vp{getValueFromBuffer(e){return this.dataBuffer[e]}}class j_ extends gc{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Eh(r,e,i){return V_(r,Math.ceil(e/8),i)}function V_(r,e,i){const o=new Uint8Array(e);let c=0;for(;c<e;){const f=r[i.increment()];if(f<=127){const m=f+3,v=r[i.increment()],T=c+m;o.fill(v,c,T),c=T}else{const m=256-f;for(let v=0;v<m;v++)o[c++]=r[i.increment()]}}return o}const Gb=new TextDecoder;function Df(r,e,i){return i-e>=12?Gb.decode(r.subarray(e,i)):(function(o,c,f){let m="",v=c;for(;v<f;){const T=o[v];let I,C,D,B=null,O=T>239?4:T>223?3:T>191?2:1;if(v+O>f)break;O===1?T<128&&(B=T):O===2?(I=o[v+1],(192&I)==128&&(B=(31&T)<<6|63&I,B<=127&&(B=null))):O===3?(I=o[v+1],C=o[v+2],(192&I)==128&&(192&C)==128&&(B=(15&T)<<12|(63&I)<<6|63&C,(B<=2047||B>=55296&&B<=57343)&&(B=null))):O===4&&(I=o[v+1],C=o[v+2],D=o[v+3],(192&I)==128&&(192&C)==128&&(192&D)==128&&(B=(15&T)<<18|(63&I)<<12|(63&C)<<6|63&D,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,O=1):B>65535&&(B-=65536,m+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),m+=String.fromCharCode(B),v+=O}return m})(r,e,i)}class Rf extends gc{offsetBuffer;constructor(e,i,o,c){super(e,o,c),this.offsetBuffer=i}}class U_ extends Rf{textEncoder;constructor(e,i,o,c){super(e,i,o,c??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Df(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class vc extends Rf{indexBuffer;textEncoder;constructor(e,i,o,c,f){super(e,o,c,f??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return Df(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Z_ extends Rf{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,c,f,m,v){super(e,o,c,v),this.indexBuffer=i,this.symbolOffsetBuffer=f,this.symbolTableBuffer=m,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,c,f){const m=[],v=new Array(c.length).fill(0);for(let T=1;T<c.length;T++)v[T]=v[T-1]+c[T-1];for(let T=0;T<f.length;T++)if(f[T]===255)m.push(f[++T]);else{const I=c[f[T]],C=v[f[T]];for(let D=0;D<I;D++)m.push(o[C+D])}return new Uint8Array(m)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return Df(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let c=1;c<e.length;c++){const f=e[c];i[c-1]=f-o,o=f}return i}}function $b(r,e,i,o,c,f){return i.type==="scalarType"?(function(m,v,T,I,C,D){let B=null,O=0;if(m===0)return null;if(D.nullable){const Z=Ln(v,T);O=Z.numValues;const q=T.get(),Y=Eh(v,O,T);T.set(q+Z.byteLength),B=new Ta(Y,Z.numValues)}const U=B??I;switch(C.physicalType){case 4:case 3:return(function(Z,q,Y,le,J){const te=Ln(Z,q),ue=Gp(te,J,Z,q),pe=le.physicalType===3;if(ue===Nr.FLAT){const Ie=Ch(J)?Af(Z,q,te,pe,J):kn(Z,q,te,pe);return new bf(Y.name,Ie,J)}if(ue===Nr.SEQUENCE){const Ie=P_(Z,q,te);return new Tf(Y.name,Ie[0],Ie[1],te.numRleValues)}{const Ie=If(Z,q,te,pe);return new Sf(Y.name,Ie,J)}})(v,T,D,C,U);case 9:return(function(Z,q,Y,le,J){let te=null,ue=null,pe=null,Ie=null,Ge=null,je=null,qe=null,tt=null;for(let Ye=0;Ye<le;Ye++){const Ve=Ln(q,Y);if(Ve.byteLength!==0)switch(Ve.physicalStreamType){case ln.PRESENT:{const Be=Eh(q,Ve.numValues,Y);je=new Ta(Be,Ve.numValues);break}case ln.OFFSET:ue=J!=null||je!=null?Af(q,Y,Ve,!1,J??je):kn(q,Y,Ve,!1);break;case ln.LENGTH:{const Be=Pl(q,Y,Ve);ao.DICTIONARY===Ve.logicalStreamType.lengthType?te=Be:ao.SYMBOL===Ve.logicalStreamType.lengthType?Ie=Be:qe=Be;break}case ln.DATA:{const Be=q.subarray(Y.get(),Y.get()+Ve.byteLength);Y.add(Ve.byteLength);const ct=Ve.logicalStreamType.dictionaryType;wa.FSST===ct?Ge=Be:wa.SINGLE===ct||wa.SHARED===ct?pe=Be:wa.NONE===ct&&(tt=Be);break}}}return(function(Ye,Ve,Be,ct,at,dt,ot){return Ve?new Z_(Ye,Be,ct,at,dt,Ve,ot):null})(Z,Ge,ue,te,pe,Ie,J??je)??(function(Ye,Ve,Be,ct,at){return Ve?at?new vc(Ye,Be,ct,Ve,at):new vc(Ye,Be,ct,Ve):null})(Z,pe,ue,te,J??je)??(function(Ye,Ve,Be,ct,at){if(!Ve||!Be)return null;if(ct)return at?new vc(Ye,ct,Ve,Be,at):new vc(Ye,ct,Ve,Be);if(at&&at.size()!==Ve.length-1){const dt=new Int32Array(at.size());let ot=0;for(let vt=0;vt<at.size();vt++)dt[vt]=at.get(vt)?ot++:0;return new vc(Ye,dt,Ve,Be,at)}return at?new U_(Ye,Ve,Be,at):new U_(Ye,Ve,Be)})(Z,qe,tt,ue,J??je)})(D.name,v,T,D.nullable?m-1:m,B);case 0:return(function(Z,q,Y,le,J){const te=Ln(Z,q),ue=te.numValues,pe=q.get(),Ie=Ch(J)?(function(je,qe,tt,Ye){const Ve=V_(je,Math.ceil(qe/8),tt),Be=new Ta(Ve,qe),ct=Ye.size(),at=new Ta(new Uint8Array(ct),ct);let dt=0;for(let ot=0;ot<Ye.size();ot++){const vt=!!Ye.get(ot)&&Be.get(dt++);at.set(ot,vt)}return at.getBuffer()})(Z,ue,q,J):Eh(Z,ue,q);q.set(pe+te.byteLength);const Ge=new Ta(Ie,ue);return new Ub(Y.name,Ge,J)})(v,T,D,0,U);case 6:case 5:return(function(Z,q,Y,le,J){const te=Ln(Z,q),ue=Gp(te,le,Z,q),pe=J.physicalType===5;if(ue===Nr.FLAT){const Ie=Ch(le)?(function(Ge,je,qe,tt,Ye){return(function(Ve,Be,ct,at){switch(Be.logicalLevelTechnique1){case Kt.DELTA:return Be.logicalLevelTechnique2===Kt.RLE&&(Ve=w_(Ve,Be.runs,Be.numRleValues)),(function(dt,ot){const vt=new BigInt64Array(dt.size());let ii=0;dt.get(0)?(vt[0]=dt.get(0)?ot[0]>>1n^-(1n&ot[0]):0n,ii=1):vt[0]=0n;let Wt=1;for(;Wt!=vt.length;++Wt)vt[Wt]=dt.get(Wt)?vt[Wt-1]+(ot[ii]>>1n^-(1n&ot[ii++])):vt[Wt-1];return vt})(at,Ve);case Kt.RLE:return(function(dt,ot,vt,ii){const Wt=ot;return vt?(function(ji,cn,br){const Vi=new BigInt64Array(ji.size());let Fi=0;for(let fi=0;fi<br;fi++){const Qi=Number(cn[fi]);let ar=cn[fi+br];ar=ar>>1n^-(1n&ar);for(let zi=Fi;zi<Fi+Qi;zi++)ji.get(zi)?Vi[zi]=ar:(Vi[zi]=0n,Fi++);Fi+=Qi}return Vi})(ii,dt,Wt.runs):(function(ji,cn,br){const Vi=new BigInt64Array(ji.size());let Fi=0;for(let fi=0;fi<br;fi++){const Qi=Number(cn[fi]),ar=cn[fi+br];for(let zi=Fi;zi<Fi+Qi;zi++)ji.get(zi)?Vi[zi]=ar:(Vi[zi]=0n,Fi++);Fi+=Qi}return Vi})(ii,dt,Wt.runs)})(Ve,Be,ct,at);case Kt.NONE:return Ve=ct?(function(dt,ot){const vt=new BigInt64Array(dt.size());let ii=0,Wt=0;for(;Wt!=vt.length;++Wt)if(dt.get(Wt)){const ji=ot[ii++];vt[Wt]=ji>>1n^-(1n&ji)}else vt[Wt]=0n;return vt})(at,Ve):(function(dt,ot){const vt=new BigInt64Array(dt.size());let ii=0,Wt=0;for(;Wt!=vt.length;++Wt)vt[Wt]=dt.get(Wt)?ot[ii++]:0n;return vt})(at,Ve),Ve;default:throw new Error("The specified Logical level technique is not supported")}})(Up(Ge,je,qe.numValues),qe,tt,Ye)})(Z,q,te,pe,le):I_(Z,q,te,pe);return new E_(Y.name,Ie,le)}if(ue===Nr.SEQUENCE){const Ie=M_(Z,q,te);return new C_(Y.name,Ie[0],Ie[1],te.numRleValues)}{const Ie=A_(Z,q,te,pe);return new j_(Y.name,Ie,le)}})(v,T,D,U,C);case 7:return(function(Z,q,Y,le){const J=Ln(Z,q),te=Ch(le)?(function(ue,pe,Ie,Ge){const je=pe.get(),qe=je+Ge*Float32Array.BYTES_PER_ELEMENT,tt=new Uint8Array(ue.subarray(je,qe)).buffer,Ye=new Float32Array(tt);pe.set(qe);const Ve=Ie.size(),Be=new Float32Array(Ve);let ct=0;for(let at=0;at<Ve;at++)Be[at]=Ie.get(at)?Ye[ct++]:0;return Be})(Z,q,le,J.numValues):(function(ue,pe,Ie){const Ge=pe.get(),je=Ge+Ie*Float32Array.BYTES_PER_ELEMENT,qe=new Uint8Array(ue.subarray(Ge,je)).buffer,tt=new Float32Array(qe);return pe.set(je),tt})(Z,q,J.numValues);return new Zb(Y.name,te,le)})(v,T,D,U);case 8:return(function(Z,q,Y,le){const J=Ln(Z,q),te=Ch(le)?(function(ue,pe,Ie,Ge){const je=pe.get(),qe=je+Ge*Float64Array.BYTES_PER_ELEMENT,tt=new Uint8Array(ue.subarray(je,qe)).buffer,Ye=new Float64Array(tt);pe.set(qe);const Ve=Ie.size(),Be=new Float64Array(Ve);let ct=0;for(let at=0;at<Ve;at++)Be[at]=Ie.get(at)?Ye[ct++]:0;return Be})(Z,q,le,J.numValues):(function(ue,pe,Ie){const Ge=pe.get(),je=Ge+Ie*Float64Array.BYTES_PER_ELEMENT,qe=new Uint8Array(ue.subarray(Ge,je)).buffer,tt=new Float64Array(qe);return pe.set(je),tt})(Z,q,J.numValues);return new wf(Y.name,te,le)})(v,T,D,U);default:throw new Error(`The specified data type for the field is currently not supported: ${C}`)}})(o,r,e,c,i.scalarType,i):o!=1?null:(function(m,v,T,I){let C=null,D=null,B=null,O=null,U=!1;for(;!U;){const le=Ln(m,v);switch(le.physicalStreamType){case ln.LENGTH:ao.DICTIONARY===le.logicalStreamType.lengthType?C=Pl(m,v,le):B=Pl(m,v,le);break;case ln.DATA:wa.SINGLE===le.logicalStreamType.dictionaryType||wa.SHARED===le.logicalStreamType.dictionaryType?(D=m.subarray(v.get(),v.get()+le.byteLength),U=!0):O=m.subarray(v.get(),v.get()+le.byteLength),v.add(le.byteLength)}}const Z=T.complexType.children,q=[];let Y=0;for(const le of Z){const J=Qr(m,v,1)[0];if(J==0)continue;const te=`${T.name}${le.name==="default"?"":":"+le.name}`;if(J!==2||le.type!=="scalarField"||le.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const ue=Ln(m,v),pe=Eh(m,ue.numValues,v),Ie=Ln(m,v),Ge=Ie.decompressedCount!==I?Af(m,v,Ie,!1,new Ta(pe,ue.numValues)):kn(m,v,Ie,!1);q[Y++]=O?new Z_(te,Ge,C,D,B,O,new Ta(pe,ue.numValues)):new vc(te,Ge,C,D,new Ta(pe,ue.numValues))}return q})(r,e,i,c)}function Ch(r){return r instanceof Ta}function qb(r){if(r.name==="id")return!1;if(r.type==="scalarType"){const e=r.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(r.type==="complexType"){const e=r.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",r),!1}const Wb=new TextDecoder;function G_(r,e){const i=Qr(r,e,1)[0];if(i===0)return"";const o=e.get(),c=r.subarray(o,o+i);return e.add(i),Wb.decode(c)}function $_(r,e){const i=Qr(r,e,1)[0]>>>0,o=!!(4&i),c=!!(2&i),f=Qr(r,e,1)[0]>>>0,m={};if(1&i&&(m.nullable=!0),c){const v={};if(o?(v.type="logicalType",v.logicalType=f):(v.type="physicalType",v.physicalType=f),8&i){const T=Qr(r,e,1)[0]>>>0;v.children=new Array(T);for(let I=0;I<T;I++)v.children[I]=$_(r,e)}m.type="complexField",m.complexField=v}else{const v={};o?(v.type="logicalType",v.logicalType=f):(v.type="physicalType",v.physicalType=f),m.type="scalarField",m.scalarField=v}return m}function Hb(r,e){const i=Qr(r,e,1)[0]>>>0,o=(function(c){switch(c){case 0:case 1:case 2:case 3:{const f={};f.nullable=!!(1&c),f.columnScope=0;const m={};return m.physicalType=c>1?6:4,m.type="physicalType",f.scalarType=m,f.type="scalarType",f}case 4:{const f={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:0};return f.type="complexType",f.complexType=m,f}case 30:{const f={nullable:!1,columnScope:0},m={type:"physicalType",physicalType:1};return f.type="complexType",f.complexType=m,f}default:return(function(f){let m=null;switch(f){case 10:case 11:m=0;break;case 12:case 13:m=1;break;case 14:case 15:m=2;break;case 16:case 17:m=3;break;case 18:case 19:m=4;break;case 20:case 21:m=5;break;case 22:case 23:m=6;break;case 24:case 25:m=7;break;case 26:case 27:m=8;break;case 28:case 29:m=9;break;default:return null}const v={};v.nullable=!!(1&f),v.columnScope=0;const T={type:"physicalType"};return T.physicalType=m,v.type="scalarType",v.scalarType=T,v})(c)}})(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if((function(c){return c>=10})(i)?o.name=G_(r,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),(function(c){return c===30})(i)){const c=Qr(r,e,1)[0]>>>0,f=o.complexType;f.children=new Array(c);for(let m=0;m<c;m++)f.children[m]=$_(r,e)}return o}function Xb(r,e){const i={featureTables:[]},o={};o.name=G_(r,e);const c=Qr(r,e,1)[0]>>>0,f=Qr(r,e,1)[0]>>>0;o.columns=new Array(f);for(let m=0;m<f;m++)o.columns[m]=Hb(r,e);return i.featureTables.push(o),[i,c]}function Yb(r,e,i,o,c,f,m=!1){const v=e.scalarType.physicalType,T=Gp(c,f,r,i);if(v===4)switch(T){case Nr.FLAT:{const I=kn(r,i,c,!1);return new bf(o,I,f)}case Nr.SEQUENCE:{const I=P_(r,i,c);return new Tf(o,I[0],I[1],c.numRleValues)}case Nr.CONST:{const I=If(r,i,c,!1);return new Sf(o,I,f)}}else switch(T){case Nr.FLAT:{if(m){const C=(function(D,B,O,U){const Z=(function(q,Y,le){const J=new Float64Array(Y);for(let te=0;te<Y;te++)J[te]=Fb(q,le);return J})(D,O.numValues,B);return(function(q,Y,le){switch(Y.logicalLevelTechnique1){case Kt.DELTA:return Y.logicalLevelTechnique2===Kt.RLE&&(q=T_(q,Y.runs,Y.numRleValues)),(function(J){J[0]=J[0]%2==1?(J[0]+1)/-2:J[0]/2;const te=J.length/4*4;let ue=1;if(te>=4)for(;ue<te-4;ue+=4){const pe=J[ue],Ie=J[ue+1],Ge=J[ue+2],je=J[ue+3];J[ue]=(pe%2==1?(pe+1)/-2:pe/2)+J[ue-1],J[ue+1]=(Ie%2==1?(Ie+1)/-2:Ie/2)+J[ue],J[ue+2]=(Ge%2==1?(Ge+1)/-2:Ge/2)+J[ue+1],J[ue+3]=(je%2==1?(je+1)/-2:je/2)+J[ue+2]}for(;ue!=J.length;++ue)J[ue]=(J[ue]%2==1?(J[ue]+1)/-2:J[ue]/2)+J[ue-1]})(q),q;case Kt.RLE:return(function(J,te,ue){return T_(J,te.runs,te.numRleValues)})(q,Y);case Kt.NONE:return q;default:throw new Error(`The specified Logical level technique is not supported: ${Y.logicalLevelTechnique1}`)}})(Z,O)})(r,i,c);return new wf(o,C,f)}const I=I_(r,i,c,!1);return new E_(o,I,f)}case Nr.SEQUENCE:{const I=M_(r,i,c);return new C_(o,I[0],I[1],c.numRleValues)}case Nr.CONST:{const I=A_(r,i,c,!1);return new j_(o,I,f)}}throw new Error("Vector type not supported for id column.")}class Kb{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case jr.POINT:case jr.MULTIPOINT:this.type=1;break;case jr.LINESTRING:case jr.MULTILINESTRING:this.type=2;break;case jr.POLYGON:case jr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const c of i)o.push(new F(c.x,c.y));e.push(o)}return e}}class Jb{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new Kb(this.features[e],this.extent)}}class q_{constructor(e){this.layers={};const i=(function(o,c,f=!0){const m=new Rb(0),v=[];for(;m.get()<o.length;){const T=Qr(o,m,1)[0]>>>0,I=m.get()+T;if(I>o.length)throw new Error(`Block overruns tile: ${I} > ${o.length}`);if(Qr(o,m,1)[0]>>>0!=1){m.set(I);continue}const C=Xb(o,m),D=C[1],B=C[0].featureTables[0];let O=null,U=null;const Z=[];let q=0;for(const le of B.columns){const J=le.name;if(J==="id"){let te=null;if(le.nullable){const pe=Ln(o,m),Ie=m.get(),Ge=Eh(o,pe.numValues,m);m.set(Ie+pe.byteLength),te=new Ta(Ge,pe.numValues)}const ue=Ln(o,m);q=ue.decompressedCount,O=Yb(o,le,m,J,ue,te??q,f)}else if(J==="geometry"){const te=Qr(o,m,1)[0];if(q===0){const ue=m.get();q=Ln(o,m).decompressedCount,m.set(ue)}U=Vb(o,te,m,q)}else{const te=qb(le)?Qr(o,m,1)[0]:1;if(te===0&&le.type==="scalarType")continue;const ue=$b(o,m,le,te,q);if(ue)if(Array.isArray(ue))for(const pe of ue)Z.push(pe);else Z.push(ue)}}const Y=new Db(B.name,U,O,Z,D);v.push(Y),m.set(I)}return v})(new Uint8Array(e));this.layers=i.reduce(((o,c)=>Object.assign(Object.assign({},o),{[c.name]:new Jb(c)})),{})}}class au{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new au;return i.extend(e(new F(this.minX,this.minY))),i.extend(e(new F(this.maxX,this.minY))),i.extend(e(new F(this.minX,this.maxY))),i.extend(e(new F(this.maxX,this.maxY))),i}static fromPoints(e){const i=new au;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Qb{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const c=[];for(const f of o)c.push(new F(f[0],f[1]));e.push(c)}return e}}const Lh="_geojsonTileLayer";function e1(r,e){e.writeVarintField(15,r.version||1),e.writeStringField(1,r.name||""),e.writeVarintField(5,r.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let f=0;f<r.length;f++)i.feature=r.feature(f),e.writeMessage(2,t1,i);const o=i.keys;for(const f of o)e.writeStringField(3,f);const c=i.values;for(const f of c)e.writeMessage(4,n1,f)}function t1(r,e){if(!r.feature)return;const i=r.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,i1,r),e.writeVarintField(3,i.type),e.writeMessage(4,r1,i)}function i1(r,e){for(const i in r.feature?.properties){let o=r.feature.properties[i],c=r.keycache[i];if(o===null)continue;c===void 0&&(r.keys.push(i),c=r.keys.length-1,r.keycache[i]=c),e.writeVarint(c),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const f=typeof o+":"+o;let m=r.valuecache[f];m===void 0&&(r.values.push(o),m=r.values.length-1,r.valuecache[f]=m),e.writeVarint(m)}}function Ff(r,e){return(e<<3)+(7&r)}function W_(r){return r<<1^r>>31}function r1(r,e){const i=r.loadGeometry(),o=r.type;let c=0,f=0;for(const m of i){let v=1;o===1&&(v=m.length),e.writeVarint(Ff(1,v));const T=o===3?m.length-1:m.length;for(let I=0;I<T;I++){I===1&&o!==1&&e.writeVarint(Ff(2,T-1));const C=m[I].x-c,D=m[I].y-f;e.writeVarint(W_(C)),e.writeVarint(W_(D)),c+=C,f+=D}r.type===3&&e.writeVarint(Ff(7,1))}}function n1(r,e){const i=typeof r;i==="string"?e.writeStringField(1,r):i==="boolean"?e.writeBooleanField(7,r):i==="number"&&(r%1!=0?e.writeDoubleField(3,r):r<0?e.writeSVarintField(6,r):e.writeVarintField(5,r))}class H_{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Wl(si,16,0),this.grid3D=new Wl(si,16,0),this.featureIndexArray=new j,this.promoteId=i}insert(e,i,o,c,f,m){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,f);const T=m?this.grid3D:this.grid;for(let I=0;I<i.length;I++){const C=i[I],D=[1/0,1/0,-1/0,-1/0];for(let B=0;B<C.length;B++){const O=C[B];D[0]=Math.min(D[0],O.x),D[1]=Math.min(D[1],O.y),D[2]=Math.max(D[2],O.x),D[3]=Math.max(D[3],O.y)}D[0]<si&&D[1]<si&&D[2]>=0&&D[3]>=0&&T.insert(v,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new zg(new Fp(this.rawTileData)).layers:new q_(this.rawTileData).layers,this.sourceLayerCoder=new g_(this.vtLayers?Object.keys(this.vtLayers).sort():[Lh])),this.vtLayers}query(e,i,o,c){this.loadVTLayers();const f=e.params,m=si/e.tileSize/e.scale,v=ft(f.filter,f.globalState),T=e.queryGeometry,I=e.queryPadding*m,C=au.fromPoints(T),D=this.grid.query(C.minX-I,C.minY-I,C.maxX+I,C.maxY+I),B=au.fromPoints(e.cameraQueryGeometry).expandBy(I),O=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,((q,Y,le,J)=>(function(te,ue,pe,Ie,Ge){for(const qe of te)if(ue<=qe.x&&pe<=qe.y&&Ie>=qe.x&&Ge>=qe.y)return!0;const je=[new F(ue,pe),new F(ue,Ge),new F(Ie,Ge),new F(Ie,pe)];if(te.length>2){for(const qe of je)if(sc(te,qe))return!0}for(let qe=0;qe<te.length-1;qe++)if(ax(te[qe],te[qe+1],je))return!0;return!1})(e.cameraQueryGeometry,q-I,Y-I,le+I,J+I)));for(const q of O)D.push(q);D.sort(o1);const U={};let Z;for(let q=0;q<D.length;q++){const Y=D[q];if(Y===Z)continue;Z=Y;const le=this.featureIndexArray.get(Y);let J=null;this.loadMatchingFeature(U,le.bucketIndex,le.sourceLayerIndex,le.featureIndex,v,f.layers,f.availableImages,i,o,c,((te,ue,pe)=>(J||(J=Us(te)),ue.queryIntersectsFeature({queryGeometry:T,feature:te,featureState:pe,geometry:J,zoom:this.z,transform:e.transform,pixelsToTileUnits:m,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return U}loadMatchingFeature(e,i,o,c,f,m,v,T,I,C,D){const B=this.bucketLayerIDs[i];if(m&&!B.some((q=>m.has(q))))return;const O=this.sourceLayerCoder.decode(o),U=this.vtLayers[O].feature(c);if(f.needGeometry){const q=Zs(U,!0);if(!f.filter(new Si(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!f.filter(new Si(this.tileID.overscaledZ),U))return;const Z=this.getId(U,O);for(let q=0;q<B.length;q++){const Y=B[q];if(m&&!m.has(Y))continue;const le=T[Y];if(!le)continue;let J={};Z&&C&&(J=C.getState(le.sourceLayer||Lh,Z));const te=Ui({},I[Y]);te.paint=X_(te.paint,le.paint,U,J,v),te.layout=X_(te.layout,le.layout,U,J,v);const ue=!D||D(U,le,J);if(!ue)continue;const pe=new __(U,this.z,this.x,this.y,Z);pe.layer=te;let Ie=e[Y];Ie===void 0&&(Ie=e[Y]=[]),Ie.push({featureIndex:c,feature:pe,intersectionZ:ue})}}lookupSymbolFeatures(e,i,o,c,f,m,v,T){const I={};this.loadVTLayers();const C=ft(f.filterSpec,f.globalState);for(const D of e)this.loadMatchingFeature(I,o,c,D,C,m,v,T,i);return I}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let c=e.id;return this.promoteId&&(c=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof c=="boolean"&&(c=Number(c)),c===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(c=Number(e.properties.cluster_id))),c}}function X_(r,e,i,o,c){return dn(r,((f,m)=>{const v=e instanceof Qu?e.get(m):null;return v&&v.evaluate?v.evaluate(i,o,c):v}))}function o1(r,e){return e-r}function Y_(r,e,i,o,c){const f=[];for(let m=0;m<r.length;m++){const v=r[m];let T;for(let I=0;I<v.length-1;I++){let C=v[I],D=v[I+1];C.x<e&&D.x<e||(C.x<e?C=new F(e,C.y+(e-C.x)/(D.x-C.x)*(D.y-C.y))._round():D.x<e&&(D=new F(e,C.y+(e-C.x)/(D.x-C.x)*(D.y-C.y))._round()),C.y<i&&D.y<i||(C.y<i?C=new F(C.x+(i-C.y)/(D.y-C.y)*(D.x-C.x),i)._round():D.y<i&&(D=new F(C.x+(i-C.y)/(D.y-C.y)*(D.x-C.x),i)._round()),C.x>=o&&D.x>=o||(C.x>=o?C=new F(o,C.y+(o-C.x)/(D.x-C.x)*(D.y-C.y))._round():D.x>=o&&(D=new F(o,C.y+(o-C.x)/(D.x-C.x)*(D.y-C.y))._round()),C.y>=c&&D.y>=c||(C.y>=c?C=new F(C.x+(c-C.y)/(D.y-C.y)*(D.x-C.x),c)._round():D.y>=c&&(D=new F(C.x+(c-C.y)/(D.y-C.y)*(D.x-C.x),c)._round()),T&&C.equals(T[T.length-1])||(T=[C],f.push(T)),T.push(D)))))}}return f}function K_(r,e,i,o,c){switch(e){case 1:return(function(f,m,v,T){const I=[];for(const C of f)for(const D of C){const B=T===0?D.x:D.y;B>=m&&B<=v&&I.push([D])}return I})(r,i,o,c);case 2:return J_(r,i,o,c,!1);case 3:return J_(r,i,o,c,!0)}return[]}function a1(r,e,i,o,c){const f=o===0?s1:l1;let m=[];const v=[];for(let C=0;C<r.length-1;C++){const D=r[C],B=r[C+1],O=o===0?D.x:D.y,U=o===0?B.x:B.y;let Z=!1;O<e?U>e&&m.push(f(D,B,e)):O>i?U<i&&m.push(f(D,B,i)):m.push(D),U<e&&O>=e&&(m.push(f(D,B,e)),Z=!0),U>i&&O<=i&&(m.push(f(D,B,i)),Z=!0),!c&&Z&&(v.push(m),m=[])}const T=r.length-1,I=o===0?r[T].x:r[T].y;return I>=e&&I<=i&&m.push(r[T]),c&&m.length>0&&!m[0].equals(m[m.length-1])&&m.push(new F(m[0].x,m[0].y)),m.length>0&&v.push(m),v}function J_(r,e,i,o,c){const f=[];for(const m of r){const v=a1(m,e,i,o,c);v.length>0&&f.push(...v)}return f}function s1(r,e,i){return new F(i,r.y+(i-r.x)/(e.x-r.x)*(e.y-r.y))}function l1(r,e,i){return new F(r.x+(i-r.y)/(e.y-r.y)*(e.x-r.x),i)}st("FeatureIndex",H_,{omit:["rawTileData","sourceLayerCoder"]});class Ml extends F{constructor(e,i,o,c){super(e,i),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new Ml(this.x,this.y,this.angle,this.segment)}}function Q_(r,e,i,o,c){if(e.segment===void 0||i===0)return!0;let f=e,m=e.segment+1,v=0;for(;v>-i/2;){if(m--,m<0)return!1;v-=r[m].dist(f),f=r[m]}v+=r[m].dist(r[m+1]),m++;const T=[];let I=0;for(;v<i/2;){const C=r[m],D=r[m+1];if(!D)return!1;let B=r[m-1].angleTo(C)-C.angleTo(D);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:v,angleDelta:B}),I+=B;v-T[0].distance>o;)I-=T.shift().angleDelta;if(I>c)return!1;m++,v+=C.dist(D)}return!0}function ey(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function ty(r,e,i){return r?.6*e*i:0}function iy(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function u1(r,e,i,o,c,f){const m=ty(i,c,f),v=iy(i,o)*f;let T=0;const I=ey(r)/2;for(let C=0;C<r.length-1;C++){const D=r[C],B=r[C+1],O=D.dist(B);if(T+O>I){const U=(I-T)/O,Z=Ii.number(D.x,B.x,U),q=Ii.number(D.y,B.y,U),Y=new Ml(Z,q,B.angleTo(D),C);return Y._round(),!m||Q_(r,Y,v,m,e)?Y:void 0}T+=O}}function c1(r,e,i,o,c,f,m,v,T){const I=ty(o,f,m),C=iy(o,c),D=C*m,B=r[0].x===0||r[0].x===T||r[0].y===0||r[0].y===T;return e-D<e/4&&(e=D+e/4),ry(r,B?e/2*v%e:(C/2+2*f)*m*v%e,e,I,i,D,B,!1,T)}function ry(r,e,i,o,c,f,m,v,T){const I=f/2,C=ey(r);let D=0,B=e-i,O=[];for(let U=0;U<r.length-1;U++){const Z=r[U],q=r[U+1],Y=Z.dist(q),le=q.angleTo(Z);for(;B+i<D+Y;){B+=i;const J=(B-D)/Y,te=Ii.number(Z.x,q.x,J),ue=Ii.number(Z.y,q.y,J);if(te>=0&&te<T&&ue>=0&&ue<T&&B-I>=0&&B+I<=C){const pe=new Ml(te,ue,le,U);pe._round(),o&&!Q_(r,pe,f,o,c)||O.push(pe)}}D+=Y}return v||O.length||m||(O=ry(r,D/2,i,o,c,f,m,!0,T)),O}function ny(r,e,i,o){const c=[],f=r.image,m=f.pixelRatio,v=f.paddedRect.w-2,T=f.paddedRect.h-2;let I={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const C=f.stretchX||[[0,v]],D=f.stretchY||[[0,T]],B=(Be,ct)=>Be+ct[1]-ct[0],O=C.reduce(B,0),U=D.reduce(B,0),Z=v-O,q=T-U;let Y=0,le=O,J=0,te=U,ue=0,pe=Z,Ie=0,Ge=q;if(f.content&&o){const Be=f.content,ct=Be[2]-Be[0],at=Be[3]-Be[1];(f.textFitWidth||f.textFitHeight)&&(I=Qg(r)),Y=Hp(C,0,Be[0]),J=Hp(D,0,Be[1]),le=Hp(C,Be[0],Be[2]),te=Hp(D,Be[1],Be[3]),ue=Be[0]-Y,Ie=Be[1]-J,pe=ct-le,Ge=at-te}const je=I.x1,qe=I.y1,tt=I.x2-je,Ye=I.y2-qe,Ve=(Be,ct,at,dt)=>{const ot=Xp(Be.stretch-Y,le,tt,je),vt=Yp(Be.fixed-ue,pe,Be.stretch,O),ii=Xp(ct.stretch-J,te,Ye,qe),Wt=Yp(ct.fixed-Ie,Ge,ct.stretch,U),ji=Xp(at.stretch-Y,le,tt,je),cn=Yp(at.fixed-ue,pe,at.stretch,O),br=Xp(dt.stretch-J,te,Ye,qe),Vi=Yp(dt.fixed-Ie,Ge,dt.stretch,U),Fi=new F(ot,ii),fi=new F(ji,ii),Qi=new F(ji,br),ar=new F(ot,br),zi=new F(vt/m,Wt/m),$n=new F(cn/m,Vi/m),hn=e*Math.PI/180;if(hn){const Vr=Math.sin(hn),Xi=Math.cos(hn),wr=[Xi,-Vr,Vr,Xi];Fi._matMult(wr),fi._matMult(wr),ar._matMult(wr),Qi._matMult(wr)}const qn=Be.stretch+Be.fixed,Yo=ct.stretch+ct.fixed;return{tl:Fi,tr:fi,bl:ar,br:Qi,tex:{x:f.paddedRect.x+1+qn,y:f.paddedRect.y+1+Yo,w:at.stretch+at.fixed-qn,h:dt.stretch+dt.fixed-Yo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zi,pixelOffsetBR:$n,minFontScaleX:pe/m/tt,minFontScaleY:Ge/m/Ye,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const Be=oy(C,Z,O),ct=oy(D,q,U);for(let at=0;at<Be.length-1;at++){const dt=Be[at],ot=Be[at+1];for(let vt=0;vt<ct.length-1;vt++)c.push(Ve(dt,ct[vt],ot,ct[vt+1]))}}else c.push(Ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:T+1}));return c}function Hp(r,e,i){let o=0;for(const c of r)o+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return o}function oy(r,e,i){const o=[{fixed:-1,stretch:0}];for(const[c,f]of r){const m=o[o.length-1];o.push({fixed:c-m.stretch,stretch:m.stretch}),o.push({fixed:c-m.stretch,stretch:m.stretch+(f-c)})}return o.push({fixed:e+1,stretch:i}),o}function Xp(r,e,i,o){return r/e*i+o}function Yp(r,e,i,o){return r-e*i/o}st("Anchor",Ml);class Kp{constructor(e,i,o,c,f,m,v,T,I,C){var D;if(this.boxStartIndex=e.length,I){let B=m.top,O=m.bottom;const U=m.collisionPadding;U&&(B-=U[1],O+=U[3]);let Z=O-B;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const B=!((D=m.image)===null||D===void 0)&&D.content&&(m.image.textFitWidth||m.image.textFitHeight)?Qg(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};B.y1=B.y1*v-T[0],B.y2=B.y2*v+T[2],B.x1=B.x1*v-T[3],B.x2=B.x2*v+T[1];const O=m.collisionPadding;if(O&&(B.x1-=O[0]*v,B.y1-=O[1]*v,B.x2+=O[2]*v,B.y2+=O[3]*v),C){const U=new F(B.x1,B.y1),Z=new F(B.x2,B.y1),q=new F(B.x1,B.y2),Y=new F(B.x2,B.y2),le=C*Math.PI/180;U._rotate(le),Z._rotate(le),q._rotate(le),Y._rotate(le),B.x1=Math.min(U.x,Z.x,q.x,Y.x),B.x2=Math.max(U.x,Z.x,q.x,Y.x),B.y1=Math.min(U.y,Z.y,q.y,Y.y),B.y2=Math.max(U.y,Z.y,q.y,Y.y)}e.emplaceBack(i.x,i.y,B.x1,B.y1,B.x2,B.y2,o,c,f)}this.boxEndIndex=e.length}}class h1{constructor(e=[],i=(o,c)=>o<c?-1:o>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,c=i[e];for(;e>0;){const f=e-1>>1,m=i[f];if(o(c,m)>=0)break;i[e]=m,e=f}i[e]=c}_down(e){const{data:i,compare:o}=this,c=this.length>>1,f=i[e];for(;e<c;){let m=1+(e<<1);const v=m+1;if(v<this.length&&o(i[v],i[m])<0&&(m=v),o(i[m],f)>=0)break;i[e]=i[m],e=m}i[e]=f}}function p1(r,e=1,i=!1){const o=au.fromPoints(r[0]),c=Math.min(o.width(),o.height());let f=c/2;const m=new h1([],d1),{minX:v,minY:T,maxX:I,maxY:C}=o;if(c===0)return new F(v,T);for(let O=v;O<I;O+=c)for(let U=T;U<C;U+=c)m.push(new xc(O+f,U+f,f,r));let D=(function(O){let U=0,Z=0,q=0;const Y=O[0];for(let le=0,J=Y.length,te=J-1;le<J;te=le++){const ue=Y[le],pe=Y[te],Ie=ue.x*pe.y-pe.x*ue.y;Z+=(ue.x+pe.x)*Ie,q+=(ue.y+pe.y)*Ie,U+=3*Ie}return new xc(Z/U,q/U,0,O)})(r),B=m.length;for(;m.length;){const O=m.pop();(O.d>D.d||!D.d)&&(D=O,i&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,B)),O.max-D.d<=e||(f=O.h/2,m.push(new xc(O.p.x-f,O.p.y-f,f,r)),m.push(new xc(O.p.x+f,O.p.y-f,f,r)),m.push(new xc(O.p.x-f,O.p.y+f,f,r)),m.push(new xc(O.p.x+f,O.p.y+f,f,r)),B+=4)}return i&&(console.log(`num probes: ${B}`),console.log(`best distance: ${D.d}`)),D.p}function d1(r,e){return e.max-r.max}function xc(r,e,i,o){this.p=new F(r,e),this.h=i,this.d=(function(c,f){let m=!1,v=1/0;for(let T=0;T<f.length;T++){const I=f[T];for(let C=0,D=I.length,B=D-1;C<D;B=C++){const O=I[C],U=I[B];O.y>c.y!=U.y>c.y&&c.x<(U.x-O.x)*(c.y-O.y)/(U.y-O.y)+O.x&&(m=!m),v=Math.min(v,cg(c,O,U))}}return(m?1:-1)*Math.sqrt(v)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var un;b.aQ=void 0,(un=b.aQ||(b.aQ={}))[un.center=1]="center",un[un.left=2]="left",un[un.right=3]="right",un[un.top=4]="top",un[un.bottom=5]="bottom",un[un["top-left"]=6]="top-left",un[un["top-right"]=7]="top-right",un[un["bottom-left"]=8]="bottom-left",un[un["bottom-right"]=9]="bottom-right";const Bf=Number.POSITIVE_INFINITY;function ay(r,e){return e[1]!==Bf?(function(i,o,c){let f=0,m=0;switch(o=Math.abs(o),c=Math.abs(c),i){case"top-right":case"top-left":case"top":m=c-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-c}switch(i){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,m]})(r,e[0],e[1]):(function(i,o){let c=0,f=0;o<0&&(o=0);const m=o/Math.SQRT2;switch(i){case"top-right":case"top-left":f=m-7;break;case"bottom-right":case"bottom-left":f=7-m;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(i){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=o;break;case"right":c=-o}return[c,f]})(r,e[0])}function sy(r,e,i){var o;const c=r.layout,f=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(f){const v=f.values,T=[];for(let I=0;I<v.length;I+=2){const C=T[I]=v[I],D=v[I+1].map((B=>B*Or));C.startsWith("top")?D[1]-=7:C.startsWith("bottom")&&(D[1]+=7),T[I+1]=D}return new Er(T)}const m=c.get("text-variable-anchor");if(m){let v;v=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},i)*Or,Bf]:c.get("text-offset").evaluate(e,{},i).map((I=>I*Or));const T=[];for(const I of m)T.push(I,ay(I,v));return new Er(T)}return null}function Of(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function f1(r,e,i,o,c,f,m,v,T,I,C,D){let B=f.textMaxSize.evaluate(e,{});B===void 0&&(B=m);const O=r.layers[0].layout,U=O.get("icon-offset").evaluate(e,{},C),Z=uy(i.horizontal),q=m/24,Y=r.tilePixelRatio*q,le=r.tilePixelRatio*B/24,J=r.tilePixelRatio*v,te=r.tilePixelRatio*O.get("symbol-spacing"),ue=O.get("text-padding")*r.tilePixelRatio,pe=(function(at,dt,ot,vt=1){const ii=at.get("icon-padding").evaluate(dt,{},ot),Wt=ii&&ii.values;return[Wt[0]*vt,Wt[1]*vt,Wt[2]*vt,Wt[3]*vt]})(O,e,C,r.tilePixelRatio),Ie=O.get("text-max-angle")/180*Math.PI,Ge=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",je=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",qe=O.get("symbol-placement"),tt=te/2,Ye=O.get("icon-text-fit");let Ve;o&&Ye!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(Ve=e_(o,i.vertical,Ye,O.get("icon-text-fit-padding"),U,q)),Z&&(o=e_(o,Z,Ye,O.get("icon-text-fit-padding"),U,q)));const Be=C?D.line.getGranularityForZoomLevel(C.z):1,ct=(at,dt)=>{dt.x<0||dt.x>=si||dt.y<0||dt.y>=si||(function(ot,vt,ii,Wt,ji,cn,br,Vi,Fi,fi,Qi,ar,zi,$n,hn,qn,Yo,Vr,Xi,wr,er,Ur,qs,Sa,Dh){const Il=ot.addToLineVertexArray(vt,ii);let su,bc,wc,Tc,dy=0,fy=0,my=0,gy=0,qf=-1,Wf=-1;const Ws={};let _y=Ri("");if(ot.allowVerticalPlacement&&Wt.vertical){const Sn=Vi.layout.get("text-rotate").evaluate(er,{},Sa)+90;wc=new Kp(Fi,vt,fi,Qi,ar,Wt.vertical,zi,$n,hn,Sn),br&&(Tc=new Kp(Fi,vt,fi,Qi,ar,br,Yo,Vr,hn,Sn))}if(ji){const Sn=Vi.layout.get("icon-rotate").evaluate(er,{}),Io=Vi.layout.get("icon-text-fit")!=="none",lu=ny(ji,Sn,qs,Io),Ma=br?ny(br,Sn,qs,Io):void 0;bc=new Kp(Fi,vt,fi,Qi,ar,ji,Yo,Vr,!1,Sn),dy=4*lu.length;const uu=ot.iconSizeData;let ss=null;uu.kind==="source"?(ss=[Gs*Vi.layout.get("icon-size").evaluate(er,{})],ss[0]>Tl&&yr(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):uu.kind==="composite"&&(ss=[Gs*Ur.compositeIconSizes[0].evaluate(er,{},Sa),Gs*Ur.compositeIconSizes[1].evaluate(er,{},Sa)],(ss[0]>Tl||ss[1]>Tl)&&yr(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,lu,ss,wr,Xi,er,b.aA.none,vt,Il.lineStartIndex,Il.lineLength,-1,Sa),qf=ot.icon.placedSymbolArray.length-1,Ma&&(fy=4*Ma.length,ot.addSymbols(ot.icon,Ma,ss,wr,Xi,er,b.aA.vertical,vt,Il.lineStartIndex,Il.lineLength,-1,Sa),Wf=ot.icon.placedSymbolArray.length-1)}const yy=Object.keys(Wt.horizontal);for(const Sn of yy){const Io=Wt.horizontal[Sn];if(!su){_y=Ri(Io.text);const Ma=Vi.layout.get("text-rotate").evaluate(er,{},Sa);su=new Kp(Fi,vt,fi,Qi,ar,Io,zi,$n,hn,Ma)}const lu=Io.positionedLines.length===1;if(my+=ly(ot,vt,Io,cn,Vi,hn,er,qn,Il,Wt.vertical?b.aA.horizontal:b.aA.horizontalOnly,lu?yy:[Sn],Ws,qf,Ur,Sa),lu)break}Wt.vertical&&(gy+=ly(ot,vt,Wt.vertical,cn,Vi,hn,er,qn,Il,b.aA.vertical,["vertical"],Ws,Wf,Ur,Sa));const _1=su?su.boxStartIndex:ot.collisionBoxArray.length,y1=su?su.boxEndIndex:ot.collisionBoxArray.length,v1=wc?wc.boxStartIndex:ot.collisionBoxArray.length,x1=wc?wc.boxEndIndex:ot.collisionBoxArray.length,b1=bc?bc.boxStartIndex:ot.collisionBoxArray.length,w1=bc?bc.boxEndIndex:ot.collisionBoxArray.length,T1=Tc?Tc.boxStartIndex:ot.collisionBoxArray.length,S1=Tc?Tc.boxEndIndex:ot.collisionBoxArray.length;let Pa=-1;const Qp=(Sn,Io)=>Sn&&Sn.circleDiameter?Math.max(Sn.circleDiameter,Io):Io;Pa=Qp(su,Pa),Pa=Qp(wc,Pa),Pa=Qp(bc,Pa),Pa=Qp(Tc,Pa);const vy=Pa>-1?1:0;vy&&(Pa*=Dh/Or),ot.glyphOffsetArray.length>=fc.MAX_GLYPHS&&yr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),er.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,er.sortKey);const P1=sy(Vi,er,Sa),[M1,I1]=(function(Sn,Io){const lu=Sn.length,Ma=Io?.values;if(Ma?.length>0)for(let uu=0;uu<Ma.length;uu+=2){const ss=Ma[uu+1];Sn.emplaceBack(b.aQ[Ma[uu]],ss[0],ss[1])}return[lu,Sn.length]})(ot.textAnchorOffsets,P1);ot.symbolInstances.emplaceBack(vt.x,vt.y,Ws.right>=0?Ws.right:-1,Ws.center>=0?Ws.center:-1,Ws.left>=0?Ws.left:-1,Ws.vertical||-1,qf,Wf,_y,_1,y1,v1,x1,b1,w1,T1,S1,fi,my,gy,dy,fy,vy,0,zi,Pa,M1,I1)})(r,dt,at,i,o,c,Ve,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Y,[ue,ue,ue,ue],Ge,T,J,pe,je,U,e,f,I,C,m)};if(qe==="line")for(const at of Y_(e.geometry,0,0,si,si)){const dt=ru(at,Be),ot=c1(dt,te,Ie,i.vertical||Z,o,24,le,r.overscaling,si);for(const vt of ot)Z&&m1(r,Z.text,tt,vt)||ct(dt,vt)}else if(qe==="line-center"){for(const at of e.geometry)if(at.length>1){const dt=ru(at,Be),ot=u1(dt,Ie,i.vertical||Z,o,24,le);ot&&ct(dt,ot)}}else if(e.type==="Polygon")for(const at of Wa(e.geometry,0)){const dt=p1(at,16);ct(ru(at[0],Be,!0),new Ml(dt.x,dt.y,0))}else if(e.type==="LineString")for(const at of e.geometry){const dt=ru(at,Be);ct(dt,new Ml(dt[0].x,dt[0].y,0))}else if(e.type==="Point")for(const at of e.geometry)for(const dt of at)ct([dt],new Ml(dt.x,dt.y,0))}function ly(r,e,i,o,c,f,m,v,T,I,C,D,B,O,U){const Z=(function(le,J,te,ue,pe,Ie,Ge,je){const qe=ue.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,tt=[];for(const Ye of J.positionedLines)for(const Ve of Ye.positionedGlyphs){if(!Ve.rect)continue;const Be=Ve.rect||{};let ct=4,at=!0,dt=1,ot=0;const vt=(pe||je)&&Ve.vertical,ii=Ve.metrics.advance*Ve.scale/2;if(je&&J.verticalizable&&(ot=Ye.lineOffset/2-(Ve.imageName?-(Or-Ve.metrics.width*Ve.scale)/2:(Ve.scale-1)*Or)),Ve.imageName){const Vr=Ge[Ve.imageName];at=Vr.sdf,dt=Vr.pixelRatio,ct=1/dt}const Wt=pe?[Ve.x+ii,Ve.y]:[0,0];let ji=pe?[0,0]:[Ve.x+ii+te[0],Ve.y+te[1]-ot],cn=[0,0];vt&&(cn=ji,ji=[0,0]);const br=Ve.metrics.isDoubleResolution?2:1,Vi=(Ve.metrics.left-ct)*Ve.scale-ii+ji[0],Fi=(-Ve.metrics.top-ct)*Ve.scale+ji[1],fi=Vi+Be.w/br*Ve.scale/dt,Qi=Fi+Be.h/br*Ve.scale/dt,ar=new F(Vi,Fi),zi=new F(fi,Fi),$n=new F(Vi,Qi),hn=new F(fi,Qi);if(vt){const Vr=new F(-ii,ii- -17),Xi=-Math.PI/2,wr=12-ii,er=new F(22-wr,-(Ve.imageName?wr:0)),Ur=new F(...cn);ar._rotateAround(Xi,Vr)._add(er)._add(Ur),zi._rotateAround(Xi,Vr)._add(er)._add(Ur),$n._rotateAround(Xi,Vr)._add(er)._add(Ur),hn._rotateAround(Xi,Vr)._add(er)._add(Ur)}if(qe){const Vr=Math.sin(qe),Xi=Math.cos(qe),wr=[Xi,-Vr,Vr,Xi];ar._matMult(wr),zi._matMult(wr),$n._matMult(wr),hn._matMult(wr)}const qn=new F(0,0),Yo=new F(0,0);tt.push({tl:ar,tr:zi,bl:$n,br:hn,tex:Be,writingMode:J.writingMode,glyphOffset:Wt,sectionIndex:Ve.sectionIndex,isSDF:at,pixelOffsetTL:qn,pixelOffsetBR:Yo,minFontScaleX:0,minFontScaleY:0})}return tt})(0,i,v,c,f,m,o,r.allowVerticalPlacement),q=r.textSizeData;let Y=null;q.kind==="source"?(Y=[Gs*c.layout.get("text-size").evaluate(m,{})],Y[0]>Tl&&yr(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):q.kind==="composite"&&(Y=[Gs*O.compositeTextSizes[0].evaluate(m,{},U),Gs*O.compositeTextSizes[1].evaluate(m,{},U)],(Y[0]>Tl||Y[1]>Tl)&&yr(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,Z,Y,v,f,m,I,e,T.lineStartIndex,T.lineLength,B,U);for(const le of C)D[le]=r.text.placedSymbolArray.length-1;return 4*Z.length}function uy(r){for(const e in r)return r[e];return null}function m1(r,e,i,o){const c=r.compareText;if(e in c){const f=c[e];for(let m=f.length-1;m>=0;m--)if(o.dist(f[m])<i)return!0}else c[e]=[];return c[e].push(o),!1}const cy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Nf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=cy[15&o];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new Nf(v,m,f,e)}constructor(e,i=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=cy.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-v%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return jf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:v}=this,T=[0,f.length-1,0],I=[];for(;T.length;){const C=T.pop()||0,D=T.pop()||0,B=T.pop()||0;if(D-B<=v){for(let q=B;q<=D;q++){const Y=m[2*q],le=m[2*q+1];Y>=e&&Y<=o&&le>=i&&le<=c&&I.push(f[q])}continue}const O=B+D>>1,U=m[2*O],Z=m[2*O+1];U>=e&&U<=o&&Z>=i&&Z<=c&&I.push(f[O]),(C===0?e<=U:i<=Z)&&(T.push(B),T.push(O-1),T.push(1-C)),(C===0?o>=U:c>=Z)&&(T.push(O+1),T.push(D),T.push(1-C))}return I}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:m}=this,v=[0,c.length-1,0],T=[],I=o*o;for(;v.length;){const C=v.pop()||0,D=v.pop()||0,B=v.pop()||0;if(D-B<=m){for(let q=B;q<=D;q++)py(f[2*q],f[2*q+1],e,i)<=I&&T.push(c[q]);continue}const O=B+D>>1,U=f[2*O],Z=f[2*O+1];py(U,Z,e,i)<=I&&T.push(c[O]),(C===0?e-o<=U:i-o<=Z)&&(v.push(B),v.push(O-1),v.push(1-C)),(C===0?e+o>=U:i+o>=Z)&&(v.push(O+1),v.push(D),v.push(1-C))}return T}}function jf(r,e,i,o,c,f){if(c-o<=i)return;const m=o+c>>1;hy(r,e,m,o,c,f),jf(r,e,i,o,m-1,1-f),jf(r,e,i,m+1,c,1-f)}function hy(r,e,i,o,c,f){for(;c>o;){if(c-o>600){const I=c-o+1,C=i-o+1,D=Math.log(I),B=.5*Math.exp(2*D/3),O=.5*Math.sqrt(D*B*(I-B)/I)*(C-I/2<0?-1:1);hy(r,e,i,Math.max(o,Math.floor(i-C*B/I+O)),Math.min(c,Math.floor(i+(I-C)*B/I+O)),f)}const m=e[2*i+f];let v=o,T=c;for(kh(r,e,o,i),e[2*c+f]>m&&kh(r,e,o,c);v<T;){for(kh(r,e,v,T),v++,T--;e[2*v+f]<m;)v++;for(;e[2*T+f]>m;)T--}e[2*o+f]===m?kh(r,e,o,T):(T++,kh(r,e,T,c)),T<=i&&(o=T+1),i<=T&&(c=T-1)}}function kh(r,e,i,o){Vf(r,i,o),Vf(e,2*i,2*o),Vf(e,2*i+1,2*o+1)}function Vf(r,e,i){const o=r[e];r[e]=r[i],r[i]=o}function py(r,e,i,o){const c=r-i,f=e-o;return c*c+f*f}var Uf;b.cI=void 0,(Uf=b.cI||(b.cI={})).create="create",Uf.load="load",Uf.fullLoad="fullLoad";let Jp=null,zh=[];const Zf=1e3/60,Gf="loadTime",$f="fullLoadTime",g1={mark(r){performance.mark(r)},frame(r){const e=r;Jp!=null&&zh.push(e-Jp),Jp=e},clearMetrics(){Jp=null,zh=[],performance.clearMeasures(Gf),performance.clearMeasures($f);for(const r in b.cI)performance.clearMarks(b.cI[r])},getPerformanceMetrics(){performance.measure(Gf,b.cI.create,b.cI.load),performance.measure($f,b.cI.create,b.cI.fullLoad);const r=performance.getEntriesByName(Gf)[0].duration,e=performance.getEntriesByName($f)[0].duration,i=zh.length,o=1/(zh.reduce(((f,m)=>f+m),0)/i/1e3),c=zh.filter((f=>f>Zf)).reduce(((f,m)=>f+(m-Zf)/Zf),0);return{loadTime:r,fullLoadTime:e,fps:o,percentDroppedFrames:c/(i+c)*100,totalFrames:i}}};b.$=me,b.A=Je,b.B=Xc,b.C=_l,b.D=yt,b.E=ti,b.F=function([r,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(i),y:r*Math.sin(e)*Math.sin(i),z:r*Math.cos(i)}},b.G=Ii,b.H=Si,b.I=pf,b.J=$l,b.K=function(r){if(Li==null){const e=r.navigator?r.navigator.userAgent:null;Li=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Li},b.L=class{constructor(r,e){this.target=r,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Lb((()=>this.process())),this.subscription=na(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=zn(self)?r:window}registerMessageHandler(r,e){this.messageHandlers[r]=e}unregisterMessageHandler(r){delete this.messageHandlers[r]}sendAsync(r,e){return new Promise(((i,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=e?na(e.signal,"abort",(()=>{f?.unsubscribe(),delete this.resolveRejects[c];const T={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),kb):null;this.resolveRejects[c]={resolve:T=>{f?.unsubscribe(),i(T)},reject:T=>{f?.unsubscribe(),o(T)}};const m=[],v=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:Ds(r.data,m)});this.target.postMessage(v,{transfer:m})}))}receive(r){const e=r.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(zn(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){return s(this,void 0,void 0,(function*(){if(e.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(e.error?c.reject(Xl(e.error)):c.resolve(Xl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Xl(e.data),o=new AbortController;this.abortControllers[r]=o;try{const c=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}}))}completeTask(r,e,i){const o=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Ds(e):null,data:Ds(i,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.M=Se,b.N=function(){var r=new Je(16);return Je!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},b.O=function(r,e,i){var o,c,f,m,v,T,I,C,D,B,O,U,Z=i[0],q=i[1],Y=i[2];return e===r?(r[12]=e[0]*Z+e[4]*q+e[8]*Y+e[12],r[13]=e[1]*Z+e[5]*q+e[9]*Y+e[13],r[14]=e[2]*Z+e[6]*q+e[10]*Y+e[14],r[15]=e[3]*Z+e[7]*q+e[11]*Y+e[15]):(c=e[1],f=e[2],m=e[3],v=e[4],T=e[5],I=e[6],C=e[7],D=e[8],B=e[9],O=e[10],U=e[11],r[0]=o=e[0],r[1]=c,r[2]=f,r[3]=m,r[4]=v,r[5]=T,r[6]=I,r[7]=C,r[8]=D,r[9]=B,r[10]=O,r[11]=U,r[12]=o*Z+v*q+D*Y+e[12],r[13]=c*Z+T*q+B*Y+e[13],r[14]=f*Z+I*q+O*Y+e[14],r[15]=m*Z+C*q+U*Y+e[15]),r},b.P=F,b.Q=function(r,e,i){var o=i[0],c=i[1],f=i[2];return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r[4]=e[4]*c,r[5]=e[5]*c,r[6]=e[6]*c,r[7]=e[7]*c,r[8]=e[8]*f,r[9]=e[9]*f,r[10]=e[10]*f,r[11]=e[11]*f,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},b.R=Gn,b.S=function(r,e,i){var o=e[0],c=e[1],f=e[2],m=e[3],v=e[4],T=e[5],I=e[6],C=e[7],D=e[8],B=e[9],O=e[10],U=e[11],Z=e[12],q=e[13],Y=e[14],le=e[15],J=i[0],te=i[1],ue=i[2],pe=i[3];return r[0]=J*o+te*v+ue*D+pe*Z,r[1]=J*c+te*T+ue*B+pe*q,r[2]=J*f+te*I+ue*O+pe*Y,r[3]=J*m+te*C+ue*U+pe*le,r[4]=(J=i[4])*o+(te=i[5])*v+(ue=i[6])*D+(pe=i[7])*Z,r[5]=J*c+te*T+ue*B+pe*q,r[6]=J*f+te*I+ue*O+pe*Y,r[7]=J*m+te*C+ue*U+pe*le,r[8]=(J=i[8])*o+(te=i[9])*v+(ue=i[10])*D+(pe=i[11])*Z,r[9]=J*c+te*T+ue*B+pe*q,r[10]=J*f+te*I+ue*O+pe*Y,r[11]=J*m+te*C+ue*U+pe*le,r[12]=(J=i[12])*o+(te=i[13])*v+(ue=i[14])*D+(pe=i[15])*Z,r[13]=J*c+te*T+ue*B+pe*q,r[14]=J*f+te*I+ue*O+pe*Y,r[15]=J*m+te*C+ue*U+pe*le,r},b.T=rf,b.U=function(r,e){const i={};for(let o=0;o<e.length;o++){const c=e[o];c in r&&(i[c]=r[c])}return i},b.V=Sl,b.W=Mr,b.X=u_,b.Y=l_,b.Z=fe,b._=s,b.a=ee,b.a$=p_,b.a0=nt,b.a1=ra,b.a2=Po,b.a3=h_,b.a4=jp,b.a5=si,b.a6=function(r,e,i){if(!r)return e||{};if(!e)return r||{};const o=m_(r),c=m_(e);(function(m,v){v.removeAll&&(m.add.clear(),m.update.clear(),m.remove.clear(),v.remove.clear());for(const T of v.remove)m.add.delete(T),m.update.delete(T);for(const[T,I]of v.update){const C=m.update.get(T);C&&(v.update.set(T,zb(C,I)),m.update.delete(T))}})(o,c);const f={};if((o.removeAll||c.removeAll)&&(f.removeAll=!0),f.remove=new Set([...o.remove,...c.remove]),f.add=new Map([...o.add,...c.add]),f.update=new Map([...o.update,...c.update]),f.remove.size&&f.add.size)for(const m of f.add.keys())f.remove.delete(m);return(function(m){const v={};return m.removeAll&&(v.removeAll=m.removeAll),m.remove&&(v.remove=Array.from(m.remove)),m.add&&(v.add=Array.from(m.add.values())),m.update&&(v.update=Array.from(m.update.values())),v})(f)},b.a7=function(r,e){if(r==null||r.type==null)return!0;if(r.type==="Feature")return Ah(r,e)!=null;if(r.type==="FeatureCollection"){const i=new Set;for(const o of r.features){const c=Ah(o,e);if(c==null||i.has(c))return!1;i.add(c)}return!0}return!1},b.a8=function(r,e){const i=new Map;if(!(r==null||r.type==null))if(r.type==="Feature")i.set(Ah(r,e),r);else for(const o of r.features)i.set(Ah(o,e),o);return i},b.a9=function(r,e,i){var o,c;if(e.removeAll)r.clear();else if(e.remove)for(const f of e.remove)r.delete(f);if(e.add)for(const f of e.add){const m=Ah(f,i);m!=null&&r.set(m,f)}if(e.update)for(const f of e.update){let m=r.get(f.id);if(!m)continue;const v=!!f.newGeometry,T=f.removeAllProperties||((o=f.removeProperties)===null||o===void 0?void 0:o.length)>0||((c=f.addOrUpdateProperties)===null||c===void 0?void 0:c.length)>0;if((v||T)&&(m=Object.assign({},m),r.set(f.id,m),v&&(m.geometry=f.newGeometry),T)){if(m.properties=f.removeAllProperties?{}:Object.assign({},m.properties||{}),f.removeProperties)for(const I of f.removeProperties)delete m.properties[I];if(f.addOrUpdateProperties)for(const{key:I,value:C}of f.addOrUpdateProperties)m.properties[I]=C}}},b.aB=function(r,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/Gs:r.kind==="composite"?Ii.number(o/Gs,c/Gs,i):e},b.aC=function(r,e){var i=e[0],o=e[1],c=e[2],f=e[3],m=e[4],v=e[5],T=e[6],I=e[7],C=e[8],D=e[9],B=e[10],O=e[11],U=e[12],Z=e[13],q=e[14],Y=e[15],le=i*v-o*m,J=i*T-c*m,te=i*I-f*m,ue=o*T-c*v,pe=o*I-f*v,Ie=c*I-f*T,Ge=C*Z-D*U,je=C*q-B*U,qe=C*Y-O*U,tt=D*q-B*Z,Ye=D*Y-O*Z,Ve=B*Y-O*q,Be=le*Ve-J*Ye+te*tt+ue*qe-pe*je+Ie*Ge;return Be?(r[0]=(v*Ve-T*Ye+I*tt)*(Be=1/Be),r[1]=(c*Ye-o*Ve-f*tt)*Be,r[2]=(Z*Ie-q*pe+Y*ue)*Be,r[3]=(B*pe-D*Ie-O*ue)*Be,r[4]=(T*qe-m*Ve-I*je)*Be,r[5]=(i*Ve-c*qe+f*je)*Be,r[6]=(q*te-U*Ie-Y*J)*Be,r[7]=(C*Ie-B*te+O*J)*Be,r[8]=(m*Ye-v*qe+I*Ge)*Be,r[9]=(o*qe-i*Ye-f*Ge)*Be,r[10]=(U*pe-Z*te+Y*le)*Be,r[11]=(D*te-C*pe-O*le)*Be,r[12]=(v*je-m*tt-T*Ge)*Be,r[13]=(i*tt-o*je+c*Ge)*Be,r[14]=(Z*J-U*ue-q*le)*Be,r[15]=(C*ue-D*J+B*le)*Be,r):null},b.aD=hr,b.aE=function(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)},b.aF=function(r){return r[0]=0,r[1]=0,r},b.aG=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r},b.aH=mf,b.aI=Pr,b.aJ=function(r,e,i,o){const c=e.y-r.y,f=e.x-r.x,m=o.y-i.y,v=o.x-i.x,T=m*f-v*c;if(T===0)return null;const I=(v*(r.y-i.y)-m*(r.x-i.x))/T;return new F(r.x+I*f,r.y+I*c)},b.aK=Y_,b.aL=dh,b.aM=function(r){let e=1/0,i=1/0,o=-1/0,c=-1/0;for(const f of r)e=Math.min(e,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),c=Math.max(c,f.y);return[e,i,o,c]},b.aN=Or,b.aO=Et,b.aP=function(r,e,i,o,c=!1){if(!i[0]&&!i[1])return[0,0];const f=c?o==="map"?-r.bearingInRadians:0:o==="viewport"?r.bearingInRadians:0;if(f){const m=Math.sin(f),v=Math.cos(f);i=[i[0]*v-i[1]*m,i[0]*m+i[1]*v]}return[c?i[0]:Et(e,i[0],r.zoom),c?i[1]:Et(e,i[1],r.zoom)]},b.aR=ff,b.aS=Of,b.aT=df,b.aU=Nf,b.aV=rr,b.aW=Dp,b.aX=N,b.aY=He,b.aZ=Re,b.a_=en,b.aa=Lh,b.ab=Ih,b.ac=au,b.ad=25,b.ae=xf,b.af=r=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of r){const c=window.document.createElement("source");Ze(o)||(e.crossOrigin="Anonymous"),c.src=o,e.appendChild(c)}}))},b.ag=Fe,b.ah=function(){return Ro++},b.ai=t,b.aj=fc,b.ak=ft,b.al=Zs,b.am=__,b.an=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,c,f)=>{const m=c||f;return e[o]=!m||m.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},b.ao=Bt,b.ap=85.051129,b.aq=Da,b.ar=function(r){return Math.pow(2,r)},b.as=ke,b.at=c_,b.au=function(r){return Math.log(r)/Math.LN2},b.av=function(r){var e=r[0],i=r[1];return e*e+i*i},b.aw=function(r){if(!r.length)return new Set;const e=Math.max(...r.map((T=>T.canonical.z)));let i=1/0,o=-1/0,c=1/0,f=-1/0;const m=[];for(const T of r){const{x:I,y:C,z:D}=T.canonical,B=Math.pow(2,e-D),O=I*B,U=C*B;m.push({id:T,x:O,y:U}),O<i&&(i=O),O>o&&(o=O),U<c&&(c=U),U>f&&(f=U)}const v=new Set;for(const T of m)T.x!==i&&T.x!==o&&T.y!==c&&T.y!==f||v.add(T.id);return v},b.ax=function(r,e){const i=Math.abs(2*r.wrap)-+(r.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||o-i||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x},b.ay=class{constructor(r,e){this.max=r,this.onRemove=e,this.reset()}reset(){for(const r in this.data)for(const e of this.data[r])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(r,e,i){const o=r.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const c={value:e,timeout:void 0};if(i!==void 0&&(c.timeout=setTimeout((()=>{this.remove(r,c)}),i)),this.data[o].push(c),this.order.push(o),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const e=this.data[r].shift();return e.timeout&&clearTimeout(e.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),e.value}getByKey(r){const e=this.data[r];return e?e[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,e){if(!this.has(r))return this;const i=r.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),c=this.data[i][o];return this.data[i].splice(o,1),c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(c.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(r){const e=[];for(const i in this.data)for(const o of this.data[i])r(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},b.az=function(r,e){let i=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:m}=r,v=c?Bt(qi.interpolationFactor(c,e,f,m),0,1):0;r.kind==="camera"?o=Ii.number(r.minSize,r.maxSize,v):i=v}return{uSizeT:i,uSize:o}},b.b=Dn,b.b$=class extends Tn{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},b.b0=Pt,b.b1=Vt,b.b2=function(r){var e=new Je(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},b.b3=function(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r},b.b4=function(r,e){var i=e[0],o=e[1],c=e[2],f=i*i+o*o+c*c;return f>0&&(f=1/Math.sqrt(f)),r[0]=e[0]*f,r[1]=e[1]*f,r[2]=e[2]*f,r},b.b5=ei,b.b6=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},b.b7=function(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r[3]=e[3]*i[3],r},b.b8=ht,b.b9=function(r,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(r[0]*i[0]+r[1]*i[1]+r[2]*i[2])-i[3])/o},b.bA=function(){return new Float64Array(3)},b.bB=function(r,e,i,o){return r[0]=e[0]+i[0]*o,r[1]=e[1]+i[1]*o,r[2]=e[2]+i[2]*o,r},b.bC=gr,b.bD=function(r,e,i){var o=i[0],c=i[1],f=i[2],m=i[3],v=e[0],T=e[1],I=e[2],C=c*I-f*T,D=f*v-o*I,B=o*T-c*v;return r[0]=v+m*(C+=C)+c*(B+=B)-f*(D+=D),r[1]=T+m*D+f*C-o*B,r[2]=I+m*B+o*D-c*C,r},b.bE=function(r,e,i){const o=(function(T){var I=T[3],C=T[4],D=T[5],B=T[6],O=T[7],U=T[8];return T[0]*(U*C-D*O)+T[1]*(-U*I+D*B)+T[2]*(O*I-C*B)})([r[0],r[1],r[2],e[0],e[1],e[2],i[0],i[1],i[2]]);if(o===0)return null;const c=ei([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),f=ei([],[i[0],i[1],i[2]],[r[0],r[1],r[2]]),m=ei([],[r[0],r[1],r[2]],[e[0],e[1],e[2]]),v=Pt([],c,-r[3]);return Vt(v,v,Pt([],f,-e[3])),Vt(v,v,Pt([],m,-i[3])),Pt(v,v,1/o),v},b.bF=vf,b.bG=function(){return new Float64Array(4)},b.bH=function(r,e,i,o){var c=[],f=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],f[0]=c[0]*Math.cos(o)-c[1]*Math.sin(o),f[1]=c[0]*Math.sin(o)+c[1]*Math.cos(o),f[2]=c[2],r[0]=f[0]+i[0],r[1]=f[1]+i[1],r[2]=f[2]+i[2],r},b.bI=function(r,e,i,o){var c=[],f=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],f[0]=c[0],f[1]=c[1]*Math.cos(o)-c[2]*Math.sin(o),f[2]=c[1]*Math.sin(o)+c[2]*Math.cos(o),r[0]=f[0]+i[0],r[1]=f[1]+i[1],r[2]=f[2]+i[2],r},b.bJ=function(r,e,i,o){var c=[],f=[];return c[0]=e[0]-i[0],c[1]=e[1]-i[1],c[2]=e[2]-i[2],f[0]=c[2]*Math.sin(o)+c[0]*Math.cos(o),f[1]=c[1],f[2]=c[2]*Math.cos(o)-c[0]*Math.sin(o),r[0]=f[0]+i[0],r[1]=f[1]+i[1],r[2]=f[2]+i[2],r},b.bK=function(r,e,i){var o=Math.sin(i),c=Math.cos(i),f=e[0],m=e[1],v=e[2],T=e[3],I=e[8],C=e[9],D=e[10],B=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*c-I*o,r[1]=m*c-C*o,r[2]=v*c-D*o,r[3]=T*c-B*o,r[8]=f*o+I*c,r[9]=m*o+C*c,r[10]=v*o+D*c,r[11]=T*o+B*c,r},b.bL=function(r,e){const i=li(r,360),o=li(e,360),c=o-i,f=o>i?c-360:c+360;return Math.abs(c)<Math.abs(f)?c:f},b.bM=function(r){return r[0]=0,r[1]=0,r[2]=0,r},b.bN=function(r,e,i,o){const c=Math.sqrt(r*r+e*e),f=Math.sqrt(i*i+o*o);r/=c,e/=c,i/=f,o/=f;const m=Math.acos(r*i+e*o);return-e*i+r*o>0?m:-m},b.bO=function(r,e){const i=li(r,2*Math.PI),o=li(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},b.bP=function(){const r={},e=Le.$version;for(const i in Le.$root){const o=Le.$root[i];if(o.required){let c=null;c=i==="version"?e:o.type==="array"?[]:{},c!=null&&(r[i]=c)}}return r},b.bQ=De,b.bR=Rs,b.bS=function r(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!r(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!r(e[o],i[o]))return!1;return!0}return e===i},b.bT=function(r){r=r.slice();const e=Object.create(null);for(let i=0;i<r.length;i++)e[r[i].id]=r[i];for(let i=0;i<r.length;i++)"ref"in r[i]&&(r[i]=Ir(r[i],e[r[i].ref]));return r},b.bU=function(r,e){if(r.type==="custom")return new Cb(r,e);switch(r.type){case"background":return new Eb(r,e);case"circle":return new dx(r,e);case"color-relief":return new vx(r,e);case"fill":return new Dx(r,e);case"fill-extrusion":return new qx(r,e);case"heatmap":return new mx(r,e);case"hillshade":return new _x(r,e);case"line":return new Qx(r,e);case"raster":return new Tp(r,e);case"symbol":return new Np(r,e)}},b.bV=r=>r.type==="raster",b.bW=$r,b.bX=function(r,e){if(!r)return[{command:"setStyle",args:[e]}];let i=[];try{if(!Ct(r.version,e.version))return[{command:"setStyle",args:[e]}];Ct(r.center,e.center)||i.push({command:"setCenter",args:[e.center]}),Ct(r.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),Ct(r.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Ct(r.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),Ct(r.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),Ct(r.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),Ct(r.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),Ct(r.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),Ct(r.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),Ct(r.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),Ct(r.light,e.light)||i.push({command:"setLight",args:[e.light]}),Ct(r.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),Ct(r.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),Ct(r.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},c=[];(function(m,v,T,I){let C;for(C in v=v||{},m=m||{})Object.prototype.hasOwnProperty.call(m,C)&&(Object.prototype.hasOwnProperty.call(v,C)||xi(C,T,I));for(C in v)Object.prototype.hasOwnProperty.call(v,C)&&(Object.prototype.hasOwnProperty.call(m,C)?Ct(m[C],v[C])||(m[C].type==="geojson"&&v[C].type==="geojson"&&bi(m,v,C)?hi(T,{command:"setGeoJSONSourceData",args:[C,v[C].data]}):Zi(C,v,T,I)):Ar(C,v,T))})(r.sources,e.sources,c,o);const f=[];r.layers&&r.layers.forEach((m=>{"source"in m&&o[m.source]?i.push({command:"removeLayer",args:[m.id]}):f.push(m)})),i=i.concat(c),(function(m,v,T){v=v||[];const I=(m=m||[]).map(fs),C=v.map(fs),D=m.reduce(tn,{}),B=v.reduce(tn,{}),O=I.slice(),U=Object.create(null);let Z,q,Y,le,J;for(let te=0,ue=0;te<I.length;te++)Z=I[te],Object.prototype.hasOwnProperty.call(B,Z)?ue++:(hi(T,{command:"removeLayer",args:[Z]}),O.splice(O.indexOf(Z,ue),1));for(let te=0,ue=0;te<C.length;te++)Z=C[C.length-1-te],O[O.length-1-te]!==Z&&(Object.prototype.hasOwnProperty.call(D,Z)?(hi(T,{command:"removeLayer",args:[Z]}),O.splice(O.lastIndexOf(Z,O.length-ue),1)):ue++,le=O[O.length-te],hi(T,{command:"addLayer",args:[B[Z],le]}),O.splice(O.length-te,0,Z),U[Z]=!0);for(let te=0;te<C.length;te++)if(Z=C[te],q=D[Z],Y=B[Z],!U[Z]&&!Ct(q,Y))if(Ct(q.source,Y.source)&&Ct(q["source-layer"],Y["source-layer"])&&Ct(q.type,Y.type)){for(J in ir(q.layout,Y.layout,T,Z,null,"setLayoutProperty"),ir(q.paint,Y.paint,T,Z,null,"setPaintProperty"),Ct(q.filter,Y.filter)||hi(T,{command:"setFilter",args:[Z,Y.filter]}),Ct(q.minzoom,Y.minzoom)&&Ct(q.maxzoom,Y.maxzoom)||hi(T,{command:"setLayerZoomRange",args:[Z,Y.minzoom,Y.maxzoom]}),q)Object.prototype.hasOwnProperty.call(q,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?ir(q[J],Y[J],T,Z,J.slice(6),"setPaintProperty"):Ct(q[J],Y[J])||hi(T,{command:"setLayerProperty",args:[Z,J,Y[J]]}));for(J in Y)Object.prototype.hasOwnProperty.call(Y,J)&&!Object.prototype.hasOwnProperty.call(q,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?ir(q[J],Y[J],T,Z,J.slice(6),"setPaintProperty"):Ct(q[J],Y[J])||hi(T,{command:"setLayerProperty",args:[Z,J,Y[J]]}))}else hi(T,{command:"removeLayer",args:[Z]}),le=O[O.lastIndexOf(Z)+1],hi(T,{command:"addLayer",args:[Y,le]})})(f,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},b.bY=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},b.bZ=dn,b.b_=ea,b.ba=Gr,b.bb=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r},b.bc=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]},b.bd=f_,b.be=mc,b.bf=function(r,e,i,o,c){var f=1/Math.tan(e/2);if(r[0]=f/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=f,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0){var m=1/(o-c);r[10]=(c+o)*m,r[14]=2*c*o*m}else r[10]=-1,r[14]=-2*o;return r},b.bg=function(r){var e=new Je(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},b.bh=function(r,e,i){var o=Math.sin(i),c=Math.cos(i),f=e[0],m=e[1],v=e[2],T=e[3],I=e[4],C=e[5],D=e[6],B=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*c+I*o,r[1]=m*c+C*o,r[2]=v*c+D*o,r[3]=T*c+B*o,r[4]=I*c-f*o,r[5]=C*c-m*o,r[6]=D*c-v*o,r[7]=B*c-T*o,r},b.bi=function(r,e,i){var o=Math.sin(i),c=Math.cos(i),f=e[4],m=e[5],v=e[6],T=e[7],I=e[8],C=e[9],D=e[10],B=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=f*c+I*o,r[5]=m*c+C*o,r[6]=v*c+D*o,r[7]=T*c+B*o,r[8]=I*c-f*o,r[9]=C*c-m*o,r[10]=D*c-v*o,r[11]=B*c-T*o,r},b.bj=function(){const r=new Float32Array(16);return ke(r),r},b.bk=function(){const r=new Float64Array(16);return ke(r),r},b.bl=function(){return new Float64Array(16)},b.bm=function(r,e,i){const o=new Float64Array(4);return gr(o,r,e-90,i),o},b.bn=function(r,e,i,o){var c,f,m,v,T,I=e[0],C=e[1],D=e[2],B=e[3],O=i[0],U=i[1],Z=i[2],q=i[3];return(f=I*O+C*U+D*Z+B*q)<0&&(f=-f,O=-O,U=-U,Z=-Z,q=-q),1-f>Ke?(c=Math.acos(f),m=Math.sin(c),v=Math.sin((1-o)*c)/m,T=Math.sin(o*c)/m):(v=1-o,T=o),r[0]=v*I+T*O,r[1]=v*C+T*U,r[2]=v*D+T*Z,r[3]=v*B+T*q,r},b.bo=function(r){const e=new Float64Array(9);(function(f,m){var v=m[0],T=m[1],I=m[2],C=m[3],D=v+v,B=T+T,O=I+I,U=v*D,Z=T*D,q=T*B,Y=I*D,le=I*B,J=I*O,te=C*D,ue=C*B,pe=C*O;f[0]=1-q-J,f[3]=Z-pe,f[6]=Y+ue,f[1]=Z+pe,f[4]=1-U-J,f[7]=le-te,f[2]=Y-ue,f[5]=le+te,f[8]=1-U-q})(e,r);const i=en(-Math.asin(Bt(e[2],-1,1)));let o,c;return Math.hypot(e[5],e[8])<.001?(o=0,c=-en(Math.atan2(e[3],e[4]))):(o=en(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),c=en(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:i+90,bearing:c}},b.bp=function(r,e){return r.roll==e.roll&&r.pitch==e.pitch&&r.bearing==e.bearing},b.bq=Ft,b.br=Ho,b.bs=hc,b.bt=bh,b.bu=cc,b.bv=pr,b.bw=_r,b.bx=Yi,b.by=function(r,e,i,o,c){return pr(o,c,Bt((r-e)/(i-e),0,1))},b.bz=li,b.c=ye,b.c$=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},b.c0=Vs,b.c1=class extends Tn{constructor(r,e){super(r,e),this.current=oc}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},b.c2=os,b.c3=class extends Tn{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},b.c4=class extends Tn{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},b.c5=Ue,b.c6=function(r,e){var i=Math.sin(e),o=Math.cos(e);return r[0]=o,r[1]=i,r[2]=0,r[3]=-i,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},b.c7=function(r,e,i){var o=e[0],c=e[1],f=e[2];return r[0]=o*i[0]+c*i[3]+f*i[6],r[1]=o*i[1]+c*i[4]+f*i[7],r[2]=o*i[2]+c*i[5]+f*i[8],r},b.c8=function(r,e,i,o,c,f,m){var v=1/(e-i),T=1/(o-c),I=1/(f-m);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*T,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*I,r[11]=0,r[12]=(e+i)*v,r[13]=(c+o)*T,r[14]=(m+f)*I,r[15]=1,r},b.c9=class extends Tn{constructor(r,e){super(r,e),this.current=new Array}set(r){if(r!=this.current){this.current=r;const e=new Float32Array(4*r.length);for(let i=0;i<r.length;i++)e[4*i]=r[i].r,e[4*i+1]=r[i].g,e[4*i+2]=r[i].b,e[4*i+3]=r[i].a;this.gl.uniform4fv(this.location,e)}}},b.cA=function(r,e){return H[e]&&(r instanceof MouseEvent||r instanceof WheelEvent)},b.cB=function(r,e){return Pe[e]&&"touches"in r},b.cC=function(r){return Pe[r]||H[r]},b.cD=function(r,e,i){var o=e[0],c=e[1];return r[0]=i[0]*o+i[4]*c+i[12],r[1]=i[1]*o+i[5]*c+i[13],r},b.cE=function(r,e){const{x:i,y:o}=Ih.fromLngLat(e);return!(r<0||r>25||o<0||o>=1||i<0||i>=1)},b.cF=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},b.cG=class extends ec{},b.cH=g1,b.cJ=we,b.cK=function(r,e){ye.REGISTERED_PROTOCOLS[r]=e},b.cL=function(r){delete ye.REGISTERED_PROTOCOLS[r]},b.cM=function(r,e){const i={};for(let c=0;c<r.length;c++){const f=e&&e[r[c].id]||qu(r[c]);e&&(e[r[c].id]=f);let m=i[f];m||(m=i[f]=[]),m.push(r[c])}const o=[];for(const c in i)o.push(i[c]);return o},b.cN=st,b.cO=g_,b.cP=H_,b.cQ=Kg,b.cR=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=si/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new Si(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Si(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Si(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:C}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Si(I),r.canonical),o["text-size"].possiblyEvaluate(new Si(C),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:C}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Si(I),r.canonical),o["icon-size"].possiblyEvaluate(new Si(C),r.canonical)]}const f=i.get("text-line-height")*Or,m=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",v=i.get("text-keep-upright"),T=i.get("text-size");for(const I of r.bucket.features){const C=i.get("text-font").evaluate(I,{},r.canonical).join(","),D=T.evaluate(I,{},r.canonical),B=c.layoutTextSize.evaluate(I,{},r.canonical),O=c.layoutIconSize.evaluate(I,{},r.canonical),U={horizontal:{},vertical:void 0},Z=I.text;let q,Y=[0,0];if(Z){const te=Z.toString(),ue=i.get("text-letter-spacing").evaluate(I,{},r.canonical)*Or,pe=qd(te)?ue:0,Ie=i.get("text-anchor").evaluate(I,{},r.canonical),Ge=sy(e,I,r.canonical);if(!Ge){const Ye=i.get("text-radial-offset").evaluate(I,{},r.canonical);Y=Ye?ay(Ie,[Ye*Or,Bf]):i.get("text-offset").evaluate(I,{},r.canonical).map((Ve=>Ve*Or))}let je=m?"center":i.get("text-justify").evaluate(I,{},r.canonical);const qe=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(I,{},r.canonical)*Or:1/0,tt=()=>{r.bucket.allowVerticalPlacement&&Fs(te)&&(U.vertical=Bp(Z,r.glyphMap,r.glyphPositions,r.imagePositions,C,qe,f,Ie,"left",pe,Y,b.aA.vertical,!0,B,D))};if(!m&&Ge){const Ye=new Set;if(je==="auto")for(let Be=0;Be<Ge.values.length;Be+=2)Ye.add(Of(Ge.values[Be]));else Ye.add(je);let Ve=!1;for(const Be of Ye)if(!U.horizontal[Be])if(Ve)U.horizontal[Be]=U.horizontal[0];else{const ct=Bp(Z,r.glyphMap,r.glyphPositions,r.imagePositions,C,qe,f,"center",Be,pe,Y,b.aA.horizontal,!1,B,D);ct&&(U.horizontal[Be]=ct,Ve=ct.positionedLines.length===1)}tt()}else{je==="auto"&&(je=Of(Ie));const Ye=Bp(Z,r.glyphMap,r.glyphPositions,r.imagePositions,C,qe,f,Ie,je,pe,Y,b.aA.horizontal,!1,B,D);Ye&&(U.horizontal[je]=Ye),tt(),Fs(te)&&m&&v&&(U.vertical=Bp(Z,r.glyphMap,r.glyphPositions,r.imagePositions,C,qe,f,Ie,je,pe,Y,b.aA.vertical,!1,B,D))}}let le=!1;if(I.icon&&I.icon.name){const te=r.imageMap[I.icon.name];te&&(q=Pb(r.imagePositions[I.icon.name],i.get("icon-offset").evaluate(I,{},r.canonical),i.get("icon-anchor").evaluate(I,{},r.canonical)),le=!!te.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=le:r.bucket.sdfIcons!==le&&yr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(te.pixelRatio!==r.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const J=uy(U.horizontal)||U.vertical;r.bucket.iconsInText=!!J&&J.iconsInText,(J||q)&&f1(r.bucket,I,U,q,r.imageMap,c,B,O,Y,le,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},b.cS=sf,b.cT=uf,b.cU=cf,b.cV=function(r){const e=new Fp;return(function(i,o){for(const c in i.layers)o.writeMessage(3,e1,i.layers[c])})(r,e),e.finish()},b.cW=function(r,e,i,o,c,f){let m=K_(r,e,i,c,0);return m=K_(m,e,o,f,1),m},b.cX=class{constructor(r){this.maxEntries=r,this.map=new Map}get(r){const e=this.map.get(r);return e!==void 0&&(this.map.delete(r),this.map.set(r,e)),e}set(r,e){if(this.map.has(r))this.map.delete(r);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(r,e)}clear(){this.map.clear()}},b.cY=zg,b.cZ=Fp,b.c_=q_,b.ca=class extends Tn{constructor(r,e){super(r,e),this.current=new Array}set(r){if(r!=this.current){this.current=r;const e=new Float32Array(r);this.gl.uniform1fv(this.location,e)}}},b.cb=class extends eu{},b.cc=rb,b.cd=class extends Os{},b.ce=tf,b.cf=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},b.cg=yg,b.ch=function(r,e,i){var o=e[0],c=e[1],f=e[2],m=i[3]*o+i[7]*c+i[11]*f+i[15];return r[0]=(i[0]*o+i[4]*c+i[8]*f+i[12])/(m=m||1),r[1]=(i[1]*o+i[5]*c+i[9]*f+i[13])/m,r[2]=(i[2]*o+i[6]*c+i[10]*f+i[14])/m,r},b.ci=class extends ns{},b.cj=class extends nc{},b.ck=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]},b.cl=function(r,e){var i=r[0],o=r[1],c=r[2],f=r[3],m=r[4],v=r[5],T=r[6],I=r[7],C=r[8],D=r[9],B=r[10],O=r[11],U=r[12],Z=r[13],q=r[14],Y=r[15],le=e[0],J=e[1],te=e[2],ue=e[3],pe=e[4],Ie=e[5],Ge=e[6],je=e[7],qe=e[8],tt=e[9],Ye=e[10],Ve=e[11],Be=e[12],ct=e[13],at=e[14],dt=e[15];return Math.abs(i-le)<=Ke*Math.max(1,Math.abs(i),Math.abs(le))&&Math.abs(o-J)<=Ke*Math.max(1,Math.abs(o),Math.abs(J))&&Math.abs(c-te)<=Ke*Math.max(1,Math.abs(c),Math.abs(te))&&Math.abs(f-ue)<=Ke*Math.max(1,Math.abs(f),Math.abs(ue))&&Math.abs(m-pe)<=Ke*Math.max(1,Math.abs(m),Math.abs(pe))&&Math.abs(v-Ie)<=Ke*Math.max(1,Math.abs(v),Math.abs(Ie))&&Math.abs(T-Ge)<=Ke*Math.max(1,Math.abs(T),Math.abs(Ge))&&Math.abs(I-je)<=Ke*Math.max(1,Math.abs(I),Math.abs(je))&&Math.abs(C-qe)<=Ke*Math.max(1,Math.abs(C),Math.abs(qe))&&Math.abs(D-tt)<=Ke*Math.max(1,Math.abs(D),Math.abs(tt))&&Math.abs(B-Ye)<=Ke*Math.max(1,Math.abs(B),Math.abs(Ye))&&Math.abs(O-Ve)<=Ke*Math.max(1,Math.abs(O),Math.abs(Ve))&&Math.abs(U-Be)<=Ke*Math.max(1,Math.abs(U),Math.abs(Be))&&Math.abs(Z-ct)<=Ke*Math.max(1,Math.abs(Z),Math.abs(ct))&&Math.abs(q-at)<=Ke*Math.max(1,Math.abs(q),Math.abs(at))&&Math.abs(Y-dt)<=Ke*Math.max(1,Math.abs(Y),Math.abs(dt))},b.cm=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},b.cn=r=>r.type==="symbol",b.co=r=>r.type==="circle",b.cp=r=>r.type==="heatmap",b.cq=r=>r.type==="line",b.cr=r=>r.type==="fill",b.cs=r=>r.type==="fill-extrusion",b.ct=r=>r.type==="hillshade",b.cu=r=>r.type==="color-relief",b.cv=r=>r.type==="background",b.cw=r=>r.type==="custom",b.cx=Mi,b.cy=function(r,e,i){const o=It(e.x-i.x,e.y-i.y),c=It(r.x-i.x,r.y-i.y),f=Math.atan2(o[0]*c[1]-o[1]*c[0],(function(m,v){return m[0]*v[0]+m[1]*v[1]})(o,c));return en(f)},b.cz=jt,b.d=Ze,b.d0=function(r,e,i,o,c){return s(this,void 0,void 0,(function*(){if(nt())try{return yield ra(r,e,i,o,c)}catch{}return(function(f,m,v,T,I){const C=f.width,D=f.height;Xn&&In||(Xn=new OffscreenCanvas(C,D),In=Xn.getContext("2d",{willReadFrequently:!0})),Xn.width=C,Xn.height=D,In.drawImage(f,0,0,C,D);const B=In.getImageData(m,v,T,I);return In.clearRect(0,0,C,D),B.data})(r,e,i,o,c)}))},b.d1=bg,b.d2=$,b.d3=class{constructor(r,e){this.layers={[Lh]:this},this.name=Lh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=r.length,this.features=r}feature(r){return new Qb(this.features[r],this.extent)}},b.d4=l,b.d5=xa,b.e=Ui,b.f=r=>s(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),b.g=Ee,b.h=r=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=ia}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):ia})),b.i=zn,b.j=(r,e)=>Xe(Ui(r,{type:"json"}),e),b.k=ci,b.l=At,b.m=Xe,b.n=(r,e)=>Xe(Ui(r,{type:"arrayBuffer"}),e),b.o=function(r){return new Fp(r).readFields(_b,[])},b.p=Yg,b.q=function(r){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))},b.r=gh,b.s=na,b.t=wn,b.u=Le,b.v=Gd,b.w=yr,b.x=eh,b.y=Gl,b.z=Ju})),S("worker",["./shared"],(function(b){class s{constructor(H,W){this.keyCache={},H&&this.replace(H,W)}replace(H,W){this._layerConfigs={},this._layers={},this.update(H,[],W)}update(H,W,ee){for(const ye of H){this._layerConfigs[ye.id]=ye;const Ee=this._layers[ye.id]=b.bU(ye,ee);Ee._featureFilter=b.ak(Ee.filter,ee),this.keyCache[ye.id]&&delete this.keyCache[ye.id]}for(const ye of W)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const fe=b.cM(Object.values(this._layerConfigs),this.keyCache);for(const ye of fe){const Ee=ye.map((ut=>this._layers[ut.id])),Se=Ee[0];if(Se.visibility==="none")continue;const we=Se.source||"";let De=this.familiesBySource[we];De||(De=this.familiesBySource[we]={});const Xe=Se.sourceLayer||b.aa;let Ze=De[Xe];Ze||(Ze=De[Xe]=[]),Ze.push(Ee)}}}class F{constructor(H){const W={},ee=[];for(const Se in H){const we=H[Se],De=W[Se]={};for(const Xe in we){const Ze=we[+Xe];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const ut={x:0,y:0,w:Ze.bitmap.width+2,h:Ze.bitmap.height+2};ee.push(ut),De[Xe]={rect:ut,metrics:Ze.metrics}}}const{w:fe,h:ye}=b.p(ee),Ee=new b.r({width:fe||1,height:ye||1});for(const Se in H){const we=H[Se];for(const De in we){const Xe=we[+De];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const Ze=W[Se][De].rect;b.r.copy(Xe.bitmap,Ee,{x:0,y:0},{x:Ze.x+1,y:Ze.y+1},Xe.bitmap)}}this.image=Ee,this.positions=W}}b.cN("GlyphAtlas",F);class ${constructor(H){this.tileID=new b.a2(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[]}parse(H,W,ee,fe,ye){return b._(this,void 0,void 0,(function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new b.ai;const Ee=new b.cO(Object.keys(H.layers).sort()),Se=new b.cP(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const we={},De={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ee,subdivisionGranularity:ye},Xe=W.familiesBySource[this.source];for(const bi in Xe){const ir=H.layers[bi];if(!ir)continue;ir.version===1&&b.w(`Vector tile source "${this.source}" layer "${bi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fs=Ee.encode(bi),tn=[];for(let Fe=0;Fe<ir.length;Fe++){const zr=ir.feature(Fe),Dr=Se.getId(zr,bi);tn.push({feature:zr,id:Dr,index:Fe,sourceLayerIndex:fs})}for(const Fe of Xe[bi]){const zr=Fe[0];zr.source!==this.source&&b.w(`layer.source = ${zr.source} does not equal this.source = ${this.source}`),zr.isHidden(this.zoom,!0)||(Q(Fe,this.zoom,ee),(we[zr.id]=zr.createBucket({index:Se.bucketLayerIDs.length,layers:Fe,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fs,sourceID:this.source})).populate(tn,De,this.tileID.canonical),Se.bucketLayerIDs.push(Fe.map((Dr=>Dr.id))))}}const Ze=b.bZ(De.glyphDependencies,(bi=>Object.keys(bi).map(Number)));this.inFlightDependencies.forEach((bi=>bi?.abort())),this.inFlightDependencies=[];let ut=Promise.resolve({});if(Object.keys(Ze).length){const bi=new AbortController;this.inFlightDependencies.push(bi),ut=fe.sendAsync({type:"GG",data:{stacks:Ze,source:this.source,tileID:this.tileID,type:"glyphs"}},bi)}const _t=Object.keys(De.iconDependencies);let At=Promise.resolve({});if(_t.length){const bi=new AbortController;this.inFlightDependencies.push(bi),At=fe.sendAsync({type:"GI",data:{icons:_t,source:this.source,tileID:this.tileID,type:"icons"}},bi)}const ci=Object.keys(De.patternDependencies);let ti=Promise.resolve({});if(ci.length){const bi=new AbortController;this.inFlightDependencies.push(bi),ti=fe.sendAsync({type:"GI",data:{icons:ci,source:this.source,tileID:this.tileID,type:"patterns"}},bi)}const Le=De.dashDependencies;let vi=Promise.resolve({});if(Object.keys(Le).length){const bi=new AbortController;this.inFlightDependencies.push(bi),vi=fe.sendAsync({type:"GDA",data:{dashes:Le}},bi)}const[Ir,Ct,hi,Ar]=yield Promise.all([ut,At,ti,vi]),xi=new F(Ir),Zi=new b.cQ(Ct,hi);for(const bi in we){const ir=we[bi];ir instanceof b.aj?(Q(ir.layers,this.zoom,ee),b.cR({bucket:ir,glyphMap:Ir,glyphPositions:xi.positions,imageMap:Ct,imagePositions:Zi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:De.subdivisionGranularity})):ir.hasDependencies&&(ir instanceof b.cS||ir instanceof b.cT||ir instanceof b.cU)&&(Q(ir.layers,this.zoom,ee),ir.addFeatures(De,this.tileID.canonical,Zi.patternPositions,Ar))}return this.status="done",{buckets:Object.values(we).filter((bi=>!bi.isEmpty())),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xi.image,imageAtlas:Zi,dashPositions:Ar,glyphMap:this.returnDependencies?Ir:null,iconMap:this.returnDependencies?Ct:null,glyphPositions:this.returnDependencies?xi.positions:null}}))}}function Q(Pe,H,W){const ee=new b.H(H);for(const fe of Pe)fe.recalculate(ee,W)}class oe{constructor(H,W,ee,fe,ye){this.type=H,this.properties=ee||{},this.extent=ye,this.pointsArray=W,this.id=fe}loadGeometry(){return this.pointsArray.map((H=>H.map((W=>new b.P(W.x,W.y)))))}}class xe{constructor(H,W,ee){this.version=2,this._myFeatures=H,this.name=W,this.length=H.length,this.extent=ee}feature(H){return this._myFeatures[H]}}class ge{constructor(){this.layers={}}addLayer(H){this.layers[H.name]=H}}function Me(Pe){let H=b.cV(Pe);return H.byteOffset===0&&H.byteLength===H.buffer.byteLength||(H=new Uint8Array(H)),{vectorTile:Pe,rawData:H.buffer}}function be(Pe,H,W){const{extent:ee}=Pe,fe=Math.pow(2,W.z-H.z),ye=(W.x-H.x*fe)*ee,Ee=(W.y-H.y*fe)*ee,Se=[];for(let we=0;we<Pe.length;we++){const De=Pe.feature(we);let Xe=De.loadGeometry();for(const ut of Xe)for(const _t of ut)_t.x=_t.x*fe-ye,_t.y=_t.y*fe-Ee;const Ze=128;Xe=b.cW(Xe,De.type,-Ze,-Ze,ee+Ze,ee+Ze),Xe.length!==0&&Se.push(new oe(De.type,Xe,De.properties,De.id,ee))}return new xe(Se,Pe.name,ee)}class me{constructor(H,W,ee){this.actor=H,this.layerIndex=W,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new b.cX(1e3)}loadVectorTile(H,W){return b._(this,void 0,void 0,(function*(){const ee=yield b.n(H.request,W);try{return{vectorTile:H.encoding!=="mlt"?new b.cY(new b.cZ(ee.data)):new b.c_(ee.data),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(fe){const ye=new Uint8Array(ee.data);let Ee=`Unable to parse the tile at ${H.request.url}, `;throw Ee+=ye[0]===31&&ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${fe.message}`,new Error(Ee)}}))}loadTile(H){return b._(this,void 0,void 0,(function*(){const{uid:W,overzoomParameters:ee}=H;ee&&(H.request=ee.overzoomRequest);const fe=!!(H&&H.request&&H.request.collectResourceTiming)&&new b.c$(H.request),ye=new $(H);this.loading[W]=ye;const Ee=new AbortController;ye.abort=Ee;try{const Se=yield this.loadVectorTile(H,Ee);if(delete this.loading[W],!Se)return null;if(ee){const ut=this._getOverzoomTile(H,Se.vectorTile);Se.rawData=ut.rawData,Se.vectorTile=ut.vectorTile}const we=Se.rawData,De={};Se.expires&&(De.expires=Se.expires),Se.cacheControl&&(De.cacheControl=Se.cacheControl);const Xe={};if(fe){const ut=fe.finish();ut&&(Xe.resourceTiming=JSON.parse(JSON.stringify(ut)))}ye.vectorTile=Se.vectorTile;const Ze=ye.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);this.loaded[W]=ye,this.fetching[W]={rawTileData:we,cacheControl:De,resourceTiming:Xe};try{const ut=yield Ze;return b.e({rawTileData:we.slice(0),encoding:H.encoding},ut,De,Xe)}finally{delete this.fetching[W]}}catch(Se){throw delete this.loading[W],ye.status="done",this.loaded[W]=ye,Se}}))}_getOverzoomTile(H,W){const{tileID:ee,source:fe,overzoomParameters:ye}=H,{maxZoomTileID:Ee}=ye,Se=`${Ee.key}_${ee.key}`,we=this.overzoomedTileResultCache.get(Se);if(we)return we;const De=new ge,Xe=this.layerIndex.familiesBySource[fe];for(const ut in Xe){const _t=W.layers[ut];if(!_t)continue;const At=be(_t,Ee,ee.canonical);At.length>0&&De.addLayer(At)}const Ze=Me(De);return this.overzoomedTileResultCache.set(Se,Ze),Ze}reloadTile(H){return b._(this,void 0,void 0,(function*(){const W=H.uid;if(!this.loaded||!this.loaded[W])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[W];if(ee.showCollisionBoxes=H.showCollisionBoxes,ee.status==="parsing"){const fe=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);let ye;if(this.fetching[W]){const{rawTileData:Ee,cacheControl:Se,resourceTiming:we}=this.fetching[W];delete this.fetching[W],ye=b.e({rawTileData:Ee.slice(0),encoding:H.encoding},fe,Se,we)}else ye=fe;return ye}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity)}))}abortTile(H){return b._(this,void 0,void 0,(function*(){const W=this.loading,ee=H.uid;W&&W[ee]&&W[ee].abort&&(W[ee].abort.abort(),delete W[ee])}))}removeTile(H){return b._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[H.uid]&&delete this.loaded[H.uid]}))}}class nt{constructor(){this.loaded={}}loadTile(H){return b._(this,void 0,void 0,(function*(){const{uid:W,encoding:ee,rawImageData:fe,redFactor:ye,greenFactor:Ee,blueFactor:Se,baseShift:we}=H,De=fe.width+2,Xe=fe.height+2,Ze=b.b(fe)?new b.R({width:De,height:Xe},yield b.d0(fe,-1,-1,De,Xe)):fe,ut=new b.d1(W,Ze,ee,ye,Ee,Se,we);return this.loaded=this.loaded||{},this.loaded[W]=ut,ut}))}removeTile(H){const W=this.loaded,ee=H.uid;W&&W[ee]&&delete W[ee]}}var Ke,Je,Ue=(function(){if(Je)return Ke;function Pe(W,ee){if(W.length!==0){H(W[0],ee);for(var fe=1;fe<W.length;fe++)H(W[fe],!ee)}}function H(W,ee){for(var fe=0,ye=0,Ee=0,Se=W.length,we=Se-1;Ee<Se;we=Ee++){var De=(W[Ee][0]-W[we][0])*(W[we][1]+W[Ee][1]),Xe=fe+De;ye+=Math.abs(fe)>=Math.abs(De)?fe-Xe+De:De-Xe+fe,fe=Xe}fe+ye>=0!=!!ee&&W.reverse()}return Je=1,Ke=function W(ee,fe){var ye,Ee=ee&&ee.type;if(Ee==="FeatureCollection")for(ye=0;ye<ee.features.length;ye++)W(ee.features[ye],fe);else if(Ee==="GeometryCollection")for(ye=0;ye<ee.geometries.length;ye++)W(ee.geometries[ye],fe);else if(Ee==="Feature")W(ee.geometry,fe);else if(Ee==="Polygon")Pe(ee.coordinates,fe);else if(Ee==="MultiPolygon")for(ye=0;ye<ee.coordinates.length;ye++)Pe(ee.coordinates[ye],fe);return ee}})(),ke=b.d2(Ue);const $e={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pe=>Pe},ht=Math.fround||(wt=new Float32Array(1),Pe=>(wt[0]=+Pe,wt[0]));var wt;class Vt{constructor(H){this.options=Object.assign(Object.create($e),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:W,minZoom:ee,maxZoom:fe}=this.options;W&&console.time("total time");const ye=`prepare ${H.length} points`;W&&console.time(ye),this.points=H;const Ee=[];for(let we=0;we<H.length;we++){const De=H[we];if(!De.geometry)continue;const[Xe,Ze]=De.geometry.coordinates,ut=ht(mi(Xe)),_t=ht(Gr(Ze));Ee.push(ut,_t,1/0,we,-1,1),this.options.reduce&&Ee.push(0)}let Se=this.trees[fe+1]=this._createTree(Ee);W&&console.timeEnd(ye);for(let we=fe;we>=ee;we--){const De=+Date.now();Se=this.trees[we]=this._createTree(this._cluster(Se,we)),W&&console.log("z%d: %d clusters in %dms",we,Se.numItems,+Date.now()-De)}return W&&console.timeEnd("total time"),this}getClusters(H,W){let ee=((H[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,H[1]));let ye=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)ee=-180,ye=180;else if(ee>ye){const Ze=this.getClusters([ee,fe,180,Ee],W),ut=this.getClusters([-180,fe,ye,Ee],W);return Ze.concat(ut)}const Se=this.trees[this._limitZoom(W)],we=Se.range(mi(ee),Gr(Ee),mi(ye),Gr(fe)),De=Se.data,Xe=[];for(const Ze of we){const ut=this.stride*Ze;Xe.push(De[ut+5]>1?Pt(De,ut,this.clusterProps):this.points[De[ut+3]])}return Xe}getChildren(H){const W=this._getOriginId(H),ee=this._getOriginZoom(H),fe="No cluster with the specified id.",ye=this.trees[ee];if(!ye)throw new Error(fe);const Ee=ye.data;if(W*this.stride>=Ee.length)throw new Error(fe);const Se=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),we=ye.within(Ee[W*this.stride],Ee[W*this.stride+1],Se),De=[];for(const Xe of we){const Ze=Xe*this.stride;Ee[Ze+4]===H&&De.push(Ee[Ze+5]>1?Pt(Ee,Ze,this.clusterProps):this.points[Ee[Ze+3]])}if(De.length===0)throw new Error(fe);return De}getLeaves(H,W,ee){const fe=[];return this._appendLeaves(fe,H,W=W||10,ee=ee||0,0),fe}getTile(H,W,ee){const fe=this.trees[this._limitZoom(H)],ye=Math.pow(2,H),{extent:Ee,radius:Se}=this.options,we=Se/Ee,De=(ee-we)/ye,Xe=(ee+1+we)/ye,Ze={features:[]};return this._addTileFeatures(fe.range((W-we)/ye,De,(W+1+we)/ye,Xe),fe.data,W,ee,ye,Ze),W===0&&this._addTileFeatures(fe.range(1-we/ye,De,1,Xe),fe.data,ye,ee,ye,Ze),W===ye-1&&this._addTileFeatures(fe.range(0,De,we/ye,Xe),fe.data,-1,ee,ye,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(H){let W=this._getOriginZoom(H)-1;for(;W<=this.options.maxZoom;){const ee=this.getChildren(H);if(W++,ee.length!==1)break;H=ee[0].properties.cluster_id}return W}_appendLeaves(H,W,ee,fe,ye){const Ee=this.getChildren(W);for(const Se of Ee){const we=Se.properties;if(we&&we.cluster?ye+we.point_count<=fe?ye+=we.point_count:ye=this._appendLeaves(H,we.cluster_id,ee,fe,ye):ye<fe?ye++:H.push(Se),H.length===ee)break}return ye}_createTree(H){const W=new b.aU(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<H.length;ee+=this.stride)W.add(H[ee],H[ee+1]);return W.finish(),W.data=H,W}_addTileFeatures(H,W,ee,fe,ye,Ee){for(const Se of H){const we=Se*this.stride,De=W[we+5]>1;let Xe,Ze,ut;if(De)Xe=ei(W,we,this.clusterProps),Ze=W[we],ut=W[we+1];else{const ci=this.points[W[we+3]];Xe=ci.properties;const[ti,Le]=ci.geometry.coordinates;Ze=mi(ti),ut=Gr(Le)}const _t={type:1,geometry:[[Math.round(this.options.extent*(Ze*ye-ee)),Math.round(this.options.extent*(ut*ye-fe))]],tags:Xe};let At;At=De||this.options.generateId?W[we+3]:this.points[W[we+3]].id,At!==void 0&&(_t.id=At),Ee.features.push(_t)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,W){const{radius:ee,extent:fe,reduce:ye,minPoints:Ee}=this.options,Se=ee/(fe*Math.pow(2,W)),we=H.data,De=[],Xe=this.stride;for(let Ze=0;Ze<we.length;Ze+=Xe){if(we[Ze+2]<=W)continue;we[Ze+2]=W;const ut=we[Ze],_t=we[Ze+1],At=H.within(we[Ze],we[Ze+1],Se),ci=we[Ze+5];let ti=ci;for(const Le of At){const vi=Le*Xe;we[vi+2]>W&&(ti+=we[vi+5])}if(ti>ci&&ti>=Ee){let Le,vi=ut*ci,Ir=_t*ci,Ct=-1;const hi=(Ze/Xe<<5)+(W+1)+this.points.length;for(const Ar of At){const xi=Ar*Xe;if(we[xi+2]<=W)continue;we[xi+2]=W;const Zi=we[xi+5];vi+=we[xi]*Zi,Ir+=we[xi+1]*Zi,we[xi+4]=hi,ye&&(Le||(Le=this._map(we,Ze,!0),Ct=this.clusterProps.length,this.clusterProps.push(Le)),ye(Le,this._map(we,xi)))}we[Ze+4]=hi,De.push(vi/ti,Ir/ti,1/0,hi,-1,ti),ye&&De.push(Ct)}else{for(let Le=0;Le<Xe;Le++)De.push(we[Ze+Le]);if(ti>1)for(const Le of At){const vi=Le*Xe;if(!(we[vi+2]<=W)){we[vi+2]=W;for(let Ir=0;Ir<Xe;Ir++)De.push(we[vi+Ir])}}}}return De}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,W,ee){if(H[W+5]>1){const Ee=this.clusterProps[H[W+6]];return ee?Object.assign({},Ee):Ee}const fe=this.points[H[W+3]].properties,ye=this.options.map(fe);return ee&&ye===fe?Object.assign({},ye):ye}}function Pt(Pe,H,W){return{type:"Feature",id:Pe[H+3],properties:ei(Pe,H,W),geometry:{type:"Point",coordinates:[(ee=Pe[H],360*(ee-.5)),Pr(Pe[H+1])]}};var ee}function ei(Pe,H,W){const ee=Pe[H+5],fe=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,ye=Pe[H+6],Ee=ye===-1?{}:Object.assign({},W[ye]);return Object.assign(Ee,{cluster:!0,cluster_id:Pe[H+3],point_count:ee,point_count_abbreviated:fe})}function mi(Pe){return Pe/360+.5}function Gr(Pe){const H=Math.sin(Pe*Math.PI/180),W=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return W<0?0:W>1?1:W}function Pr(Pe){const H=(180-360*Pe)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function lo(Pe,H,W,ee){let fe=ee;const ye=H+(W-H>>1);let Ee,Se=W-H;const we=Pe[H],De=Pe[H+1],Xe=Pe[W],Ze=Pe[W+1];for(let ut=H+3;ut<W;ut+=3){const _t=gr(Pe[ut],Pe[ut+1],we,De,Xe,Ze);if(_t>fe)Ee=ut,fe=_t;else if(_t===fe){const At=Math.abs(ut-ye);At<Se&&(Ee=ut,Se=At)}}fe>ee&&(Ee-H>3&&lo(Pe,H,Ee,ee),Pe[Ee+2]=fe,W-Ee>3&&lo(Pe,Ee,W,ee))}function gr(Pe,H,W,ee,fe,ye){let Ee=fe-W,Se=ye-ee;if(Ee!==0||Se!==0){const we=((Pe-W)*Ee+(H-ee)*Se)/(Ee*Ee+Se*Se);we>1?(W=fe,ee=ye):we>0&&(W+=Ee*we,ee+=Se*we)}return Ee=Pe-W,Se=H-ee,Ee*Ee+Se*Se}function hr(Pe,H,W,ee){const fe={id:Pe??null,type:H,geometry:W,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")It(fe,W);else if(H==="Polygon")It(fe,W[0]);else if(H==="MultiLineString")for(const ye of W)It(fe,ye);else if(H==="MultiPolygon")for(const ye of W)It(fe,ye[0]);return fe}function It(Pe,H){for(let W=0;W<H.length;W+=3)Pe.minX=Math.min(Pe.minX,H[W]),Pe.minY=Math.min(Pe.minY,H[W+1]),Pe.maxX=Math.max(Pe.maxX,H[W]),Pe.maxY=Math.max(Pe.maxY,H[W+1])}function si(Pe,H,W,ee){if(!H.geometry)return;const fe=H.geometry.coordinates;if(fe&&fe.length===0)return;const ye=H.geometry.type,Ee=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2);let Se=[],we=H.id;if(W.promoteId?we=H.properties[W.promoteId]:W.generateId&&(we=ee||0),ye==="Point")Et(fe,Se);else if(ye==="MultiPoint")for(const De of fe)Et(De,Se);else if(ye==="LineString")li(fe,Se,Ee,!1);else if(ye==="MultiLineString"){if(W.lineMetrics){for(const De of fe)Se=[],li(De,Se,Ee,!1),Pe.push(hr(we,"LineString",Se,H.properties));return}pr(fe,Se,Ee,!1)}else if(ye==="Polygon")pr(fe,Se,Ee,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const De of H.geometry.geometries)si(Pe,{id:we,geometry:De,properties:H.properties},W,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const De of fe){const Xe=[];pr(De,Xe,Ee,!0),Se.push(Xe)}}Pe.push(hr(we,ye,Se,H.properties))}function Et(Pe,H){H.push(_r(Pe[0]),Mi(Pe[1]),0)}function li(Pe,H,W,ee){let fe,ye,Ee=0;for(let we=0;we<Pe.length;we++){const De=_r(Pe[we][0]),Xe=Mi(Pe[we][1]);H.push(De,Xe,0),we>0&&(Ee+=ee?(fe*Xe-De*ye)/2:Math.sqrt(Math.pow(De-fe,2)+Math.pow(Xe-ye,2))),fe=De,ye=Xe}const Se=H.length-3;H[2]=1,lo(H,0,Se,W),H[Se+2]=1,H.size=Math.abs(Ee),H.start=0,H.end=H.size}function pr(Pe,H,W,ee){for(let fe=0;fe<Pe.length;fe++){const ye=[];li(Pe[fe],ye,W,ee),H.push(ye)}}function _r(Pe){return Pe/360+.5}function Mi(Pe){const H=Math.sin(Pe*Math.PI/180),W=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return W<0?0:W>1?1:W}function jt(Pe,H,W,ee,fe,ye,Ee,Se){if(ee/=H,ye>=(W/=H)&&Ee<ee)return Pe;if(Ee<W||ye>=ee)return null;const we=[];for(const De of Pe){const Xe=De.geometry;let Ze=De.type;const ut=fe===0?De.minX:De.minY,_t=fe===0?De.maxX:De.maxY;if(ut>=W&&_t<ee){we.push(De);continue}if(_t<W||ut>=ee)continue;let At=[];if(Ze==="Point"||Ze==="MultiPoint")Bt(Xe,At,W,ee,fe);else if(Ze==="LineString")Mr(Xe,At,W,ee,fe,!1,Se.lineMetrics);else if(Ze==="MultiLineString")Ro(Xe,At,W,ee,fe,!1);else if(Ze==="Polygon")Ro(Xe,At,W,ee,fe,!0);else if(Ze==="MultiPolygon")for(const ci of Xe){const ti=[];Ro(ci,ti,W,ee,fe,!0),ti.length&&At.push(ti)}if(At.length){if(Se.lineMetrics&&Ze==="LineString"){for(const ci of At)we.push(hr(De.id,Ze,ci,De.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(At.length===1?(Ze="LineString",At=At[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=At.length===3?"Point":"MultiPoint"),we.push(hr(De.id,Ze,At,De.tags))}}return we.length?we:null}function Bt(Pe,H,W,ee,fe){for(let ye=0;ye<Pe.length;ye+=3){const Ee=Pe[ye+fe];Ee>=W&&Ee<=ee&&dn(H,Pe[ye],Pe[ye+1],Pe[ye+2])}}function Mr(Pe,H,W,ee,fe,ye,Ee){let Se=Ui(Pe);const we=fe===0?ea:$r;let De,Xe,Ze=Pe.start;for(let ti=0;ti<Pe.length-3;ti+=3){const Le=Pe[ti],vi=Pe[ti+1],Ir=Pe[ti+2],Ct=Pe[ti+3],hi=Pe[ti+4],Ar=fe===0?Le:vi,xi=fe===0?Ct:hi;let Zi=!1;Ee&&(De=Math.sqrt(Math.pow(Le-Ct,2)+Math.pow(vi-hi,2))),Ar<W?xi>W&&(Xe=we(Se,Le,vi,Ct,hi,W),Ee&&(Se.start=Ze+De*Xe)):Ar>ee?xi<ee&&(Xe=we(Se,Le,vi,Ct,hi,ee),Ee&&(Se.start=Ze+De*Xe)):dn(Se,Le,vi,Ir),xi<W&&Ar>=W&&(Xe=we(Se,Le,vi,Ct,hi,W),Zi=!0),xi>ee&&Ar<=ee&&(Xe=we(Se,Le,vi,Ct,hi,ee),Zi=!0),!ye&&Zi&&(Ee&&(Se.end=Ze+De*Xe),H.push(Se),Se=Ui(Pe)),Ee&&(Ze+=De)}let ut=Pe.length-3;const _t=Pe[ut],At=Pe[ut+1],ci=fe===0?_t:At;ci>=W&&ci<=ee&&dn(Se,_t,At,Pe[ut+2]),ut=Se.length-3,ye&&ut>=3&&(Se[ut]!==Se[0]||Se[ut+1]!==Se[1])&&dn(Se,Se[0],Se[1],Se[2]),Se.length&&H.push(Se)}function Ui(Pe){const H=[];return H.size=Pe.size,H.start=Pe.start,H.end=Pe.end,H}function Ro(Pe,H,W,ee,fe,ye){for(const Ee of Pe)Mr(Ee,H,W,ee,fe,ye,!1)}function dn(Pe,H,W,ee){Pe.push(H,W,ee)}function ea(Pe,H,W,ee,fe,ye){const Ee=(ye-H)/(ee-H);return dn(Pe,ye,W+(fe-W)*Ee,1),Ee}function $r(Pe,H,W,ee,fe,ye){const Ee=(ye-W)/(fe-W);return dn(Pe,H+(ee-H)*Ee,ye,1),Ee}function ta(Pe,H){const W=[];for(let ee=0;ee<Pe.length;ee++){const fe=Pe[ee],ye=fe.type;let Ee;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ee=yr(fe.geometry,H);else if(ye==="MultiLineString"||ye==="Polygon"){Ee=[];for(const Se of fe.geometry)Ee.push(yr(Se,H))}else if(ye==="MultiPolygon"){Ee=[];for(const Se of fe.geometry){const we=[];for(const De of Se)we.push(yr(De,H));Ee.push(we)}}W.push(hr(fe.id,ye,Ee,fe.tags))}return W}function yr(Pe,H){const W=[];W.size=Pe.size,Pe.start!==void 0&&(W.start=Pe.start,W.end=Pe.end);for(let ee=0;ee<Pe.length;ee+=3)W.push(Pe[ee]+H,Pe[ee+1],Pe[ee+2]);return W}function fn(Pe,H){if(Pe.transformed)return Pe;const W=1<<Pe.z,ee=Pe.x,fe=Pe.y;for(const ye of Pe.features){const Ee=ye.geometry,Se=ye.type;if(ye.geometry=[],Se===1)for(let we=0;we<Ee.length;we+=2)ye.geometry.push(zn(Ee[we],Ee[we+1],H,W,ee,fe));else for(let we=0;we<Ee.length;we++){const De=[];for(let Xe=0;Xe<Ee[we].length;Xe+=2)De.push(zn(Ee[we][Xe],Ee[we][Xe+1],H,W,ee,fe));ye.geometry.push(De)}}return Pe.transformed=!0,Pe}function zn(Pe,H,W,ee,fe,ye){return[Math.round(W*(Pe*ee-fe)),Math.round(W*(H*ee-ye))]}function Li(Pe,H,W,ee,fe){const ye=H===fe.maxZoom?0:fe.tolerance/((1<<H)*fe.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Pe.length,source:null,x:W,y:ee,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Se of Pe)Dn(Ee,Se,ye,fe);return Ee}function Dn(Pe,H,W,ee){const fe=H.geometry,ye=H.type,Ee=[];if(Pe.minX=Math.min(Pe.minX,H.minX),Pe.minY=Math.min(Pe.minY,H.minY),Pe.maxX=Math.max(Pe.maxX,H.maxX),Pe.maxY=Math.max(Pe.maxY,H.maxY),ye==="Point"||ye==="MultiPoint")for(let Se=0;Se<fe.length;Se+=3)Ee.push(fe[Se],fe[Se+1]),Pe.numPoints++,Pe.numSimplified++;else if(ye==="LineString")ia(Ee,fe,Pe,W,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Se=0;Se<fe.length;Se++)ia(Ee,fe[Se],Pe,W,ye==="Polygon",Se===0);else if(ye==="MultiPolygon")for(let Se=0;Se<fe.length;Se++){const we=fe[Se];for(let De=0;De<we.length;De++)ia(Ee,we[De],Pe,W,!0,De===0)}if(Ee.length){let Se=H.tags||null;if(ye==="LineString"&&ee.lineMetrics){Se={};for(const De in H.tags)Se[De]=H.tags[De];Se.mapbox_clip_start=fe.start/fe.size,Se.mapbox_clip_end=fe.end/fe.size}const we={geometry:Ee,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Se};H.id!==null&&(we.id=H.id),Pe.features.push(we)}}function ia(Pe,H,W,ee,fe,ye){const Ee=ee*ee;if(ee>0&&H.size<(fe?Ee:ee))return void(W.numPoints+=H.length/3);const Se=[];for(let we=0;we<H.length;we+=3)(ee===0||H[we+2]>Ee)&&(W.numSimplified++,Se.push(H[we],H[we+1])),W.numPoints++;fe&&(function(we,De){let Xe=0;for(let Ze=0,ut=we.length,_t=ut-2;Ze<ut;_t=Ze,Ze+=2)Xe+=(we[Ze]-we[_t])*(we[Ze+1]+we[_t+1]);if(Xe>0===De)for(let Ze=0,ut=we.length;Ze<ut/2;Ze+=2){const _t=we[Ze],At=we[Ze+1];we[Ze]=we[ut-2-Ze],we[Ze+1]=we[ut-1-Ze],we[ut-2-Ze]=_t,we[ut-1-Ze]=At}})(Se,ye),Pe.push(Se)}const ra={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xn{constructor(H,W){const ee=(W=this.options=(function(ye,Ee){for(const Se in Ee)ye[Se]=Ee[Se];return ye})(Object.create(ra),W)).debug;if(ee&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let fe=(function(ye,Ee){const Se=[];if(ye.type==="FeatureCollection")for(let we=0;we<ye.features.length;we++)si(Se,ye.features[we],Ee,we);else si(Se,ye.type==="Feature"?ye:{geometry:ye},Ee);return Se})(H,W);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),fe=(function(ye,Ee){const Se=Ee.buffer/Ee.extent;let we=ye;const De=jt(ye,1,-1-Se,Se,0,-1,2,Ee),Xe=jt(ye,1,1-Se,2+Se,0,-1,2,Ee);return(De||Xe)&&(we=jt(ye,1,-Se,1+Se,0,-1,2,Ee)||[],De&&(we=ta(De,1).concat(we)),Xe&&(we=we.concat(ta(Xe,-1)))),we})(fe,W),fe.length&&this.splitTile(fe,0,0,0),ee&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,W,ee,fe,ye,Ee,Se){const we=[H,W,ee,fe],De=this.options,Xe=De.debug;for(;we.length;){fe=we.pop(),ee=we.pop(),W=we.pop(),H=we.pop();const Ze=1<<W,ut=In(W,ee,fe);let _t=this.tiles[ut];if(!_t&&(Xe>1&&console.time("creation"),_t=this.tiles[ut]=Li(H,W,ee,fe,De),this.tileCoords.push({z:W,x:ee,y:fe}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,ee,fe,_t.numFeatures,_t.numPoints,_t.numSimplified),console.timeEnd("creation"));const Zi=`z${W}`;this.stats[Zi]=(this.stats[Zi]||0)+1,this.total++}if(_t.source=H,ye==null){if(W===De.indexMaxZoom||_t.numPoints<=De.indexMaxPoints)continue}else{if(W===De.maxZoom||W===ye)continue;if(ye!=null){const Zi=ye-W;if(ee!==Ee>>Zi||fe!==Se>>Zi)continue}}if(_t.source=null,H.length===0)continue;Xe>1&&console.time("clipping");const At=.5*De.buffer/De.extent,ci=.5-At,ti=.5+At,Le=1+At;let vi=null,Ir=null,Ct=null,hi=null,Ar=jt(H,Ze,ee-At,ee+ti,0,_t.minX,_t.maxX,De),xi=jt(H,Ze,ee+ci,ee+Le,0,_t.minX,_t.maxX,De);H=null,Ar&&(vi=jt(Ar,Ze,fe-At,fe+ti,1,_t.minY,_t.maxY,De),Ir=jt(Ar,Ze,fe+ci,fe+Le,1,_t.minY,_t.maxY,De),Ar=null),xi&&(Ct=jt(xi,Ze,fe-At,fe+ti,1,_t.minY,_t.maxY,De),hi=jt(xi,Ze,fe+ci,fe+Le,1,_t.minY,_t.maxY,De),xi=null),Xe>1&&console.timeEnd("clipping"),we.push(vi||[],W+1,2*ee,2*fe),we.push(Ir||[],W+1,2*ee,2*fe+1),we.push(Ct||[],W+1,2*ee+1,2*fe),we.push(hi||[],W+1,2*ee+1,2*fe+1)}}getTile(H,W,ee){H=+H,W=+W,ee=+ee;const fe=this.options,{extent:ye,debug:Ee}=fe;if(H<0||H>24)return null;const Se=1<<H,we=In(H,W=W+Se&Se-1,ee);if(this.tiles[we])return fn(this.tiles[we],ye);Ee>1&&console.log("drilling down to z%d-%d-%d",H,W,ee);let De,Xe=H,Ze=W,ut=ee;for(;!De&&Xe>0;)Xe--,Ze>>=1,ut>>=1,De=this.tiles[In(Xe,Ze,ut)];return De&&De.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",Xe,Ze,ut),console.time("drilling down")),this.splitTile(De.source,Xe,Ze,ut,H,W,ee),Ee>1&&console.timeEnd("drilling down"),this.tiles[we]?fn(this.tiles[we],ye):null):null}}function In(Pe,H,W){return 32*((1<<Pe)*W+H)+Pe}class na extends me{constructor(H,W,ee,fe=Da){super(H,W,ee),this._dataUpdateable=new Map,this._createGeoJSONIndex=fe}loadVectorTile(H,W){return b._(this,void 0,void 0,(function*(){const ee=H.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const fe=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);return fe?Me(new b.d3(fe.features,{version:2,extent:b.a5})):null}))}loadData(H){return b._(this,void 0,void 0,(function*(){var W;(W=this._pendingRequest)===null||W===void 0||W.abort();const ee=this._startPerformance(H);this._pendingRequest=new AbortController;try{(!this._pendingData||H.request||H.data||H.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest));const fe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(fe,H),this.loaded={};const ye={};return this._finishPerformance(ee,H,ye),ye}catch(fe){if(delete this._pendingRequest,b.Z(fe))return{abandoned:!0};throw fe}}))}_startPerformance(H){var W;if(!((W=H?.request)===null||W===void 0)&&W.collectResourceTiming)return new b.c$(H.request)}_finishPerformance(H,W,ee){if(!H)return;const fe=H.finish();fe&&(ee.resourceTiming={},ee.resourceTiming[W.source]=JSON.parse(JSON.stringify(fe)))}getData(){return b._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(H){const W=this.loaded;return W&&W[H.uid]?super.reloadTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,W){return b._(this,void 0,void 0,(function*(){let ee;if(H.request?ee=yield this.loadGeoJSONFromUrl(H.request,H.promoteId,W):H.data?ee=this._loadGeoJSONFromObject(H.data,H.promoteId):H.dataDiff&&(ee=this._loadGeoJSONFromDiff(H.dataDiff,H.promoteId,H.source)),delete this._pendingRequest,typeof ee!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);return ke(ee,!0),H.filter&&(ee=this._filterGeoJSON(ee,H.filter)),ee}))}loadGeoJSONFromUrl(H,W,ee){return b._(this,void 0,void 0,(function*(){const fe=yield b.j(H,ee);return this._dataUpdateable=b.a7(fe.data,W)?b.a8(fe.data,W):void 0,fe.data}))}_loadGeoJSONFromObject(H,W){return this._dataUpdateable=b.a7(H,W)?b.a8(H,W):void 0,H}_loadGeoJSONFromDiff(H,W,ee){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ee}`);b.a9(this._dataUpdateable,H,W);const fe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(fe)}_filterGeoJSON(H,W){const ee=b.d4(W,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map((ye=>`${ye.key}: ${ye.message}`)).join(", "));const fe=H.features.filter((ye=>ee.value.evaluate({zoom:0},ye)));return this._toFeatureCollection(fe)}_toFeatureCollection(H){return{type:"FeatureCollection",features:H}}removeSource(H){return b._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}function Da(Pe,H){return H.cluster?new Vt((function({superclusterOptions:W,clusterProperties:ee}){if(!ee||!W)return W;const fe={},ye={},Ee={accumulated:null,zoom:0},Se={properties:null},we=Object.keys(ee);for(const De of we){const[Xe,Ze]=ee[De],ut=b.d4(Ze),_t=b.d4(typeof Xe=="string"?[Xe,["accumulated"],["get",De]]:Xe);fe[De]=ut.value,ye[De]=_t.value}return W.map=De=>{Se.properties=De;const Xe={};for(const Ze of we)Xe[Ze]=fe[Ze].evaluate(Ee,Se);return Xe},W.reduce=(De,Xe)=>{Se.properties=Xe;for(const Ze of we)Ee.accumulated=De[Ze],De[Ze]=ye[Ze].evaluate(Ee,Se)},W})(H)).load(Pe.features):(function(W,ee){return new Xn(W,ee)})(Pe,H.geojsonVtOptions)}class en{constructor(H){this.self=H,this.actor=new b.L(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(W,ee)=>{if(this.externalWorkerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.externalWorkerSourceTypes[W]=ee},this.self.addProtocol=b.cK,this.self.removeProtocol=b.cL,this.self.registerRTLTextPlugin=W=>{b.d5.setMethods(W)},this.actor.registerMessageHandler("LDT",((W,ee)=>this._getDEMWorkerSource(W,ee.source).loadTile(ee))),this.actor.registerMessageHandler("RDT",((W,ee)=>b._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(W,ee.source).removeTile(ee)})))),this.actor.registerMessageHandler("GCEZ",((W,ee)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,ee.type,ee.source).getClusterExpansionZoom(ee)})))),this.actor.registerMessageHandler("GCC",((W,ee)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,ee.type,ee.source).getClusterChildren(ee)})))),this.actor.registerMessageHandler("GCL",((W,ee)=>b._(this,void 0,void 0,(function*(){return this._getWorkerSource(W,ee.type,ee.source).getClusterLeaves(ee)})))),this.actor.registerMessageHandler("LD",((W,ee)=>this._getWorkerSource(W,ee.type,ee.source).loadData(ee))),this.actor.registerMessageHandler("GD",((W,ee)=>this._getWorkerSource(W,ee.type,ee.source).getData())),this.actor.registerMessageHandler("LT",((W,ee)=>this._getWorkerSource(W,ee.type,ee.source).loadTile(ee))),this.actor.registerMessageHandler("RT",((W,ee)=>this._getWorkerSource(W,ee.type,ee.source).reloadTile(ee))),this.actor.registerMessageHandler("AT",((W,ee)=>this._getWorkerSource(W,ee.type,ee.source).abortTile(ee))),this.actor.registerMessageHandler("RMT",((W,ee)=>this._getWorkerSource(W,ee.type,ee.source).removeTile(ee))),this.actor.registerMessageHandler("RS",((W,ee)=>b._(this,void 0,void 0,(function*(){if(!this.workerSources[W]||!this.workerSources[W][ee.type]||!this.workerSources[W][ee.type][ee.source])return;const fe=this.workerSources[W][ee.type][ee.source];delete this.workerSources[W][ee.type][ee.source],fe.removeSource!==void 0&&fe.removeSource(ee)})))),this.actor.registerMessageHandler("RM",(W=>b._(this,void 0,void 0,(function*(){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],this.globalStates.delete(W)})))),this.actor.registerMessageHandler("SR",((W,ee)=>b._(this,void 0,void 0,(function*(){this.referrer=ee})))),this.actor.registerMessageHandler("SRPS",((W,ee)=>this._syncRTLPluginState(W,ee))),this.actor.registerMessageHandler("IS",((W,ee)=>b._(this,void 0,void 0,(function*(){this.self.importScripts(ee)})))),this.actor.registerMessageHandler("SI",((W,ee)=>this._setImages(W,ee))),this.actor.registerMessageHandler("UL",((W,ee)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(W).update(ee.layers,ee.removedIds,this._getGlobalState(W))})))),this.actor.registerMessageHandler("UGS",((W,ee)=>b._(this,void 0,void 0,(function*(){const fe=this._getGlobalState(W);for(const ye in ee)fe[ye]=ee[ye]})))),this.actor.registerMessageHandler("SL",((W,ee)=>b._(this,void 0,void 0,(function*(){this._getLayerIndex(W).replace(ee,this._getGlobalState(W))}))))}_getGlobalState(H){let W=this.globalStates.get(H);return W||(W={},this.globalStates.set(H,W)),W}_setImages(H,W){return b._(this,void 0,void 0,(function*(){this.availableImages[H]=W;for(const ee in this.workerSources[H]){const fe=this.workerSources[H][ee];for(const ye in fe)fe[ye].availableImages=W}}))}_syncRTLPluginState(H,W){return b._(this,void 0,void 0,(function*(){return yield b.d5.syncState(W,this.self.importScripts)}))}_getAvailableImages(H){let W=this.availableImages[H];return W||(W=[]),W}_getLayerIndex(H){let W=this.layerIndexes[H];return W||(W=this.layerIndexes[H]=new s),W}_getWorkerSource(H,W,ee){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][W]||(this.workerSources[H][W]={}),!this.workerSources[H][W][ee]){const fe={sendAsync:(ye,Ee)=>(ye.targetMapId=H,this.actor.sendAsync(ye,Ee))};switch(W){case"vector":this.workerSources[H][W][ee]=new me(fe,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][W][ee]=new na(fe,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][W][ee]=new this.externalWorkerSourceTypes[W](fe,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][W][ee]}_getDEMWorkerSource(H,W){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][W]||(this.demWorkerSources[H][W]=new nt),this.demWorkerSources[H][W]}}return b.i(self)&&(self.worker=new en(self)),en})),S("index",["exports","./shared"],(function(b,s){var F="5.14.0";function $(){var g=new s.A(4);return s.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let Q,oe,xe;const ge={frame(g,t,n){const u=requestAnimationFrame((y=>{p(),t(y)})),{unsubscribe:p}=s.s(g.signal,"abort",(()=>{p(),cancelAnimationFrame(u),n(new s.a(g.signal.reason))}),!1)},frameAsync(g){return new Promise(((t,n)=>{this.frame(g,t,n)}))},getImageData(g,t=0){return this.getImageCanvasContext(g).getImageData(-t,-t,g.width+2*t,g.height+2*t)},getImageCanvasContext(g){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=g.width,t.height=g.height,n.drawImage(g,0,0,g.width,g.height),n},resolveURL:g=>(Q||(Q=document.createElement("a")),Q.href=g,Q.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return xe!==void 0?xe:!!matchMedia&&(oe==null&&(oe=matchMedia("(prefers-reduced-motion: reduce)")),oe.matches)},set prefersReducedMotion(g){xe=g}},Me=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(g){this._frozenAt=g}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function be(){return Me.getCurrentTime()}class me{static testProp(t){if(!me.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in me.docStyle)return t[n];return t[0]}static create(t,n,u){const p=window.document.createElement(t);return n!==void 0&&(p.className=n),u&&u.appendChild(p),p}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){me.docStyle&&me.selectProp&&(me.userSelect=me.docStyle[me.selectProp],me.docStyle[me.selectProp]="none")}static enableDrag(){me.docStyle&&me.selectProp&&(me.docStyle[me.selectProp]=me.userSelect)}static setTransform(t,n){t.style[me.transformProp]=n}static addEventListener(t,n,u,p={}){t.addEventListener(n,u,"passive"in p?p:p.capture)}static removeEventListener(t,n,u,p={}){t.removeEventListener(n,u,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",me.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",me.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",me.suppressClickInternal,!0)}),0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,u){const p=n.boundingClientRect;return new s.P((u.clientX-p.left)/n.x-t.clientLeft,(u.clientY-p.top)/n.y-t.clientTop)}static mousePos(t,n){const u=me.getScale(t);return me.getPoint(t,u,n)}static touchPos(t,n){const u=[],p=me.getScale(t);for(let y=0;y<n.length;y++)u.push(me.getPoint(t,p,n[y]));return u}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const n=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),u=n.querySelectorAll("script");for(const p of u)p.remove();return me.clean(n),n.innerHTML}static isPossiblyDangerous(t,n){const u=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!u.includes("javascript:")&&!u.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const n=t.children;for(const u of n)me.removeAttributes(u),me.clean(u)}static removeAttributes(t){for(const{name:n,value:u}of t.attributes)me.isPossiblyDangerous(n,u)&&t.removeAttribute(n)}}me.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,me.selectProp=me.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),me.transformProp=me.testProp(["transform","WebkitTransform"]);const nt={supported:!1,testSupport:function(g){!Ue&&Je&&(ke?$e(g):Ke=g)}};let Ke,Je,Ue=!1,ke=!1;function $e(g){const t=g.createTexture();g.bindTexture(g.TEXTURE_2D,t);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Je),g.isContextLost())return;nt.supported=!0}catch{}g.deleteTexture(t),Ue=!0}var ht;typeof document<"u"&&(Je=document.createElement("img"),Je.onload=()=>{Ke&&$e(Ke),Ke=null,ke=!0},Je.onerror=()=>{Ue=!0,Ke=null},Je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(g){let t,n,u,p;g.resetRequestQueue=()=>{t=[],n=0,u=0,p={}},g.addThrottleControl=E=>{const z=u++;return p[z]=E,z},g.removeThrottleControl=E=>{delete p[E],x()},g.getImage=(E,z,R=!0)=>new Promise(((j,N)=>{nt.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),s.e(E,{type:"image"}),t.push({abortController:z,requestParameters:E,supportImageRefresh:R,state:"queued",onError:G=>{N(G)},onSuccess:G=>{j(G)}}),x()}));const y=E=>s._(this,void 0,void 0,(function*(){E.state="running";const{requestParameters:z,supportImageRefresh:R,onError:j,onSuccess:N,abortController:G}=E,X=R===!1&&!s.i(self)&&!s.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce(((re,ae)=>re&&ae==="accept"),!0));n++;const ie=X?M(z,G):s.m(z,G);try{const re=yield ie;delete E.abortController,E.state="completed",re.data instanceof HTMLImageElement||s.b(re.data)?N(re):re.data&&N({data:yield(ne=re.data,typeof createImageBitmap=="function"?s.f(ne):s.h(ne)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete E.abortController,j(re)}finally{n--,x()}var ne})),x=()=>{const E=(()=>{for(const z of Object.keys(p))if(p[z]())return!0;return!1})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=n;z<E&&t.length>0;z++){const R=t.shift();R.abortController.signal.aborted?z--:y(R)}},M=(E,z)=>new Promise(((R,j)=>{const N=new Image,G=E.url,X=E.credentials;X&&X==="include"?N.crossOrigin="use-credentials":(X&&X==="same-origin"||!s.d(G))&&(N.crossOrigin="anonymous"),z.signal.addEventListener("abort",(()=>{N.src="",j(new s.a(z.signal.reason))})),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,R({data:N})},N.onerror=()=>{N.onerror=N.onload=null,z.signal.aborted||j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=G}))})(ht||(ht={})),ht.resetRequestQueue();class wt{constructor(t){this._transformRequestFn=t??null}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Vt(g){const t=[];if(typeof g=="string")t.push({id:"default",url:g});else if(g&&g.length>0){const n=[];for(const{id:u,url:p}of g){const y=`${u}${p}`;n.indexOf(y)===-1&&(n.push(y),t.push({id:u,url:p}))}}return t}function Pt(g,t,n){try{const u=new URL(g);return u.pathname+=`${t}${n}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ei(g){const{userImage:t}=g;return!!(t&&t.render&&t.render())&&(g.data.replace(new Uint8Array(t.data.buffer)),!0)}class mi extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:u}of this.requestors)u(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const u=n.spriteData;n.data=new s.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let u=!0;const p=n.data||n.spriteData;return this._validateStretch(n.stretchX,p&&p.width)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(n.stretchY,p&&p.height)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(n.content,n)||(this.fire(new s.k(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,n){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||n<p[1])return!1;u=p[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const u=n.spriteData,p=u&&u.width||n.data.width,y=u&&u.height||n.data.height;return!(t[0]<0||p<t[0]||t[1]<0||y<t[1]||t[2]<0||p<t[2]||t[3]<0||y<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,u=!0){const p=this.getImage(t);if(u&&(p.data.width!==n.data.width||p.data.height!==n.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=p.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((n,u)=>{let p=!0;if(!this.isLoaded())for(const y of t)this.images[y]||(p=!1);this.isLoaded()||p?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})}))}_getImagesForIds(t){const n={};for(const u of t){let p=this.getImage(u);p||(this.fire(new s.l("styleimagemissing",{id:u})),p=this.getImage(u)),p?n[u]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:s.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],u=this.getImage(t);if(!u)return null;if(n&&n.position.version===u.version)return n.position;if(n)n.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},y=new s.I(p,u);this.patterns[t]={bin:p,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.T(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:n,h:u}=s.p(t),p=this.atlasImage;p.resize({width:n||1,height:u||1});for(const y in this.patterns){const{bin:x}=this.patterns[y],M=x.x+1,E=x.y+1,z=this.getImage(y).data,R=z.width,j=z.height;s.R.copy(z,p,{x:0,y:0},{x:M,y:E},{width:R,height:j}),s.R.copy(z,p,{x:0,y:j-1},{x:M,y:E-1},{width:R,height:1}),s.R.copy(z,p,{x:0,y:0},{x:M,y:E+j},{width:R,height:1}),s.R.copy(z,p,{x:R-1,y:0},{x:M-1,y:E},{width:1,height:j}),s.R.copy(z,p,{x:0,y:0},{x:M+R,y:E},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const u=this.getImage(n);u||s.w(`Image with ID: "${n}" was not found`),ei(u)&&this.updateImage(n,u)}}cloneImages(){const t={};for(const n in this.images){const u=this.images[n];t[n]=Object.assign(Object.assign({},u),{data:u.data?u.data.clone():null})}return t}}const Gr=1e20;function Pr(g,t,n,u,p,y,x,M,E){for(let z=t;z<t+u;z++)lo(g,n*y+z,y,p,x,M,E);for(let z=n;z<n+p;z++)lo(g,z*y+t,1,u,x,M,E)}function lo(g,t,n,u,p,y,x){y[0]=0,x[0]=-Gr,x[1]=Gr,p[0]=g[t];for(let M=1,E=0,z=0;M<u;M++){p[M]=g[t+M*n];const R=M*M;do{const j=y[E];z=(p[M]-p[j]+R-j*j)/(M-j)/2}while(z<=x[E]&&--E>-1);E++,y[E]=M,x[E]=z,x[E+1]=Gr}for(let M=0,E=0;M<u;M++){for(;x[E+1]<M;)E++;const z=y[E],R=M-z;g[t+M*n]=p[z]+R*R}}const gr=s.v.layout_symbol["text-font"].default.join(",");class hr{constructor(t,n,u){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={},this.lang=u}setURL(t){this.url=t}getGlyphs(t){return s._(this,void 0,void 0,(function*(){const n=[];for(const y in t)for(const x of t[y])n.push(this._getAndCacheGlyphsPromise(y,x));const u=yield Promise.all(n),p={};for(const{stack:y,id:x,glyph:M}of u)p[y]||(p[y]={}),p[y][x]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return p}))}_getAndCacheGlyphsPromise(t,n){return s._(this,void 0,void 0,(function*(){let u=this.entries[t];u||(u=this.entries[t]={glyphs:{},requests:{},ranges:{}});let p=u.glyphs[n];return p!==void 0?{stack:t,id:n,glyph:p}:!this.url||this._charUsesLocalIdeographFontFamily(n)?(p=u.glyphs[n]=this._drawGlyph(u,t,n),{stack:t,id:n,glyph:p}):yield this._downloadAndCacheRangePromise(t,n)}))}_downloadAndCacheRangePromise(t,n){return s._(this,void 0,void 0,(function*(){const u=this.entries[t],p=Math.floor(n/256);if(u.ranges[p])return{stack:t,id:n,glyph:null};if(!u.requests[p]){const y=hr.loadGlyphRange(t,p,this.url,this.requestManager);u.requests[p]=y}try{const y=yield u.requests[p];for(const x in y)u.glyphs[+x]=y[+x];return u.ranges[p]=!0,{stack:t,id:n,glyph:y[n]||null}}catch(y){const x=u.glyphs[n]=this._drawGlyph(u,t,n);return this._warnOnMissingGlyphRange(x,p,n,y),{stack:t,id:n,glyph:x}}}))}_warnOnMissingGlyphRange(t,n,u,p){const y=256*n,x=y+255,M=u.toString(16).padStart(4,"0").toUpperCase();s.w(`Unable to load glyph range ${n}, ${y}-${x}. Rendering codepoint U+${M} locally instead. ${p}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&s.q(t)}_drawGlyph(t,n,u){const p=n===gr&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(u),y=p?"ideographTinySDF":"tinySDF";t[y]||(t[y]=this._createTinySDF(p?this.localIdeographFontFamily:n));const x=t[y].draw(String.fromCodePoint(u));return{id:u,bitmap:new s.r({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const n=t?t.split(","):[];n.push("sans-serif");const u=n.map((p=>/[-\w]+/.test(p)?p:`'${CSS.escape(p)}'`)).join(",");return new hr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:this._fontWeight(n[0]),fontStyle:this._fontStyle(n[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const n={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let u;for(const[p,y]of Object.entries(n))new RegExp(`\\b${p}\\b`,"i").test(t)&&(u=`${y}`);return u}destroy(){for(const t in this.entries){const n=this.entries[t];n.tinySDF&&(n.tinySDF=null),n.ideographTinySDF&&(n.ideographTinySDF=null),n.glyphs={},n.requests={},n.ranges={}}this.entries={}}}hr.loadGlyphRange=function(g,t,n,u){return s._(this,void 0,void 0,(function*(){const p=256*t,y=p+255,x=u.transformRequest(n.replace("{fontstack}",g).replace("{range}",`${p}-${y}`),"Glyphs"),M=yield s.n(x,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${t}, ${p}-${y}`);const E={};for(const z of s.o(M.data))E[z.id]=z;return E}))},hr.TinySDF=class{constructor({fontSize:g=24,buffer:t=3,radius:n=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:x="normal",lang:M=null}={}){this.buffer=t,this.cutoff=u,this.radius=n,this.lang=M;const E=this.size=g+4*t,z=this._createCanvas(E),R=this.ctx=z.getContext("2d",{willReadFrequently:!0});R.font=`${x} ${y} ${g}px ${p}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(g){const t=document.createElement("canvas");return t.width=t.height=g,t}draw(g){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(g),x=Math.ceil(n),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),E=Math.min(this.size-this.buffer,x+Math.ceil(u)),z=M+2*this.buffer,R=E+2*this.buffer,j=Math.max(z*R,0),N=new Uint8ClampedArray(j),G={data:N,width:z,height:R,glyphWidth:M,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(M===0||E===0)return G;const{ctx:X,buffer:ie,gridInner:ne,gridOuter:re}=this;this.lang&&(X.lang=this.lang),X.clearRect(ie,ie,M,E),X.fillText(g,ie,ie+x);const ae=X.getImageData(ie,ie,M,E);re.fill(Gr,0,j),ne.fill(0,0,j);for(let he=0;he<E;he++)for(let se=0;se<M;se++){const de=ae.data[4*(he*M+se)+3]/255;if(de===0)continue;const ve=(he+ie)*z+se+ie;if(de===1)re[ve]=0,ne[ve]=Gr;else{const ce=.5-de;re[ve]=ce>0?ce*ce:0,ne[ve]=ce<0?ce*ce:0}}Pr(re,0,0,z,R,z,this.f,this.v,this.z),Pr(ne,ie,ie,M,E,z,this.f,this.v,this.z);for(let he=0;he<j;he++){const se=Math.sqrt(re[he])-Math.sqrt(ne[he]);N[he]=Math.round(255-255*(se/this.radius+this.cutoff))}return G}};class It{constructor(){this.specification=s.u.light.position}possiblyEvaluate(t,n){return s.F(t.expression.evaluate(n))}interpolate(t,n,u){return{x:s.G.number(t.x,n.x,u),y:s.G.number(t.y,n.y,u),z:s.G.number(t.z,n.z,u)}}}let si;class Et extends s.E{constructor(t){super(),si=si||new s.t({anchor:new s.D(s.u.light.anchor),position:new It,color:new s.D(s.u.light.color),intensity:new s.D(s.u.light.intensity)}),this._transitionable=new s.x(si,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(s.y,t,n))for(const u in t){const p=t[u];u.endsWith(s.z)?this._transitionable.setTransition(u.slice(0,-s.z.length),p):this._transitionable.setValue(u,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&s.B(this,t.call(s.C,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.u}))}}const li=new s.t({"sky-color":new s.D(s.u.sky["sky-color"]),"horizon-color":new s.D(s.u.sky["horizon-color"]),"fog-color":new s.D(s.u.sky["fog-color"]),"fog-ground-blend":new s.D(s.u.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.u.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.u.sky["atmosphere-blend"])});class pr extends s.E{constructor(t){super(),this._transitionable=new s.x(li,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0))}setSky(t,n={}){if(!this._validate(s.J,t,n)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in t){const p=t[u];u.endsWith(s.z)?this._transitionable.setTransition(u.slice(0,-s.z.length),p):this._transitionable.setValue(u,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u={}){return u?.validate!==!1&&s.B(this,t.call(s.C,s.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class _r{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const u=t.join(",")+String(n);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,n)),this.dashEntry[u]}getDashRanges(t,n,u){const p=[];let y=t.length%2==1?-t[t.length-1]*u:0,x=t[0]*u,M=!0;p.push({left:y,right:x,isDash:M,zeroLength:t[0]===0});let E=t[0];for(let z=1;z<t.length;z++){M=!M;const R=t[z];y=E*u,E+=R,x=E*u,p.push({left:y,right:x,isDash:M,zeroLength:R===0})}return p}addRoundDash(t,n,u){const p=n/2;for(let y=-u;y<=u;y++){const x=this.width*(this.nextRow+u+y);let M=0,E=t[M];for(let z=0;z<this.width;z++){z/E.right>1&&(E=t[++M]);const R=Math.abs(z-E.left),j=Math.abs(z-E.right),N=Math.min(R,j);let G;const X=y/u*(p+1);if(E.isDash){const ie=p-Math.abs(X);G=Math.sqrt(N*N+ie*ie)}else G=p-Math.sqrt(N*N+X*X);this.data[x+z]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(t){for(let M=t.length-1;M>=0;--M){const E=t[M],z=t[M+1];E.zeroLength?t.splice(M,1):z&&z.isDash===E.isDash&&(z.left=E.left,t.splice(M,1))}const n=t[0],u=t[t.length-1];n.isDash===u.isDash&&(n.left=u.left-this.width,u.right=n.right+this.width);const p=this.width*this.nextRow;let y=0,x=t[y];for(let M=0;M<this.width;M++){M/x.right>1&&(x=t[++y]);const E=Math.abs(M-x.left),z=Math.abs(M-x.right),R=Math.min(E,z);this.data[p+M]=Math.max(0,Math.min(255,(x.isDash?R:-R)+128))}}addDash(t,n){const u=n?7:0,p=2*u+1;if(this.nextRow+p>this.height)return s.w("LineAtlas out of space"),null;let y=0;for(let M=0;M<t.length;M++)y+=t[M];if(y!==0){const M=this.width/y,E=this.getDashRanges(t,this.width,M);n?this.addRoundDash(E,M,u):this.addRegularDash(E)}const x={y:this.nextRow+u,height:2*u,width:y};return this.nextRow+=p,this.dirty=!0,x}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Mi="maplibre_preloaded_worker_pool";class jt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<jt.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((n=>{n.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Mi]}numActive(){return Object.keys(this.active).length}}const Bt=Math.floor(ge.hardwareConcurrency/2);let Mr,Ui;function Ro(){return Mr||(Mr=new jt),Mr}jt.workerCount=s.K(globalThis)?Math.max(Math.min(Bt,3),1):1;class dn{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const u=this.workerPool.acquire(n);for(let p=0;p<u.length;p++){const y=new s.L(u[p],n);y.name=`Worker ${p}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const u=[];for(const p of this.actors)u.push(p.sendAsync({type:t,data:n}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((n=>{n.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const u of this.actors)u.registerMessageHandler(t,n)}unregisterMessageHandler(t){for(const n of this.actors)n.unregisterMessageHandler(t)}}function ea(){return Ui||(Ui=new dn(Ro(),s.M),Ui.registerMessageHandler("GR",((g,t,n)=>s.m(t,n)))),Ui}function $r(g,t){const n=s.N();return s.O(n,n,[1,1,0]),s.Q(n,n,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?s.S(n,n,g.calculatePosMatrix(t.toUnwrapped())):n}function ta(g,t,n,u,p,y,x){var M;const E=(function(N,G,X){if(N)for(const ie of N){const ne=G[ie];if(ne&&ne.source===X&&ne.type==="fill-extrusion")return!0}else for(const ie in G){const ne=G[ie];if(ne.source===X&&ne.type==="fill-extrusion")return!0}return!1})((M=p?.layers)!==null&&M!==void 0?M:null,t,g.id),z=y.maxPitchScaleFactor(),R=g.tilesIn(u,z,E);R.sort(yr);const j=[];for(const N of R)j.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,n,g.getState(),N.queryGeometry,N.cameraQueryGeometry,N.scale,p,y,z,$r(y,N.tileID),x?(G,X)=>x(N.tileID,G,X):void 0)});return(function(N,G){for(const X in N)for(const ie of N[X])fn(ie,G);return N})((function(N){const G={},X={};for(const ie of N){const ne=ie.queryResults,re=ie.wrappedTileID,ae=X[re]=X[re]||{};for(const he in ne){const se=ne[he],de=ae[he]=ae[he]||{},ve=G[he]=G[he]||[];for(const ce of se)de[ce.featureIndex]||(de[ce.featureIndex]=!0,ve.push(ce))}}return G})(j),g)}function yr(g,t){const n=g.tileID,u=t.tileID;return n.overscaledZ-u.overscaledZ||n.canonical.y-u.canonical.y||n.wrap-u.wrap||n.canonical.x-u.canonical.x}function fn(g,t){const n=g.feature,u=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=u}function zn(g,t,n){return s._(this,void 0,void 0,(function*(){let u=g;if(g.url?u=(yield s.j(t.transformRequest(g.url,"Source"),n)).data:yield ge.frameAsync(n),!u)return null;const p=s.U(s.e(u,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(p.vectorLayerIds=u.vector_layers.map((y=>y.id))),p}))}class Li{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof s.V?new s.V(t.lng,t.lat):s.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof s.V?new s.V(t.lng,t.lat):s.V.convert(t),this}extend(t){const n=this._sw,u=this._ne;let p,y;if(t instanceof s.V)p=t,y=t;else{if(!(t instanceof Li))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Li.convert(t)):this.extend(s.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(s.V.convert(t)):this;if(p=t._sw,y=t._ne,!p||!y)return this}return n||u?(n.lng=Math.min(p.lng,n.lng),n.lat=Math.min(p.lat,n.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new s.V(p.lng,p.lat),this._ne=new s.V(y.lng,y.lat)),this}getCenter(){return new s.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.V(this.getWest(),this.getNorth())}getSouthEast(){return new s.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:u}=s.V.convert(t);let p=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}intersects(t){if(!((t=Li.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const n=s.W(this.getWest(),-180,180),u=s.W(this.getEast(),-180,180),p=s.W(t.getWest(),-180,180),y=s.W(t.getEast(),-180,180),x=n>=u,M=p>=y;return!(!x||!M)||(x?y>=n||p<=u:M?u>=p||n<=y:p<=u&&y>=n)}static convert(t){return t instanceof Li?t:t&&new Li(t)}static fromLngLat(t,n=0){const u=360*n/40075017,p=u/Math.cos(Math.PI/180*t.lat);return new Li(new s.V(t.lng-p,t.lat-u),new s.V(t.lng+p,t.lat+u))}adjustAntiMeridian(){const t=new s.V(this._sw.lng,this._sw.lat),n=new s.V(this._ne.lng,this._ne.lat);return new Li(t,t.lng>n.lng?new s.V(n.lng+360,n.lat):n)}}class Dn{constructor(t,n,u){this.bounds=Li.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),u=Math.floor(s.Y(this.bounds.getWest())*n),p=Math.floor(s.X(this.bounds.getNorth())*n),y=Math.ceil(s.Y(this.bounds.getEast())*n),x=Math.ceil(s.X(this.bounds.getSouth())*n);return t.x>=u&&t.x<y&&t.y>=p&&t.y<x}}class ia extends s.E{constructor(t,n,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.U(n,["url","scheme","tileSize","promoteId","encoding"])),this._options=s.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield zn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(s.e(this,t),t.bounds&&(this.tileBounds=new Dn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,s.Z(t)||this.fire(new s.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(t){return s._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(n,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};u.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((y,x)=>{t.reloadPromise={resolve:y,reject:x}}))}else t.actor=this.dispatcher.getActor(),p="LT";t.abortController=new AbortController;try{const y=yield t.actor.sendAsync({type:p,data:u},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,y)}catch(y){if(delete t.abortController,t.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const n=t.tileID.scaledTo(this.maxzoom).canonical,u=n.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:n,overzoomRequest:this.map._requestManager.transformRequest(u,"Tile")}}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const u=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(u.resolve).catch(u.reject)}}abortTile(t){return s._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return s._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ra extends s.E{constructor(t,n,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},n),s.e(this,s.U(n,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield zn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(s.e(this,n),n.bounds&&(this.tileBounds=new Dn(n.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(n){this._tileJSONRequest=null,this._loaded=!0,s.Z(n)||this.fire(new s.k(n))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return s.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return s._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const u=yield ht.getImage(this.map._requestManager.transformRequest(n,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&t.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const p=this.map.painter.context,y=p.gl,x=u.data;t.texture=this.map.painter.getTileTexture(x.width),t.texture?t.texture.update(x,{useMipmap:!0}):(t.texture=new s.T(p,x,y.RGBA,{useMipmap:!0}),t.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(u){if(delete t.abortController,t.aborted)t.state="unloaded";else if(u)throw t.state="errored",u}}))}abortTile(t){return s._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return s._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Xn extends ra{constructor(t,n,u,p){super(t,n,u,p),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return s._(this,void 0,void 0,(function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(n,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const p=yield ht.getImage(u,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){const y=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const x=s.b(y)&&s.$()?y:yield this.readImageNow(y),M={type:this.type,uid:t.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const E=yield t.actor.sendAsync({type:"LDT",data:M});t.dem=E,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}}))}readImageNow(t){return s._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&s.a0()){const n=t.width+2,u=t.height+2;try{return new s.R({width:n,height:u},yield s.a1(t,-1,-1,n,u))}catch{}}return ge.getImageData(t,1)}))}_getNeighboringTiles(t){const n=t.canonical,u=Math.pow(2,n.z),p=(n.x-1+u)%u,y=n.x===0?t.wrap-1:t.wrap,x=(n.x+1+u)%u,M=n.x+1===u?t.wrap+1:t.wrap,E={};return E[new s.a2(t.overscaledZ,y,n.z,p,n.y).key]={backfilled:!1},E[new s.a2(t.overscaledZ,M,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(E[new s.a2(t.overscaledZ,y,n.z,p,n.y-1).key]={backfilled:!1},E[new s.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new s.a2(t.overscaledZ,M,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<u&&(E[new s.a2(t.overscaledZ,y,n.z,p,n.y+1).key]={backfilled:!1},E[new s.a2(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new s.a2(t.overscaledZ,M,n.z,x,n.y+1).key]={backfilled:!1}),E}unloadTile(t){return s._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function In(g){return g.type==="GeometryCollection"?g.geometries.map((t=>t.coordinates)).flat(1/0):g.coordinates.flat(1/0)}function na(g){const t=new Li;let n;switch(g.type){case"FeatureCollection":n=g.features.map((u=>In(u.geometry))).flat(1/0);break;case"Feature":n=In(g.geometry);break;default:n=In(g)}if(n.length==0)return t;for(let u=0;u<n.length-1;u+=2)t.extend([n[u],n[u+1]]);return t}class Da extends s.E{constructor(t,n,u,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=u.getActor(),this.setEventedParent(p),this._data=typeof n.data=="string"?{url:n.data}:{geojson:n.data},this._options=s.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:s.a5,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.a5,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(s.a5/this.tileSize)}_getClusterMaxZoom(t){const n=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||s.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${n}"`),n}load(){return s._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,n){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const u=this._updateWorkerData();return n?u:this}updateData(t,n){this._pendingWorkerUpdate.diff=s.a6(this._pendingWorkerUpdate.diff,t);const u=this._updateWorkerData();return n?u:this}getData(){return s._(this,void 0,void 0,(function*(){const t=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return s._(this,void 0,void 0,(function*(){return na(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:u}})}_updateWorkerData(){return s._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void s.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:n}=this._pendingWorkerUpdate,u=s.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(u.request=this.map._requestManager.transformRequest(ge.resolveURL(t),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=t,this._pendingWorkerUpdate.data=void 0):n&&(u.dataDiff=n,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new s.l("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));n&&this._applyDiff(n);let y=null;p.resourceTiming&&p.resourceTiming[this.id]&&(y=p.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&s.e(x,{resourceTiming:y}),this.fire(new s.l("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},x),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(n)})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(p))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(t){const n=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){if(!s.a7(this._data.geojson,n))throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:s.a8(this._data.geojson,n)}}this._data.updateable&&s.a9(this._data.updateable,t,n)}_getShouldReloadTileOptions(t){if(this._options.cluster||!t||t.removeAll)return;const{add:n=[],update:u=[],remove:p=[]}=t||{},y=new Set([...u.map((x=>x.id)),...p]);for(const x of y.values())if(typeof x!="number"&&this.promoteId==null)return void s.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs. Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...u.map((x=>x.newGeometry)),...n.map((x=>x.geometry))].filter(Boolean).map((x=>na(x))),prevIds:y}}shouldReloadTile(t,{nextBounds:n,prevIds:u}){if(!t.latestFeatureIndex)return t.state!=="unloaded";const p=t.latestFeatureIndex.loadVTLayers();for(let E=0;E<t.latestFeatureIndex.featureIndexArray.length;E++){const z=t.latestFeatureIndex.featureIndexArray.get(E),R=p[s.aa].feature(z.featureIndex),j=t.latestFeatureIndex.getId(R,s.aa);if(u.has(j))return!0}const{buffer:y,extent:x}=this.workerOptions.geojsonVtOptions,M=(function({x:E,y:z,z:R},j=0){const N=s.a3((E-j)/Math.pow(2,R)),G=s.a4((z+1+j)/Math.pow(2,R)),X=s.a3((E+1+j)/Math.pow(2,R)),ie=s.a4((z-j)/Math.pow(2,R));return new Li([N,G],[X,ie])})(t.tileID.canonical,y/x);for(const E of n)if(M.intersects(E))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return s._(this,void 0,void 0,(function*(){const n=t.actor?"RT":"LT";t.actor=this.actor;const u={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const p=yield this.actor.sendAsync({type:n,data:u},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(p,this.map.painter,n==="RT")}))}abortTile(t){return s._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return s._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class en extends s.E{constructor(t,n,u,p){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=u,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=n}load(t){return s._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield ht.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,s.Z(n)||this.fire(new s.k(n))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(s.ab.fromLngLat);var u;return this.tileID=(function(p){const y=s.ac.fromPoints(p),x=y.width(),M=y.height(),E=Math.max(x,M),z=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),R=Math.pow(2,z);return new s.ae(z,Math.floor((y.minX+y.maxX)/2*R),Math.floor((y.minY+y.maxY)/2*R))})(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map((p=>this.tileID.getTilePoint(p)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.texture||(this.texture=new s.T(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return s._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:n,minY:u,maxX:p,maxY:y}=s.ac.fromPoints(t),x={};for(let M=0;M<=s.ad;M++){const E=Math.pow(2,M),z=Math.floor(n*E),R=Math.floor(u*E),j=Math.floor(p*E),N=Math.floor(y*E);x[M]={minTileX:z,minTileY:R,maxTileX:j,maxTileY:N}}return x}}class Pe extends en{constructor(t,n,u,p){super(t,n,u,p),this.roundZoom=!0,this.type="video",this.options=n}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield s.af(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new s.k(n))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new s.k(new s.ag(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let u=!1;for(const p in this.tiles){const y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class H extends en{constructor(t,n,u,p){super(t,n,u,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((x=>typeof x!="number"))))||this.fire(new s.k(new s.ag(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.ag(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.k(new s.ag(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.ag(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.ag(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return s._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,u=n.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new s.T(n,this.canvas,u.RGBA,{premultiply:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const y in this.tiles){const x=this.tiles[y];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const W={},ee=g=>{switch(g){case"geojson":return Da;case"image":return en;case"raster":return ra;case"raster-dem":return Xn;case"vector":return ia;case"video":return Pe;case"canvas":return H}return W[g]},fe="RTLPluginLoaded";class ye extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ea()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((n=>{throw this.status="error",n}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return s._(this,arguments,void 0,(function*(n,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ge.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return s._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(fe))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ee=null;function Se(){return Ee||(Ee=new ye),Ee}var we,De;(function(g){g[g.Base=0]="Base",g[g.Parent=1]="Parent"})(we||(we={})),(function(g){g[g.Departing=0]="Departing",g[g.Incoming=1]="Incoming"})(De||(De={}));class Xe{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=s.ah(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:n,fadingParentID:u,fadeEndTime:p}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=n,this.fadingParentID=u,this.fadeEndTime=p}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=be(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(p,y){const x={};if(!y)return x;for(const M of p){const E=M.layerIds.map((z=>y.getLayer(z))).filter(Boolean);if(E.length!==0){M.layers=E,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map((z=>E.filter((R=>R.id===z))[0])));for(const z of E)x[z.id]=M}}return x})(t.buckets,n?.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof s.aj){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof s.aj&&y.hasRTLText){this.hasRTLText=!0,Se().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(p).queryRadius(y))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new s.ai}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new s.T(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,u,p,y,x,M,E,z,R,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:x,tileSize:this.tileSize,pixelPosMatrix:R,transform:E,params:M,queryPadding:this.queryPadding*z,getElevation:j},t,n,u):{}}querySourceFeatures(t,n){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),y=n&&n.sourceLayer?n.sourceLayer:"",x=p[s.aa]||p[y];if(!x)return;const M=s.ak(n?.filter,n?.globalState),{z:E,x:z,y:R}=this.tileID.canonical,j={z:E,x:z,y:R};for(let N=0;N<x.length;N++){const G=x.feature(N);if(M.needGeometry){const ne=s.al(G,!0);if(!M.filter(new s.H(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!M.filter(new s.H(this.tileID.overscaledZ),G))continue;const X=u.getId(G,y),ie=new s.am(G,E,z,R,X);ie.tile=j,t.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const u=s.an(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(n)if(this.expirationTime<n)p=!0;else{const y=this.expirationTime-n;y?this.expirationTime=u+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!n.style.hasLayer(p))continue;const y=this.buckets[p],x=y.layers[0].sourceLayer||s.aa,M=u[x],E=t[x];if(!M||!E||Object.keys(E).length===0)continue;y.update(E,M,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const z=n&&n.style&&n.style.getLayer(p);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(y)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<be()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=be()+t}setDependencies(t,n){const u={};for(const p of n)u[p]=!0;this.dependencies[t]=u}hasDependency(t,n){for(const u of t){const p=this.dependencies[u];if(p){for(const y of n)if(p[y])return!0}}return!1}}class Ze{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,u){const p=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},s.e(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==p&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const y in this.state[t][p])u[y]||(this.deletedStates[t][p][y]=null)}else for(const y in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][y]===null&&delete this.deletedStates[t][p][y]}removeFeatureState(t,n,u){if(this.deletedStates[t]===null)return;const p=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&n!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,n){const u=String(n),p=s.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const y=this.deletedStates[t][n];if(y===null)return{};for(const x in y)delete p[x]}return p}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),s.e(this.state[p][x],this.stateChanges[p][x]),y[x]=this.state[p][x];u[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(this.deletedStates[p]===null)for(const x in this.state[p])y[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(const M of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][M];y[x]=this.state[p][x]}u[p]=u[p]||{},s.e(u[p],y)}this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0&&t.setFeatureState(u,n)}}const ut=89.25;function _t(g,t){const n=s.ao(t.lat,-s.ap,s.ap);return new s.P(s.Y(t.lng)*g,s.X(n)*g)}function At(g,t){return new s.ab(t.x/g,t.y/g).toLngLat()}function ci(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(s.aq(90-g.pitch)),Math.tan(s.aq(ut-g.pitch)))}function ti(g,t){const n=g.canonical,u=t/s.ar(n.z),p=n.x+Math.pow(2,n.z)*g.wrap,y=s.as(new Float64Array(16));return s.O(y,y,[p*u,n.y*u,0]),s.Q(y,y,[u/s.a5,u/s.a5,1]),y}function Le(g,t,n,u,p){const y=s.ab.fromLngLat(g,t),x=p*s.at(1,g.lat),{x:M,y:E,z}=vi(n,u);return new s.ab(y.x+x*-M,y.y+x*-E,y.z+x*-z)}function vi(g,t){const n=s.aq(g),u=s.aq(t),p=Math.cos(-n),y=Math.sin(n);return{x:y*Math.sin(u),y:-y*Math.cos(u),z:p}}function Ir(g,t,n){const u=t.intersectsFrustum(g);if(!n||u===0)return u;const p=t.intersectsPlane(n);return p===0?0:u===2&&p===2?2:1}function Ct(g,t,n){let u=0;const p=(n-t)/10;for(let y=0;y<10;y++)u+=p*Math.pow(Math.cos(t+(y+.5)/10*(n-t)),g);return u}function hi(g,t){return function(n,u,p,y,x){const M=2*((g-1)/s.au(Math.cos(s.aq(ut-x))/Math.cos(s.aq(ut)))-1),E=Math.acos(p/y),z=2*Ct(M-1,0,s.aq(x/2)),R=Math.min(s.aq(ut),E+s.aq(x/2)),j=Ct(M-1,Math.min(R,E-s.aq(x/2)),R),N=Math.atan(u/p),G=Math.hypot(u,p);let X=n;return X+=s.au(y/G/Math.max(.5,Math.cos(s.aq(x/2)))),X+=M*s.au(Math.cos(N))/2,X-=s.au(Math.max(1,j/z/t))/2,X}}const Ar=hi(9.314,3);function xi(g,t){const n=(t.roundZoom?Math.round:Math.floor)(g.zoom+s.au(g.tileSize/t.tileSize));return Math.max(0,n)}function Zi(g,t){const n=g.getCameraFrustum(),u=g.getClippingPlane(),p=g.screenPointToMercatorCoordinate(g.getCameraPoint()),y=s.ab.fromLngLat(g.center,g.elevation);p.z=y.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const x=g.getCoveringTilesDetailsProvider(),M=x.allowVariableZoom(g,t),E=xi(g,t),z=t.minzoom||0,R=t.maxzoom!==void 0?t.maxzoom:g.maxZoom,j=Math.min(Math.max(0,E),R),N=Math.pow(2,j),G=[N*p.x,N*p.y,0],X=[N*y.x,N*y.y,0],ie=Math.hypot(y.x-p.x,y.y-p.y),ne=Math.abs(y.z-p.z),re=Math.hypot(ie,ne),ae=de=>({zoom:0,x:0,y:0,wrap:de,fullyVisible:!1}),he=[],se=[];if(g.renderWorldCopies&&x.allowWorldCopies())for(let de=1;de<=3;de++)he.push(ae(-de)),he.push(ae(de));for(he.push(ae(0));he.length>0;){const de=he.pop(),ve=de.x,ce=de.y;let Te=de.fullyVisible;const Re={x:ve,y:ce,z:de.zoom},Ce=x.getTileBoundingVolume(Re,de.wrap,g.elevation,t);if(!Te){const et=Ir(n,Ce,u);if(et===0)continue;Te=et===2}const ze=x.distanceToTile2d(p.x,p.y,Re,Ce);let Oe=E;M&&(Oe=(t.calculateTileZoom||Ar)(g.zoom+s.au(g.tileSize/t.tileSize),ze,ne,re,g.fov)),Oe=(t.roundZoom?Math.round:Math.floor)(Oe),Oe=Math.max(0,Oe);const He=Math.min(Oe,R);if(de.wrap=x.getWrap(y,Re,de.wrap),de.zoom>=He){if(de.zoom<z)continue;const et=j-de.zoom,We=G[0]-.5-(ve<<et),gt=G[1]-.5-(ce<<et),zt=t.reparseOverscaled?Math.max(de.zoom,Oe):de.zoom;se.push({tileID:new s.a2(de.zoom===R?zt:de.zoom,de.wrap,de.zoom,ve,ce),distanceSq:s.av([X[0]-.5-ve,X[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(We*We+gt*gt)})}else for(let et=0;et<4;et++)he.push({zoom:de.zoom+1,x:(ve<<1)+et%2,y:(ce<<1)+(et>>1),wrap:de.wrap,fullyVisible:Te})}return se.sort(((de,ve)=>de.distanceSq-ve.distanceSq)).map((de=>de.tileID))}const bi=s.ac.fromPoints([new s.P(0,0),new s.P(s.a5,s.a5)]);function ir(g){return g==="raster"||g==="image"||g==="video"}function fs(g,t,n,u,p,y,x){if(!t.hasData())return!1;const{tileID:M,fadingRole:E,fadingDirection:z,fadingParentID:R}=t;if(E===we.Base&&z===De.Incoming&&R)return n[R.key]=R,!0;const j=Math.max(M.overscaledZ-p,y);for(let N=M.overscaledZ-1;N>=j;N--){const G=M.scaledTo(N),X=g.getLoadedTile(G);if(X)return t.setCrossFadeLogic({fadingRole:we.Base,fadingDirection:De.Incoming,fadingParentID:X.tileID,fadeEndTime:u+x}),X.setCrossFadeLogic({fadingRole:we.Parent,fadingDirection:De.Departing,fadeEndTime:u+x}),n[G.key]=G,!0}return!1}function tn(g,t,n,u,p,y){if(!t.hasData())return!1;const x=t.tileID.children(p);let M=Fe(g,t,x,n,u,p,y);if(M)return!0;for(const E of x)Fe(g,t,E.children(p),n,u,p,y)&&(M=!0);return M}function Fe(g,t,n,u,p,y,x){if(n[0].overscaledZ>=y)return!1;let M=!1;for(const E of n){const z=g.getLoadedTile(E);if(!z)continue;const{fadingRole:R,fadingDirection:j,fadingParentID:N}=z;R===we.Base&&j===De.Departing&&N||(z.setCrossFadeLogic({fadingRole:we.Base,fadingDirection:De.Departing,fadingParentID:t.tileID,fadeEndTime:p+x}),t.setCrossFadeLogic({fadingRole:we.Parent,fadingDirection:De.Incoming,fadeEndTime:p+x})),u[E.key]=E,M=!0}return M}function zr(g,t,n,u){const p=g.tileID;return!!g.selfFading||!g.hasData()&&!!t.has(p)&&(g.setSelfFadeLogic(n+u),!0)}function Dr(g,t){var n;g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let u=t.tileID.canonical.x-g.tileID.canonical.x;const p=t.tileID.canonical.y-g.tileID.canonical.y,y=Math.pow(2,g.tileID.canonical.z),x=t.tileID.key;u===0&&p===0||Math.abs(p)>1||(Math.abs(u)>1&&(Math.abs(u+y)===1?u+=y:Math.abs(u-y)===1&&(u-=y)),t.dem&&g.dem&&(g.dem.backfillBorder(t.dem,u,p),!((n=g.neighboringTiles)===null||n===void 0)&&n[x]&&(g.neighboringTiles[x].backfilled=!0)))}class ms{constructor(){this._tiles={}}handleWrapJump(t){const n={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+t),n[p.tileID.key]=p}this._tiles=n}setFeatureState(t,n){for(const u in this._tiles)this._tiles[u].setFeatureState(t,n)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((n=>n.tileID)).sort(s.ax).map((n=>n.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,n){this._tiles[t]=n}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const n=this.getTileById(t.key);return n?.hasData()?n:null}isIdRenderable(t,n=!1){var u;return(u=this.getTileById(t))===null||u===void 0?void 0:u.isRenderable(n)}getRenderableIds(t=0,n){const u=[];for(const p of this.getAllIds())this.isIdRenderable(p,n)&&u.push(this.getTileById(p));return n?u.sort(((p,y)=>{const x=p.tileID,M=y.tileID,E=new s.P(x.canonical.x,x.canonical.y)._rotate(-t),z=new s.P(M.canonical.x,M.canonical.y)._rotate(-t);return x.overscaledZ-M.overscaledZ||z.y-E.y||z.x-E.x})).map((p=>p.tileID.key)):u.map((p=>p.tileID)).sort(s.ax).map((p=>p.key))}}class mn extends s.E{constructor(t,n,u){super(),this.id=t,this.dispatcher=u,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,y,x,M)=>{const E=new(ee(y.type))(p,y,x,M);if(E.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${E.id}`);return E})(t,n,u,this),this._inViewTiles=new ms,this._outOfViewCache=new s.ay(0,(p=>this._unloadTile(p))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Ze,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const n of this._inViewTiles.getAllTiles())n.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new ms}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,u){return s._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,u)}catch(p){t.state="errored",p.status!==404?this._source.fire(new s.k(p,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new s.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const n of this._inViewTiles.getAllTiles())n.upload(t),n.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var n;return this._inViewTiles.getRenderableIds((n=this.transform)===null||n===void 0?void 0:n.bearingInRadians,t)}hasRenderableParent(t){const n=t.overscaledZ-1;if(n>=this._source.minzoom){const u=this.getLoadedTile(t.scaledTo(n));if(u)return this._inViewTiles.isIdRenderable(u.tileID.key)}return!1}reload(t,n=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const u of this._inViewTiles.getAllIds()){const p=this._inViewTiles.getTileById(u);n&&!this._source.shouldReloadTile(p,n)||(t?this._reloadTile(u,"expired"):p.state!=="errored"&&this._reloadTile(u,"reloading"))}}}_reloadTile(t,n){return s._(this,void 0,void 0,(function*(){const u=this._inViewTiles.getTileById(t);u&&(u.state!=="loading"&&(u.state=n),yield this._loadTile(u,t,n))}))}_tileLoaded(t,n,u){t.timeAdded=be(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&(function(p,y){var x,M;const E=y.getRenderableIds();for(const z of E){if(!p.neighboringTiles||!p.neighboringTiles[z])continue;const R=y.getTileById(z);p.neighboringTiles[z].backfilled||Dr(p,R),!((M=(x=R.neighboringTiles)===null||x===void 0?void 0:x[p.tileID.key])===null||M===void 0)&&M.backfilled||Dr(R,p)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,n){const u=this._getLoadedDescendents(n),p=new Set;for(const y of n){const x=u[y.key];if(!x?.length){p.add(y);continue}const M=y.overscaledZ+mn.maxOverzooming,E=x.filter((j=>j.tileID.overscaledZ<=M));if(!E.length){p.add(y);continue}const z=Math.min(...E.map((j=>j.tileID.overscaledZ))),R=E.filter((j=>j.tileID.overscaledZ===z)).map((j=>j.tileID));for(const j of R)t[j.key]=j;this._areDescendentsComplete(R,z,y.overscaledZ)||p.add(y)}return p}_getLoadedDescendents(t){var n;const u={};for(const p of this._inViewTiles.getAllTiles().filter((y=>y.hasData())))for(const y of t)p.tileID.isChildOf(y)&&(u[n=y.key]||(u[n]=[])).push(p);return u}_areDescendentsComplete(t,n,u){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===n:Math.pow(4,n-u)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(n*u*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._outOfViewCache.setMaxSize(y)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,n&&(this._inViewTiles.handleWrapJump(n),this._resetTileReloadTimers())}update(t,n){if(!this._sourceLoaded||this._paused)return;let u;this.transform=t,this.terrain=n,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((E=>new s.a2(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y))):(u=Zi(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((E=>this._source.hasTile(E))))):u=[],this.usedForTerrain&&(u=this._addTerrainIdealTiles(u));const p=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,p&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const y=xi(t,this._source),x=this._updateRetainedTiles(u,y),M=ir(this._source.type);M&&this._rasterFadeDuration>0&&!n&&(function(E,z,R,j,N,G,X){const ie=be(),ne=s.aw(z);for(const re of z){const ae=E.getTileById(re.key);ae.fadingDirection!==De.Departing&&ae.fadeOpacity!==0||ae.resetFadeLogic(),fs(E,ae,R,ie,j,N,X)||tn(E,ae,R,ie,G,X)||zr(ae,ne,ie,X)||ae.resetFadeLogic()}})(this._inViewTiles,u,x,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),M?this._cleanUpRasterTiles(x):this._cleanUpVectorTiles(x)}_cleanUpRasterTiles(t){for(const n of this._inViewTiles.getAllIds())t[n]||this._removeTile(n)}_cleanUpVectorTiles(t){for(const n of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(n);t[n]?u.clearSymbolFadeHold():u.hasSymbolBuckets?u.holdingForSymbolFade()?u.symbolFadeFinished()&&this._removeTile(n):u.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(n)}}_addTerrainIdealTiles(t){const n=[];for(const u of t)if(u.canonical.z>this._source.minzoom){const p=u.scaledTo(u.canonical.z-1);n.push(p);const y=u.scaledTo(Math.max(this._source.minzoom,Math.min(u.canonical.z,5)));n.push(y)}return t.concat(n)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){var u;const p=new Set;for(const z of t)this._addTile(z).hasData()||p.add(z);const y=t.reduce(((z,R)=>(z[R.key]=R,z)),{}),x=this._retainLoadedChildren(y,p),M={},E=Math.max(n-mn.maxUnderzooming,this._source.minzoom);for(const z of x){let R=this._inViewTiles.getTileById(z.key),j=R?.wasRequested();for(let N=z.overscaledZ-1;N>=E;--N){const G=z.scaledTo(N);if(M[G.key])break;if(M[G.key]=!0,R=this.getTile(G),!R&&j&&(R=this._addTile(G)),R){const X=R.hasData();if((X||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||j)&&(y[G.key]=G),j=R.wasRequested(),X)break}}}return y}_addTile(t){let n=this._inViewTiles.getTileById(t.key);if(n)return n;n=this._outOfViewCache.getAndRemove(t),n&&(n.resetFadeLogic(),this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null));const u=n;return n||(n=new Xe(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._inViewTiles.setTile(t.key,n),u||this._source.fire(new s.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){this._clearTileReloadTimer(t);const u=n.getExpiryTimeout();u&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),u))}_clearTileReloadTimer(t){const n=this._timers[t];n&&(clearTimeout(n),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const n=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,n)}}refreshTiles(t){for(const n of this._inViewTiles.getAllIds()){const u=this._inViewTiles.getTileById(n);(this._inViewTiles.isIdRenderable(n)||u.state=="errored")&&t.some((p=>p.equals(u.tileID.canonical)))&&this._reloadTile(n,"expired")}}_removeTile(t){const n=this._inViewTiles.getTileById(t);n&&(n.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._outOfViewCache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,n,u){const p=[],y=this.transform;if(!y)return p;const x=y.getCoveringTilesDetailsProvider().allowWorldCopies(),M=u?y.getCameraQueryGeometry(t):t,E=G=>y.screenPointToMercatorCoordinate(G,this.terrain),z=this.transformBbox(t,E,!x),R=this.transformBbox(M,E,!x),j=this.getIds(),N=s.ac.fromPoints(R);for(let G=0;G<j.length;G++){const X=this._inViewTiles.getTileById(j[G]);if(X.holdingForSymbolFade())continue;const ie=x?[X.tileID]:[X.tileID.unwrapTo(-1),X.tileID.unwrapTo(0)],ne=Math.pow(2,y.zoom-X.tileID.overscaledZ),re=n*X.queryPadding*s.a5/X.tileSize/ne;for(const ae of ie){const he=N.map((se=>ae.getTilePoint(new s.ab(se.x,se.y))));if(he.expandBy(re),he.intersects(bi)){const se=z.map((ve=>ae.getTilePoint(ve))),de=R.map((ve=>ae.getTilePoint(ve)));p.push({tile:X,tileID:x?ae:ae.unwrapTo(0),queryGeometry:se,cameraQueryGeometry:de,scale:ne})}}}return p}transformBbox(t,n,u){let p=t.map(n);if(u){const y=s.ac.fromPoints(t);y.shrinkBy(.001*Math.min(y.width(),y.height()));const x=y.map(n);s.ac.fromPoints(p).covers(x)||(p=p.map((M=>M.x>.5?new s.ab(M.x-1,M.y,M.z):M)))}return p}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map((u=>this._inViewTiles.getTileById(u).tileID));return this.transform&&this.transform.populateCache(n),n}hasTransition(){return!!this._source.hasTransition()||!(!ir(this._source.type)||!(function(t,n){if(n<=0)return!1;const u=be();for(const p of t.getAllTiles())if(p.fadeEndTime>=u)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,n,u){this._state.updateState(t=t||s.aa,n,u)}removeFeatureState(t,n,u){this._state.removeFeatureState(t=t||s.aa,n,u)}getFeatureState(t,n){return this._state.getState(t=t||s.aa,n)}setDependencies(t,n,u){const p=this._inViewTiles.getTileById(t);p&&p.setDependencies(n,u)}reloadTilesForDependencies(t,n){for(const u of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(u).hasDependency(t,n)&&this._reloadTile(u,"reloading");this._outOfViewCache.filter((u=>!u.hasDependency(t,n)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}mn.maxUnderzooming=10,mn.maxOverzooming=3;class rt{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ao(t,0,1);let n=1,u=this._distances[n];const p=t*this.paddedLength+this.padding;for(;u<p&&n<this._distances.length;)u=this._distances[++n];const y=n-1,x=this._distances[y],M=u-x,E=M>0?(p-x)/M:0;return this.points[y].mult(1-E).add(this.points[n].mult(E))}}function Ot(g,t){let n=!0;return g==="always"||g!=="never"&&t!=="never"||(n=!1),n}class kt{constructor(t,n,u){const p=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(n/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,u,p,y){this._forEachCell(n,u,p,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)}insertCircle(t,n,u,p){this._forEachCell(n-p,u-p,n+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,n,u,p,y,x){this.boxCells[y].push(x)}_insertCircleCell(t,n,u,p,y,x){this.circleCells[y].push(x)}_query(t,n,u,p,y,x,M){if(u<0||t>this.width||p<0||n>this.height)return[];const E=[];if(t<=0&&n<=0&&this.width<=u&&this.height<=p){if(y)return[{key:null,x1:t,y1:n,x2:u,y2:p}];for(let z=0;z<this.boxKeys.length;z++)E.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const R=this.circles[3*z],j=this.circles[3*z+1],N=this.circles[3*z+2];E.push({key:this.circleKeys[z],x1:R-N,y1:j-N,x2:R+N,y2:j+N})}}else this._forEachCell(t,n,u,p,this._queryCell,E,{hitTest:y,overlapMode:x,seenUids:{box:{},circle:{}}},M);return E}query(t,n,u,p){return this._query(t,n,u,p,!1,null)}hitTest(t,n,u,p,y,x){return this._query(t,n,u,p,!0,y,x).length>0}hitTestCircle(t,n,u,p,y){const x=t-u,M=t+u,E=n-u,z=n+u;if(M<0||x>this.width||z<0||E>this.height)return!1;const R=[];return this._forEachCell(x,E,M,z,this._queryCellCircle,R,{hitTest:!0,overlapMode:p,circle:{x:t,y:n,radius:u},seenUids:{box:{},circle:{}}},y),R.length>0}_queryCell(t,n,u,p,y,x,M,E){const{seenUids:z,hitTest:R,overlapMode:j}=M,N=this.boxCells[y];if(N!==null){const X=this.bboxes;for(const ie of N)if(!z.box[ie]){z.box[ie]=!0;const ne=4*ie,re=this.boxKeys[ie];if(t<=X[ne+2]&&n<=X[ne+3]&&u>=X[ne+0]&&p>=X[ne+1]&&(!E||E(re))&&(!R||!Ot(j,re.overlapMode))&&(x.push({key:re,x1:X[ne],y1:X[ne+1],x2:X[ne+2],y2:X[ne+3]}),R))return!0}}const G=this.circleCells[y];if(G!==null){const X=this.circles;for(const ie of G)if(!z.circle[ie]){z.circle[ie]=!0;const ne=3*ie,re=this.circleKeys[ie];if(this._circleAndRectCollide(X[ne],X[ne+1],X[ne+2],t,n,u,p)&&(!E||E(re))&&(!R||!Ot(j,re.overlapMode))){const ae=X[ne],he=X[ne+1],se=X[ne+2];if(x.push({key:re,x1:ae-se,y1:he-se,x2:ae+se,y2:he+se}),R)return!0}}}return!1}_queryCellCircle(t,n,u,p,y,x,M,E){const{circle:z,seenUids:R,overlapMode:j}=M,N=this.boxCells[y];if(N!==null){const X=this.bboxes;for(const ie of N)if(!R.box[ie]){R.box[ie]=!0;const ne=4*ie,re=this.boxKeys[ie];if(this._circleAndRectCollide(z.x,z.y,z.radius,X[ne+0],X[ne+1],X[ne+2],X[ne+3])&&(!E||E(re))&&!Ot(j,re.overlapMode))return x.push(!0),!0}}const G=this.circleCells[y];if(G!==null){const X=this.circles;for(const ie of G)if(!R.circle[ie]){R.circle[ie]=!0;const ne=3*ie,re=this.circleKeys[ie];if(this._circlesCollide(X[ne],X[ne+1],X[ne+2],z.x,z.y,z.radius)&&(!E||E(re))&&!Ot(j,re.overlapMode))return x.push(!0),!0}}}_forEachCell(t,n,u,p,y,x,M,E){const z=this._convertToXCellCoord(t),R=this._convertToYCellCoord(n),j=this._convertToXCellCoord(u),N=this._convertToYCellCoord(p);for(let G=z;G<=j;G++)for(let X=R;X<=N;X++)if(y.call(this,t,n,u,p,this.xCellCount*X+G,x,M,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,u,p,y,x){const M=p-t,E=y-n,z=u+x;return z*z>M*M+E*E}_circleAndRectCollide(t,n,u,p,y,x,M){const E=(x-p)/2,z=Math.abs(t-(p+E));if(z>E+u)return!1;const R=(M-y)/2,j=Math.abs(n-(y+R));if(j>R+u)return!1;if(z<=E||j<=R)return!0;const N=z-E,G=j-R;return N*N+G*G<=u*u}}function rn(g,t,n){const u=s.N();if(!g){const{vecSouth:j,vecEast:N}=uo(t),G=$();G[0]=N[0],G[1]=N[1],G[2]=j[0],G[3]=j[1],p=G,(R=(x=(y=G)[0])*(z=y[3])-(E=y[2])*(M=y[1]))&&(p[0]=z*(R=1/R),p[1]=-M*R,p[2]=-E*R,p[3]=x*R),u[0]=G[0],u[1]=G[1],u[4]=G[2],u[5]=G[3]}var p,y,x,M,E,z,R;return s.Q(u,u,[1/n,1/n,1]),u}function Js(g,t,n,u){if(g){const p=s.N();if(!t){const{vecSouth:y,vecEast:x}=uo(n);p[0]=x[0],p[1]=x[1],p[4]=y[0],p[5]=y[1]}return s.Q(p,p,[u,u,1]),p}return n.pixelsToClipSpaceMatrix}function uo(g){const t=Math.cos(g.rollInRadians),n=Math.sin(g.rollInRadians),u=Math.cos(g.pitchInRadians),p=Math.cos(g.bearingInRadians),y=Math.sin(g.bearingInRadians),x=s.aD();x[0]=-p*u*n-y*t,x[1]=-y*u*n+p*t;const M=s.aE(x);M<1e-9?s.aF(x):s.aG(x,x,1/M);const E=s.aD();E[0]=p*u*t-y*n,E[1]=y*u*t+p*n;const z=s.aE(E);return z<1e-9?s.aF(E):s.aG(E,E,1/z),{vecEast:E,vecSouth:x}}function Rt(g,t,n,u){let p;u?(p=[g,t,u(g,t),1],s.aI(p,p,n)):(p=[g,t,0,1],oa(p,p,n));const y=p[3];return{point:new s.P(p[0]/y,p[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function gs(g,t){return .5+g/t*.5}function Ra(g,t){return g.x>=-t[0]&&g.x<=t[0]&&g.y>=-t[1]&&g.y<=t[1]}function Qs(g,t,n,u,p,y,x,M,E,z,R,j,N){const G=n?g.textSizeData:g.iconSizeData,X=s.az(G,t.transform.zoom),ie=[256/t.width*2+1,256/t.height*2+1],ne=n?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ne.clear();const re=g.lineVertexArray,ae=n?g.text.placedSymbolArray:g.icon.placedSymbolArray,he=t.transform.width/t.transform.height;let se=!1;for(let de=0;de<ae.length;de++){const ve=ae.get(de);if(ve.hidden||ve.writingMode===s.aA.vertical&&!se){gi(ve.numGlyphs,ne);continue}se=!1;const ce=new s.P(ve.anchorX,ve.anchorY),Te={getElevation:N,pitchedLabelPlaneMatrix:u,lineVertexArray:re,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:ce,unwrappedTileID:E,width:z,height:R,translation:j},Re=Yn(ve.anchorX,ve.anchorY,Te);if(!Ra(Re.point,ie)){gi(ve.numGlyphs,ne);continue}const Ce=gs(t.transform.cameraToCenterDistance,Re.signedDistanceFromCamera),ze=s.aB(G,X,ve),Oe=y?ze*t.transform.getPitchedTextCorrection(ve.anchorX,ve.anchorY,E)/Ce:ze*Ce,He=Fa({projectionContext:Te,pitchedLabelPlaneMatrixInverse:p,symbol:ve,fontSize:Oe,flip:!1,keepUpright:x,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:ne,aspectRatio:he,rotateToLine:M});se=He.useVertical,(He.notEnoughRoom||se||He.needsFlipping&&Fa({projectionContext:Te,pitchedLabelPlaneMatrixInverse:p,symbol:ve,fontSize:Oe,flip:!0,keepUpright:x,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:ne,aspectRatio:he,rotateToLine:M}).notEnoughRoom)&&gi(ve.numGlyphs,ne)}n?g.text.dynamicLayoutVertexBuffer.updateData(ne):g.icon.dynamicLayoutVertexBuffer.updateData(ne)}function co(g,t,n,u,p,y,x,M){const E=y.glyphStartIndex+y.numGlyphs,z=y.lineStartIndex,R=y.lineStartIndex+y.lineLength,j=t.getoffsetX(y.glyphStartIndex),N=t.getoffsetX(E-1),G=Wr(g*j,n,u,p,y.segment,z,R,M,x);if(!G)return null;const X=Wr(g*N,n,u,p,y.segment,z,R,M,x);return X?M.projectionCache.anyProjectionOccluded?null:{first:G,last:X}:null}function _s(g,t,n,u){return g===s.aA.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*u?{useVertical:!0}:(g===s.aA.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function Fa(g){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:n,symbol:u,fontSize:p,flip:y,keepUpright:x,glyphOffsetArray:M,dynamicLayoutVertexArray:E,aspectRatio:z,rotateToLine:R}=g,j=p/24,N=u.lineOffsetX*j,G=u.lineOffsetY*j;let X;if(u.numGlyphs>1){const ie=u.glyphStartIndex+u.numGlyphs,ne=u.lineStartIndex,re=u.lineStartIndex+u.lineLength,ae=co(j,M,N,G,y,u,R,t);if(!ae)return{notEnoughRoom:!0};const he=Ba(ae.first.point.x,ae.first.point.y,t,n),se=Ba(ae.last.point.x,ae.last.point.y,t,n);if(x&&!y){const de=_s(u.writingMode,he,se,z);if(de)return de}X=[ae.first];for(let de=u.glyphStartIndex+1;de<ie-1;de++){const ve=Wr(j*M.getoffsetX(de),N,G,y,u.segment,ne,re,t,R);if(!ve)return{notEnoughRoom:!0};X.push(ve)}X.push(ae.last)}else{if(x&&!y){const ne=pi(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,re=u.lineStartIndex+u.segment+1,ae=new s.P(t.lineVertexArray.getx(re),t.lineVertexArray.gety(re)),he=pi(ae.x,ae.y,t),se=he.signedDistanceFromCamera>0?he.point:ys(t.tileAnchorPoint,ae,ne,1,t),de=Ba(ne.x,ne.y,t,n),ve=Ba(se.x,se.y,t,n),ce=_s(u.writingMode,de,ve,z);if(ce)return ce}const ie=Wr(j*M.getoffsetX(u.glyphStartIndex),N,G,y,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,t,R);if(!ie||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[ie]}for(const ie of X)s.aH(E,ie.point,ie.angle);return{}}function ys(g,t,n,u,p){const y=g.add(g.sub(t)._unit()),x=pi(y.x,y.y,p).point,M=n.sub(x);return n.add(M._mult(u/M.mag()))}function qr(g,t,n){const u=t.projectionCache;if(u.projections[g])return u.projections[g];const p=new s.P(t.lineVertexArray.getx(g),t.lineVertexArray.gety(g)),y=pi(p.x,p.y,t);if(y.signedDistanceFromCamera>0)return u.projections[g]=y.point,u.anyProjectionOccluded=u.anyProjectionOccluded||y.isOccluded,y.point;const x=g-n.direction;return ys(n.distanceFromAnchor===0?t.tileAnchorPoint:new s.P(t.lineVertexArray.getx(x),t.lineVertexArray.gety(x)),p,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,t)}function pi(g,t,n){const u=g+n.translation[0],p=t+n.translation[1];let y;return n.pitchWithMap?(y=Rt(u,p,n.pitchedLabelPlaneMatrix,n.getElevation),y.isOccluded=!1):(y=n.transform.projectTileCoordinates(u,p,n.unwrappedTileID,n.getElevation),y.point.x=(.5*y.point.x+.5)*n.width,y.point.y=(.5*-y.point.y+.5)*n.height),y}function Ba(g,t,n,u){if(n.pitchWithMap){const p=[g,t,0,1];return s.aI(p,p,u),n.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],n.unwrappedTileID,n.getElevation).point}return{x:g/n.width*2-1,y:1-t/n.height*2}}function Yn(g,t,n){return n.transform.projectTileCoordinates(g,t,n.unwrappedTileID,n.getElevation)}function Oa(g,t,n){return g._unit()._perp()._mult(t*n)}function Fo(g,t,n,u,p,y,x,M,E){if(M.projectionCache.offsets[g])return M.projectionCache.offsets[g];const z=n.add(t);if(g+E.direction<u||g+E.direction>=p)return M.projectionCache.offsets[g]=z,z;const R=qr(g+E.direction,M,E),j=Oa(R.sub(n),x,E.direction),N=n.add(j),G=R.add(j);return M.projectionCache.offsets[g]=s.aJ(y,z,N,G)||z,M.projectionCache.offsets[g]}function Wr(g,t,n,u,p,y,x,M,E){const z=u?g-t:g+t;let R=z>0?1:-1,j=0;u&&(R*=-1,j=Math.PI),R<0&&(j+=Math.PI);let N,G=R>0?y+p:y+p+1;M.projectionCache.cachedAnchorPoint?N=M.projectionCache.cachedAnchorPoint:(N=pi(M.tileAnchorPoint.x,M.tileAnchorPoint.y,M).point,M.projectionCache.cachedAnchorPoint=N);let X,ie,ne=N,re=N,ae=0,he=0;const se=Math.abs(z),de=[];let ve;for(;ae+he<=se;){if(G+=R,G<y||G>=x)return null;ae+=he,re=ne,ie=X;const Re={absOffsetX:se,direction:R,distanceFromAnchor:ae,previousVertex:re};if(ne=qr(G,M,Re),n===0)de.push(re),ve=ne.sub(re);else{let Ce;const ze=ne.sub(re);Ce=ze.mag()===0?Oa(qr(G+R,M,Re).sub(ne),n,R):Oa(ze,n,R),ie||(ie=re.add(Ce)),X=Fo(G,Ce,ne,y,x,ie,n,M,Re),de.push(ie),ve=X.sub(ie)}he=ve.mag()}const ce=ve._mult((se-ae)/he)._add(ie||re),Te=j+Math.atan2(ne.y-re.y,ne.x-re.x);return de.push(ce),{point:ce,angle:E?Te:0,path:de}}const ri=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function gi(g,t){for(let n=0;n<g;n++){const u=t.length;t.resize(u+4),t.float32.set(ri,3*u)}}function oa(g,t,n){const u=t[0],p=t[1];return g[0]=n[0]*u+n[4]*p+n[12],g[1]=n[1]*u+n[5]*p+n[13],g[3]=n[3]*u+n[7]*p+n[15],g}const wi=100;class aa{constructor(t,n=new kt(t.width+200,t.height+200,25),u=new kt(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=u,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+wi,this.screenBottomBoundary=t.height+wi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,u,p,y,x,M,E,z,R,j,N){const G=this.projectAndGetPerspectiveRatio(t.anchorPointX+E[0],t.anchorPointY+E[1],y,R,N),X=u*G.perspectiveRatio;let ie;if(x||M)ie=this._projectCollisionBox(t,X,p,y,x,M,E,G,R,j,N);else{const ve=G.x+(j?j.x*X:0),ce=G.y+(j?j.y*X:0);ie={allPointsOccluded:!1,box:[ve+t.x1*X,ce+t.y1*X,ve+t.x2*X,ce+t.y2*X]}}const[ne,re,ae,he]=ie.box,se=x?ie.allPointsOccluded:G.isOccluded;let de=se;return de||(de=G.perspectiveRatio<this.perspectiveRatioCutoff),de||(de=!this.isInsideGrid(ne,re,ae,he)),de||n!=="always"&&this.grid.hitTest(ne,re,ae,he,n,z)?{box:[ne,re,ae,he],placeable:!1,offscreen:!1,occluded:se}:{box:[ne,re,ae,he],placeable:!0,offscreen:this.isOffscreen(ne,re,ae,he),occluded:se}}placeCollisionCircles(t,n,u,p,y,x,M,E,z,R,j,N,G,X){const ie=[],ne=new s.P(n.anchorX,n.anchorY),re=this.getPerspectiveRatio(ne.x,ne.y,x,X),ae=(z?y*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,x)/re:y*re)/s.aN,he={getElevation:X,pitchedLabelPlaneMatrix:M,lineVertexArray:u,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ne,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:G},se=co(ae,p,n.lineOffsetX*ae,n.lineOffsetY*ae,!1,n,!1,he);let de=!1,ve=!1,ce=!0;if(se){const Te=.5*j*re+N,Re=new s.P(-100,-100),Ce=new s.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new rt,Oe=se.first,He=se.last;let et=[];for(let zt=Oe.path.length-1;zt>=1;zt--)et.push(Oe.path[zt]);for(let zt=1;zt<He.path.length;zt++)et.push(He.path[zt]);const We=2.5*Te;if(z){const zt=this.projectPathToScreenSpace(et,he);et=zt.some((di=>di.signedDistanceFromCamera<=0))?[]:zt.map((di=>di.point))}let gt=[];if(et.length>0){const zt=et[0].clone(),di=et[0].clone();for(let ki=1;ki<et.length;ki++)zt.x=Math.min(zt.x,et[ki].x),zt.y=Math.min(zt.y,et[ki].y),di.x=Math.max(di.x,et[ki].x),di.y=Math.max(di.y,et[ki].y);gt=zt.x>=Re.x&&di.x<=Ce.x&&zt.y>=Re.y&&di.y<=Ce.y?[et]:di.x<Re.x||zt.x>Ce.x||di.y<Re.y||zt.y>Ce.y?[]:s.aK([et],Re.x,Re.y,Ce.x,Ce.y)}for(const zt of gt){ze.reset(zt,.25*Te);let di=0;di=ze.length<=.5*Te?1:Math.ceil(ze.paddedLength/We)+1;for(let ki=0;ki<di;ki++){const yi=ki/Math.max(di-1,1),Ni=ze.lerp(yi),Ai=Ni.x+wi,Lr=Ni.y+wi;ie.push(Ai,Lr,Te,0);const Ri=Ai-Te,vr=Lr-Te,nr=Ai+Te,or=Lr+Te;if(ce=ce&&this.isOffscreen(Ri,vr,nr,or),ve=ve||this.isInsideGrid(Ri,vr,nr,or),t!=="always"&&this.grid.hitTestCircle(Ai,Lr,Te,t,R)&&(de=!0,!E))return{circles:[],offscreen:!1,collisionDetected:de}}}}return{circles:!E&&de||!ve||re<this.perspectiveRatioCutoff?[]:ie,offscreen:ce,collisionDetected:de}}projectPathToScreenSpace(t,n){const u=(function(p,y){const x=s.N();return s.aC(x,y.pitchedLabelPlaneMatrix),p.map((M=>{const E=Rt(M.x,M.y,x,y.getElevation),z=y.transform.projectTileCoordinates(E.point.x,E.point.y,y.unwrappedTileID,y.getElevation);return z.point.x=(.5*z.point.x+.5)*y.width,z.point.y=(.5*-z.point.y+.5)*y.height,z}))})(t,n);return(function(p){let y=0,x=0,M=0,E=0;for(let z=0;z<p.length;z++)p[z].isOccluded?(M=z+1,E=0):(E++,E>x&&(x=E,y=M));return p.slice(y,y+x)})(u)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[],u=new s.ac;for(const j of t){const N=new s.P(j.x+wi,j.y+wi);u.extend(N),n.push(N)}const{minX:p,minY:y,maxX:x,maxY:M}=u,E=this.grid.query(p,y,x,M).concat(this.ignoredGrid.query(p,y,x,M)),z={},R={};for(const j of E){const N=j.key;if(z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]={}),z[N.bucketInstanceId][N.featureIndex])continue;const G=[new s.P(j.x1,j.y1),new s.P(j.x2,j.y1),new s.P(j.x2,j.y2),new s.P(j.x1,j.y2)];s.aL(n,G)&&(z[N.bucketInstanceId][N.featureIndex]=!0,R[N.bucketInstanceId]===void 0&&(R[N.bucketInstanceId]=[]),R[N.bucketInstanceId].push(N.featureIndex))}return R}insertCollisionBox(t,n,u,p,y,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:x,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,u,p,y,x){const M=u?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:y,collisionGroupID:x,overlapMode:n};for(let z=0;z<t.length;z+=4)M.insertCircle(E,t[z],t[z+1],t[z+2])}projectAndGetPerspectiveRatio(t,n,u,p,y){if(y){let x;p?(x=[t,n,p(t,n),1],s.aI(x,x,y)):(x=[t,n,0,1],oa(x,x,y));const M=x[3];return{x:(x[0]/M+1)/2*this.transform.width+wi,y:(-x[1]/M+1)/2*this.transform.height+wi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M*.5,isOccluded:!1,signedDistanceFromCamera:M}}{const x=this.transform.projectTileCoordinates(t,n,u,p);return{x:(x.point.x+1)/2*this.transform.width+wi,y:(1-x.point.y)/2*this.transform.height+wi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(t,n,u,p){const y=this.transform.projectTileCoordinates(t,n,u,p);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(t,n,u,p){return u<wi||t>=this.screenRightBoundary||p<wi||n>this.screenBottomBoundary}isInsideGrid(t,n,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=s.as([]);return s.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,n,u,p,y,x,M,E,z,R,j){let N=1,G=0,X=0,ie=1;const ne=t.anchorPointX+M[0],re=t.anchorPointY+M[1];if(x&&!y){const et=this.projectAndGetPerspectiveRatio(ne+1,re,p,z,j),We=et.x-E.x,gt=Math.atan((et.y-E.y)/We)+(We<0?Math.PI:0),zt=Math.sin(gt),di=Math.cos(gt);N=di,G=zt,X=-zt,ie=di}else if(!x&&y){const et=uo(this.transform);N=et.vecEast[0],G=et.vecEast[1],X=et.vecSouth[0],ie=et.vecSouth[1]}let ae=E.x,he=E.y,se=n;y&&(ae=ne,he=re,se=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),se*=this.transform.getPitchedTextCorrection(ne,re,p),R||(se*=s.ao(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),R&&(ae+=N*R.x*se+X*R.y*se,he+=G*R.x*se+ie*R.y*se);const de=t.x1*se,ve=t.x2*se,ce=(de+ve)/2,Te=t.y1*se,Re=t.y2*se,Ce=(Te+Re)/2,ze=[{offsetX:de,offsetY:Te},{offsetX:ce,offsetY:Te},{offsetX:ve,offsetY:Te},{offsetX:ve,offsetY:Ce},{offsetX:ve,offsetY:Re},{offsetX:ce,offsetY:Re},{offsetX:de,offsetY:Re},{offsetX:de,offsetY:Ce}];let Oe=[];for(const{offsetX:et,offsetY:We}of ze)Oe.push(new s.P(ae+N*et+X*We,he+G*et+ie*We));let He=!1;if(y){const et=Oe.map((We=>this.projectAndGetPerspectiveRatio(We.x,We.y,p,z,j)));He=et.some((We=>!We.isOccluded)),Oe=et.map((We=>new s.P(We.x,We.y)))}else He=!0;return{box:s.aM(Oe),allPointsOccluded:!He}}}class el{constructor(t,n,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Nt{constructor(t,n,u,p,y){this.text=new el(t?t.text:null,n,u,y),this.icon=new el(t?t.icon:null,n,p,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gi{constructor(t,n,u){this.text=t,this.icon=n,this.skipFade=u}}class tl{constructor(t,n,u,p,y){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=y}}class vs{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:u=>u.collisionGroupID===n}}return this.collisionGroups[t]}}function Hr(g,t,n,u,p){const{horizontalAlign:y,verticalAlign:x}=s.aT(g);return new s.P(-(y-.5)*t+u[0]*p,-(x-.5)*n+u[1]*p)}class Dl{constructor(t,n,u,p,y){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new aa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new vs(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const n=this.terrain;return n?(u,p)=>n.getElevation(t,u,p):null}getBucketParts(t,n,u,p){const y=u.getBucket(n),x=u.latestFeatureIndex;if(!y||!x||n.id!==y.layerIds[0])return;const M=u.collisionBoxArray,E=y.layers[0].layout,z=y.layers[0].paint,R=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),j=u.tileSize/s.a5,N=u.tileID.toUnwrapped(),G=E.get("text-rotation-alignment")==="map",X=s.aO(u,1,this.transform.zoom),ie=s.aP(this.collisionIndex.transform,u,z.get("text-translate"),z.get("text-translate-anchor")),ne=s.aP(this.collisionIndex.transform,u,z.get("icon-translate"),z.get("icon-translate-anchor")),re=rn(G,this.transform,X);this.retainedQueryData[y.bucketInstanceId]=new tl(y.bucketInstanceId,x,y.sourceLayerIndex,y.index,u.tileID);const ae={bucket:y,layout:E,translationText:ie,translationIcon:ne,unwrappedTileID:N,pitchedLabelPlaneMatrix:re,scale:R,textPixelRatio:j,holdingForFade:u.holdingForSymbolFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:s.az(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(p)for(const he of y.sortKeyRanges){const{sortKey:se,symbolInstanceStart:de,symbolInstanceEnd:ve}=he;t.push({sortKey:se,symbolInstanceStart:de,symbolInstanceEnd:ve,parameters:ae})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(t,n,u,p,y,x,M,E,z,R,j,N,G,X,ie,ne,re,ae,he,se){const de=s.aQ[t.textAnchor],ve=[t.textOffset0,t.textOffset1],ce=Hr(de,u,p,ve,y),Te=this.collisionIndex.placeCollisionBox(n,N,E,z,R,M,x,ne,j.predicate,he,ce,se);if((!ae||this.collisionIndex.placeCollisionBox(ae,N,E,z,R,M,x,re,j.predicate,he,ce,se).placeable)&&Te.placeable){let Re;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Re=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:ve,width:u,height:p,anchor:de,textBoxScale:y,prevAnchor:Re},this.markUsedJustification(X,de,G,ie),X.allowVerticalPlacement&&(this.markUsedOrientation(X,ie,G),this.placedOrientations[G.crossTileID]=ie),{shift:ce,placedGlyphBoxes:Te}}}placeLayerBucketPart(t,n,u){const{bucket:p,layout:y,translationText:x,translationIcon:M,unwrappedTileID:E,pitchedLabelPlaneMatrix:z,textPixelRatio:R,holdingForFade:j,collisionBoxArray:N,partiallyEvaluatedTextSize:G,collisionGroup:X}=t.parameters,ie=y.get("text-optional"),ne=y.get("icon-optional"),re=s.aR(y,"text-overlap","text-allow-overlap"),ae=re==="always",he=s.aR(y,"icon-overlap","icon-allow-overlap"),se=he==="always",de=y.get("text-rotation-alignment")==="map",ve=y.get("text-pitch-alignment")==="map",ce=y.get("icon-text-fit")!=="none",Te=y.get("symbol-z-order")==="viewport-y",Re=ae&&(se||!p.hasIconData()||ne),Ce=se&&(ae||!p.hasTextData()||ie);!p.collisionArrays&&N&&p.deserializeCollisionBoxes(N);const ze=this.retainedQueryData[p.bucketInstanceId].tileID,Oe=this._getTerrainElevationFunc(ze),He=this.transform.getFastPathSimpleProjectionMatrix(ze),et=(We,gt,zt)=>{var di,ki;if(n[We.crossTileID])return;if(j)return void(this.placements[We.crossTileID]=new Gi(!1,!1,!1));let yi=!1,Ni=!1,Ai=!0,Lr=null,Ri={box:null,placeable:!1,offscreen:null,occluded:!1},vr={placeable:!1},nr=null,or=null,Kr=null,Tn=0,Ho=0,os=0;gt.textFeatureIndex?Tn=gt.textFeatureIndex:We.useRuntimeCollisionCircles&&(Tn=We.featureIndex),gt.verticalTextFeatureIndex&&(Ho=gt.verticalTextFeatureIndex);const Vs=gt.textBox;if(Vs){const Br=xr=>{let kr=s.aA.horizontal;if(p.allowVerticalPlacement&&!xr&&this.prevPlacement){const Zn=this.prevPlacement.placedOrientations[We.crossTileID];Zn&&(this.placedOrientations[We.crossTileID]=Zn,kr=Zn,this.markUsedOrientation(p,kr,We))}return kr},sn=(xr,kr)=>{if(p.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&gt.verticalTextBox){for(const Zn of p.writingModes)if(Zn===s.aA.vertical?(Ri=kr(),vr=Ri):Ri=xr(),Ri&&Ri.placeable)break}else Ri=xr()},Jr=We.textAnchorOffsetStartIndex,oo=We.textAnchorOffsetEndIndex;if(oo===Jr){const xr=(kr,Zn)=>{const Hi=this.collisionIndex.placeCollisionBox(kr,re,R,ze,E,ve,de,x,X.predicate,Oe,void 0,He);return Hi&&Hi.placeable&&(this.markUsedOrientation(p,Zn,We),this.placedOrientations[We.crossTileID]=Zn),Hi};sn((()=>xr(Vs,s.aA.horizontal)),(()=>{const kr=gt.verticalTextBox;return p.allowVerticalPlacement&&We.numVerticalGlyphVertices>0&&kr?xr(kr,s.aA.vertical):{box:null,offscreen:null}})),Br(Ri&&Ri.placeable)}else{let xr=s.aQ[(ki=(di=this.prevPlacement)===null||di===void 0?void 0:di.variableOffsets[We.crossTileID])===null||ki===void 0?void 0:ki.anchor];const kr=(Hi,Xd,Mp)=>{const ph=Hi.x2-Hi.x1,Ip=Hi.y2-Hi.y1,Us=We.textBoxScale,Zs=ce&&he==="never"?Xd:null;let as=null,Ap=re==="never"?1:2,ac="never";xr&&Ap++;for(let dh=0;dh<Ap;dh++){for(let bl=Jr;bl<oo;bl++){const fh=p.textAnchorOffsets.get(bl);if(xr&&fh.textAnchor!==xr)continue;const mh=this.attemptAnchorPlacement(fh,Hi,ph,Ip,Us,de,ve,R,ze,E,X,ac,We,p,Mp,x,M,Zs,Oe);if(mh&&(as=mh.placedGlyphBoxes,as&&as.placeable))return yi=!0,Lr=mh.shift,as}xr?xr=null:ac=re}return u&&!as&&(as={box:this.collisionIndex.placeCollisionBox(Vs,"always",R,ze,E,ve,de,x,X.predicate,Oe,void 0,He).box,offscreen:!1,placeable:!1,occluded:!1}),as};sn((()=>kr(Vs,gt.iconBox,s.aA.horizontal)),(()=>{const Hi=gt.verticalTextBox;return p.allowVerticalPlacement&&(!Ri||!Ri.placeable)&&We.numVerticalGlyphVertices>0&&Hi?kr(Hi,gt.verticalIconBox,s.aA.vertical):{box:null,occluded:!0,offscreen:null}})),Ri&&(yi=Ri.placeable,Ai=Ri.offscreen);const Zn=Br(Ri&&Ri.placeable);if(!yi&&this.prevPlacement){const Hi=this.prevPlacement.variableOffsets[We.crossTileID];Hi&&(this.variableOffsets[We.crossTileID]=Hi,this.markUsedJustification(p,Hi.anchor,We,Zn))}}}if(nr=Ri,yi=nr&&nr.placeable,Ai=nr&&nr.offscreen,We.useRuntimeCollisionCircles&&We.centerJustifiedTextSymbolIndex>=0){const Br=p.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex),sn=s.aB(p.textSizeData,G,Br),Jr=y.get("text-padding");or=this.collisionIndex.placeCollisionCircles(re,Br,p.lineVertexArray,p.glyphOffsetArray,sn,E,z,u,ve,X.predicate,We.collisionCircleDiameter,Jr,x,Oe),or.circles.length&&or.collisionDetected&&!u&&s.w("Collisions detected, but collision boxes are not shown"),yi=ae||or.circles.length>0&&!or.collisionDetected,Ai=Ai&&or.offscreen}if(gt.iconFeatureIndex&&(os=gt.iconFeatureIndex),gt.iconBox){const Br=sn=>this.collisionIndex.placeCollisionBox(sn,he,R,ze,E,ve,de,M,X.predicate,Oe,ce&&Lr?Lr:void 0,He);vr&&vr.placeable&&gt.verticalIconBox?(Kr=Br(gt.verticalIconBox),Ni=Kr.placeable):(Kr=Br(gt.iconBox),Ni=Kr.placeable),Ai=Ai&&Kr.offscreen}const oc=ie||We.numHorizontalGlyphVertices===0&&We.numVerticalGlyphVertices===0,xl=ne||We.numIconVertices===0;oc||xl?xl?oc||(Ni=Ni&&yi):yi=Ni&&yi:Ni=yi=Ni&&yi;const Xo=Ni&&Kr.placeable;if(yi&&nr.placeable&&this.collisionIndex.insertCollisionBox(nr.box,re,y.get("text-ignore-placement"),p.bucketInstanceId,vr&&vr.placeable&&Ho?Ho:Tn,X.ID),Xo&&this.collisionIndex.insertCollisionBox(Kr.box,he,y.get("icon-ignore-placement"),p.bucketInstanceId,os,X.ID),or&&yi&&this.collisionIndex.insertCollisionCircles(or.circles,re,y.get("text-ignore-placement"),p.bucketInstanceId,Tn,X.ID),u&&this.storeCollisionData(p.bucketInstanceId,zt,gt,nr,Kr,or),We.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[We.crossTileID]=new Gi((yi||Re)&&!nr?.occluded,(Ni||Ce)&&!Kr?.occluded,Ai||p.justReloaded),n[We.crossTileID]=!0};if(Te){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const We=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let gt=We.length-1;gt>=0;--gt){const zt=We[gt];et(p.symbolInstances.get(zt),p.collisionArrays[zt],zt)}}else for(let We=t.symbolInstanceStart;We<t.symbolInstanceEnd;We++)et(p.symbolInstances.get(We),p.collisionArrays[We],We);p.justReloaded=!1}storeCollisionData(t,n,u,p,y,x){if(u.textBox||u.iconBox){let M,E;this.collisionBoxArrays.has(t)?M=this.collisionBoxArrays.get(t):(M=new Map,this.collisionBoxArrays.set(t,M)),M.has(n)?E=M.get(n):(E={text:null,icon:null},M.set(n,E)),u.textBox&&(E.text=p.box),u.iconBox&&(E.icon=y.box)}if(x){let M=this.collisionCircleArrays[t];M===void 0&&(M=this.collisionCircleArrays[t]=[]);for(let E=0;E<x.circles.length;E+=4)M.push(x.circles[E+0]-wi),M.push(x.circles[E+1]-wi),M.push(x.circles[E+2]),M.push(x.collisionDetected?1:0)}}markUsedJustification(t,n,u,p){let y;y=p===s.aA.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[s.aS(n)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const M of x)M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=y>=0&&M!==y?0:u.crossTileID)}markUsedOrientation(t,n,u){const p=n===s.aA.horizontal||n===s.aA.horizontalOnly?n:0,y=n===s.aA.vertical?n:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const M of x)t.text.placedSymbolArray.get(M).placedOrientation=p;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let u=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const p=n?n.symbolFadeChange(t):1,y=n?n.opacities:{},x=n?n.variableOffsets:{},M=n?n.placedOrientations:{};for(const E in this.placements){const z=this.placements[E],R=y[E];R?(this.opacities[E]=new Nt(R,p,z.text,z.icon),u=u||z.text!==R.text.placed||z.icon!==R.icon.placed):(this.opacities[E]=new Nt(null,p,z.text,z.icon,z.skipFade),u=u||z.text||z.icon)}for(const E in y){const z=y[E];if(!this.opacities[E]){const R=new Nt(z,p,!1,!1);R.isHidden()||(this.opacities[E]=R,u=u||z.text.placed||z.icon.placed)}}for(const E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(const E in M)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=M[E]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const u={};for(const p of n){const y=p.getBucket(t);y&&p.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,p.tileID,u,p.collisionBoxArray)}}updateBucketOpacities(t,n,u,p){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const y=t.layers[0],x=y.layout,M=new Nt(null,0,!1,!1,!0),E=x.get("text-allow-overlap"),z=x.get("icon-allow-overlap"),R=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=x.get("text-rotation-alignment")==="map",N=x.get("text-pitch-alignment")==="map",G=x.get("icon-text-fit")!=="none",X=new Nt(null,0,E&&(z||!t.hasIconData()||x.get("icon-optional")),z&&(E||!t.hasTextData()||x.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const ie=(re,ae,he)=>{for(let se=0;se<ae/4;se++)re.opacityVertexArray.emplaceBack(he);re.hasVisibleVertices=re.hasVisibleVertices||he!==la},ne=this.collisionBoxArrays.get(t.bucketInstanceId);for(let re=0;re<t.symbolInstances.length;re++){const ae=t.symbolInstances.get(re),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:se,crossTileID:de}=ae;let ve=this.opacities[de];u[de]?ve=M:ve||(ve=X,this.opacities[de]=ve),u[de]=!0;const ce=ae.numIconVertices>0,Te=this.placedOrientations[ae.crossTileID],Re=Te===s.aA.vertical,Ce=Te===s.aA.horizontal||Te===s.aA.horizontalOnly;if(he>0||se>0){const Oe=xs(ve.text);ie(t.text,he,Re?la:Oe),ie(t.text,se,Ce?la:Oe);const He=ve.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach((gt=>{gt>=0&&(t.text.placedSymbolArray.get(gt).hidden=He||Re?1:0)})),ae.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=He||Ce?1:0);const et=this.variableOffsets[ae.crossTileID];et&&this.markUsedJustification(t,et.anchor,ae,Te);const We=this.placedOrientations[ae.crossTileID];We&&(this.markUsedJustification(t,"left",ae,We),this.markUsedOrientation(t,We,ae))}if(ce){const Oe=xs(ve.icon),He=!(G&&ae.verticalPlacedIconSymbolIndex&&Re);ae.placedIconSymbolIndex>=0&&(ie(t.icon,ae.numIconVertices,He?Oe:la),t.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=ve.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(ie(t.icon,ae.numVerticalIconVertices,He?la:Oe),t.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=ve.icon.isHidden())}const ze=ne&&ne.has(re)?ne.get(re):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Oe=t.collisionArrays[re];if(Oe){let He=new s.P(0,0);if(Oe.textBox||Oe.verticalTextBox){let et=!0;if(R){const We=this.variableOffsets[de];We?(He=Hr(We.anchor,We.width,We.height,We.textOffset,We.textBoxScale),j&&He._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):et=!1}if(Oe.textBox||Oe.verticalTextBox){let We;Oe.textBox&&(We=Re),Oe.verticalTextBox&&(We=Ce),Na(t.textCollisionBox.collisionVertexArray,ve.text.placed,!et||We,ze.text,He.x,He.y)}}if(Oe.iconBox||Oe.verticalIconBox){const et=!!(!Ce&&Oe.verticalIconBox);let We;Oe.iconBox&&(We=et),Oe.verticalIconBox&&(We=!et),Na(t.iconCollisionBox.collisionVertexArray,ve.icon.placed,We,ze.icon,G?He.x:0,G?He.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const u=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Na(g,t,n,u,p,y){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-wi,M=u[1]-wi,E=u[2]-wi,z=u[3]-wi;g.emplaceBack(t?1:0,n?1:0,p||0,y||0,x,M),g.emplaceBack(t?1:0,n?1:0,p||0,y||0,E,M),g.emplaceBack(t?1:0,n?1:0,p||0,y||0,E,z),g.emplaceBack(t?1:0,n?1:0,p||0,y||0,x,z)}const ho=Math.pow(2,25),$i=Math.pow(2,24),sa=Math.pow(2,17),po=Math.pow(2,16),Bo=Math.pow(2,9),il=Math.pow(2,8),Kn=Math.pow(2,1);function xs(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const t=g.placed?1:0,n=Math.floor(127*g.opacity);return n*ho+t*$i+n*sa+t*po+n*Bo+t*il+n*Kn+t}const la=0;class Rn{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,u,p,y){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(x,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort(((M,E)=>M.sortKey-E.sortKey)));this._currentPartIndex<x.length;)if(n.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1}}class Oo{constructor(t,n,u,p,y,x,M,E){this.placement=new Dl(t,n,x,M,E),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,n,u){const p=be(),y=()=>!this._forceFullPlacement&&be()-p>2;for(;this._currentPlacementIndex>=0;){const x=n[t[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=M)&&(!x.maxzoom||x.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Rn(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ft=512/s.a5/2;class ja{constructor(t,n,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const p=new Map;for(let y=0;y<n.length;y++){const x=n.get(y),M=x.key,E=p.get(M);E?E.push(x):p.set(M,[x])}for(const[y,x]of p){const M={positions:x.map((E=>({x:Math.floor(E.anchorX*Ft),y:Math.floor(E.anchorY*Ft)}))),crossTileIDs:x.map((E=>E.crossTileID))};if(M.positions.length>128){const E=new s.aU(M.positions.length,16,Uint16Array);for(const{x:z,y:R}of M.positions)E.add(z,R);E.finish(),delete M.positions,M.index=E}this._symbolsByKey[y]=M}}getScaledCoordinates(t,n){const{x:u,y:p,z:y}=this.tileID.canonical,{x,y:M,z:E}=n.canonical,z=Ft/Math.pow(2,E-y),R=(M*s.a5+t.anchorY)*z,j=p*s.a5*Ft;return{x:Math.floor((x*s.a5+t.anchorX)*z-u*s.a5*Ft),y:Math.floor(R-j)}}findMatches(t,n,u){const p=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let y=0;y<t.length;y++){const x=t.get(y);if(x.crossTileID)continue;const M=this._symbolsByKey[x.key];if(!M)continue;const E=this.getScaledCoordinates(x,n);if(M.index){const z=M.index.range(E.x-p,E.y-p,E.x+p,E.y+p).sort();for(const R of z){const j=M.crossTileIDs[R];if(!u[j]){u[j]=!0,x.crossTileID=j;break}}}else if(M.positions)for(let z=0;z<M.positions.length;z++){const R=M.positions[z],j=M.crossTileIDs[z];if(Math.abs(R.x-E.x)<=p&&Math.abs(R.y-E.y)<=p&&!u[j]){u[j]=!0,x.crossTileID=j;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class Iu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const u in this.indexes){const p=this.indexes[u],y={};for(const x in p){const M=p[x];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+n),y[M.tileID.key]=M}this.indexes[u]=y}this.lng=t}addBucket(t,n,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<n.symbolInstances.length;y++)n.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const x=this.indexes[y];if(Number(y)>t.overscaledZ)for(const M in x){const E=x[M];E.tileID.isChildOf(t)&&E.findMatches(n.symbolInstances,t,p)}else{const M=x[t.scaledTo(Number(y)).key];M&&M.findMatches(n.symbolInstances,t,p)}}for(let y=0;y<n.symbolInstances.length;y++){const x=n.symbolInstances.get(y);x.crossTileID||(x.crossTileID=u.generate(),p[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ja(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const u of n.getCrossTileIDsLists())for(const p of u)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let n=!1;for(const u in this.indexes){const p=this.indexes[u];for(const y in p)t[p[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[y]),delete p[y],n=!0)}return n}}class nn{constructor(){this.layerIndexes={},this.crossTileIDs=new Iu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,u){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new bs);let y=!1;const x={};p.handleWrapJump(u);for(const M of n){const E=M.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(M.tileID,E,this.crossTileIDs)&&(y=!0),x[E.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(y=!0),y}pruneUnusedLayers(t){const n={};t.forEach((u=>{n[u]=!0}));for(const u in this.layerIndexes)n[u]||delete this.layerIndexes[u]}}var Tt="void main() {fragColor=vec4(1.0);}";const ni={prelude:pt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:pt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:pt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:pt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:pt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:pt(Tt,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:pt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:pt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:pt(Tt,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:pt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:pt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:pt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:pt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:pt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:pt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:pt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:pt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:pt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:pt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:pt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:pt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:pt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:pt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:pt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:pt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:pt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:pt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:pt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:pt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function pt(g,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/in ([\w]+) ([\w]+)/g),p=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=y?y.concat(p):p,M={};return{fragmentSource:g=g.replace(n,((E,z,R,j,N)=>(M[N]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${R} ${j} ${N};
#else
uniform ${R} ${j} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${R} ${j} ${N} = u_${N};
#endif
`))),vertexSource:t=t.replace(n,((E,z,R,j,N)=>{const G=j==="float"?"vec2":"vec4",X=N.match(/color/)?"color":G;return M[N]?z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${R} ${G} a_${N};
out ${R} ${j} ${N};
#else
uniform ${R} ${j} u_${N};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${R} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);
#else
    ${R} ${j} ${N} = u_${N};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${R} ${G} a_${N};
#else
uniform ${R} ${j} u_${N};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${R} ${j} ${N} = a_${N};
#else
    ${R} ${j} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${R} ${j} ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);
#else
    ${R} ${j} ${N} = u_${N};
#endif
`})),staticAttributes:u,staticUniforms:x}}class _i{constructor(t,n,u){this.vertexBuffer=t,this.indexBuffer=n,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Jn=s.aV([{name:"a_pos",type:"Int16",components:2}]);const Er="#define PROJECTION_MERCATOR",Xr="mercator";class Yi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Xr}get shaderDefine(){return Er}get shaderPreludeCode(){return ni.projectionMercator}get vertexShaderPreludeCode(){return ni.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aW.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,n,u,p,y){if(this._cachedMesh)return this._cachedMesh;const x=new s.aX;x.emplaceBack(0,0),x.emplaceBack(s.a5,0),x.emplaceBack(0,s.a5),x.emplaceBack(s.a5,s.a5);const M=t.createVertexBuffer(x,Jn.members),E=s.aY.simpleSegment(0,0,4,2),z=new s.aZ;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const R=t.createIndexBuffer(z);return this._cachedMesh=new _i(M,R,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class No{constructor(t=0,n=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=u,this.right=p}interpolate(t,n,u){return n.top!=null&&t.top!=null&&(this.top=s.G.number(t.top,n.top,u)),n.bottom!=null&&t.bottom!=null&&(this.bottom=s.G.number(t.bottom,n.bottom,u)),n.left!=null&&t.left!=null&&(this.left=s.G.number(t.left,n.left,u)),n.right!=null&&t.right!=null&&(this.right=s.G.number(t.right,n.right,u)),this}getCenter(t,n){const u=s.ao((this.left+t-this.right)/2,0,t),p=s.ao((this.top+n-this.bottom)/2,0,n);return new s.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new No(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function An(g,t){if(!g.renderWorldCopies||g.lngRange)return;const n=t.lng-g.center.lng;t.lng+=n>180?-360:n<-180?360:0}function Xt(g){return Math.max(0,Math.floor(g))}class gn{constructor(t,n){var u;this.applyConstrain=(p,y)=>this._constrainOverride!==null?this._constrainOverride(p,y):this._callbacks.defaultConstrain(p,y),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=n?.renderWorldCopies===void 0||!!n?.renderWorldCopies,this._minZoom=n?.minZoom||0,this._maxZoom=n?.maxZoom||22,this._minPitch=n?.minPitch==null?0:n?.minPitch,this._maxPitch=n?.maxPitch==null?60:n?.maxPitch,this._constrainOverride=(u=n?.constrainOverride)!==null&&u!==void 0?u:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Xt(this._zoom),this._scale=s.ar(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new No,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,n,u){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Xt(this._zoom),this._scale=s.ar(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new No(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!u&&t.autoCalculateNearFarZ,n&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const n=s.W(t,-180,180)*Math.PI/180;var u,p,y,x,M,E,z,R,j;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=$(),u=this._rotationMatrix,y=-this._bearingInRadians,x=(p=this._rotationMatrix)[0],M=p[1],E=p[2],z=p[3],R=Math.sin(y),j=Math.cos(y),u[0]=x*j+E*R,u[1]=M*j+z*R,u[2]=x*-R+E*j,u[3]=M*-R+z*j)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const n=s.ao(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const n=t/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.a_(this._fovInRadians)}setFov(t){t=s.ao(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=s.aq(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const n=this.applyConstrain(this._center,t).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=s.ar(n),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,n){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,u){this._unmodified=!1,this._edgeInsets.interpolate(t,n,u),this.constrainInternal(),this._calcMatrices()}resize(t,n,u=!0){this._width=t,this._height=n,u&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Li([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-s.ap,s.ap])}getCameraQueryGeometry(t,n){if(n.length===1)return[n[0],t];{const{minX:u,minY:p,maxX:y,maxY:x}=s.ac.fromPoints(n).extend(t);return[new s.P(u,p),new s.P(y,p),new s.P(y,x),new s.P(u,x),new s.P(u,p)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:n,zoom:u}=this.applyConstrain(this.center,this.zoom);this.setCenter(n),this.setZoom(u),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=s.as(new Float64Array(16));s.Q(t,t,[this._width/2,-this._height/2,1]),s.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=s.as(new Float64Array(16)),s.Q(t,t,[1,-1,1]),s.O(t,t,[-1,-1,0]),s.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,n,u,p){const y=u!==void 0?u:this.bearing,x=p=p!==void 0?p:this.pitch,{distanceToCenter:M,clampedElevation:E}=this._distanceToCenterFromAltElevationPitch(n,this.elevation,x),{x:z,y:R}=vi(x,y),j=s.ab.fromLngLat(t,n);let N,G,X=s.a$(1,j.y),ie=0;do{if(ie+=1,ie>10)break;G=M/X,N=new s.ab(j.x+z*G,j.y+R*G),X=1/N.meterInMercatorCoordinateUnits()}while(Math.abs(M-G*X)>1e-12);return{center:N.toLngLat(),elevation:E,zoom:s.au(this.height/2/Math.tan(this.fovInRadians/2)/G/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const n=1/this.worldSize,u=s.at(1,this.center.lat)*this.worldSize,p=s.ab.fromLngLat(this.center,this.elevation),y=p.x/n,x=p.y/n,M=p.z/n,E=this.pitch,z=this.bearing,{x:R,y:j,z:N}=vi(E,z),G=this.cameraToCenterDistance,X=y+G*-R,ie=x+G*-j,ne=M+G*N,{distanceToCenter:re,clampedElevation:ae}=this._distanceToCenterFromAltElevationPitch(ne/u,t,E),he=re*u,se=new s.ab((X+R*he)*n,(ie+j*he)*n,0).toLngLat(),de=s.at(1,se.lat),ve=s.au(this.height/2/Math.tan(this.fovInRadians/2)/re/de/this.tileSize);this._elevation=ae,this._center=se,this.setZoom(ve)}_distanceToCenterFromAltElevationPitch(t,n,u){const p=-Math.cos(s.aq(u)),y=t-n;let x,M=n;return p*y>=0||Math.abs(p)<.1?(x=1e4,M=t+x*p):x=-y/p,{distanceToCenter:x,clampedElevation:M}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=s.at(1,this.center.lat)*this.worldSize;return Le(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const n=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/n,t.canonical.y/n,1/n/s.a5,1/n/s.a5]}}class Fn{constructor(t,n){this.min=t,this.max=n,this.center=s.b0([],s.b1([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],u=s.b2(this.min),p=s.b2(this.max);for(let y=0;y<n.length;y++)u[y]=n[y]?this.min[y]:this.center[y],p[y]=n[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Fn(u,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let n=!0;for(let u=0;u<t.planes.length;u++){const p=this.intersectsPlane(t.planes[u]);if(p===0)return 0;p===1&&(n=!1)}return n?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let n=t[3],u=t[3];for(let p=0;p<3;p++)t[p]>0?(n+=t[p]*this.min[p],u+=t[p]*this.max[p]):(u+=t[p]*this.min[p],n+=t[p]*this.max[p]);return n>=0?2:u<0?0:1}}class ws{distanceToTile2d(t,n,u,p){const y=p.distanceX([t,n]),x=p.distanceY([t,n]);return Math.hypot(y,x)}getWrap(t,n,u){return u}getTileBoundingVolume(t,n,u,p){var y,x;let M=0,E=0;if(p?.terrain){const R=new s.a2(t.z,n,t.z,t.x,t.y),j=p.terrain.getMinMaxElevation(R);M=(y=j.minElevation)!==null&&y!==void 0?y:Math.min(0,u),E=(x=j.maxElevation)!==null&&x!==void 0?x:Math.max(0,u)}const z=1<<t.z;return new Fn([n+t.x/z,t.y/z,M],[n+(t.x+1)/z,(t.y+1)/z,E])}allowVariableZoom(t,n){const u=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,p=s.ao(78.5-u/2,0,60);return!!n.terrain||t.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class on{constructor(t,n,u){this.points=t,this.planes=n,this.aabb=u}static fromInvProjectionMatrix(t,n=1,u=0,p,y){const x=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],M=Math.pow(2,u),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((N=>(function(G,X,ie,ne){const re=s.aI([],G,X),ae=1/re[3]/ie*ne;return s.b7(re,re,[ae,ae,1/re[3],ae])})(N,t,n,M)));p&&(function(N,G,X,ie){const ne=ie?4:0,re=ie?0:4;let ae=0;const he=[],se=[];for(let ce=0;ce<4;ce++){const Te=s.b3([],N[ce+re],N[ce+ne]),Re=s.b8(Te);s.b0(Te,Te,1/Re),he.push(Re),se.push(Te)}for(let ce=0;ce<4;ce++){const Te=s.b9(N[ce+ne],se[ce],X);ae=Te!==null&&Te>=0?Math.max(ae,Te):Math.max(ae,he[ce])}const de=(function(ce,Te){const Re=s.b3([],ce[Te[0]],ce[Te[1]]),Ce=s.b3([],ce[Te[2]],ce[Te[1]]),ze=[0,0,0,0];return s.b4(ze,s.b5([],Re,Ce)),ze[3]=-s.b6(ze,ce[Te[0]]),ze})(N,G),ve=(function(ce,Te){const Re=s.ba(ce),Ce=s.bb([],ce,1/Re),ze=s.b3([],Te,s.b0([],Ce,s.b6(Te,Ce))),Oe=s.ba(ze);if(Oe>0){const He=Math.sqrt(1-Ce[3]*Ce[3]),et=s.b0([],Ce,-Ce[3]),We=s.b1([],et,s.b0([],ze,He/Oe));return s.bc(Te,We)}return null})(X,de);if(ve!==null){const ce=ve/s.b6(se[0],de);ae=Math.min(ae,ce)}for(let ce=0;ce<4;ce++){const Te=Math.min(ae,he[ce]);N[ce+re]=[N[ce+ne][0]+se[ce][0]*Te,N[ce+ne][1]+se[ce][1]*Te,N[ce+ne][2]+se[ce][2]*Te,1]}})(E,x[0],p,y);const z=x.map((N=>{const G=s.b3([],E[N[0]],E[N[1]]),X=s.b3([],E[N[2]],E[N[1]]),ie=s.b4([],s.b5([],G,X)),ne=-s.b6(ie,E[N[1]]);return ie.concat(ne)})),R=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],j=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const N of E)for(let G=0;G<3;G++)R[G]=Math.min(R[G],N[G]),j[G]=Math.max(j[G],N[G]);return new on(E,z,new Fn(R,j))}}class jo{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,u){return this._helper.interpolatePadding(t,n,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,u=!0){this._helper.resize(t,n,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,n){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(n,u)=>{u=s.ao(+u,this.minZoom,this.maxZoom);const p={center:new s.V(n.lng,n.lat),zoom:u};let y=this._helper._lngRange;if(!this._helper._renderWorldCopies&&y===null){const se=179.9999999999;y=[-se,se]}const x=this.tileSize*s.ar(p.zoom);let M=0,E=x,z=0,R=x,j=0,N=0;const{x:G,y:X}=this.size;if(this._helper._latRange){const se=this._helper._latRange;M=s.X(se[1])*x,E=s.X(se[0])*x,E-M<X&&(j=X/(E-M))}y&&(z=s.W(s.Y(y[0])*x,0,x),R=s.W(s.Y(y[1])*x,0,x),R<z&&(R+=x),R-z<G&&(N=G/(R-z)));const{x:ie,y:ne}=_t(x,n);let re,ae;const he=Math.max(N||0,j||0);if(he){const se=new s.P(N?(R+z)/2:ie,j?(E+M)/2:ne);return p.center=At(x,se).wrap(),p.zoom+=s.au(he),p}if(this._helper._latRange){const se=X/2;ne-se<M&&(ae=M+se),ne+se>E&&(ae=E-se)}if(y){const se=(z+R)/2;let de=ie;this._helper._renderWorldCopies&&(de=s.W(ie,se-x/2,se+x/2));const ve=G/2;de-ve<z&&(re=z+ve),de+ve>R&&(re=R-ve)}if(re!==void 0||ae!==void 0){const se=new s.P(re??ie,ae??ne);p.center=At(x,se).wrap()}return p},this.applyConstrain=(n,u)=>this._helper.applyConstrain(n,u),this._helper=new gn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,u)=>this.defaultConstrain(n,u)},t),this._coveringTilesDetailsProvider=new ws}clone(){const t=new jo;return t.apply(this),t}apply(t,n,u){this._helper.apply(t,n,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const n=[new s.bd(0,t)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new s.P(0,0)),p=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),M=Math.floor(Math.min(u.x,p.x,y.x,x.x)),E=Math.floor(Math.max(u.x,p.x,y.x,x.x)),z=1;for(let R=M-z;R<=E+z;R++)R!==0&&n.push(new s.bd(R,t))}return n}getCameraFrustum(){return on.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const n=this.screenPointToLocation(this.centerPoint,t),u=t?t.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(t,n){const u=s.at(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(n,u),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),x=s.ab.fromLngLat(t),M=new s.ab(x.x-(p.x-y.x),x.y-(p.y-y.y));this.setCenter(M?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,n){return n?this.coordinatePoint(s.ab.fromLngLat(t),n.getElevationForLngLat(t),this._pixelMatrix3D):this.coordinatePoint(s.ab.fromLngLat(t))}screenPointToLocation(t,n){var u;return(u=this.screenPointToMercatorCoordinate(t,n))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(t,n){if(n){const u=n.pointCoordinate(t);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,n){const u=n||0,p=[t.x,t.y,0,1],y=[t.x,t.y,1,1];s.aI(p,p,this._pixelMatrixInverse),s.aI(y,y,this._pixelMatrixInverse);const x=p[3],M=y[3],E=p[1]/x,z=y[1]/M,R=p[2]/x,j=y[2]/M,N=R===j?0:(u-R)/(j-R);return new s.ab(s.G.number(p[0]/x,y[0]/M,N)/this.worldSize,s.G.number(E,z,N)/this.worldSize,u)}coordinatePoint(t,n=0,u=this._pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,n,1];return s.aI(p,p,u),new s.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this._helper._height/2-ci(this));return new Li().extend(this.screenPointToLocation(new s.P(0,t))).extend(this.screenPointToLocation(new s.P(this._helper._width,t))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(t,n){return n?n.pointCoordinate(t)!=null:t.y>this.height/2-ci(this)}calculatePosMatrix(t,n=!1,u){var p;const y=(p=t.key)!==null&&p!==void 0?p:s.be(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),x=n?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(y)){const z=x.get(y);return u?z.f32:z.f64}const M=ti(t,this.worldSize);s.S(M,n?this._alignedProjMatrix:this._viewProjMatrix,M);const E={f64:M,f32:new Float32Array(M)};return x.set(y,E),u?E.f32:E.f64}calculateFogMatrix(t){const n=t.key,u=this._fogMatrixCacheF32;if(u.has(n))return u.get(n);const p=ti(t,this.worldSize);return s.S(p,this._fogMatrix,p),u.set(n,new Float32Array(p)),u.get(n)}calculateCenterFromCameraLngLatAlt(t,n,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,u,p)}_calculateNearFarZIfNeeded(t,n,u){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=t-p*this._helper._pixelPerMeter/Math.cos(n),x=p<0?y:t,M=Math.PI/2+this.pitchInRadians,E=s.aq(this.fov)*(Math.abs(Math.cos(s.aq(this.roll)))*this.height+Math.abs(Math.sin(s.aq(this.roll)))*this.width)/this.height*(.5+u.y/this.height),z=Math.sin(E)*x/Math.sin(s.ao(Math.PI-M-E,.01,Math.PI-.01)),R=ci(this),j=Math.atan(R/this._helper.cameraToCenterDistance),N=s.aq(.75),G=j>N?2*j*(.5+u.y/(2*R)):N,X=Math.sin(G)*x/Math.sin(s.ao(Math.PI-M-G,.01,Math.PI-.01)),ie=Math.min(z,X);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*ie+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,n=_t(this.worldSize,this.center),u=n.x,p=n.y;this._helper._pixelPerMeter=s.at(1,this.center.lat)*this.worldSize;const y=s.aq(Math.min(this.pitch,ut)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let M;this._calculateNearFarZIfNeeded(x,y,t),M=new Float64Array(16),s.bf(M,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aC(this._invProjMatrix,M),M[8]=2*-t.x/this._helper._width,M[9]=2*t.y/this._helper._height,this._projectionMatrix=s.bg(M),s.Q(M,M,[1,-1,1]),s.O(M,M,[0,0,-this._helper.cameraToCenterDistance]),s.bh(M,M,-this.rollInRadians),s.bi(M,M,this.pitchInRadians),s.bh(M,M,-this.bearingInRadians),s.O(M,M,[-u,-p,0]),this._mercatorMatrix=s.Q([],M,[this.worldSize,this.worldSize,this.worldSize]),s.Q(M,M,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,M),s.O(M,M,[0,0,-this.elevation]),this._viewProjMatrix=M,this._invViewProjMatrix=s.aC([],M);const E=[0,0,-1,1];s.aI(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),s.bf(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,s.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.bh(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.bi(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.bh(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.O(this._fogMatrix,this._fogMatrix,[-u,-p,0]),s.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,M);const z=this._helper._width%2/2,R=this._helper._height%2/2,j=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),G=u-Math.round(u)+j*z+N*R,X=p-Math.round(p)+j*R+N*z,ie=new Float64Array(M);if(s.O(ie,ie,[G>.5?G-1:G,X>.5?X-1:X,0]),this._alignedProjMatrix=ie,M=s.aC(new Float64Array(16),this._pixelMatrix),!M)throw new Error("failed to invert matrix");this._pixelMatrixInverse=M,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new s.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.aI(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=s.at(1,this.center.lat)*this.worldSize;return Le(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,n){const u=s.ab.fromLngLat(t),p=[u.x*this.worldSize,u.y*this.worldSize,n,1];return s.aI(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(t){const{overscaledTileID:n,aligned:u,applyTerrainMatrix:p}=t,y=this._helper.getMercatorTileCoordinates(n),x=n?this.calculatePosMatrix(n,u,!0):null;let M;return M=n&&n.terrainRttPosMatrix32f&&p?n.terrainRttPosMatrix32f:x||s.bj(),{mainMatrix:M,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:M}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,n,u){return 1}transformLightDirection(t){return s.b2(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,n,u,p){const y=this.calculatePosMatrix(u);let x;p?(x=[t,n,p(t,n),1],s.aI(x,x,y)):(x=[t,n,0,1],oa(x,x,y));const M=x[3];return{point:new s.P(x[0]/M,x[1]/M),signedDistanceFromCamera:M,isOccluded:!1}}populateCache(t){for(const n of t)this.calculatePosMatrix(n)}getMatrixForModel(t,n){const u=s.ab.fromLngLat(t,n),p=u.meterInMercatorCoordinateUnits(),y=s.bk();return s.O(y,y,[u.x,u.y,u.z]),s.bh(y,y,Math.PI),s.bi(y,y,Math.PI/2),s.Q(y,y,[-p,p,p]),y}getProjectionDataForCustomLayer(t=!0){const n=new s.a2(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:t}),p=ti(n,this.worldSize);s.S(p,this._viewProjMatrix,p),u.tileMercatorCoords=[0,0,1,1];const y=[s.a5,s.a5,this.worldSize/this._helper.pixelsPerMeter],x=s.bl();return s.Q(x,p,y),u.fallbackMatrix=x,u.mainMatrix=x,u}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Bn(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Au(g){if(g.useSlerp)if(g.k<1){const t=s.bm(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),n=s.bm(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),u=new Float64Array(4);s.bn(u,t,n,g.k);const p=s.bo(u);g.tr.setRoll(p.roll),g.tr.setPitch(p.pitch),g.tr.setBearing(p.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(s.G.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(s.G.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(s.G.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function rl(g,t,n,u,p){const y=p.padding,x=_t(p.worldSize,n.getNorthWest()),M=_t(p.worldSize,n.getNorthEast()),E=_t(p.worldSize,n.getSouthEast()),z=_t(p.worldSize,n.getSouthWest()),R=s.aq(-u),j=x.rotate(R),N=M.rotate(R),G=E.rotate(R),X=z.rotate(R),ie=new s.P(Math.max(j.x,N.x,X.x,G.x),Math.max(j.y,N.y,X.y,G.y)),ne=new s.P(Math.min(j.x,N.x,X.x,G.x),Math.min(j.y,N.y,X.y,G.y)),re=ie.sub(ne),ae=(p.width-(y.left+y.right+t.left+t.right))/re.x,he=(p.height-(y.top+y.bottom+t.top+t.bottom))/re.y;if(he<0||ae<0)return void Bn();const se=Math.min(s.au(p.scale*Math.min(ae,he)),g.maxZoom),de=s.P.convert(g.offset),ve=new s.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(s.aq(u)),ce=de.add(ve).mult(p.scale/s.ar(se));return{center:At(p.worldSize,x.add(E).div(2).sub(ce)),zoom:se,bearing:u}}class $t{get useGlobeControls(){return!1}handlePanInertia(t,n){const u=t.mag(),p=Math.abs(ci(n));return{easingOffset:t.mult(Math.min(.75*p/u,1)),easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(t,n){t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta),t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta)}handleMapControlsPan(t,n,u){t.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(u,t.around)}cameraForBoxAndBearing(t,n,u,p,y){return rl(t,n,u,p,y)}handleJumpToCenterZoom(t,n){t.zoom!==(n.zoom!==void 0?+n.zoom:t.zoom)&&t.setZoom(+n.zoom),n.center!==void 0&&t.setCenter(s.V.convert(n.center))}handleEaseTo(t,n){const u=t.zoom,p=t.padding,y={roll:t.roll,pitch:t.pitch,bearing:t.bearing},x={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},M=n.zoom!==void 0,E=!t.isPaddingEqual(n.padding);let z=!1;const R=M?+n.zoom:t.zoom;let j=t.centerPoint.add(n.offsetAsPoint);const N=t.screenPointToLocation(j),{center:G,zoom:X}=t.applyConstrain(s.V.convert(n.center||N),R??u);An(t,G);const ie=_t(t.worldSize,N),ne=_t(t.worldSize,G).sub(ie),re=s.ar(X-u);return z=X!==u,{easeFunc:ae=>{if(z&&t.setZoom(s.G.number(u,X,ae)),s.bp(y,x)||Au({startEulerAngles:y,endEulerAngles:x,tr:t,k:ae,useSlerp:y.roll!=x.roll}),E&&(t.interpolatePadding(p,n.padding,ae),j=t.centerPoint.add(n.offsetAsPoint)),n.around)t.setLocationAtPoint(n.around,n.aroundPoint);else{const he=s.ar(t.zoom-u),se=X>u?Math.min(2,re):Math.max(.5,re),de=Math.pow(se,1-ae),ve=At(t.worldSize,ie.add(ne.mult(ae*de)).mult(he));t.setLocationAtPoint(t.renderWorldCopies?ve.wrap():ve,j)}},isZooming:z,elevationCenter:G}}handleFlyTo(t,n){const u=n.zoom!==void 0,p=t.zoom,y=t.applyConstrain(s.V.convert(n.center||n.locationAtOffset),u?+n.zoom:p),x=y.center,M=y.zoom;An(t,x);const E=_t(t.worldSize,n.locationAtOffset),z=_t(t.worldSize,x).sub(E),R=z.mag(),j=s.ar(M-p);let N;if(n.minZoom!==void 0){const G=Math.min(+n.minZoom,p,M),X=t.applyConstrain(x,G).zoom;N=s.ar(X-p)}return{easeFunc:(G,X,ie,ne)=>{t.setZoom(G===1?M:p+s.au(X));const re=G===1?x:At(t.worldSize,E.add(z.mult(ie)).mult(X));t.setLocationAtPoint(t.renderWorldCopies?re.wrap():re,ne)},scaleOfZoom:j,targetCenter:x,scaleOfMinZoom:N,pixelPathLength:R}}}class Ti{constructor(t,n,u){this.blendFunction=t,this.blendColor=n,this.mask=u}}Ti.Replace=[1,0],Ti.disabled=new Ti(Ti.Replace,s.bq.transparent,[!1,!1,!1,!1]),Ti.unblended=new Ti(Ti.Replace,s.bq.transparent,[!0,!0,!0,!0]),Ti.alphaBlended=new Ti([1,771],s.bq.transparent,[!0,!0,!0,!0]);const Rr=2305;class Zt{constructor(t,n,u){this.enable=t,this.mode=n,this.frontFace=u}}Zt.disabled=new Zt(!1,1029,Rr),Zt.backCCW=new Zt(!0,1029,Rr),Zt.frontCCW=new Zt(!0,1028,Rr);class Dt{constructor(t,n,u){this.func=t,this.mask=n,this.range=u}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const Va=7680;class Yt{constructor(t,n,u,p,y,x){this.test=t,this.ref=n,this.mask=u,this.fail=p,this.depthFail=y,this.pass=x}}Yt.disabled=new Yt({func:519,mask:0},0,0,Va,Va,Va);const Ts=new WeakMap;function _n(g){var t;if(Ts.has(g))return Ts.get(g);{const n=(t=g.getParameter(g.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ts.set(g,n),n}}class Ua{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const n=t.context,u=n.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const p=new s.aX;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const y=new s.aZ;y.emplaceBack(0,1,2),this._fullscreenTriangle=new _i(n.createVertexBuffer(p,Jn.members),n.createIndexBuffer(y),s.aY.simpleSegment(0,0,p.length,y.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(u.TEXTURE1);const x=u.createTexture();u.bindTexture(u.TEXTURE_2D,x),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),_n(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,n){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,n=t.gl;t.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,n){const u=this._cachedRenderContext.context,p=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:s.bq.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,p.TRIANGLES,Dt.disabled,Yt.disabled,Ti.unblended,Zt.disabled,((y,x)=>({u_input:y,u_output_expected:x}))(t,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&_n(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const y=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&_n(t)){const n=t.clientWaitSync(this._readbackQueue.sync,0,0);if(n===t.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ua._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let n=0;return n+=t[0]/256,n+=t[1]/65536,n+=t[2]/16777216,t[3]<127&&(n=-n),n/128}}const Vo=s.a5/128;function nl(g,t){const n=g.granularity!==void 0?Math.max(g.granularity,1):1,u=n+(g.generateBorders?2:0),p=n+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),y=u+1,x=p+1,M=g.generateBorders?-1:0,E=g.generateBorders||g.extendToNorthPole?-1:0,z=n+(g.generateBorders?1:0),R=n+(g.generateBorders||g.extendToSouthPole?1:0),j=y*x,N=u*p*6,G=y*x>65536;if(G&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const X=G||t==="32bit",ie=new Int16Array(2*j);let ne=0;for(let he=E;he<=R;he++)for(let se=M;se<=z;se++){let de=se/n*s.a5;se===-1&&(de=-Vo),se===n+1&&(de=s.a5+Vo);let ve=he/n*s.a5;he===-1&&(ve=g.extendToNorthPole?s.bs:-Vo),he===n+1&&(ve=g.extendToSouthPole?s.bt:s.a5+Vo),ie[ne++]=de,ie[ne++]=ve}const re=X?new Uint32Array(N):new Uint16Array(N);let ae=0;for(let he=0;he<p;he++)for(let se=0;se<u;se++){const de=se+1+he*y,ve=se+(he+1)*y,ce=se+1+(he+1)*y;re[ae++]=se+he*y,re[ae++]=ve,re[ae++]=de,re[ae++]=de,re[ae++]=ve,re[ae++]=ce}return{vertices:ie.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:X}}const Ss=new s.aW({fill:new s.bu(128,2),line:new s.bu(512,0),tile:new s.bu(128,32),stencil:new s.bu(128,1),circle:3});class En{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ni.projectionGlobe}get vertexShaderPreludeCode(){return ni.projectionMercator.vertexSource}get subdivisionGranularity(){return Ss}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Ua(t));const n=s.X(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(n,u),y=be();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=y);const x=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bv(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bw(x))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,n,u,p,y){const x=(y==="stencil"?Ss.stencil:Ss.tile).getGranularityForZoomLevel(n.z);return this._getMesh(t,{granularity:x,generateBorders:u,extendToNorthPole:n.y===0&&p,extendToSouthPole:n.y===(1<<n.z)-1&&p})}_getMesh(t,n){const u=this._getMeshKey(n);if(u in this._tileMeshCache)return this._tileMeshCache[u];const p=(function(y,x){const M=nl(x,"16bit"),E=s.aX.deserialize({arrayBuffer:M.vertices,length:M.vertices.byteLength/2/2}),z=s.aZ.deserialize({arrayBuffer:M.indices,length:M.indices.byteLength/2/3});return new _i(y.createVertexBuffer(E,Jn.members),y.createIndexBuffer(z),s.aY.simpleSegment(0,0,E.length,z.length))})(t,n);return this._tileMeshCache[u]=p,p}recalculate(t){}hasTransition(){const t=be();let n=!1;return n=n||(t-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Oc=new s.t({type:new s.D(s.u.projection.type)});class Rl extends s.E{constructor(t){super(),this._transitionable=new s.x(Oc,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.H(0)),this._mercatorProjection=new Yi,this._verticalPerspectiveProjection=new En}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof s.bx){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,n,u,p,y){return this.currentProjection.getMeshFromTileID(t,n,u,p,y)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function qi(g){const t=fo(g.worldSize,g.center.lat);return 2*Math.PI*t}function On(g,t,n,u,p){const y=1/(1<<p),x=t/s.a5*y+u*y,M=s.bz((g/s.a5*y+n*y)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,z=Math.cos(E),R=new Float64Array(3);return R[0]=Math.sin(M)*z,R[1]=Math.sin(E),R[2]=Math.cos(M)*z,R}function Ii(g){return(function(t,n){const u=Math.cos(n),p=new Float64Array(3);return p[0]=Math.sin(t)*u,p[1]=Math.sin(n),p[2]=Math.cos(t)*u,p})(g.lng*Math.PI/180,g.lat*Math.PI/180)}function fo(g,t){return g/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Fl(g){const t=Math.asin(g[1])/Math.PI*180,n=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(n>1e-6){const u=g[0]/n,p=Math.acos(g[2]/n),y=(u>0?p:-p)/Math.PI*180;return new s.V(s.W(y,-180,180),t)}return new s.V(0,t)}function Za(g){return Math.cos(g*Math.PI/180)}function Di(g,t){const n=Za(g),u=Za(t);return s.au(u/n)}function Eu(g,t){const n=g.rotate(t.bearingInRadians),u=t.zoom+Di(t.center.lat,0),p=s.bv(1/Za(t.center.lat),1/Za(Math.min(Math.abs(t.center.lat),60)),s.by(u,7,3,0,1)),y=360/qi({worldSize:t.worldSize,center:{lat:t.center.lat}});return new s.V(t.center.lng-n.x*y*p,s.ao(t.center.lat+n.y*y,-s.ap,s.ap))}function Bl(g){const t=.5*g,n=Math.sin(t),u=Math.cos(t);return Math.log(n+u)-Math.log(u-n)}function ol(g,t,n,u){const p=g.lat+n*u;if(Math.abs(n)>1){const y=(Math.sign(g.lat+n)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,x=Math.abs(g.lat+n)*Math.PI/180,M=Bl(y+u*(x-y)),E=Bl(y),z=Bl(x);return new s.V(g.lng+t*((M-E)/(z-E)),p)}return new s.V(g.lng+t*u,p)}class Nc{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,n,u,p){const y=`${t.z}_${t.x}_${t.y}_${p?.terrain?"t":""}`,x=this._cache.get(y);if(x)return x;const M=this._cachePrevious.get(y);if(M)return this._cache.set(y,M),M;const E=this._boundingVolumeFactory(t,n,u,p);return this._cache.set(y,E),this._hadAnyChanges=!0,E}}class ua{constructor(t,n,u,p){this.min=u,this.max=p,this.points=t,this.planes=n}static fromAabb(t,n){const u=[];for(let p=0;p<8;p++)u.push([1&~p?t[0]:n[0],(p>>1&1)==1?n[1]:t[1],(p>>2&1)==1?n[2]:t[2]]);return new ua(u,[[-1,0,0,n[0]],[1,0,0,-t[0]],[0,-1,0,n[1]],[0,1,0,-t[1]],[0,0,-1,n[2]],[0,0,1,-t[2]]],t,n)}static fromCenterSizeAngles(t,n,u){const p=s.bC([],u[0],u[1],u[2]),y=s.bD([],[n[0],0,0],p),x=s.bD([],[0,n[1],0],p),M=s.bD([],[0,0,n[2]],p),E=[...t],z=[...t];for(let j=0;j<8;j++)for(let N=0;N<3;N++){const G=t[N]+y[N]*(1&~j?-1:1)+x[N]*((j>>1&1)==1?1:-1)+M[N]*((j>>2&1)==1?1:-1);E[N]=Math.min(E[N],G),z[N]=Math.max(z[N],G)}const R=[];for(let j=0;j<8;j++){const N=[...t];s.b1(N,N,s.b0([],y,1&~j?-1:1)),s.b1(N,N,s.b0([],x,(j>>1&1)==1?1:-1)),s.b1(N,N,s.b0([],M,(j>>2&1)==1?1:-1)),R.push(N)}return new ua(R,[[...y,-s.b6(y,R[0])],[...x,-s.b6(x,R[0])],[...M,-s.b6(M,R[0])],[-y[0],-y[1],-y[2],-s.b6(y,R[7])],[-x[0],-x[1],-x[2],-s.b6(x,R[7])],[-M[0],-M[1],-M[2],-s.b6(M,R[7])]],E,z)}intersectsFrustum(t){let n=!0;const u=this.points.length,p=this.planes.length,y=t.planes.length,x=t.points.length;for(let M=0;M<y;M++){const E=t.planes[M];let z=0;for(let R=0;R<u;R++){const j=this.points[R];E[0]*j[0]+E[1]*j[1]+E[2]*j[2]+E[3]>=0&&z++}if(z===0)return 0;z<u&&(n=!1)}if(n)return 2;for(let M=0;M<p;M++){const E=this.planes[M];let z=0;for(let R=0;R<x;R++){const j=t.points[R];E[0]*j[0]+E[1]*j[1]+E[2]*j[2]+E[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(t){const n=this.points.length;let u=0;for(let p=0;p<n;p++){const y=this.points[p];t[0]*y[0]+t[1]*y[1]+t[2]*y[2]+t[3]>=0&&u++}return u===n?2:u===0?0:1}}function Ps(g,t,n){const u=g-t;return u<0?-u:Math.max(0,u-n)}function mo(g,t,n,u,p){const y=g-n;let x;return x=y<0?Math.min(-y,1+y-p):y>1?Math.min(Math.max(y-p,0),1-y):0,Math.max(x,Ps(t,u,p))}class go{constructor(){this._boundingVolumeCache=new Nc(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,n,u,p){const y=1<<u.z,x=1/y,M=u.x/y,E=u.y/y;let z=2;return z=Math.min(z,mo(t,n,M,E,x)),z=Math.min(z,mo(t,n,M+.5,-E-x,x)),z=Math.min(z,mo(t,n,M+.5,2-E-x,x)),z}getWrap(t,n,u){const p=1<<n.z,y=1/p,x=n.x/p,M=Ps(t.x,x,y),E=Ps(t.x,x-1,y),z=Ps(t.x,x+1,y),R=Math.min(M,E,z);return R===z?1:R===E?-1:0}allowVariableZoom(t,n){return xi(t,n)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,n,u,p){return this._boundingVolumeCache.getTileBoundingVolume(t,n,u,p)}_computeTileBoundingVolume(t,n,u,p){var y,x;let M=0,E=0;if(p?.terrain){const z=new s.a2(t.z,n,t.z,t.x,t.y),R=p.terrain.getMinMaxElevation(z);M=(y=R.minElevation)!==null&&y!==void 0?y:Math.min(0,u),E=(x=R.maxElevation)!==null&&x!==void 0?x:Math.max(0,u)}if(M/=s.bF,E/=s.bF,M+=1,E+=1,t.z<=0)return ua.fromAabb([-E,-E,-E],[E,E,E]);if(t.z===1)return ua.fromAabb([t.x===0?-E:0,t.y===0?0:-E,-E],[t.x===0?0:E,t.y===0?E:0,E]);{const z=[On(0,0,t.x,t.y,t.z),On(s.a5,0,t.x,t.y,t.z),On(s.a5,s.a5,t.x,t.y,t.z),On(0,s.a5,t.x,t.y,t.z)],R=[];for(const ze of z)R.push(s.b0([],ze,E));if(E!==M)for(const ze of z)R.push(s.b0([],ze,M));t.y===0&&R.push([0,1,0]),t.y===(1<<t.z)-1&&R.push([0,-1,0]);const j=[1,1,1],N=[-1,-1,-1];for(const ze of R)for(let Oe=0;Oe<3;Oe++)j[Oe]=Math.min(j[Oe],ze[Oe]),N[Oe]=Math.max(N[Oe],ze[Oe]);const G=On(s.a5/2,s.a5/2,t.x,t.y,t.z),X=s.b5([],[0,1,0],G);s.b4(X,X);const ie=s.b5([],G,X);s.b4(ie,ie);const ne=s.b5([],z[2],z[1]);s.b4(ne,ne);const re=s.b5([],z[0],z[3]);s.b4(re,re),R.push(s.b0([],G,E)),t.y>=(1<<t.z)/2&&R.push(s.b0([],On(s.a5/2,0,t.x,t.y,t.z),E)),t.y<(1<<t.z)/2&&R.push(s.b0([],On(s.a5/2,s.a5,t.x,t.y,t.z),E));const ae=Ms(G,R),he=Ms(ie,R),se=[-G[0],-G[1],-G[2],ae.max],de=[G[0],G[1],G[2],-ae.min],ve=[-ie[0],-ie[1],-ie[2],he.max],ce=[ie[0],ie[1],ie[2],-he.min],Te=[...ne,0],Re=[...re,0],Ce=[];return t.y===0?Ce.push(s.bE(Re,Te,se),s.bE(Re,Te,de)):Ce.push(s.bE(ve,Te,se),s.bE(ve,Te,de),s.bE(ve,Re,se),s.bE(ve,Re,de)),t.y===(1<<t.z)-1?Ce.push(s.bE(Re,Te,se),s.bE(Re,Te,de)):Ce.push(s.bE(ce,Te,se),s.bE(ce,Te,de),s.bE(ce,Re,se),s.bE(ce,Re,de)),new ua(Ce,[se,de,ve,ce,Te,Re],j,N)}}}function Ms(g,t){let n=1/0,u=-1/0;for(const p of t){const y=s.b6(g,p);n=Math.min(n,y),u=Math.max(u,y)}return{min:n,max:u}}class Qn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,u){return this._helper.interpolatePadding(t,n,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n){this._helper.resize(t,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=s.bG(),this._projectionMatrix=s.bk(),this._globeViewProjMatrix32f=s.bj(),this._globeViewProjMatrixNoCorrection=s.bk(),this._globeViewProjMatrixNoCorrectionInverted=s.bk(),this._globeProjMatrixInverted=s.bk(),this._cameraPosition=s.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(n,u)=>{const p=s.ao(n.lat,-s.ap,s.ap),y=s.ao(+u,this.minZoom+Di(0,p),this.maxZoom);return{center:new s.V(n.lng,p),zoom:y}},this.applyConstrain=(n,u)=>this._helper.applyConstrain(n,u),this._helper=new gn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,u)=>this.defaultConstrain(n,u)},t),this._coveringTilesDetailsProvider=new go}clone(){const t=new Qn;return t.apply(this),t}apply(t,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=s.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:n,applyGlobeMatrix:u}=t,p=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const n=this.pitchInRadians,u=this.cameraToCenterDistance/t,p=Math.sin(n)*u,y=Math.cos(n)*u+1,x=1/Math.sqrt(p*p+y*y)*1;let M=-p,E=y;const z=Math.sqrt(M*M+E*E);M/=z,E/=z;const R=[0,M,E];s.bH(R,R,[0,0,0],-this.bearingInRadians),s.bI(R,R,[0,0,0],-1*this.center.lat*Math.PI/180),s.bJ(R,R,[0,0,0],this.center.lng*Math.PI/180);const j=1/s.b8(R);return s.b0(R,R,j),[...R,-x*j]}isLocationOccluded(t){return!this.isSurfacePointVisible(Ii(t))}transformLightDirection(t){const n=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,p=Math.cos(u),y=[Math.sin(n)*p,Math.sin(u),Math.cos(n)*p],x=[y[2],0,-y[0]],M=[0,0,0];s.b5(M,x,y),s.b4(x,x),s.b4(M,M);const E=[0,0,0];return s.b4(E,[x[0]*t[0]+M[0]*t[1]+y[0]*t[2],x[1]*t[0]+M[1]*t[1]+y[1]*t[2],x[2]*t[0]+M[2]*t[1]+y[2]*t[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,n,u){const p=(function(M,E,z){const R=1/(1<<z.z);return new s.ab(M/s.a5*R+z.x*R,E/s.a5*R+z.y*R)})(t,n,u.canonical),y=(x=p.y,[s.bz(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(t,n,u,p){const y=u.canonical,x=On(t,n,y.x,y.y,y.z),M=1+(p?p(t,n):0)/s.bF,E=[x[0]*M,x[1]*M,x[2]*M,1];s.aI(E,E,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,R=z[0]*x[0]+z[1]*x[1]+z[2]*x[2]+z[3]<0;return{point:new s.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:R}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=fo(this.worldSize,this.center.lat),n=s.bl(),u=s.bl();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),s.bf(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;n[8]=2*-p.x/this._helper._width,n[9]=2*p.y/this._helper._height,this._projectionMatrix=s.bg(n),this._globeProjMatrixInverted=s.bl(),s.aC(this._globeProjMatrixInverted,n),s.O(n,n,[0,0,-this.cameraToCenterDistance]),s.bh(n,n,this.rollInRadians),s.bi(n,n,-this.pitchInRadians),s.bh(n,n,this.bearingInRadians),s.O(n,n,[0,0,-t]);const y=s.bA();y[0]=t,y[1]=t,y[2]=t,s.bi(u,n,this.center.lat*Math.PI/180),s.bK(u,u,-this.center.lng*Math.PI/180),s.Q(u,u,y),this._globeViewProjMatrixNoCorrection=u,s.bi(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bK(n,n,-this.center.lng*Math.PI/180),s.Q(n,n,y),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=s.bl(),s.aC(this._globeViewProjMatrixNoCorrectionInverted,u);const x=s.bA();this._cameraPosition=s.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,s.bH(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),s.bI(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),s.bH(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),s.b1(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bI(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),s.bJ(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const M=s.bg(this._globeViewProjMatrixNoCorrectionInverted);s.Q(M,M,[1,1,-1]),this._cachedFrustum=on.fromInvProjectionMatrix(M,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){s.w("calculateFogMatrix is not supported on globe projection.");const n=s.bl();return s.as(n),n}getVisibleUnwrappedCoordinates(t){return[new s.bd(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=Ii(t);s.b0(u,u,1+n/s.bF);const p=s.bG();return s.aI(p,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(t){}getBounds(){const t=.5*this.width,n=.5*this.height,u=[new s.P(0,0),new s.P(t,0),new s.P(this.width,0),new s.P(this.width,n),new s.P(this.width,this.height),new s.P(t,this.height),new s.P(0,this.height),new s.P(0,n)],p=[];for(const j of u)p.push(this.unprojectScreenPoint(j));let y=0,x=0,M=0,E=0;const z=this.center;for(const j of p){const N=s.bL(z.lng,j.lng),G=s.bL(z.lat,j.lat);N<x&&(x=N),N>y&&(y=N),G<E&&(E=G),G>M&&(M=G)}const R=[z.lng+x,z.lat+E,z.lng+y,z.lat+M];return this.isSurfacePointOnScreen([0,1,0])&&(R[3]=90,R[0]=-180,R[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(R[1]=-90,R[0]=-180,R[2]=180),new Li(R)}calculateCenterFromCameraLngLatAlt(t,n,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,u,p)}setLocationAtPoint(t,n){const u=Ii(this.unprojectScreenPoint(n)),p=Ii(t),y=s.bA();s.bM(y);const x=s.bA();s.bJ(x,u,y,-this.center.lng*Math.PI/180),s.bI(x,x,y,this.center.lat*Math.PI/180);const M=p[0]*p[0]+p[2]*p[2],E=x[0]*x[0];if(M<E)return;const z=Math.sqrt(M-E),R=-z,j=s.bN(p[0],p[2],x[0],z),N=s.bN(p[0],p[2],x[0],R),G=s.bA();s.bJ(G,p,y,-j);const X=s.bN(G[1],G[2],x[1],x[2]),ie=s.bA();s.bJ(ie,p,y,-N);const ne=s.bN(ie[1],ie[2],x[1],x[2]),re=.5*Math.PI,ae=X>=-re&&X<=re,he=ne>=-re&&ne<=re;let se,de;if(ae&&he){const Re=this.center.lng*Math.PI/180,Ce=this.center.lat*Math.PI/180;s.bO(j,Re)+s.bO(X,Ce)<s.bO(N,Re)+s.bO(ne,Ce)?(se=j,de=X):(se=N,de=ne)}else if(ae)se=j,de=X;else{if(!he)return;se=N,de=ne}const ve=se/Math.PI*180,ce=de/Math.PI*180,Te=this.center.lat;this.setCenter(new s.V(ve,s.ao(ce,-90,90))),this.setZoom(this.zoom+Di(Te,this.center.lat))}locationToScreenPoint(t,n){const u=Ii(t);if(n){const p=n.getElevationForLngLatZoom(t,this._helper._tileZoom);s.b0(u,u,1+p/s.bF)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(t){const n=s.bG();return s.aI(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new s.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,n){if(n){const u=n.pointCoordinate(t);if(u)return u}return s.ab.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,n){var u;return(u=this.screenPointToMercatorCoordinate(t,n))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(t,n){const u=this._cameraPosition,p=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(u,p)}getRayDirectionFromPixel(t){const n=s.bG();n[0]=t.x/this.width*2-1,n[1]=-1*(t.y/this.height*2-1),n[2]=1,n[3]=1,s.aI(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const u=s.bA();u[0]=n[0]-this._cameraPosition[0],u[1]=n[1]-this._cameraPosition[1],u[2]=n[2]-this._cameraPosition[2];const p=s.bA();return s.b4(p,u),p}isSurfacePointVisible(t){const n=this._cachedClippingPlane;return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const n=s.bG();return s.aI(n,[...t,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(t,n){const u=s.b6(t,n),p=s.bA(),y=s.bA();s.b0(y,n,u),s.b3(p,t,y);const x=1-s.b6(p,p);if(x<0)return null;const M=s.b6(t,t)-1,E=-u+(u<0?1:-1)*Math.sqrt(x),z=M/E,R=E;return{tMin:Math.min(z,R),tMax:Math.max(z,R)}}unprojectScreenPoint(t){const n=this._cameraPosition,u=this.getRayDirectionFromPixel(t),p=this.rayPlanetIntersection(n,u);if(p){const R=s.bA();s.b1(R,n,[u[0]*p.tMin,u[1]*p.tMin,u[2]*p.tMin]);const j=s.bA();return s.b4(j,R),Fl(j)}const y=this._cachedClippingPlane,x=y[0]*u[0]+y[1]*u[1]+y[2]*u[2],M=-s.bc(y,n)/x,E=s.bA();if(M>0)s.b1(E,n,[u[0]*M,u[1]*M,u[2]*M]);else{const R=s.bA();s.b1(R,n,[2*u[0],2*u[1],2*u[2]]);const j=s.bc(this._cachedClippingPlane,R);s.b3(E,R,[this._cachedClippingPlane[0]*j,this._cachedClippingPlane[1]*j,this._cachedClippingPlane[2]*j])}const z=(function(R){const j=s.bA();return j[0]=R[0]*-R[3],j[1]=R[1]*-R[3],j[2]=R[2]*-R[3],{center:j,radius:Math.sqrt(1-R[3]*R[3])}})(y);return Fl((function(R,j,N){const G=s.bA();s.b3(G,N,R);const X=s.bA();return s.bB(X,R,G,j/s.ba(G)),X})(z.center,z.radius,E))}getMatrixForModel(t,n){const u=s.V.convert(t),p=1/s.bF,y=s.bk();return s.bK(y,y,u.lng/180*Math.PI),s.bi(y,y,-u.lat/180*Math.PI),s.O(y,y,[0,0,1+n/s.bF]),s.bi(y,y,.5*Math.PI),s.Q(y,y,[p,p,p]),y}getProjectionDataForCustomLayer(t=!0){const n=this.getProjectionData({overscaledTileID:new s.a2(0,0,0,0,0),applyGlobeMatrix:t});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(t){}}class Cr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,n,u){return this._helper.interpolatePadding(t,n,u)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,n,u=!0){this._helper.resize(t,n,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,n){this._helper.overrideNearFarZ(t,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,n){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(n,u)=>this.currentTransform.defaultConstrain(n,u),this.applyConstrain=(n,u)=>this._helper.applyConstrain(n,u),this._helper=new gn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(n,u)=>this.defaultConstrain(n,u)},t),this._globeness=1,this._mercatorTransform=new jo,this._verticalPerspectiveTransform=new Qn}clone(){const t=new Cr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const n=this._mercatorTransform.getProjectionData(t),u=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:n.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return s.bv(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bv(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,n,u){const p=this._mercatorTransform.getPitchedTextCorrection(t,n,u),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,n,u);return s.bv(p,y,this._globeness)}projectTileCoordinates(t,n,u,p){return this.currentTransform.projectTileCoordinates(t,n,u,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,n){return this.currentTransform.lngLatToCameraDepth(t,n)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,n,u,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,n,u,p)}setLocationAtPoint(t,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,n){return this.currentTransform.locationToScreenPoint(t,n)}screenPointToMercatorCoordinate(t,n){return this.currentTransform.screenPointToMercatorCoordinate(t,n)}screenPointToLocation(t,n){return this.currentTransform.screenPointToLocation(t,n)}isPointOnMapSurface(t,n){return this.currentTransform.isPointOnMapSurface(t,n)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,n){return this.currentTransform.getMatrixForModel(t,n)}getProjectionDataForCustomLayer(t=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return n;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return u.fallbackMatrix=n.mainMatrix,u}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Ki{get useGlobeControls(){return!0}handlePanInertia(t,n){const u=Eu(t,n);return Math.abs(u.lng-n.center.lng)>180&&(u.lng=n.center.lng+179.5*Math.sign(u.lng-n.center.lng)),{easingCenter:u,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,n){const u=t.around,p=n.screenPointToLocation(u);t.bearingDelta&&n.setBearing(n.bearing+t.bearingDelta),t.pitchDelta&&n.setPitch(n.pitch+t.pitchDelta),t.rollDelta&&n.setRoll(n.roll+t.rollDelta);const y=n.zoom;t.zoomDelta&&n.setZoom(n.zoom+t.zoomDelta);const x=n.zoom-y;if(x===0)return;const M=s.bL(n.center.lng,p.lng),E=M/(Math.abs(M/180)+1),z=s.bL(n.center.lat,p.lat),R=n.getRayDirectionFromPixel(u),j=n.cameraPosition,N=-1*s.b6(j,R),G=s.bA();s.b1(G,j,[R[0]*N,R[1]*N,R[2]*N]);const X=s.b8(G)-1,ie=Math.exp(.5*-Math.max(X-.3,0)),ne=fo(n.worldSize,n.center.lat)/Math.min(n.width,n.height),re=s.by(ne,.9,.5,1,.25),ae=(1-s.ar(-x))*Math.min(ie,re),he=n.center.lat,se=n.zoom,de=new s.V(n.center.lng+E*ae,s.ao(n.center.lat+z*ae,-s.ap,s.ap));n.setLocationAtPoint(p,u);const ve=n.center,ce=s.by(Math.abs(M),45,85,0,1),Te=s.by(ne,.75,.35,0,1),Re=Math.pow(Math.max(ce,Te),.25),Ce=s.bL(ve.lng,de.lng),ze=s.bL(ve.lat,de.lat);n.setCenter(new s.V(ve.lng+Ce*Re,ve.lat+ze*Re).wrap()),n.setZoom(se+Di(he,n.center.lat))}handleMapControlsPan(t,n,u){if(!t.panDelta)return;const p=n.center.lat,y=n.zoom;n.setCenter(Eu(t.panDelta,n).wrap()),n.setZoom(y+Di(p,n.center.lat))}cameraForBoxAndBearing(t,n,u,p,y){const x=rl(t,n,u,p,y),M=n.left/y.width*2-1,E=(y.width-n.right)/y.width*2-1,z=n.top/y.height*-2+1,R=(y.height-n.bottom)/y.height*-2+1,j=s.bL(u.getWest(),u.getEast())<0,N=j?u.getEast():u.getWest(),G=j?u.getWest():u.getEast(),X=Math.max(u.getNorth(),u.getSouth()),ie=Math.min(u.getNorth(),u.getSouth()),ne=N+.5*s.bL(N,G),re=X+.5*s.bL(X,ie),ae=y.clone();ae.setCenter(x.center),ae.setBearing(x.bearing),ae.setPitch(0),ae.setRoll(0),ae.setZoom(x.zoom);const he=ae.modelViewProjectionMatrix,se=[Ii(u.getNorthWest()),Ii(u.getNorthEast()),Ii(u.getSouthWest()),Ii(u.getSouthEast()),Ii(new s.V(G,re)),Ii(new s.V(N,re)),Ii(new s.V(ne,X)),Ii(new s.V(ne,ie))],de=Ii(x.center);let ve=Number.POSITIVE_INFINITY;for(const ce of se)M<0&&(ve=Ki.getLesserNonNegativeNonNull(ve,Ki.solveVectorScale(ce,de,he,"x",M))),E>0&&(ve=Ki.getLesserNonNegativeNonNull(ve,Ki.solveVectorScale(ce,de,he,"x",E))),z>0&&(ve=Ki.getLesserNonNegativeNonNull(ve,Ki.solveVectorScale(ce,de,he,"y",z))),R<0&&(ve=Ki.getLesserNonNegativeNonNull(ve,Ki.solveVectorScale(ce,de,he,"y",R)));if(Number.isFinite(ve)&&ve!==0)return x.zoom=ae.zoom+s.au(ve),x;Bn()}handleJumpToCenterZoom(t,n){const u=t.center.lat,p=t.applyConstrain(n.center?s.V.convert(n.center):t.center,t.zoom).center;t.setCenter(p.wrap());const y=n.zoom!==void 0?+n.zoom:t.zoom+Di(u,p.lat);t.zoom!==y&&t.setZoom(y)}handleEaseTo(t,n){const u=t.zoom,p=t.center,y=t.padding,x={roll:t.roll,pitch:t.pitch,bearing:t.bearing},M={roll:n.roll===void 0?t.roll:n.roll,pitch:n.pitch===void 0?t.pitch:n.pitch,bearing:n.bearing===void 0?t.bearing:n.bearing},E=n.zoom!==void 0,z=!t.isPaddingEqual(n.padding);let R=!1;const j=n.center?s.V.convert(n.center):p,N=t.applyConstrain(j,u).center;An(t,N);const G=t.clone();G.setCenter(N),G.setZoom(E?+n.zoom:u+Di(p.lat,j.lat)),G.setBearing(n.bearing);const X=new s.P(s.ao(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),s.ao(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));G.setLocationAtPoint(N,X);const ie=(n.offset&&n.offsetAsPoint.mag())>0?G.center:N,ne=E?+n.zoom:u+Di(p.lat,ie.lat),re=u+Di(p.lat,0),ae=ne+Di(ie.lat,0),he=s.bL(p.lng,ie.lng),se=s.bL(p.lat,ie.lat),de=s.ar(ae-re);return R=ne!==u,{easeFunc:ve=>{if(s.bp(x,M)||Au({startEulerAngles:x,endEulerAngles:M,tr:t,k:ve,useSlerp:x.roll!=M.roll}),z&&t.interpolatePadding(y,n.padding,ve),n.around)s.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(n.around,n.aroundPoint);else{const ce=ae>re?Math.min(2,de):Math.max(.5,de),Te=Math.pow(ce,1-ve),Re=ol(p,he,se,ve*Te);t.setCenter(Re.wrap())}if(R){const ce=s.G.number(re,ae,ve)+Di(0,t.center.lat);t.setZoom(ce)}},isZooming:R,elevationCenter:ie}}handleFlyTo(t,n){const u=n.zoom!==void 0,p=t.center,y=t.zoom,x=t.padding,M=!t.isPaddingEqual(n.padding),E=t.applyConstrain(s.V.convert(n.center||n.locationAtOffset),y).center,z=u?+n.zoom:t.zoom+Di(t.center.lat,E.lat),R=t.clone();R.setCenter(E),R.setZoom(z),R.setBearing(n.bearing);const j=new s.P(s.ao(t.centerPoint.x+n.offsetAsPoint.x,0,t.width),s.ao(t.centerPoint.y+n.offsetAsPoint.y,0,t.height));R.setLocationAtPoint(E,j);const N=R.center;An(t,N);const G=(function(se,de,ve){const ce=Ii(de),Te=Ii(ve),Re=s.b6(ce,Te),Ce=Math.acos(Re),ze=qi(se);return Ce/(2*Math.PI)*ze})(t,p,N),X=y+Di(p.lat,0),ie=z+Di(N.lat,0),ne=s.ar(ie-X);let re;if(typeof n.minZoom=="number"){const se=+n.minZoom+Di(N.lat,0),de=Math.min(se,X,ie)+Di(0,N.lat),ve=t.applyConstrain(N,de).zoom+Di(N.lat,0);re=s.ar(ve-X)}const ae=s.bL(p.lng,N.lng),he=s.bL(p.lat,N.lat);return{easeFunc:(se,de,ve,ce)=>{const Te=ol(p,ae,he,ve);M&&t.interpolatePadding(x,n.padding,se);const Re=se===1?N:Te;t.setCenter(Re.wrap());const Ce=X+s.au(de);t.setZoom(se===1?z:Ce+Di(0,Re.lat))},scaleOfZoom:ne,targetCenter:N,scaleOfMinZoom:re,pixelPathLength:G}}static solveVectorScale(t,n,u,p,y){const x=p==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],M=[u[3],u[7],u[11],u[15]],E=t[0]*x[0]+t[1]*x[1]+t[2]*x[2],z=t[0]*M[0]+t[1]*M[1]+t[2]*M[2],R=n[0]*x[0]+n[1]*x[1]+n[2]*x[2],j=n[0]*M[0]+n[1]*M[1]+n[2]*M[2];return R+y*z===E+y*j||M[3]*(E-R)+x[3]*(j-z)+E*j==R*z?null:(R+x[3]-y*j-y*M[3])/(R-E-y*j+y*z)}static getLesserNonNegativeNonNull(t,n){return n!==null&&n>=0&&n<t?n:t}}class Ol{constructor(t){this._globe=t,this._mercatorCameraHelper=new $t,this._verticalPerspectiveCameraHelper=new Ki}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,n){return this.currentHelper.handlePanInertia(t,n)}handleMapControlsRollPitchBearingZoom(t,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,n)}handleMapControlsPan(t,n,u){this.currentHelper.handleMapControlsPan(t,n,u)}cameraForBoxAndBearing(t,n,u,p,y){return this.currentHelper.cameraForBoxAndBearing(t,n,u,p,y)}handleJumpToCenterZoom(t,n){this.currentHelper.handleJumpToCenterZoom(t,n)}handleEaseTo(t,n){return this.currentHelper.handleEaseTo(t,n)}handleFlyTo(t,n){return this.currentHelper.handleFlyTo(t,n)}}const Ga=(g,t)=>s.B(g,t&&t.filter((n=>n.identifier!=="source.canvas"))),ca=s.bP();class _o extends s.E{constructor(t,n={}){var u,p;super(),this._rtlPluginLoaded=()=>{for(const x in this.tileManagers){const M=this.tileManagers[x].getSource().type;M!=="vector"&&M!=="geojson"||this.tileManagers[x].reload()}},this.map=t,this.dispatcher=new dn(Ro(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((x,M)=>this.getGlyphs(x,M))),this.dispatcher.registerMessageHandler("GI",((x,M)=>this.getImages(x,M))),this.dispatcher.registerMessageHandler("GDA",((x,M)=>this.getDashes(x,M))),this.imageManager=new mi,this.imageManager.setEventedParent(this);const y=((u=t._container)===null||u===void 0?void 0:u.lang)||typeof document<"u"&&((p=document.documentElement)===null||p===void 0?void 0:p.lang)||void 0;this.glyphManager=new hr(t._requestManager,n.localIdeographFontFamily,y),this.lineAtlas=new _r(256,512),this.crossTileSymbolIndex=new nn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",s.bQ()),Se().on(fe,this._rtlPluginLoaded),this.on("data",(x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const M=this.tileManagers[x.sourceId];if(!M)return;const E=M.getSource();if(E&&E.vectorLayerIds)for(const z in this._layers){const R=this._layers[z];R.source===E.id&&this._validateLayer(R)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new s.bR,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,n){var u,p,y;this._checkLoaded();const x=n===null?(y=(p=(u=this.stylesheet.state)===null||u===void 0?void 0:u[t])===null||p===void 0?void 0:p.default)!==null&&y!==void 0?y:null:n;if(s.bS(x,this._globalState[t]))return this;this._globalState[t]=x,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const n=[];for(const u in t)!s.bS(this._globalState[u],t[u].default)&&(n.push(u),this._globalState[u]=t[u].default);this._applyGlobalStateChanges(n)}_applyGlobalStateChanges(t){if(t.length===0)return;const n=new Set,u={};for(const p of t){u[p]=this._globalState[p];for(const y in this._layers){const x=this._layers[y],M=x.getLayoutAffectingGlobalStateRefs(),E=x.getPaintAffectingGlobalStateRefs();if(M.has(p)&&n.add(x.source),E.has(p))for(const{name:z,value:R}of E.get(p))this._updatePaintProperty(x,z,R)}}this.dispatcher.broadcast("UGS",u);for(const p in this.tileManagers)n.has(p)&&(this._reloadSource(p),this._changed=!0)}loadURL(t,n={},u){this.fire(new s.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const p=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;s.j(p,this._loadStyleRequest).then((x=>{this._loadStyleRequest=null,this._load(x.data,n,u)})).catch((x=>{this._loadStyleRequest=null,x&&!y.signal.aborted&&this.fire(new s.k(x))}))}loadJSON(t,n={},u){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ge.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,u)})).catch((()=>{}))}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(ca,{validate:!1})}_load(t,n,u){var p,y;let x=n.transformStyle?n.transformStyle(u,t):t;if(!n.validate||!Ga(this,s.C(x))){x=Object.assign({},x),this._loaded=!0,this.stylesheet=x;for(const M in x.sources)this.addSource(M,x.sources[M],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new Et(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new pr(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){var t,n,u;const p=s.bT(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",p),this._order=p.map((y=>y.id)),this._layers={},this._serializedLayers=null;for(const y of p){const x=s.bU(y,this._globalState);if(x.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=x,s.bV(x)&&this.tileManagers[x.source]){const M=(u=(n=y.paint)===null||n===void 0?void 0:n["raster-fade-duration"])!==null&&u!==void 0?u:x.paint.get("raster-fade-duration");this.tileManagers[x.source].setRasterFadeDuration(M)}}}_loadSprite(t,n=!1,u=void 0){this.imageManager.setLoaded(!1);const p=new AbortController;let y;this._spriteRequest=p,(function(x,M,E,z){return s._(this,void 0,void 0,(function*(){const R=Vt(x),j=E>1?"@2x":"",N={},G={};for(const{id:X,url:ie}of R){const ne=M.transformRequest(Pt(ie,j,".json"),"SpriteJSON");N[X]=s.j(ne,z);const re=M.transformRequest(Pt(ie,j,".png"),"SpriteImage");G[X]=ht.getImage(re,z)}return yield Promise.all([...Object.values(N),...Object.values(G)]),(function(X,ie){return s._(this,void 0,void 0,(function*(){const ne={};for(const re in X){ne[re]={};const ae=ge.getImageCanvasContext((yield ie[re]).data),he=(yield X[re]).data;for(const se in he){const{width:de,height:ve,x:ce,y:Te,sdf:Re,pixelRatio:Ce,stretchX:ze,stretchY:Oe,content:He,textFitWidth:et,textFitHeight:We}=he[se];ne[re][se]={data:null,pixelRatio:Ce,sdf:Re,stretchX:ze,stretchY:Oe,content:He,textFitWidth:et,textFitHeight:We,spriteData:{width:de,height:ve,x:ce,y:Te,context:ae}}}}return ne}))})(N,G)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((x=>{if(this._spriteRequest=null,x)for(const M in x){this._spritesImagesIds[M]=[];const E=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter((z=>!(z in x))):[];for(const z of E)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in x[M]){const R=M==="default"?z:`${M}:${z}`;this._spritesImagesIds[M].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,x[M][z],!1):this.imageManager.addImage(R,x[M][z]),n&&(this._changedImages[R]=!0)}}})).catch((x=>{this._spriteRequest=null,y=x,p.signal.aborted||this.fire(new s.k(y))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),u&&u(y)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(t){const n=this.tileManagers[t.source];if(!n)return;const u=t.sourceLayer;if(!u)return;const p=n.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.k(new Error(`Source layer "${u}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,n=!1){const u=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n?s.bW(u):u);const p=[];for(const y of t)if(u[y]){const x=n?s.bW(u[y]):u[y];p.push(x)}return p}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const u of n){const p=this._layers[u];p.type!=="custom"&&(t[u]=p.serialize())}return t}hasTransitions(){var t,n,u;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const p in this.tileManagers)if(this.tileManagers[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(n){const p=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(p.length||y.length)&&this._updateWorkerLayers(p,y);for(const x in this._updatedSources){const M=this._updatedSources[x];if(M==="reload")this._reloadSource(x);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const u={};for(const p in this.tileManagers){const y=this.tileManagers[p];u[p]=y.used,y.used=!1}for(const p of this._order){const y=this._layers[p];y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)&&y.source&&(this.tileManagers[y.source].used=!0)}for(const p in u){const y=this.tileManagers[p];!!u[p]!=!!y.used&&y.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,n&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.tileManagers)this.tileManagers[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){var u;this._checkLoaded();const p=this.serialize();if(t=n.transformStyle?n.transformStyle(p,t):t,((u=n.validate)===null||u===void 0||u)&&Ga(this,s.C(t)))return!1;(t=s.bW(t)).layers=s.bT(t.layers);const y=s.bX(p,t),x=this._getOperationsToPerform(y);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const M of x.operations)M();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const n=[],u=[];for(const p of t)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":n.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":n.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":n.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":n.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":n.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":n.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":n.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":n.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":n.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":n.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":n.push((()=>this.setSprite.apply(this,p.args)));break;case"setTerrain":n.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setSky":n.push((()=>this.setSky.apply(this,p.args)));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":n.push((()=>this.setGlobalState.apply(this,p.args)));break;case"setTransition":n.push((()=>{}));break;default:u.push(p.command)}return{operations:n,unimplemented:u}}addImage(t,n){if(this.getImage(t))return this.fire(new s.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,u={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(s.C.source,`sources.${t}`,n,null,u))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const p=this.tileManagers[t]=new mn(t,n,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t}))),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new s.k(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const n=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],n.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.tileManagers[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(n),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,n,u={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new s.k(new Error(`Layer "${p}" already exists on this map.`)));let y;if(t.type==="custom"){if(Ga(this,s.bY(t)))return;y=s.bU(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=s.bW(t),t=s.e(t,{source:p})),this._validate(s.C.layer,`layers.${p}`,t,{arrayIndex:-1},u))return;y=s.bU(t,this._globalState),this._validateLayer(y),y.setEventedParent(this,{layer:{id:p}})}const x=n?this._order.indexOf(n):this._order.length;if(n&&x===-1)this.fire(new s.k(new Error(`Cannot add layer "${p}" before non-existing layer "${n}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=y,this._removedLayers[p]&&y.source&&y.type!=="custom"){const M=this._removedLayers[p];delete this._removedLayers[p],M.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.tileManagers[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const u=this._order.indexOf(t);this._order.splice(u,1);const p=n?this._order.indexOf(n):this._order.length;n&&p===-1?this.fire(new s.k(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,u){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===n&&p.maxzoom===u||(n!=null&&(p.minzoom=n),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,u={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!s.bS(p.filter,n))return n==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(s.C.filter,`layers.${p.id}.filter`,n,null,u)||(p.setFilter(s.bW(n)),this._updateLayer(p)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.bW(this.getLayer(t).filter)}setLayoutProperty(t,n,u,p={}){this._checkLoaded();const y=this.getLayer(t);y?s.bS(y.getLayoutProperty(n),u)||(y.setLayoutProperty(n,u,p),this._updateLayer(y)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const u=this.getLayer(t);if(u)return u.getLayoutProperty(n);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,u,p={}){this._checkLoaded();const y=this.getLayer(t);y?s.bS(y.getPaintProperty(n),u)||this._updatePaintProperty(y,n,u,p):this.fire(new s.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,n,u,p={}){t.setPaintProperty(n,u,p)&&this._updateLayer(t),s.bV(t)&&n==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(u),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const u=t.source,p=t.sourceLayer,y=this.tileManagers[u];if(y===void 0)return void this.fire(new s.k(new Error(`The source '${u}' does not exist in the map's style.`)));const x=y.getSource().type;x==="geojson"&&p?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(t.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(p,t.id,n)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const u=t.source,p=this.tileManagers[u];if(p===void 0)return void this.fire(new s.k(new Error(`The source '${u}' does not exist in the map's style.`)));const y=p.getSource().type,x=y==="vector"?t.sourceLayer:void 0;y!=="vector"||x?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,t.id,n):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,u=t.sourceLayer,p=this.tileManagers[n];if(p!==void 0)return p.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(u,t.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=s.bZ(this.tileManagers,(y=>y.serialize())),n=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,p=this.stylesheet;return s.b_({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:t,layers:n,terrain:u},(y=>y!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=x=>this._layers[x].type==="fill-extrusion",u={},p=[];for(let x=this._order.length-1;x>=0;x--){const M=this._order[x];if(n(M)){u[M]=x;for(const E of t){const z=E[M];if(z)for(const R of z)p.push(R)}}}p.sort(((x,M)=>M.intersectionZ-x.intersectionZ));const y=[];for(let x=this._order.length-1;x>=0;x--){const M=this._order[x];if(n(M))for(let E=p.length-1;E>=0;E--){const z=p[E].feature;if(u[z.layer.id]<x)break;y.push(z),p.pop()}else for(const E of t){const z=E[M];if(z)for(const R of z)y.push(R.feature)}}return y}queryRenderedFeatures(t,n,u){n&&n.filter&&this._validate(s.C.filter,"queryRenderedFeatures.filter",n.filter,null,n);const p={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of n.layers){const R=this._layers[z];if(!R)return this.fire(new s.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];p[R.source]=!0}}const y=[];n.availableImages=this._availableImages;const x=this._serializedAllLayers(),M=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,E=Object.assign(Object.assign({},n),{layers:M,globalState:this._globalState});for(const z in this.tileManagers)n.layers&&!p[z]||y.push(ta(this.tileManagers[z],this._layers,x,t,E,u,this.map.terrain?(R,j,N)=>this.map.terrain.getElevation(R,j,N):void 0));return this.placement&&y.push((function(z,R,j,N,G,X,ie){const ne={},re=X.queryRenderedSymbols(N),ae=[];for(const he of Object.keys(re).map(Number))ae.push(ie[he]);ae.sort(yr);for(const he of ae){const se=he.featureIndex.lookupSymbolFeatures(re[he.bucketInstanceId],R,he.bucketIndex,he.sourceLayerIndex,{filterSpec:G.filter,globalState:G.globalState},G.layers,G.availableImages,z);for(const de in se){const ve=ne[de]=ne[de]||[],ce=se[de];ce.sort(((Te,Re)=>{const Ce=he.featureSortOrder;if(Ce){const ze=Ce.indexOf(Te.featureIndex);return Ce.indexOf(Re.featureIndex)-ze}return Re.featureIndex-Te.featureIndex}));for(const Te of ce)ve.push(Te)}}return(function(he,se,de){for(const ve in he)for(const ce of he[ve])fn(ce,de[se[ve].source]);return he})(ne,z,j)})(this._layers,x,this.tileManagers,t,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,n){n?.filter&&this._validate(s.C.filter,"querySourceFeatures.filter",n.filter,null,n);const u=this.tileManagers[t];return u?(function(p,y){const x=p.getRenderableIds().map((z=>p.getTileByID(z))),M=[],E={};for(let z=0;z<x.length;z++){const R=x[z],j=R.tileID.canonical.key;E[j]||(E[j]=!0,R.querySourceFeatures(M,y))}return M})(u,n?Object.assign(Object.assign({},n),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const x in t)if(!s.bS(t[x],u[x])){p=!0;break}if(!p)return;const y={now:be(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(y)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,n={}){this._checkLoaded();const u=this.getSky();let p=!1;if(!t&&!u)return;if(t&&!u)p=!0;else if(!t&&u)p=!0;else for(const x in t)if(!s.bS(t[x],u[x])){p=!0;break}if(!p)return;const y={now:be(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,n),this.sky.updateTransitions(y)}_setProjectionInternal(t){const n=(function(u,p){const y={constrainOverride:p};if(Array.isArray(u)){const x=new Rl({type:u});return{projection:x,transform:new Cr(y),cameraHelper:new Ol(x)}}switch(u){case"mercator":return{projection:new Yi,transform:new jo(y),cameraHelper:new $t};case"globe":{const x=new Rl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:x,transform:new Cr(y),cameraHelper:new Ol(x)}}case"vertical-perspective":return{projection:new En,transform:new Qn(y),cameraHelper:new Ki};default:return s.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new Yi,transform:new jo(y),cameraHelper:new $t}}})(t,this.map.transformConstrain);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const u in this.tileManagers)this.tileManagers[u].reload()}_validate(t,n,u,p,y={}){return(!y||y.validate!==!1)&&Ga(this,t.call(s.C,s.e({key:n,style:this.serialize(),value:u,styleSpec:s.u},p)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Se().off(fe,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.tileManagers){const u=this.tileManagers[n];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const n in this.tileManagers)this.tileManagers[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,n,u,p,y=!1){let x=!1,M=!1;const E={};for(const z of this._order){const R=this._layers[z];if(R.type!=="symbol")continue;if(!E[R.source]){const N=this.tileManagers[R.source];E[R.source]=N.getRenderableIds(!0).map((G=>N.getTileByID(G))).sort(((G,X)=>X.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(X.tileID)?-1:1)))}const j=this.crossTileSymbolIndex.addLayer(R,E[R.source],t.center.lng);x=x||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(be(),t.zoom))&&(this.pauseablePlacement=new Oo(t,this.map.terrain,this._order,y,n,u,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(be()),M=!0),x&&this.pauseablePlacement.placement.setStale()),M||x)for(const z of this._order){const R=this._layers[z];R.type==="symbol"&&this.placement.updateLayerOpacities(R,E[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(be())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,n){return s._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const p=this.tileManagers[n.source];return p&&p.setDependencies(n.tileID.key,n.type,n.icons),u}))}getGlyphs(t,n){return s._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(n.stacks),p=this.tileManagers[n.source];return p&&p.setDependencies(n.tileID.key,n.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(s.C.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,n){return s._(this,void 0,void 0,(function*(){const u={};for(const[p,y]of Object.entries(n.dashes))u[p]=this.lineAtlas.getDash(y.dasharray,y.round);return u}))}addSprite(t,n,u={},p){this._checkLoaded();const y=[{id:t,url:n}],x=[...Vt(this.stylesheet.sprite),...y];this._validate(s.C.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(y,!0,p))}removeSprite(t){this._checkLoaded();const n=Vt(this.stylesheet.sprite);if(n.find((u=>u.id===t))){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;n.splice(n.findIndex((u=>u.id===t)),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Vt(this.stylesheet.sprite)}setSprite(t,n={},u){this._checkLoaded(),t&&this._validate(s.C.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const n=this.tileManagers[t];n.setEventedParent(null),n.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const n=this._layers[t];n.setEventedParent(null),n.onRemove&&n.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var jc=s.aV([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class al{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,u,p,y,x,M,E,z){this.context=t;let R=this.boundPaintVertexBuffers.length!==p.length;for(let j=0;!R&&j<p.length;j++)this.boundPaintVertexBuffers[j]!==p[j]&&(R=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==u||R||this.boundIndexBuffer!==y||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==z?this.freshBind(n,u,p,y,x,M,E,z):(t.bindVertexArray.set(this.vao),M&&M.bind(),y&&y.dynamicDraw&&y.bind(),E&&E.bind(),z&&z.bind())}freshBind(t,n,u,p,y,x,M,E){const z=t.numAttributes,R=this.context,j=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=E,n.enableAttributes(j,t);for(const N of u)N.enableAttributes(j,t);x&&x.enableAttributes(j,t),M&&M.enableAttributes(j,t),E&&E.enableAttributes(j,t),n.bind(),n.setVertexAttribPointers(j,t,y);for(const N of u)N.bind(),N.setVertexAttribPointers(j,t,y);x&&(x.bind(),x.setVertexAttribPointers(j,t,y)),p&&p.bind(),M&&(M.bind(),M.setVertexAttribPointers(j,t,y)),E&&(E.bind(),E.setVertexAttribPointers(j,t,y)),R.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Cu=(g,t,n,u,p)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:t,u_fog_color:n?n.properties.get("fog-color"):s.bq.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:n?n.calculateFogBlendOpacity(u):0,u_horizon_color:n?n.properties.get("horizon-color"):s.bq.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),$a={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function an(g){const t=[];for(let n=0;n<g.length;n++){if(g[n]===null)continue;const u=g[n].split(" ");t.push(u.pop())}return t}class ha{constructor(t,n,u,p,y,x,M,E,z=[]){const R=t.gl;this.program=R.createProgram();const j=an(n.staticAttributes),N=u?u.getBinderAttributes():[],G=j.concat(N),X=ni.prelude.staticUniforms?an(ni.prelude.staticUniforms):[],ie=M.staticUniforms?an(M.staticUniforms):[],ne=n.staticUniforms?an(n.staticUniforms):[],re=u?u.getBinderUniforms():[],ae=X.concat(ie).concat(ne).concat(re),he=[];for(const Ce of ae)he.indexOf(Ce)<0&&he.push(Ce);const se=u?u.defines():[];_n(R)&&se.unshift("#version 300 es"),y&&se.push("#define OVERDRAW_INSPECTOR;"),x&&se.push("#define TERRAIN3D;"),E&&se.push(E),z&&se.push(...z);let de=se.concat(ni.prelude.fragmentSource,M.fragmentSource,n.fragmentSource).join(`
`),ve=se.concat(ni.prelude.vertexSource,M.vertexSource,n.vertexSource).join(`
`);_n(R)||(de=(function(Ce){return Ce.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(de),ve=(function(Ce){return Ce.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ve));const ce=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(ce,de),R.compileShader(ce),!R.getShaderParameter(ce,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(ce)}`);R.attachShader(this.program,ce);const Te=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Te,ve),R.compileShader(Te),!R.getShaderParameter(Te,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(Te)}`);R.attachShader(this.program,Te),this.attributes={};const Re={};this.numAttributes=G.length;for(let Ce=0;Ce<this.numAttributes;Ce++)G[Ce]&&(R.bindAttribLocation(this.program,Ce,G[Ce]),this.attributes[G[Ce]]=Ce);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(Te),R.deleteShader(ce);for(let Ce=0;Ce<he.length;Ce++){const ze=he[Ce];if(ze&&!Re[ze]){const Oe=R.getUniformLocation(this.program,ze);Oe&&(Re[ze]=Oe)}}this.fixedUniforms=p(t,Re),this.terrainUniforms=((Ce,ze)=>({u_depth:new s.b$(Ce,ze.u_depth),u_terrain:new s.b$(Ce,ze.u_terrain),u_terrain_dim:new s.br(Ce,ze.u_terrain_dim),u_terrain_matrix:new s.c1(Ce,ze.u_terrain_matrix),u_terrain_unpack:new s.c2(Ce,ze.u_terrain_unpack),u_terrain_exaggeration:new s.br(Ce,ze.u_terrain_exaggeration)}))(t,Re),this.projectionUniforms=((Ce,ze)=>({u_projection_matrix:new s.c1(Ce,ze.u_projection_matrix),u_projection_tile_mercator_coords:new s.c2(Ce,ze.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.c2(Ce,ze.u_projection_clipping_plane),u_projection_transition:new s.br(Ce,ze.u_projection_transition),u_projection_fallback_matrix:new s.c1(Ce,ze.u_projection_fallback_matrix)}))(t,Re),this.binderUniforms=u?u.getUniforms(t,Re):[]}draw(t,n,u,p,y,x,M,E,z,R,j,N,G,X,ie,ne,re,ae,he){const se=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(p),t.setColorMode(y),t.setCullFace(x),E){t.activeTexture.set(se.TEXTURE2),se.bindTexture(se.TEXTURE_2D,E.depthTexture),t.activeTexture.set(se.TEXTURE3),se.bindTexture(se.TEXTURE_2D,E.texture);for(const ve in this.terrainUniforms)this.terrainUniforms[ve].set(E[ve])}if(z)for(const ve in z)this.projectionUniforms[$a[ve]].set(z[ve]);if(M)for(const ve in this.fixedUniforms)this.fixedUniforms[ve].set(M[ve]);ne&&ne.setUniforms(t,this.binderUniforms,X,{zoom:ie});let de=0;switch(n){case se.LINES:de=2;break;case se.TRIANGLES:de=3;break;case se.LINE_STRIP:de=1}for(const ve of G.get()){const ce=ve.vaos||(ve.vaos={});(ce[R]||(ce[R]=new al)).bind(t,this,j,ne?ne.getPaintVertexBuffers():[],N,ve.vertexOffset,re,ae,he),se.drawElements(n,ve.primitiveLength*de,se.UNSIGNED_SHORT,ve.primitiveOffset*de*2)}}}function Lu(g,t,n){const u=1/s.aO(n,1,t.transform.tileZoom),p=Math.pow(2,n.tileID.overscaledZ),y=n.tileSize*Math.pow(2,t.transform.tileZoom)/p,x=y*(n.tileID.canonical.x+n.tileID.wrap*p),M=y*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[u,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[x>>16,M>>16],u_pixel_coord_lower:[65535&x,65535&M]}}const Nn=(g,t,n,u)=>{const p=g.style.light,y=p.properties.get("position"),x=[y.x,y.y,y.z],M=s.c5();p.properties.get("anchor")==="viewport"&&s.c6(M,g.transform.bearingInRadians),s.c7(x,x,M);const E=g.transform.transformLightDirection(x),z=p.properties.get("color");return{u_lightpos:x,u_lightpos_globe:E,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+t,u_opacity:n,u_fill_translate:u}},Nl=(g,t,n,u,p,y,x)=>s.e(Nn(g,t,n,u),Lu(y,g,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),Uo=(g,t,n,u)=>s.e(Lu(t,g,n),{u_fill_translate:u}),ku=(g,t)=>({u_world:g,u_fill_translate:t}),qa=(g,t,n,u,p)=>s.e(Uo(g,t,n,p),{u_world:u}),jl=(g,t,n,u,p)=>{const y=g.transform;let x,M,E=0;if(n.paint.get("circle-pitch-alignment")==="map"){const z=s.aO(t,1,y.zoom);x=!0,M=[z,z],E=z/(s.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*p}else x=!1,M=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:M,u_globe_extrude_scale:E,u_translate:u}},eo=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),zu=g=>({u_viewport_size:[g.width,g.height]}),to=(g,t=1)=>({u_color:g,u_overlay:0,u_overlay_scale:t}),yo=(g,t,n,u)=>{const p=s.aO(g,1,t)/(s.a5*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:s.aO(g,1,t),u_intensity:n,u_globe_extrude_scale:p}},Du=(g,t,n,u)=>{const p=s.N();s.c8(p,0,g.width,g.height,0,0,1);const y=g.context.gl;return{u_matrix:p,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:n,u_color_ramp:u,u_opacity:t.paint.get("heatmap-opacity")}},Wa=(g,t,n)=>{const u=n.paint.get("hillshade-accent-color");let p;switch(n.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const y=n.getIlluminationProperties();for(let x=0;x<y.directionRadians.length;x++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[x]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:vo(0,t.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:u,u_method:p,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},Vc=(g,t)=>{const n=t.stride,u=s.N();return s.c8(u,0,s.a5,-s.a5,0,0,1),s.O(u,u,[0,-s.a5,0]),{u_matrix:u,u_image:1,u_dimension:[n,n],u_zoom:g.overscaledZ,u_unpack:t.getUnpackVector()}};function vo(g,t){const n=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new s.ab(0,u/n).toLngLat().lat,new s.ab(0,(u+1)/n).toLngLat().lat]}const Ru=(g,t,n=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:g.paint.get("color-relief-opacity")}),io=(g,t,n,u)=>{const p=g.transform;return{u_translation:pa(g,t,n),u_ratio:u/s.aO(t,1,p.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Fu=(g,t,n,u,p)=>s.e(io(g,t,n,u),{u_image:0,u_image_height:p}),jn=(g,t,n,u,p)=>{const y=g.transform,x=yn(t,y);return{u_translation:pa(g,t,n),u_texsize:t.imageAtlasTexture.size,u_ratio:u/s.aO(t,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[x,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Is=(g,t,n,u,p)=>{const y=yn(t,g.transform);return s.e(io(g,t,n,u),{u_tileratio:y,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image:0,u_mix:p.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})},As=(g,t,n,u,p,y)=>{const x=yn(t,g.transform);return s.e(io(g,t,n,u),{u_image:0,u_image_height:y,u_tileratio:x,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image_dash:1,u_mix:p.t,u_lineatlas_width:g.lineAtlas.width,u_lineatlas_height:g.lineAtlas.height})};function yn(g,t){return 1/s.aO(g,1,t.tileZoom)}function pa(g,t,n){return s.aP(g.transform,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Es=(g,t,n,u,p)=>{return{u_tl_parent:g,u_scale_parent:t,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(y=u.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ha(u.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var y,x};function Ha(g){g*=Math.PI/180;const t=Math.sin(g),n=Math.cos(g);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Zo=(g,t,n,u,p,y,x,M,E,z,R,j,N)=>{const G=x.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:G.width/G.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:M,u_coord_matrix:E,u_is_text:+R,u_pitch_with_map:+u,u_is_along_line:p,u_is_variable_anchor:y,u_texsize:j,u_texture:0,u_translation:z,u_pitched_scale:N}},da=(g,t,n,u,p,y,x,M,E,z,R,j,N,G)=>{const X=x.transform;return s.e(Zo(g,t,n,u,p,y,x,M,E,z,R,j,G),{u_gamma_scale:u?Math.cos(X.pitch*Math.PI/180)*X.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},xo=(g,t,n,u,p,y,x,M,E,z,R,j,N)=>s.e(da(g,t,n,u,p,y,x,M,E,z,!0,R,0,N),{u_texsize_icon:j,u_texture_icon:1}),sl=(g,t)=>({u_opacity:g,u_color:t}),Uc=(g,t,n,u,p)=>s.e((function(y,x,M,E){const z=M.imageManager.getPattern(y.from.toString()),R=M.imageManager.getPattern(y.to.toString()),{width:j,height:N}=M.imageManager.getPixelSize(),G=Math.pow(2,E.tileID.overscaledZ),X=E.tileSize*Math.pow(2,M.transform.tileZoom)/G,ie=X*(E.tileID.canonical.x+E.tileID.wrap*G),ne=X*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,N],u_mix:x.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/s.aO(E,1,M.transform.tileZoom),u_pixel_coord_upper:[ie>>16,ne>>16],u_pixel_coord_lower:[65535&ie,65535&ne]}})(n,p,t,u),{u_opacity:g}),Cs=(g,t)=>{},Zc={fillExtrusion:(g,t)=>({u_lightpos:new s.c3(g,t.u_lightpos),u_lightpos_globe:new s.c3(g,t.u_lightpos_globe),u_lightintensity:new s.br(g,t.u_lightintensity),u_lightcolor:new s.c3(g,t.u_lightcolor),u_vertical_gradient:new s.br(g,t.u_vertical_gradient),u_opacity:new s.br(g,t.u_opacity),u_fill_translate:new s.c4(g,t.u_fill_translate)}),fillExtrusionPattern:(g,t)=>({u_lightpos:new s.c3(g,t.u_lightpos),u_lightpos_globe:new s.c3(g,t.u_lightpos_globe),u_lightintensity:new s.br(g,t.u_lightintensity),u_lightcolor:new s.c3(g,t.u_lightcolor),u_vertical_gradient:new s.br(g,t.u_vertical_gradient),u_height_factor:new s.br(g,t.u_height_factor),u_opacity:new s.br(g,t.u_opacity),u_fill_translate:new s.c4(g,t.u_fill_translate),u_image:new s.b$(g,t.u_image),u_texsize:new s.c4(g,t.u_texsize),u_pixel_coord_upper:new s.c4(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.c4(g,t.u_pixel_coord_lower),u_scale:new s.c3(g,t.u_scale),u_fade:new s.br(g,t.u_fade)}),fill:(g,t)=>({u_fill_translate:new s.c4(g,t.u_fill_translate)}),fillPattern:(g,t)=>({u_image:new s.b$(g,t.u_image),u_texsize:new s.c4(g,t.u_texsize),u_pixel_coord_upper:new s.c4(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.c4(g,t.u_pixel_coord_lower),u_scale:new s.c3(g,t.u_scale),u_fade:new s.br(g,t.u_fade),u_fill_translate:new s.c4(g,t.u_fill_translate)}),fillOutline:(g,t)=>({u_world:new s.c4(g,t.u_world),u_fill_translate:new s.c4(g,t.u_fill_translate)}),fillOutlinePattern:(g,t)=>({u_world:new s.c4(g,t.u_world),u_image:new s.b$(g,t.u_image),u_texsize:new s.c4(g,t.u_texsize),u_pixel_coord_upper:new s.c4(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.c4(g,t.u_pixel_coord_lower),u_scale:new s.c3(g,t.u_scale),u_fade:new s.br(g,t.u_fade),u_fill_translate:new s.c4(g,t.u_fill_translate)}),circle:(g,t)=>({u_camera_to_center_distance:new s.br(g,t.u_camera_to_center_distance),u_scale_with_map:new s.b$(g,t.u_scale_with_map),u_pitch_with_map:new s.b$(g,t.u_pitch_with_map),u_extrude_scale:new s.c4(g,t.u_extrude_scale),u_device_pixel_ratio:new s.br(g,t.u_device_pixel_ratio),u_globe_extrude_scale:new s.br(g,t.u_globe_extrude_scale),u_translate:new s.c4(g,t.u_translate)}),collisionBox:(g,t)=>({u_pixel_extrude_scale:new s.c4(g,t.u_pixel_extrude_scale)}),collisionCircle:(g,t)=>({u_viewport_size:new s.c4(g,t.u_viewport_size)}),debug:(g,t)=>({u_color:new s.c0(g,t.u_color),u_overlay:new s.b$(g,t.u_overlay),u_overlay_scale:new s.br(g,t.u_overlay_scale)}),depth:Cs,clippingMask:Cs,heatmap:(g,t)=>({u_extrude_scale:new s.br(g,t.u_extrude_scale),u_intensity:new s.br(g,t.u_intensity),u_globe_extrude_scale:new s.br(g,t.u_globe_extrude_scale)}),heatmapTexture:(g,t)=>({u_matrix:new s.c1(g,t.u_matrix),u_world:new s.c4(g,t.u_world),u_image:new s.b$(g,t.u_image),u_color_ramp:new s.b$(g,t.u_color_ramp),u_opacity:new s.br(g,t.u_opacity)}),hillshade:(g,t)=>({u_image:new s.b$(g,t.u_image),u_latrange:new s.c4(g,t.u_latrange),u_exaggeration:new s.br(g,t.u_exaggeration),u_altitudes:new s.ca(g,t.u_altitudes),u_azimuths:new s.ca(g,t.u_azimuths),u_accent:new s.c0(g,t.u_accent),u_method:new s.b$(g,t.u_method),u_shadows:new s.c9(g,t.u_shadows),u_highlights:new s.c9(g,t.u_highlights)}),hillshadePrepare:(g,t)=>({u_matrix:new s.c1(g,t.u_matrix),u_image:new s.b$(g,t.u_image),u_dimension:new s.c4(g,t.u_dimension),u_zoom:new s.br(g,t.u_zoom),u_unpack:new s.c2(g,t.u_unpack)}),colorRelief:(g,t)=>({u_image:new s.b$(g,t.u_image),u_unpack:new s.c2(g,t.u_unpack),u_dimension:new s.c4(g,t.u_dimension),u_elevation_stops:new s.b$(g,t.u_elevation_stops),u_color_stops:new s.b$(g,t.u_color_stops),u_color_ramp_size:new s.b$(g,t.u_color_ramp_size),u_opacity:new s.br(g,t.u_opacity)}),line:(g,t)=>({u_translation:new s.c4(g,t.u_translation),u_ratio:new s.br(g,t.u_ratio),u_device_pixel_ratio:new s.br(g,t.u_device_pixel_ratio),u_units_to_pixels:new s.c4(g,t.u_units_to_pixels)}),lineGradient:(g,t)=>({u_translation:new s.c4(g,t.u_translation),u_ratio:new s.br(g,t.u_ratio),u_device_pixel_ratio:new s.br(g,t.u_device_pixel_ratio),u_units_to_pixels:new s.c4(g,t.u_units_to_pixels),u_image:new s.b$(g,t.u_image),u_image_height:new s.br(g,t.u_image_height)}),linePattern:(g,t)=>({u_translation:new s.c4(g,t.u_translation),u_texsize:new s.c4(g,t.u_texsize),u_ratio:new s.br(g,t.u_ratio),u_device_pixel_ratio:new s.br(g,t.u_device_pixel_ratio),u_image:new s.b$(g,t.u_image),u_units_to_pixels:new s.c4(g,t.u_units_to_pixels),u_scale:new s.c3(g,t.u_scale),u_fade:new s.br(g,t.u_fade)}),lineSDF:(g,t)=>({u_translation:new s.c4(g,t.u_translation),u_ratio:new s.br(g,t.u_ratio),u_device_pixel_ratio:new s.br(g,t.u_device_pixel_ratio),u_units_to_pixels:new s.c4(g,t.u_units_to_pixels),u_image:new s.b$(g,t.u_image),u_mix:new s.br(g,t.u_mix),u_tileratio:new s.br(g,t.u_tileratio),u_crossfade_from:new s.br(g,t.u_crossfade_from),u_crossfade_to:new s.br(g,t.u_crossfade_to),u_lineatlas_width:new s.br(g,t.u_lineatlas_width),u_lineatlas_height:new s.br(g,t.u_lineatlas_height)}),lineGradientSDF:(g,t)=>({u_translation:new s.c4(g,t.u_translation),u_ratio:new s.br(g,t.u_ratio),u_device_pixel_ratio:new s.br(g,t.u_device_pixel_ratio),u_units_to_pixels:new s.c4(g,t.u_units_to_pixels),u_image:new s.b$(g,t.u_image),u_image_height:new s.br(g,t.u_image_height),u_tileratio:new s.br(g,t.u_tileratio),u_crossfade_from:new s.br(g,t.u_crossfade_from),u_crossfade_to:new s.br(g,t.u_crossfade_to),u_image_dash:new s.b$(g,t.u_image_dash),u_mix:new s.br(g,t.u_mix),u_lineatlas_width:new s.br(g,t.u_lineatlas_width),u_lineatlas_height:new s.br(g,t.u_lineatlas_height)}),raster:(g,t)=>({u_tl_parent:new s.c4(g,t.u_tl_parent),u_scale_parent:new s.br(g,t.u_scale_parent),u_buffer_scale:new s.br(g,t.u_buffer_scale),u_fade_t:new s.br(g,t.u_fade_t),u_opacity:new s.br(g,t.u_opacity),u_image0:new s.b$(g,t.u_image0),u_image1:new s.b$(g,t.u_image1),u_brightness_low:new s.br(g,t.u_brightness_low),u_brightness_high:new s.br(g,t.u_brightness_high),u_saturation_factor:new s.br(g,t.u_saturation_factor),u_contrast_factor:new s.br(g,t.u_contrast_factor),u_spin_weights:new s.c3(g,t.u_spin_weights),u_coords_top:new s.c2(g,t.u_coords_top),u_coords_bottom:new s.c2(g,t.u_coords_bottom)}),symbolIcon:(g,t)=>({u_is_size_zoom_constant:new s.b$(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b$(g,t.u_is_size_feature_constant),u_size_t:new s.br(g,t.u_size_t),u_size:new s.br(g,t.u_size),u_camera_to_center_distance:new s.br(g,t.u_camera_to_center_distance),u_pitch:new s.br(g,t.u_pitch),u_rotate_symbol:new s.b$(g,t.u_rotate_symbol),u_aspect_ratio:new s.br(g,t.u_aspect_ratio),u_fade_change:new s.br(g,t.u_fade_change),u_label_plane_matrix:new s.c1(g,t.u_label_plane_matrix),u_coord_matrix:new s.c1(g,t.u_coord_matrix),u_is_text:new s.b$(g,t.u_is_text),u_pitch_with_map:new s.b$(g,t.u_pitch_with_map),u_is_along_line:new s.b$(g,t.u_is_along_line),u_is_variable_anchor:new s.b$(g,t.u_is_variable_anchor),u_texsize:new s.c4(g,t.u_texsize),u_texture:new s.b$(g,t.u_texture),u_translation:new s.c4(g,t.u_translation),u_pitched_scale:new s.br(g,t.u_pitched_scale)}),symbolSDF:(g,t)=>({u_is_size_zoom_constant:new s.b$(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b$(g,t.u_is_size_feature_constant),u_size_t:new s.br(g,t.u_size_t),u_size:new s.br(g,t.u_size),u_camera_to_center_distance:new s.br(g,t.u_camera_to_center_distance),u_pitch:new s.br(g,t.u_pitch),u_rotate_symbol:new s.b$(g,t.u_rotate_symbol),u_aspect_ratio:new s.br(g,t.u_aspect_ratio),u_fade_change:new s.br(g,t.u_fade_change),u_label_plane_matrix:new s.c1(g,t.u_label_plane_matrix),u_coord_matrix:new s.c1(g,t.u_coord_matrix),u_is_text:new s.b$(g,t.u_is_text),u_pitch_with_map:new s.b$(g,t.u_pitch_with_map),u_is_along_line:new s.b$(g,t.u_is_along_line),u_is_variable_anchor:new s.b$(g,t.u_is_variable_anchor),u_texsize:new s.c4(g,t.u_texsize),u_texture:new s.b$(g,t.u_texture),u_gamma_scale:new s.br(g,t.u_gamma_scale),u_device_pixel_ratio:new s.br(g,t.u_device_pixel_ratio),u_is_halo:new s.b$(g,t.u_is_halo),u_translation:new s.c4(g,t.u_translation),u_pitched_scale:new s.br(g,t.u_pitched_scale)}),symbolTextAndIcon:(g,t)=>({u_is_size_zoom_constant:new s.b$(g,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.b$(g,t.u_is_size_feature_constant),u_size_t:new s.br(g,t.u_size_t),u_size:new s.br(g,t.u_size),u_camera_to_center_distance:new s.br(g,t.u_camera_to_center_distance),u_pitch:new s.br(g,t.u_pitch),u_rotate_symbol:new s.b$(g,t.u_rotate_symbol),u_aspect_ratio:new s.br(g,t.u_aspect_ratio),u_fade_change:new s.br(g,t.u_fade_change),u_label_plane_matrix:new s.c1(g,t.u_label_plane_matrix),u_coord_matrix:new s.c1(g,t.u_coord_matrix),u_is_text:new s.b$(g,t.u_is_text),u_pitch_with_map:new s.b$(g,t.u_pitch_with_map),u_is_along_line:new s.b$(g,t.u_is_along_line),u_is_variable_anchor:new s.b$(g,t.u_is_variable_anchor),u_texsize:new s.c4(g,t.u_texsize),u_texsize_icon:new s.c4(g,t.u_texsize_icon),u_texture:new s.b$(g,t.u_texture),u_texture_icon:new s.b$(g,t.u_texture_icon),u_gamma_scale:new s.br(g,t.u_gamma_scale),u_device_pixel_ratio:new s.br(g,t.u_device_pixel_ratio),u_is_halo:new s.b$(g,t.u_is_halo),u_translation:new s.c4(g,t.u_translation),u_pitched_scale:new s.br(g,t.u_pitched_scale)}),background:(g,t)=>({u_opacity:new s.br(g,t.u_opacity),u_color:new s.c0(g,t.u_color)}),backgroundPattern:(g,t)=>({u_opacity:new s.br(g,t.u_opacity),u_image:new s.b$(g,t.u_image),u_pattern_tl_a:new s.c4(g,t.u_pattern_tl_a),u_pattern_br_a:new s.c4(g,t.u_pattern_br_a),u_pattern_tl_b:new s.c4(g,t.u_pattern_tl_b),u_pattern_br_b:new s.c4(g,t.u_pattern_br_b),u_texsize:new s.c4(g,t.u_texsize),u_mix:new s.br(g,t.u_mix),u_pattern_size_a:new s.c4(g,t.u_pattern_size_a),u_pattern_size_b:new s.c4(g,t.u_pattern_size_b),u_scale_a:new s.br(g,t.u_scale_a),u_scale_b:new s.br(g,t.u_scale_b),u_pixel_coord_upper:new s.c4(g,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.c4(g,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.br(g,t.u_tile_units_to_pixels)}),terrain:(g,t)=>({u_texture:new s.b$(g,t.u_texture),u_ele_delta:new s.br(g,t.u_ele_delta),u_fog_matrix:new s.c1(g,t.u_fog_matrix),u_fog_color:new s.c0(g,t.u_fog_color),u_fog_ground_blend:new s.br(g,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.br(g,t.u_fog_ground_blend_opacity),u_horizon_color:new s.c0(g,t.u_horizon_color),u_horizon_fog_blend:new s.br(g,t.u_horizon_fog_blend),u_is_globe_mode:new s.br(g,t.u_is_globe_mode)}),terrainDepth:(g,t)=>({u_ele_delta:new s.br(g,t.u_ele_delta)}),terrainCoords:(g,t)=>({u_texture:new s.b$(g,t.u_texture),u_terrain_coords_id:new s.br(g,t.u_terrain_coords_id),u_ele_delta:new s.br(g,t.u_ele_delta)}),projectionErrorMeasurement:(g,t)=>({u_input:new s.br(g,t.u_input),u_output_expected:new s.br(g,t.u_output_expected)}),atmosphere:(g,t)=>({u_sun_pos:new s.c3(g,t.u_sun_pos),u_atmosphere_blend:new s.br(g,t.u_atmosphere_blend),u_globe_position:new s.c3(g,t.u_globe_position),u_globe_radius:new s.br(g,t.u_globe_radius),u_inv_proj_matrix:new s.c1(g,t.u_inv_proj_matrix)}),sky:(g,t)=>({u_sky_color:new s.c0(g,t.u_sky_color),u_horizon_color:new s.c0(g,t.u_horizon_color),u_horizon:new s.c4(g,t.u_horizon),u_horizon_normal:new s.c4(g,t.u_horizon_normal),u_sky_horizon_blend:new s.br(g,t.u_sky_horizon_blend),u_sky_blend:new s.br(g,t.u_sky_blend)})};class Bu{constructor(t,n,u){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ou={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Nu{constructor(t,n,u,p){this.length=n.length,this.attributes=u,this.itemSize=n.bytesPerElement,this.dynamicDraw=p,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let u=0;u<this.attributes.length;u++){const p=n.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,n,u){for(let p=0;p<this.attributes.length;p++){const y=this.attributes[p],x=n.attributes[y.name];x!==void 0&&t.vertexAttribPointer(x,y.components,t[Ou[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class oi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vn extends oi{getDefault(){return s.bq.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class fa extends oi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ll extends oi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Xa extends oi{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ma extends oi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ya extends oi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ka extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Fr extends oi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ju extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class ga extends oi{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ul extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Go extends oi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class cl extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Cn extends oi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ja extends oi{getDefault(){return s.bq.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ls extends oi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Qa extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class es extends oi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class bo extends oi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ts extends oi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class hl extends oi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Gt extends oi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pl extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Vu extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Vl extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class is extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Uu extends oi{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Zu extends oi{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const u=this.gl;_n(u)?u.bindVertexArray(t):(n=u.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Gu extends oi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class $u extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class dl extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class rs extends oi{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class l extends rs{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _ extends rs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class P extends rs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const k="Framebuffer is not complete";class V{constructor(t,n,u,p,y){this.context=t,this.width=n,this.height=u;const x=t.gl,M=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new l(t,M),p)this.depthAttachment=y?new P(t,M):new _(t,M);else if(y)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(k)}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class K{constructor(t){var n,u;if(this.gl=t,this.clearColor=new vn(this),this.clearDepth=new fa(this),this.clearStencil=new ll(this),this.colorMask=new Xa(this),this.depthMask=new ma(this),this.stencilMask=new Ya(this),this.stencilFunc=new Ka(this),this.stencilOp=new Fr(this),this.stencilTest=new ju(this),this.depthRange=new ga(this),this.depthTest=new ul(this),this.depthFunc=new Go(this),this.blend=new cl(this),this.blendFunc=new Cn(this),this.blendColor=new Ja(this),this.blendEquation=new Ls(this),this.cullFace=new Qa(this),this.cullFaceSide=new es(this),this.frontFace=new bo(this),this.program=new ts(this),this.activeTexture=new hl(this),this.viewport=new Gt(this),this.bindFramebuffer=new pl(this),this.bindRenderbuffer=new Vu(this),this.bindTexture=new Vl(this),this.bindVertexBuffer=new is(this),this.bindElementBuffer=new Uu(this),this.bindVertexArray=new Zu(this),this.pixelStoreUnpack=new Gu(this),this.pixelStoreUnpackPremultiplyAlpha=new $u(this),this.pixelStoreUnpackFlipY=new dl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),_n(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:p?.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:p?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new Bu(this,t,n)}createVertexBuffer(t,n,u){return new Nu(this,t,n,u)}createRenderbuffer(t,n,u){const p=this.gl,y=p.createRenderbuffer();return this.bindRenderbuffer.set(y),p.renderbufferStorage(p.RENDERBUFFER,t,n,u),this.bindRenderbuffer.set(null),y}createFramebuffer(t,n,u,p){return new V(this,t,n,u,p)}clear({color:t,depth:n,stencil:u}){const p=this.gl;let y=0;t&&(y|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(y|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),u!==void 0&&(y|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bS(t.blendFunction,Ti.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return _n(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return _n(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let _e;function Ae(g,t,n,u,p){const y=g.context,x=g.transform,M=y.gl,E=g.useProgram("collisionBox"),z=[];let R=0,j=0;for(let re=0;re<u.length;re++){const ae=u[re],he=t.getTile(ae).getBucket(n);if(!he)continue;const se=p?he.textCollisionBox:he.iconCollisionBox,de=he.collisionCircleArray;de.length>0&&(z.push({circleArray:de,circleOffset:j,coord:ae}),R+=de.length/4,j=R),se&&E.draw(y,M.LINES,Dt.disabled,Yt.disabled,g.colorModeForRenderPass(),Zt.disabled,eo(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(ae),x.getProjectionData({overscaledTileID:ae,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,null,g.transform.zoom,null,null,se.collisionVertexBuffer)}if(!p||!z.length)return;const N=g.useProgram("collisionCircle"),G=new s.cb;G.resize(4*R),G._trim();let X=0;for(const re of z)for(let ae=0;ae<re.circleArray.length/4;ae++){const he=4*ae,se=re.circleArray[he+0],de=re.circleArray[he+1],ve=re.circleArray[he+2],ce=re.circleArray[he+3];G.emplace(X++,se,de,ve,ce,0),G.emplace(X++,se,de,ve,ce,1),G.emplace(X++,se,de,ve,ce,2),G.emplace(X++,se,de,ve,ce,3)}(!_e||_e.length<2*R)&&(_e=(function(re){const ae=2*re,he=new s.cd;he.resize(ae),he._trim();for(let se=0;se<ae;se++){const de=6*se;he.uint16[de+0]=4*se+0,he.uint16[de+1]=4*se+1,he.uint16[de+2]=4*se+2,he.uint16[de+3]=4*se+2,he.uint16[de+4]=4*se+3,he.uint16[de+5]=4*se+0}return he})(R));const ie=y.createIndexBuffer(_e,!0),ne=y.createVertexBuffer(G,s.cc.members,!0);for(const re of z){const ae=zu(g.transform);N.draw(y,M.TRIANGLES,Dt.disabled,Yt.disabled,g.colorModeForRenderPass(),Zt.disabled,ae,g.style.map.terrain&&g.style.map.terrain.getTerrainData(re.coord),null,n.id,ne,ie,s.aY.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,g.transform.zoom,null,null,null)}ne.destroy(),ie.destroy()}const Ne=s.as(new Float32Array(16));function Qe(g,t,n,u,p,y){const{horizontalAlign:x,verticalAlign:M}=s.aT(g);return new s.P((-(x-.5)*t/p+u[0])*y,(-(M-.5)*n/p+u[1])*y)}function ft(g,t,n,u,p,y){const x=t.tileAnchorPoint.add(new s.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let M=u.mult(y);n||(M=M.rotate(-p));const E=x.add(M);return Rt(E.x,E.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(n){const M=pi(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(g),E=Math.atan(M.y/M.x)+(M.x<0?Math.PI:0);return g.add(u.rotate(E))}return g.add(u)}function Lt(g,t,n,u,p,y,x,M,E,z,R,j){const N=g.text.placedSymbolArray,G=g.text.dynamicLayoutVertexArray,X=g.icon.dynamicLayoutVertexArray,ie={};G.clear();for(let ne=0;ne<N.length;ne++){const re=N.get(ne),ae=re.hidden||!re.crossTileID||g.allowVerticalPlacement&&!re.placedOrientation?null:u[re.crossTileID];if(ae){const he=new s.P(re.anchorX,re.anchorY),se={getElevation:j,width:p.width,height:p.height,pitchedLabelPlaneMatrix:y,pitchWithMap:n,transform:p,tileAnchorPoint:he,translation:z,unwrappedTileID:R},de=n?Yn(he.x,he.y,se):pi(he.x,he.y,se),ve=gs(p.cameraToCenterDistance,de.signedDistanceFromCamera);let ce=s.aB(g.textSizeData,M,re)*ve/s.aN;n&&(ce*=g.tilePixelRatio/x);const{width:Te,height:Re,anchor:Ce,textOffset:ze,textBoxScale:Oe}=ae,He=Qe(Ce,Te,Re,ze,Oe,ce),et=p.getPitchedTextCorrection(he.x+z[0],he.y+z[1],R),We=ft(de.point,se,t,He,-p.bearingInRadians,et),gt=g.allowVerticalPlacement&&re.placedOrientation===s.aA.vertical?Math.PI/2:0;for(let zt=0;zt<re.numGlyphs;zt++)s.aH(G,We,gt);E&&re.associatedIconIndex>=0&&(ie[re.associatedIconIndex]={shiftedAnchor:We,angle:gt})}else gi(re.numGlyphs,G)}if(E){X.clear();const ne=g.icon.placedSymbolArray;for(let re=0;re<ne.length;re++){const ae=ne.get(re);if(ae.hidden)gi(ae.numGlyphs,X);else{const he=ie[re];if(he)for(let se=0;se<ae.numGlyphs;se++)s.aH(X,he.shiftedAnchor,he.angle);else gi(ae.numGlyphs,X)}}g.icon.dynamicLayoutVertexBuffer.updateData(X)}g.text.dynamicLayoutVertexBuffer.updateData(G)}function qt(g,t,n){return n.iconsInText&&t?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function dr(g,t,n,u,p,y,x,M,E,z,R,j,N){const G=g.context,X=G.gl,ie=g.transform,ne=M==="map",re=E==="map",ae=M!=="viewport"&&n.layout.get("symbol-placement")!=="point",he=ne&&!re&&!ae,se=!n.layout.get("symbol-sort-key").isConstant();let de=!1;const ve=g.getDepthModeForSublayer(0,Dt.ReadOnly),ce=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Te=[],Re=ie.getCircleRadiusCorrection();for(const Ce of u){const ze=t.getTile(Ce),Oe=ze.getBucket(n);if(!Oe)continue;const He=p?Oe.text:Oe.icon;if(!He||!He.segments.get().length||!He.hasVisibleVertices)continue;const et=He.programConfigurations.get(n.id),We=p||Oe.sdfIcons,gt=p?Oe.textSizeData:Oe.iconSizeData,zt=re||ie.pitch!==0,di=g.useProgram(qt(We,p,Oe),et),ki=s.az(gt,ie.zoom),yi=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ce);let Ni,Ai,Lr,Ri,vr=[0,0],nr=null;if(p)Ai=ze.glyphAtlasTexture,Lr=X.LINEAR,Ni=ze.glyphAtlasTexture.size,Oe.iconsInText&&(vr=ze.imageAtlasTexture.size,nr=ze.imageAtlasTexture,Ri=zt||g.options.rotating||g.options.zooming||gt.kind==="composite"||gt.kind==="camera"?X.LINEAR:X.NEAREST);else{const xr=n.layout.get("icon-size").constantOr(0)!==1||Oe.iconsNeedLinear;Ai=ze.imageAtlasTexture,Lr=We||g.options.rotating||g.options.zooming||xr||zt?X.LINEAR:X.NEAREST,Ni=ze.imageAtlasTexture.size}const or=s.aO(ze,1,g.transform.zoom),Kr=rn(ne,g.transform,or),Tn=s.N();s.aC(Tn,Kr);const Ho=Js(re,ne,g.transform,or),os=s.aP(ie,ze,y,x),Vs=ie.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),oc=ce&&Oe.hasTextData(),xl=n.layout.get("icon-text-fit")!=="none"&&oc&&Oe.hasIconData();if(ae){const xr=g.style.map.terrain?(Zn,Hi)=>g.style.map.terrain.getElevation(Ce,Zn,Hi):null,kr=n.layout.get("text-rotation-alignment")==="map";Qs(Oe,g,p,Kr,Tn,re,z,kr,Ce.toUnwrapped(),ie.width,ie.height,os,xr)}const Xo=p&&ce||xl,Br=ae||Xo?Ne:re?Kr:g.transform.clipSpaceToPixelsMatrix,sn=We&&n.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Jr;Jr=We?Oe.iconsInText?xo(gt.kind,ki,he,re,ae,Xo,g,Br,Ho,os,Ni,vr,Re):da(gt.kind,ki,he,re,ae,Xo,g,Br,Ho,os,p,Ni,0,Re):Zo(gt.kind,ki,he,re,ae,Xo,g,Br,Ho,os,p,Ni,Re);const oo={program:di,buffers:He,uniformValues:Jr,projectionData:Vs,atlasTexture:Ai,atlasTextureIcon:nr,atlasInterpolation:Lr,atlasInterpolationIcon:Ri,isSDF:We,hasHalo:sn};if(se&&Oe.canOverlap){de=!0;const xr=He.segments.get();for(const kr of xr)Te.push({segments:new s.aY([kr]),sortKey:kr.sortKey,state:oo,terrainData:yi})}else Te.push({segments:He.segments,sortKey:0,state:oo,terrainData:yi})}de&&Te.sort(((Ce,ze)=>Ce.sortKey-ze.sortKey));for(const Ce of Te){const ze=Ce.state;if(G.activeTexture.set(X.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,X.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(G.activeTexture.set(X.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),ze.isSDF){const Oe=ze.uniformValues;ze.hasHalo&&(Oe.u_is_halo=1,Ji(ze.buffers,Ce.segments,n,g,ze.program,ve,R,j,Oe,ze.projectionData,Ce.terrainData)),Oe.u_is_halo=0}Ji(ze.buffers,Ce.segments,n,g,ze.program,ve,R,j,ze.uniformValues,ze.projectionData,Ce.terrainData)}}function Ji(g,t,n,u,p,y,x,M,E,z,R){const j=u.context;p.draw(j,j.gl.TRIANGLES,y,x,M,Zt.backCCW,E,R,z,n.id,g.layoutVertexBuffer,g.indexBuffer,t,n.paint,u.transform.zoom,g.programConfigurations.get(n.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function xn(g,t,n,u,p){const y=g.context,x=y.gl,M=Yt.disabled,E=new Ti([x.ONE,x.ONE],s.bq.transparent,[!0,!0,!0,!0]),z=t.getBucket(n);if(!z)return;const R=u.key;let j=n.heatmapFbos.get(R);j||(j=ro(y,t.tileSize,t.tileSize),n.heatmapFbos.set(R,j)),y.bindFramebuffer.set(j.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:s.bq.transparent});const N=z.programConfigurations.get(n.id),G=g.useProgram("heatmap",N,!p),X=g.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ie=g.style.map.terrain.getTerrainData(u);G.draw(y,x.TRIANGLES,Dt.disabled,M,E,Zt.disabled,yo(t,g.transform.zoom,n.paint.get("heatmap-intensity"),1),ie,X,n.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,n.paint,g.transform.zoom,N)}function Yr(g,t,n,u,p){const y=g.context,x=y.gl,M=g.transform;y.setColorMode(g.colorModeForRenderPass());const E=fl(y,t),z=n.key,R=t.heatmapFbos.get(z);if(!R)return;y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,R.colorAttachment.get()),y.activeTexture.set(x.TEXTURE1),E.bind(x.LINEAR,x.CLAMP_TO_EDGE);const j=M.getProjectionData({overscaledTileID:n,applyTerrainMatrix:p,applyGlobeMatrix:!u});g.useProgram("heatmapTexture").draw(y,x.TRIANGLES,Dt.disabled,Yt.disabled,g.colorModeForRenderPass(),Zt.disabled,Du(g,t,0,1),null,j,t.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,t.paint,M.zoom),R.destroy(),t.heatmapFbos.delete(z)}function ro(g,t,n){var u,p;const y=g.gl,x=y.createTexture();y.bindTexture(y.TEXTURE_2D,x),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const M=(u=g.HALF_FLOAT)!==null&&u!==void 0?u:y.UNSIGNED_BYTE,E=(p=g.RGBA16F)!==null&&p!==void 0?p:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,E,t,n,0,y.RGBA,M,null);const z=g.createFramebuffer(t,n,!1,!1);return z.colorAttachment.set(x),z}function fl(g,t){return t.colorRampTexture||(t.colorRampTexture=new s.T(g,t.colorRamp,g.gl.RGBA)),t.colorRampTexture}function qu(g,t,n,u,p,y,x,M){let E=256;if(p.stepInterpolant){const z=t.getSource().maxzoom,R=x.canonical.z===z?Math.ceil(1<<g.transform.maxZoom-x.canonical.z):1;E=s.ao(s.cf(y.maxLineLength/s.a5*1024*R),256,n.maxTextureSize)}return M.gradient=s.cg({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:E,image:M.gradient||void 0,clips:y.lineClipsArray}),M.texture?M.texture.update(M.gradient):M.texture=new s.T(n,M.gradient,u.RGBA),M.version=p.gradientVersion,M.texture}function Wu(g,t,n,u,p){g.activeTexture.set(t.TEXTURE0),n.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),u.updatePaintBuffers(p)}function Bi(g,t,n,u,p,y){(p||g.lineAtlas.dirty)&&(t.activeTexture.set(n.TEXTURE0),g.lineAtlas.bind(t)),u.updatePaintBuffers(y)}function _a(g,t,n,u,p,y,x){const M=y.gradients[p.id];let E=M.texture;p.gradientVersion!==M.version&&(E=qu(g,t,n,u,p,y,x,M)),n.activeTexture.set(u.TEXTURE0),E.bind(p.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}function bn(g,t,n,u,p,y,x,M,E){const z=y.gradients[p.id];let R=z.texture;p.gradientVersion!==z.version&&(R=qu(g,t,n,u,p,y,x,z)),n.activeTexture.set(u.TEXTURE0),R.bind(p.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE),n.activeTexture.set(u.TEXTURE1),g.lineAtlas.bind(n),M.updatePaintBuffers(E)}function Oi(g,t,n,u,p){if(!n||!u||!u.imageAtlas)return;const y=u.imageAtlas.patternPositions;let x=y[n.to.toString()],M=y[n.from.toString()];if(!x&&M&&(x=M),!M&&x&&(M=x),!x||!M){const E=p.getPaintProperty(t);x=y[E],M=y[E]}x&&M&&g.setConstantPatternPositions(x,M)}function $o(g,t,n,u,p,y,x,M){const E=g.context.gl,z="fill-pattern",R=n.paint.get(z),j=R&&R.constantOr(1),N=n.getCrossfadeParameters();let G,X,ie,ne,re;const ae=g.transform,he=n.paint.get("fill-translate"),se=n.paint.get("fill-translate-anchor");x?(X=j&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=E.LINES):(X=j?"fillPattern":"fill",G=E.TRIANGLES);const de=R.constantOr(null);for(const ve of u){const ce=t.getTile(ve);if(j&&!ce.patternsLoaded())continue;const Te=ce.getBucket(n);if(!Te)continue;const Re=Te.programConfigurations.get(n.id),Ce=g.useProgram(X,Re),ze=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ve);j&&(g.context.activeTexture.set(E.TEXTURE0),ce.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Re.updatePaintBuffers(N)),Oi(Re,z,de,ce,n);const Oe=ae.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),He=s.aP(ae,ce,he,se);if(x){ne=Te.indexBuffer2,re=Te.segments2;const We=[E.drawingBufferWidth,E.drawingBufferHeight];ie=X==="fillOutlinePattern"&&j?qa(g,N,ce,We,He):ku(We,He)}else ne=Te.indexBuffer,re=Te.segments,ie=j?Uo(g,N,ce,He):{u_fill_translate:He};const et=g.stencilModeForClipping(ve);Ce.draw(g.context,G,p,et,y,Zt.backCCW,ie,ze,Oe,n.id,Te.layoutVertexBuffer,ne,re,n.paint,g.transform.zoom,Re)}}function ml(g,t,n,u,p,y,x,M){const E=g.context,z=E.gl,R="fill-extrusion-pattern",j=n.paint.get(R),N=j.constantOr(1),G=n.getCrossfadeParameters(),X=n.paint.get("fill-extrusion-opacity"),ie=j.constantOr(null),ne=g.transform;for(const re of u){const ae=t.getTile(re),he=ae.getBucket(n);if(!he)continue;const se=g.style.map.terrain&&g.style.map.terrain.getTerrainData(re),de=he.programConfigurations.get(n.id),ve=g.useProgram(N?"fillExtrusionPattern":"fillExtrusion",de);N&&(g.context.activeTexture.set(z.TEXTURE0),ae.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),de.updatePaintBuffers(G));const ce=ne.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!M,applyTerrainMatrix:!0});Oi(de,R,ie,ae,n);const Te=s.aP(ne,ae,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Re=n.paint.get("fill-extrusion-vertical-gradient"),Ce=N?Nl(g,Re,X,Te,re,G,ae):Nn(g,Re,X,Te);ve.draw(E,E.gl.TRIANGLES,p,y,x,Zt.backCCW,Ce,se,ce,n.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,n.paint,g.transform.zoom,de,g.style.map.terrain&&he.centroidVertexBuffer)}}function qo(g,t,n,u,p,y,x,M,E){var z;const R=g.style.projection,j=g.context,N=g.transform,G=j.gl,X=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],ie=g.useProgram("hillshade",null,!1,X),ne=!g.options.moving;for(const re of u){const ae=t.getTile(re),he=ae.fbo;if(!he)continue;const se=R.getMeshFromTileID(j,re.canonical,M,!0,"raster"),de=(z=g.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(re);j.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,he.colorAttachment.get());const ve=N.getProjectionData({overscaledTileID:re,aligned:ne,applyGlobeMatrix:!E,applyTerrainMatrix:!0});ie.draw(j,G.TRIANGLES,y,p[re.overscaledZ],x,Zt.backCCW,Wa(g,ae,n),de,ve,n.id,se.vertexBuffer,se.indexBuffer,se.segments)}}function ks(g,t,n,u,p,y,x,M,E){var z;const R=g.style.projection,j=g.context,N=g.transform,G=j.gl,X=g.useProgram("colorRelief"),ie=!g.options.moving;let ne=!0,re=0;for(const ae of u){const he=t.getTile(ae),se=he.dem;if(ne){const Ce=G.getParameter(G.MAX_TEXTURE_SIZE),{elevationTexture:ze,colorTexture:Oe}=n.getColorRampTextures(j,Ce,se.getUnpackVector());j.activeTexture.set(G.TEXTURE1),ze.bind(G.NEAREST,G.CLAMP_TO_EDGE),j.activeTexture.set(G.TEXTURE4),Oe.bind(G.LINEAR,G.CLAMP_TO_EDGE),ne=!1,re=ze.size[0]}if(!se||!se.data)continue;const de=se.stride,ve=se.getPixels();if(j.activeTexture.set(G.TEXTURE0),j.pixelStoreUnpackPremultiplyAlpha.set(!1),he.demTexture=he.demTexture||g.getTileTexture(de),he.demTexture){const Ce=he.demTexture;Ce.update(ve,{premultiply:!1}),Ce.bind(G.LINEAR,G.CLAMP_TO_EDGE)}else he.demTexture=new s.T(j,ve,G.RGBA,{premultiply:!1}),he.demTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const ce=R.getMeshFromTileID(j,ae.canonical,M,!0,"raster"),Te=(z=g.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(ae),Re=N.getProjectionData({overscaledTileID:ae,aligned:ie,applyGlobeMatrix:!E,applyTerrainMatrix:!0});X.draw(j,G.TRIANGLES,y,p[ae.overscaledZ],x,Zt.backCCW,Ru(n,he.dem,re),Te,Re,n.id,ce.vertexBuffer,ce.indexBuffer,ce.segments)}}const wo=[new s.P(0,0),new s.P(s.a5,0),new s.P(s.a5,s.a5),new s.P(0,s.a5)];function ya(g,t,n,u,p,y,x,M,E=!1,z=!1){const R=u[u.length-1].overscaledZ,j=g.context,N=j.gl,G=g.useProgram("raster"),X=g.transform,ie=g.style.projection,ne=g.colorModeForRenderPass(),re=!g.options.moving,ae=n.paint.get("raster-opacity"),he=n.paint.get("raster-resampling"),se=n.paint.get("raster-fade-duration"),de=!!g.style.map.terrain;for(const ve of u){const ce=g.getDepthModeForSublayer(ve.overscaledZ-R,ae===1?Dt.ReadWrite:Dt.ReadOnly,N.LESS),Te=t.getTile(ve),Re=he==="nearest"?N.NEAREST:N.LINEAR;j.activeTexture.set(N.TEXTURE0),Te.texture.bind(Re,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),j.activeTexture.set(N.TEXTURE1);const{parentTile:Ce,parentScaleBy:ze,parentTopLeft:Oe,fadeValues:He}=Hu(Te,t,se,de);Te.fadeOpacity=He.tileOpacity,Ce?(Ce.fadeOpacity=He.parentTileOpacity,Ce.texture.bind(Re,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST)):Te.texture.bind(Re,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),Te.texture.useMipmap&&j.extTextureFilterAnisotropic&&g.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const et=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ve),We=X.getProjectionData({overscaledTileID:ve,aligned:re,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),gt=Es(Oe,ze,He.fadeMix,n,M),zt=ie.getMeshFromTileID(j,ve.canonical,y,x,"raster");G.draw(j,N.TRIANGLES,ce,p?p[ve.overscaledZ]:Yt.disabled,ne,E?Zt.frontCCW:Zt.backCCW,gt,et,We,n.id,zt.vertexBuffer,zt.indexBuffer,zt.segments)}}function Hu(g,t,n,u){const p={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(n===0||u)return p;if(g.fadingParentID){const y=t.getLoadedTile(g.fadingParentID);if(!y)return p;const x=Math.pow(2,y.tileID.overscaledZ-g.tileID.overscaledZ),M=[g.tileID.canonical.x*x%1,g.tileID.canonical.y*x%1],E=(function(z,R,j){const N=be(),G=(N-R.timeAdded)/j,X=z.fadingDirection===De.Incoming,ie=s.ao((N-z.timeAdded)/j,0,1),ne=s.ao(1-G,0,1),re=X?ie:ne;return{tileOpacity:re,parentTileOpacity:X?ne:ie,fadeMix:{opacity:1,mix:1-re}}})(g,y,n);return{parentTile:y,parentScaleBy:x,parentTopLeft:M,fadeValues:E}}if(g.selfFading){const y=(function(x,M){const E=(be()-x.timeAdded)/M,z=s.ao(E,0,1);return{tileOpacity:z,fadeMix:{opacity:z,mix:0}}})(g,n);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:y}}return p}const sp=new s.bq(1,0,0,1),lp=new s.bq(0,1,0,1),up=new s.bq(0,0,1,1),cp=new s.bq(1,0,1,1),zs=new s.bq(0,1,1,1);function Gc(g,t,n,u){Ul(g,0,t+n/2,g.transform.width,n,u)}function $c(g,t,n,u){Ul(g,t-n/2,0,n,g.transform.height,u)}function Ul(g,t,n,u,p,y){const x=g.context,M=x.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*g.pixelRatio,n*g.pixelRatio,u*g.pixelRatio,p*g.pixelRatio),x.clear({color:y}),M.disable(M.SCISSOR_TEST)}function hp(g,t,n){const u=g.context,p=u.gl,y=g.useProgram("debug"),x=Dt.disabled,M=Yt.disabled,E=g.colorModeForRenderPass(),z="$debug",R=g.style.map.terrain&&g.style.map.terrain.getTerrainData(n);u.activeTexture.set(p.TEXTURE0);const j=t.getTileByID(n.key).latestRawTileData,N=Math.floor((j&&j.byteLength||0)/1024),G=t.getTile(n).tileSize,X=512/Math.min(G,512)*(n.overscaledZ/g.transform.zoom)*.5;let ie=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(ie+=` => ${n.overscaledZ}`),(function(re,ae){re.initDebugOverlayCanvas();const he=re.debugOverlayCanvas,se=re.context.gl,de=re.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,he.width,he.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(ae,5,5),de.strokeText(ae,5,5),re.debugOverlayTexture.update(he),re.debugOverlayTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE)})(g,`${ie} ${N}kB`);const ne=g.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(u,p.TRIANGLES,x,M,Ti.alphaBlended,Zt.disabled,to(s.bq.transparent,X),null,ne,z,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),y.draw(u,p.LINE_STRIP,x,M,E,Zt.disabled,to(s.bq.red),R,ne,z,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function qc(g,t,n,u){const{isRenderingGlobe:p}=u,y=g.context,x=y.gl,M=g.transform,E=g.colorModeForRenderPass(),z=g.getDepthModeFor3D(),R=g.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,g.width,g.height]);for(const j of n){const N=t.getTerrainMesh(j.tileID),G=g.renderToTexture.getTexture(j),X=t.getTerrainData(j.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,G.texture);const ie=t.getMeshFrameDelta(M.zoom),ne=M.calculateFogMatrix(j.tileID.toUnwrapped()),re=Cu(ie,ne,g.style.sky,M.pitch,p),ae=M.getProjectionData({overscaledTileID:j.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});R.draw(y,x.TRIANGLES,z,Yt.disabled,E,Zt.backCCW,re,X,ae,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function Wc(g,t){if(!t.mesh){const n=new s.aX;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const u=new s.aZ;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),t.mesh=new _i(g.createVertexBuffer(n,Jn.members),g.createIndexBuffer(u),s.aY.simpleSegment(0,0,n.length,u.length))}return t.mesh}class pp{constructor(t,n){this.context=new K(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=mn.maxOverzooming+mn.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new nn}resize(t,n,u){if(this.width=Math.floor(t*u),this.height=Math.floor(n*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,n=new s.aX;n.emplaceBack(0,0),n.emplaceBack(s.a5,0),n.emplaceBack(0,s.a5),n.emplaceBack(s.a5,s.a5),this.tileExtentBuffer=t.createVertexBuffer(n,Jn.members),this.tileExtentSegments=s.aY.simpleSegment(0,0,4,2);const u=new s.aX;u.emplaceBack(0,0),u.emplaceBack(s.a5,0),u.emplaceBack(0,s.a5),u.emplaceBack(s.a5,s.a5),this.debugBuffer=t.createVertexBuffer(u,Jn.members),this.debugSegments=s.aY.simpleSegment(0,0,4,5);const p=new s.ci;p.emplaceBack(0,0,0,0),p.emplaceBack(s.a5,0,s.a5,0),p.emplaceBack(0,s.a5,0,s.a5),p.emplaceBack(s.a5,s.a5,s.a5,s.a5),this.rasterBoundsBuffer=t.createVertexBuffer(p,jc.members),this.rasterBoundsSegments=s.aY.simpleSegment(0,0,4,2);const y=new s.aX;y.emplaceBack(0,0),y.emplaceBack(s.a5,0),y.emplaceBack(0,s.a5),y.emplaceBack(s.a5,s.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(y,Jn.members),this.rasterBoundsSegmentsPosOnly=s.aY.simpleSegment(0,0,4,5);const x=new s.aX;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(x,Jn.members),this.viewportSegments=s.aY.simpleSegment(0,0,4,2);const M=new s.cj;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(M);const E=new s.aZ;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const z=this.context.gl;this.stencilClearMode=new Yt({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new _i(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=s.N();s.c8(u,0,this.width,this.height,0,0,1),s.Q(u,u,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const p={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(t,n.TRIANGLES,Dt.disabled,this.stencilClearMode,Ti.disabled,Zt.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n,u){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source,this.nextStencilID+n.length>256&&this.clearStencil();const p=this.context;p.setColorMode(Ti.disabled),p.setDepthMode(Dt.disabled);const y={};for(const x of n)y[x.key]=this.nextStencilID++;this._renderTileMasks(y,n,u,!0),this._renderTileMasks(y,n,u,!1),this._tileClippingMaskIDs=y}_renderTileMasks(t,n,u,p){const y=this.context,x=y.gl,M=this.style.projection,E=this.transform,z=this.useProgram("clippingMask");for(const R of n){const j=t[R.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),G=M.getMeshFromTileID(this.context,R.canonical,p,!0,"stencil"),X=E.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!u,applyTerrainMatrix:!0});z.draw(y,x.TRIANGLES,Dt.disabled,new Yt({func:x.ALWAYS,mask:0},j,255,x.KEEP,x.KEEP,x.REPLACE),Ti.disabled,u?Zt.disabled:Zt.backCCW,null,N,X,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}_renderTilesDepthBuffer(){const t=this.context,n=t.gl,u=this.style.projection,p=this.transform,y=this.useProgram("depth"),x=this.getDepthModeFor3D(),M=Zi(p,{tileSize:p.tileSize});for(const E of M){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),R=u.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),j=p.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(t,n.TRIANGLES,x,Yt.disabled,Ti.disabled,Zt.backCCW,null,z,j,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Yt({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Yt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const n=this.context.gl,u=t.sort(((x,M)=>M.overscaledZ-x.overscaledZ)),p=u[u.length-1].overscaledZ,y=u[0].overscaledZ-p+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const x={};for(let M=0;M<y;M++)x[M+p]=new Yt({func:n.GEQUAL,mask:255},M+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=y,[x,u]}return[{[p]:Yt.disabled},u]}stencilConfigForOverlapTwoPass(t){const n=this.context.gl,u=t.sort(((x,M)=>M.overscaledZ-x.overscaledZ)),p=u[u.length-1].overscaledZ,y=u[0].overscaledZ-p+1;if(this.clearStencil(),y>1){const x={},M={};for(let E=0;E<y;E++)x[E+p]=new Yt({func:n.GREATER,mask:255},y+1+E,255,n.KEEP,n.KEEP,n.REPLACE),M[E+p]=new Yt({func:n.GREATER,mask:255},1+E,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*y+1,[x,M,u]}return this.nextStencilID=3,[{[p]:new Yt({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[p]:new Yt({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ti([t.CONSTANT_COLOR,t.ONE],new s.bq(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ti.unblended:Ti.alphaBlended}getDepthModeForSublayer(t,n,u){if(!this.opaquePassEnabledForLayer())return Dt.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dt(u||this.context.gl.LEQUAL,n,[p,p])}getDepthModeFor3D(){return new Dt(this.context.gl.LEQUAL,Dt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){var u,p;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(be()),this.imageManager.beginFrame();const y=this.style._order,x=this.style.tileManagers,M={},E={},z={},R={isRenderingToTexture:!1,isRenderingGlobe:((u=t.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const N in x){const G=x[N];G.used&&G.prepare(this.context),M[N]=G.getVisibleCoordinates(!1),E[N]=M[N].slice().reverse(),z[N]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<y.length;N++)if(this.style._layers[y[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of y){const G=this.style._layers[N];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const X=E[G.source];(G.type==="custom"||X.length)&&this.renderLayer(this,x[G.source],G,X,R)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?s.bq.black:s.bq.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(N,G){const X=N.context,ie=X.gl,ne=((ve,ce,Te)=>{const Re=Math.cos(ce.rollInRadians),Ce=Math.sin(ce.rollInRadians),ze=ci(ce),Oe=ce.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ve.properties.get("sky-color"),u_horizon_color:ve.properties.get("horizon-color"),u_horizon:[(ce.width/2-ze*Ce)*Te,(ce.height/2+ze*Re)*Te],u_horizon_normal:[-Ce,Re],u_sky_horizon_blend:ve.properties.get("sky-horizon-blend")*ce.height/2*Te,u_sky_blend:Oe}})(G,N.style.map.transform,N.pixelRatio),re=new Dt(ie.LEQUAL,Dt.ReadWrite,[0,1]),ae=Yt.disabled,he=N.colorModeForRenderPass(),se=N.useProgram("sky"),de=Wc(X,G);se.draw(X,ie.TRIANGLES,re,ae,he,Zt.disabled,ne,null,void 0,"sky",de.vertexBuffer,de.indexBuffer,de.segments)})(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[y[this.currentLayer]],G=x[N.source],X=M[N.source];this._renderTileClippingMasks(N,X,!1),this.renderLayer(this,G,N,X,R)}this.renderPass="translucent";let j=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const N=this.style._layers[y[this.currentLayer]],G=x[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,R))continue;this.opaquePassEnabledForLayer()||j||(j=!0,R.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const X=(N.type==="symbol"?z:E)[N.source];this._renderTileClippingMasks(N,M[N.source],!!this.renderToTexture),this.renderLayer(this,G,N,X,R)}if(R.isRenderingGlobe&&(function(N,G,X){const ie=N.context,ne=ie.gl,re=N.useProgram("atmosphere"),ae=new Dt(ne.LEQUAL,Dt.ReadOnly,[0,1]),he=N.transform,se=(function(Oe,He){const et=Oe.properties.get("position"),We=[-et.x,-et.y,-et.z],gt=s.as(new Float64Array(16));return Oe.properties.get("anchor")==="map"&&(s.bh(gt,gt,He.rollInRadians),s.bi(gt,gt,-He.pitchInRadians),s.bh(gt,gt,He.bearingInRadians),s.bi(gt,gt,He.center.lat*Math.PI/180),s.bK(gt,gt,-He.center.lng*Math.PI/180)),s.ch(We,We,gt),We})(X,N.transform),de=he.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ve=G.properties.get("atmosphere-blend")*de.projectionTransition;if(ve===0)return;const ce=fo(he.worldSize,he.center.lat),Te=he.inverseProjectionMatrix,Re=new Float64Array(4);Re[3]=1,s.aI(Re,Re,he.modelViewProjectionMatrix),Re[0]/=Re[3],Re[1]/=Re[3],Re[2]/=Re[3],Re[3]=1,s.aI(Re,Re,Te),Re[0]/=Re[3],Re[1]/=Re[3],Re[2]/=Re[3],Re[3]=1;const Ce=((Oe,He,et,We,gt)=>({u_sun_pos:Oe,u_atmosphere_blend:He,u_globe_position:et,u_globe_radius:We,u_inv_proj_matrix:gt}))(se,ve,[Re[0],Re[1],Re[2]],ce,Te),ze=Wc(ie,G);re.draw(ie,ne.TRIANGLES,ae,Yt.disabled,Ti.alphaBlended,Zt.disabled,Ce,null,null,"atmosphere",ze.vertexBuffer,ze.indexBuffer,ze.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const N=(function(G,X){let ie=null;const ne=Object.values(G._layers).flatMap((se=>se.source&&!se.isHidden(X)?[G.tileManagers[se.source]]:[])),re=ne.filter((se=>se.getSource().type==="vector")),ae=ne.filter((se=>se.getSource().type!=="vector")),he=se=>{(!ie||ie.getSource().maxzoom<se.getSource().maxzoom)&&(ie=se)};return re.forEach((se=>he(se))),ie||ae.forEach((se=>he(se))),ie})(this.style,this.transform.zoom);N&&(function(G,X,ie){for(let ne=0;ne<ie.length;ne++)hp(G,X,ie[ne])})(this,N,N.getVisibleCoordinates())}this.options.showPadding&&(function(N){const G=N.transform.padding;Gc(N,N.transform.height-(G.top||0),3,sp),Gc(N,G.bottom||0,3,lp),$c(N,G.left||0,3,up),$c(N,N.transform.width-(G.right||0),3,cp);const X=N.transform.centerPoint;(function(ie,ne,re,ae){Ul(ie,ne-1,re-10,2,20,ae),Ul(ie,ne-10,re-1,20,2,ae)})(N,X.x,N.transform.height-X.y,zs)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=t?!s.ck(n,u):!s.cl(n,u)),p||(p=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(s.cm(n,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(y,x){const M=y.context,E=M.gl,z=y.transform,R=Ti.unblended,j=new Dt(E.LEQUAL,Dt.ReadWrite,[0,1]),N=x.tileManager.getRenderableTiles(),G=y.useProgram("terrainDepth");M.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),M.clear({color:s.bq.transparent,depth:1});for(const X of N){const ie=x.getTerrainMesh(X.tileID),ne=x.getTerrainData(X.tileID),re=z.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ae={u_ele_delta:x.getMeshFrameDelta(z.zoom)};G.draw(M,E.TRIANGLES,j,Yt.disabled,R,Zt.backCCW,ae,ne,re,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain),(function(y,x){const M=y.context,E=M.gl,z=y.transform,R=Ti.unblended,j=new Dt(E.LEQUAL,Dt.ReadWrite,[0,1]),N=x.getCoordsTexture(),G=x.tileManager.getRenderableTiles(),X=y.useProgram("terrainCoords");M.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),M.clear({color:s.bq.transparent,depth:1}),x.coordsIndex=[];for(const ie of G){const ne=x.getTerrainMesh(ie.tileID),re=x.getTerrainData(ie.tileID);M.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,N.texture);const ae={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(z.zoom)},he=z.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});X.draw(M,E.TRIANGLES,j,Yt.disabled,R,Zt.backCCW,ae,re,he,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments),x.coordsIndex.push(ie.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain))}renderLayer(t,n,u,p,y){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(p||[]).length)&&(this.id=u.id,s.cn(u)?(function(x,M,E,z,R,j){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:N}=j,G=Yt.disabled,X=x.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ie,ne,re,ae,he,se,de,ve,ce){const Te=ne.transform,Re=ne.style.map.terrain,Ce=he==="map",ze=se==="map";for(const Oe of ie){const He=ae.getTile(Oe),et=He.getBucket(re);if(!et||!et.text||!et.text.segments.get().length)continue;const We=s.az(et.textSizeData,Te.zoom),gt=s.aO(He,1,ne.transform.zoom),zt=rn(Ce,ne.transform,gt),di=re.layout.get("icon-text-fit")!=="none"&&et.hasIconData();if(We){const ki=Math.pow(2,Te.zoom-He.tileID.overscaledZ),yi=Re?(Ni,Ai)=>Re.getElevation(Oe,Ni,Ai):null;Lt(et,Ce,ze,ce,Te,zt,ki,We,di,s.aP(Te,He,de,ve),Oe.toUnwrapped(),yi)}}})(z,x,E,M,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),R),E.paint.get("icon-opacity").constantOr(1)!==0&&dr(x,M,E,z,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),G,X,N),E.paint.get("text-opacity").constantOr(1)!==0&&dr(x,M,E,z,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),G,X,N),M.map.showCollisionBoxes&&(Ae(x,M,E,z,!0),Ae(x,M,E,z,!1))})(t,n,u,p,this.style.placement.variableOffsets,y):s.co(u)?(function(x,M,E,z,R){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=R,N=E.paint.get("circle-opacity"),G=E.paint.get("circle-stroke-width"),X=E.paint.get("circle-stroke-opacity"),ie=!E.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(G.constantOr(1)===0||X.constantOr(1)===0))return;const ne=x.context,re=ne.gl,ae=x.transform,he=x.getDepthModeForSublayer(0,Dt.ReadOnly),se=Yt.disabled,de=x.colorModeForRenderPass(),ve=[],ce=ae.getCircleRadiusCorrection();for(let Te=0;Te<z.length;Te++){const Re=z[Te],Ce=M.getTile(Re),ze=Ce.getBucket(E);if(!ze)continue;const Oe=E.paint.get("circle-translate"),He=E.paint.get("circle-translate-anchor"),et=s.aP(ae,Ce,Oe,He),We=ze.programConfigurations.get(E.id),gt=x.useProgram("circle",We),zt=ze.layoutVertexBuffer,di=ze.indexBuffer,ki=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Re),yi={programConfiguration:We,program:gt,layoutVertexBuffer:zt,indexBuffer:di,uniformValues:jl(x,Ce,E,et,ce),terrainData:ki,projectionData:ae.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!j,applyTerrainMatrix:!0})};if(ie){const Ni=ze.segments.get();for(const Ai of Ni)ve.push({segments:new s.aY([Ai]),sortKey:Ai.sortKey,state:yi})}else ve.push({segments:ze.segments,sortKey:0,state:yi})}ie&&ve.sort(((Te,Re)=>Te.sortKey-Re.sortKey));for(const Te of ve){const{programConfiguration:Re,program:Ce,layoutVertexBuffer:ze,indexBuffer:Oe,uniformValues:He,terrainData:et,projectionData:We}=Te.state;Ce.draw(ne,re.TRIANGLES,he,se,de,Zt.backCCW,He,et,We,E.id,ze,Oe,Te.segments,E.paint,x.transform.zoom,Re)}})(t,n,u,p,y):s.cp(u)?(function(x,M,E,z,R){if(E.paint.get("heatmap-opacity")===0)return;const j=x.context,{isRenderingToTexture:N,isRenderingGlobe:G}=R;if(x.style.map.terrain){for(const X of z){const ie=M.getTile(X);M.hasRenderableParent(X)||(x.renderPass==="offscreen"?xn(x,ie,E,X,G):x.renderPass==="translucent"&&Yr(x,E,X,N,G))}j.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?(function(X,ie,ne,re){const ae=X.context,he=ae.gl,se=X.transform,de=Yt.disabled,ve=new Ti([he.ONE,he.ONE],s.bq.transparent,[!0,!0,!0,!0]);(function(ce,Te,Re){const Ce=ce.gl;ce.activeTexture.set(Ce.TEXTURE1),ce.viewport.set([0,0,Te.width/4,Te.height/4]);let ze=Re.heatmapFbos.get(s.ce);ze?(Ce.bindTexture(Ce.TEXTURE_2D,ze.colorAttachment.get()),ce.bindFramebuffer.set(ze.framebuffer)):(ze=ro(ce,Te.width/4,Te.height/4),Re.heatmapFbos.set(s.ce,ze))})(ae,X,ne),ae.clear({color:s.bq.transparent});for(let ce=0;ce<re.length;ce++){const Te=re[ce];if(ie.hasRenderableParent(Te))continue;const Re=ie.getTile(Te),Ce=Re.getBucket(ne);if(!Ce)continue;const ze=Ce.programConfigurations.get(ne.id),Oe=X.useProgram("heatmap",ze),He=se.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),et=se.getCircleRadiusCorrection();Oe.draw(ae,he.TRIANGLES,Dt.disabled,de,ve,Zt.backCCW,yo(Re,se.zoom,ne.paint.get("heatmap-intensity"),et),null,He,ne.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,ne.paint,se.zoom,ze)}ae.viewport.set([0,0,X.width,X.height])})(x,M,E,z):x.renderPass==="translucent"&&(function(X,ie){const ne=X.context,re=ne.gl;ne.setColorMode(X.colorModeForRenderPass());const ae=ie.heatmapFbos.get(s.ce);ae&&(ne.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,ae.colorAttachment.get()),ne.activeTexture.set(re.TEXTURE1),fl(ne,ie).bind(re.LINEAR,re.CLAMP_TO_EDGE),X.useProgram("heatmapTexture").draw(ne,re.TRIANGLES,Dt.disabled,Yt.disabled,X.colorModeForRenderPass(),Zt.disabled,Du(X,ie,0,1),null,null,ie.id,X.viewportBuffer,X.quadTriangleIndexBuffer,X.viewportSegments,ie.paint,X.transform.zoom))})(x,E)})(t,n,u,p,y):s.cq(u)?(function(x,M,E,z,R){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=R,N=E.paint.get("line-opacity"),G=E.paint.get("line-width");if(N.constantOr(1)===0||G.constantOr(1)===0)return;const X=x.getDepthModeForSublayer(0,Dt.ReadOnly),ie=x.colorModeForRenderPass(),ne=E.paint.get("line-dasharray"),re=ne.constantOr(1),ae=E.paint.get("line-pattern"),he=ae.constantOr(1),se=E.paint.get("line-gradient"),de=E.getCrossfadeParameters();let ve;ve=he?"linePattern":re&&se?"lineGradientSDF":re?"lineSDF":se?"lineGradient":"line";const ce=x.context,Te=ce.gl,Re=x.transform;let Ce=!0;for(const ze of z){const Oe=M.getTile(ze);if(he&&!Oe.patternsLoaded())continue;const He=Oe.getBucket(E);if(!He)continue;const et=He.programConfigurations.get(E.id),We=x.context.program.get(),gt=x.useProgram(ve,et),zt=Ce||gt.program!==We,di=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ze),ki=ae.constantOr(null),yi=ne&&ne.constantOr(null);if(ki&&Oe.imageAtlas){const vr=Oe.imageAtlas,nr=vr.patternPositions[ki.to.toString()],or=vr.patternPositions[ki.from.toString()];nr&&or&&et.setConstantPatternPositions(nr,or)}else if(yi){const vr=E.layout.get("line-cap")==="round",nr=x.lineAtlas.getDash(yi.to,vr),or=x.lineAtlas.getDash(yi.from,vr);et.setConstantDashPositions(nr,or)}const Ni=Re.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),Ai=Re.getPixelScale();let Lr;he?(Lr=jn(x,Oe,E,Ai,de),Wu(ce,Te,Oe,et,de)):re&&se?(Lr=As(x,Oe,E,Ai,de,He.lineClipsArray.length),bn(x,M,ce,Te,E,He,ze,et,de)):re?(Lr=Is(x,Oe,E,Ai,de),Bi(x,ce,Te,et,zt,de)):se?(Lr=Fu(x,Oe,E,Ai,He.lineClipsArray.length),_a(x,M,ce,Te,E,He,ze)):Lr=io(x,Oe,E,Ai);const Ri=x.stencilModeForClipping(ze);gt.draw(ce,Te.TRIANGLES,X,Ri,ie,Zt.disabled,Lr,di,Ni,E.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,E.paint,x.transform.zoom,et,He.layoutVertexBuffer2),Ce=!1}})(t,n,u,p,y):s.cr(u)?(function(x,M,E,z,R){const j=E.paint.get("fill-color"),N=E.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const{isRenderingToTexture:G}=R,X=x.colorModeForRenderPass(),ie=E.paint.get("fill-pattern"),ne=x.opaquePassEnabledForLayer()&&!ie.constantOr(1)&&j.constantOr(s.bq.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===ne){const re=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly);$o(x,M,E,z,re,X,!1,G)}if(x.renderPass==="translucent"&&E.paint.get("fill-antialias")){const re=x.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly);$o(x,M,E,z,re,X,!0,G)}})(t,n,u,p,y):s.cs(u)?(function(x,M,E,z,R){const j=E.paint.get("fill-extrusion-opacity");if(j===0)return;const{isRenderingToTexture:N}=R;if(x.renderPass==="translucent"){const G=new Dt(x.context.gl.LEQUAL,Dt.ReadWrite,x.depthRangeFor3D);if(j!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))ml(x,M,E,z,G,Yt.disabled,Ti.disabled,N),ml(x,M,E,z,G,x.stencilModeFor3D(),x.colorModeForRenderPass(),N);else{const X=x.colorModeForRenderPass();ml(x,M,E,z,G,Yt.disabled,X,N)}}})(t,n,u,p,y):s.ct(u)?(function(x,M,E,z,R){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const{isRenderingToTexture:j}=R,N=x.context,G=x.style.projection.useSubdivision,X=x.getDepthModeForSublayer(0,Dt.ReadOnly),ie=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(ne,re,ae,he,se,de,ve){const ce=ne.context,Te=ce.gl;for(const Re of ae){const Ce=re.getTile(Re),ze=Ce.dem;if(!ze||!ze.data||!Ce.needsHillshadePrepare)continue;const Oe=ze.dim,He=ze.stride,et=ze.getPixels();if(ce.activeTexture.set(Te.TEXTURE1),ce.pixelStoreUnpackPremultiplyAlpha.set(!1),Ce.demTexture=Ce.demTexture||ne.getTileTexture(He),Ce.demTexture){const gt=Ce.demTexture;gt.update(et,{premultiply:!1}),gt.bind(Te.NEAREST,Te.CLAMP_TO_EDGE)}else Ce.demTexture=new s.T(ce,et,Te.RGBA,{premultiply:!1}),Ce.demTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);ce.activeTexture.set(Te.TEXTURE0);let We=Ce.fbo;if(!We){const gt=new s.T(ce,{width:Oe,height:Oe,data:null},Te.RGBA);gt.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),We=Ce.fbo=ce.createFramebuffer(Oe,Oe,!0,!1),We.colorAttachment.set(gt.texture)}ce.bindFramebuffer.set(We.framebuffer),ce.viewport.set([0,0,Oe,Oe]),ne.useProgram("hillshadePrepare").draw(ce,Te.TRIANGLES,se,de,ve,Zt.disabled,Vc(Ce.tileID,ze),null,null,he.id,ne.rasterBoundsBuffer,ne.quadTriangleIndexBuffer,ne.rasterBoundsSegments),Ce.needsHillshadePrepare=!1}})(x,M,z,E,X,Yt.disabled,ie),N.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if(G){const[ne,re,ae]=x.stencilConfigForOverlapTwoPass(z);qo(x,M,E,ae,ne,X,ie,!1,j),qo(x,M,E,ae,re,X,ie,!0,j)}else{const[ne,re]=x.getStencilConfigForOverlapAndUpdateStencilID(z);qo(x,M,E,re,ne,X,ie,!1,j)}})(t,n,u,p,y):s.cu(u)?(function(x,M,E,z,R){if(x.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:j}=R,N=x.style.projection.useSubdivision,G=x.getDepthModeForSublayer(0,Dt.ReadOnly),X=x.colorModeForRenderPass();if(N){const[ie,ne,re]=x.stencilConfigForOverlapTwoPass(z);ks(x,M,E,re,ie,G,X,!1,j),ks(x,M,E,re,ne,G,X,!0,j)}else{const[ie,ne]=x.getStencilConfigForOverlapAndUpdateStencilID(z);ks(x,M,E,ne,ie,G,X,!1,j)}})(t,n,u,p,y):s.bV(u)?(function(x,M,E,z,R){if(x.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:j}=R,N=M.getSource(),G=x.style.projection.useSubdivision;if(N instanceof en)ya(x,M,E,z,null,!1,!1,N.tileCoords,N.flippedWindingOrder,j);else if(G){const[X,ie,ne]=x.stencilConfigForOverlapTwoPass(z);ya(x,M,E,ne,X,!1,!0,wo,!1,j),ya(x,M,E,ne,ie,!0,!0,wo,!1,j)}else{const[X,ie]=x.getStencilConfigForOverlapAndUpdateStencilID(z);ya(x,M,E,ie,X,!1,!0,wo,!1,j)}})(t,n,u,p,y):s.cv(u)?(function(x,M,E,z,R){const j=E.paint.get("background-color"),N=E.paint.get("background-opacity");if(N===0)return;const{isRenderingToTexture:G}=R,X=x.context,ie=X.gl,ne=x.style.projection,re=x.transform,ae=re.tileSize,he=E.paint.get("background-pattern");if(x.isPatternMissing(he))return;const se=!he&&j.a===1&&N===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==se)return;const de=Yt.disabled,ve=x.getDepthModeForSublayer(0,se==="opaque"?Dt.ReadWrite:Dt.ReadOnly),ce=x.colorModeForRenderPass(),Te=x.useProgram(he?"backgroundPattern":"background"),Re=z||Zi(re,{tileSize:ae,terrain:x.style.map.terrain});he&&(X.activeTexture.set(ie.TEXTURE0),x.imageManager.bind(x.context));const Ce=E.getCrossfadeParameters();for(const ze of Re){const Oe=re.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),He=he?Uc(N,x,he,{tileID:ze,tileSize:ae},Ce):sl(N,j),et=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ze),We=ne.getMeshFromTileID(X,ze.canonical,!1,!0,"raster");Te.draw(X,ie.TRIANGLES,ve,de,ce,Zt.backCCW,He,et,Oe,E.id,We.vertexBuffer,We.indexBuffer,We.segments)}})(t,0,u,p,y):s.cw(u)&&(function(x,M,E,z){const{isRenderingGlobe:R}=z,j=x.context,N=E.implementation,G=x.style.projection,X=x.transform,ie=X.getProjectionDataForCustomLayer(R),ne={farZ:X.farZ,nearZ:X.nearZ,fov:X.fov*Math.PI/180,modelViewProjectionMatrix:X.modelViewProjectionMatrix,projectionMatrix:X.projectionMatrix,shaderData:{variantName:G.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${G.shaderPreludeCode.vertexSource}`,define:G.shaderDefine},defaultProjectionData:ie},re=N.renderingMode?N.renderingMode:"2d";if(x.renderPass==="offscreen"){const ae=N.prerender;ae&&(x.setCustomLayerDefaults(),j.setColorMode(x.colorModeForRenderPass()),ae.call(N,j.gl,ne),j.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),j.setColorMode(x.colorModeForRenderPass()),j.setStencilMode(Yt.disabled);const ae=re==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,Dt.ReadOnly);j.setDepthMode(ae),N.render(j.gl,ne),j.setDirty(),x.setBaseState(),j.bindFramebuffer.set(null)}})(t,0,u,y))}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!n||!u}useProgram(t,n,u=!1,p=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,x=this.style.projection,M=u?ni.projectionMercator:x.shaderPreludeCode,E=u?Er:x.shaderDefine,z=t+(n?n.cacheKey:"")+`/${u?Xr:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[z]||(this.cache[z]=new ha(this.context,ni[t],n,Zc[t],this._showOverdrawInspector,y,M,E,p)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,n;if(this._tileTextures){for(const u in this._tileTextures){const p=this._tileTextures[u];if(p)for(const y of p)y.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((n=this.tileExtentMesh.indexBuffer)===null||n===void 0||n.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const u in this.cache){const p=this.cache[u];p&&p.program&&this.context.gl.deleteProgram(p.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}function Hc(g,t){let n,u=!1,p=null,y=null;const x=()=>{p=null,u&&(g.apply(y,n),p=setTimeout(x,t),u=!1)};return(...M)=>(u=!0,y=this,n=M,p||x(),p)}class Zl{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let u;return n.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(u=p)})),(u&&u[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const u=n.join("/");let p=u;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${u}`);let y=window.location.hash.replace(p,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let x=window.location.href.replace(/(#.+)?$/,y);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=Hc(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const n=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,p),x=Math.round(n.lng*y)/y,M=Math.round(n.lat*y)/y,E=this._map.getBearing(),z=this._map.getPitch();let R="";if(R+=t?`/${x}/${M}/${u}`:`${u}/${M}/${x}`,(E||z)&&(R+="/"+Math.round(10*E)/10),z&&(R+=`/${Math.round(z)}`),this._hashName){const j=this._hashName;let N=!1;const G=window.location.hash.slice(1).split("&").map((X=>{const ie=X.split("=")[0];return ie===j?(N=!0,`${ie}=${R}`):X})).filter((X=>X));return N||G.push(`${j}=${R}`),`#${G.join("&")}`}return`#${R}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new s.V(+t[2],+t[1])}catch{return!1}const n=+t[0],u=+(t[3]||0),p=+(t[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&u>=-180&&u<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const gl={linearity:.3,easing:s.cx(0,0,.3,1)},no=s.e({deceleration:2500,maxSpeed:1400},gl),To=s.e({deceleration:20,maxSpeed:1400},gl),dp=s.e({deceleration:1e3,maxSpeed:360},gl),So=s.e({deceleration:1e3,maxSpeed:90},gl),Gd=s.e({deceleration:1e3,maxSpeed:360},gl);class _l{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:be(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=be();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)n.zoom+=y.zoomDelta||0,n.bearing+=y.bearingDelta||0,n.pitch+=y.pitchDelta||0,n.roll+=y.rollDelta||0,y.panDelta&&n.pan._add(y.panDelta),y.around&&(n.around=y.around),y.pinchAround&&(n.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(n.pan.mag()){const y=$l(n.pan.mag(),u,s.e({},no,t||{})),x=n.pan.mult(y.amount/n.pan.mag()),M=this._map.cameraHelper.handlePanInertia(x,this._map.transform);p.center=M.easingCenter,p.offset=M.easingOffset,Gl(p,y)}if(n.zoom){const y=$l(n.zoom,u,To);p.zoom=this._map.transform.zoom+y.amount,Gl(p,y)}if(n.bearing){const y=$l(n.bearing,u,dp);p.bearing=this._map.transform.bearing+s.ao(y.amount,-179,179),Gl(p,y)}if(n.pitch){const y=$l(n.pitch,u,So);p.pitch=this._map.transform.pitch+y.amount,Gl(p,y)}if(n.roll){const y=$l(n.roll,u,Gd);p.roll=this._map.transform.roll+s.ao(y.amount,-179,179),Gl(p,y)}if(p.zoom||p.bearing){const y=n.pinchAround===void 0?n.around:n.pinchAround;p.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),s.e(p,{noMoveStart:!0})}}function Gl(g,t){(!g.duration||g.duration<t.duration)&&(g.duration=t.duration,g.easing=t.easing)}function $l(g,t,n){const{maxSpeed:u,linearity:p,deceleration:y}=n,x=s.ao(g*p/(t/1e3),-u,u),M=Math.abs(x)/(y*p);return{easing:n.easing,duration:1e3*M,amount:x*(M/2)}}class Vn extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u,p={}){u=u instanceof MouseEvent?u:new MouseEvent(t,u);const y=me.mousePos(n.getCanvas(),u),x=n.unproject(y);super(t,s.e({point:y,lngLat:x,originalEvent:u},p)),this._defaultPrevented=!1,this.target=n}}class ql extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){const p=t==="touchend"?u.changedTouches:u.touches,y=me.touchPos(n.getCanvasContainer(),p),x=y.map((E=>n.unproject(E))),M=y.reduce(((E,z,R,j)=>E.add(z.div(j.length))),new s.P(0,0));super(t,{points:y,point:M,lngLats:x,lngLat:n.unproject(M),originalEvent:u}),this._defaultPrevented=!1}}class Xc extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class Wl{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Xc(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Vn(t.type,this._map,t))}mouseup(t){this._map.fire(new Vn(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Vn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Vn(t.type,this._map,t))}mouseover(t){this._map.fire(new Vn(t.type,this._map,t))}mouseout(t){this._map.fire(new Vn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ql(t.type,this._map,t))}touchmove(t){this._map.fire(new ql(t.type,this._map,t))}touchend(t){this._map.fire(new ql(t.type,this._map,t))}touchcancel(t){this._map.fire(new ql(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class va{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Vn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Vn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class st{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(s.P.convert(t),this._map.terrain)}}class Yc{constructor(t,n){this._map=t,this._tr=new st(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(me.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const u=n;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=u,this._box||(this._box=me.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(p.x,u.x),x=Math.max(p.x,u.x),M=Math.min(p.y,u.y),E=Math.max(p.y,u.y);me.setTransform(this._box,`translate(${y}px,${M}px)`),this._box.style.width=x-y+"px",this._box.style.height=E-M+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const u=this._startPos,p=n;if(this.reset(),me.suppressClick(),u.x!==p.x||u.y!==p.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(u,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(me.remove(this._box),this._box=null),me.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new s.l(t,{originalEvent:n}))}}function Hl(g,t){if(g.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${t.length}`);const n={};for(let u=0;u<g.length;u++)n[g[u].identifier]=t[u];return n}class fp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=(function(p){const y=new s.P(0,0);for(const x of p)y._add(x);return y.div(p.length)})(n),this.touches=Hl(u,n)))}touchmove(t,n,u){if(this.aborted||!this.centroid)return;const p=Hl(u,n);for(const y in this.touches){const x=p[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,n,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Ds{constructor(t){this.singleTap=new fp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,u){this.singleTap.touchstart(t,n,u)}touchmove(t,n,u){this.singleTap.touchmove(t,n,u)}touchend(t,n,u){const p=this.singleTap.touchend(t,n,u);if(p){const y=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(y&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Xl{constructor(t){this._tr=new st(t),this._zoomIn=new Ds({numTouches:1,numTaps:2}),this._zoomOut=new Ds({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,u){this._zoomIn.touchstart(t,n,u),this._zoomOut.touchstart(t,n,u)}touchmove(t,n,u){this._zoomIn.touchmove(t,n,u),this._zoomOut.touchmove(t,n,u)}touchend(t,n,u){const p=this._zoomIn.touchend(t,n,u),y=this._zoomOut.touchend(t,n,u),x=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(p)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rs{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=Array.isArray(n)?n[0]:n;return!this._moved&&p.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(u,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&me.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const $d=0,Kc=2,mp={[$d]:1,[Kc]:2};class Fs{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=me.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(n,u){const p=mp[u];return n.buttons===void 0||(n.buttons&p)!==p})(t,this._eventButton)}isValidEndEvent(t){return me.mouseButton(t)===this._eventButton}}class qd{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class gp{constructor(t=new Fs({checkCorrectEvent:()=>!0}),n=new qd){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(t,n,u){return t instanceof MouseEvent?n(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?u(t):void 0}startMove(t){this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.startMove(n)),(n=>this.oneFingerTouchMoveStateManager.startMove(n)))}endMove(t){this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.endMove(n)),(n=>this.oneFingerTouchMoveStateManager.endMove(n)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidStartEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidMoveEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(n=>this.mouseMoveStateManager.isValidEndEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n)))}}const Xu=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=t=>{t.preventDefault()}};class Wd{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,n,u){return this._calculateTransform(t,n,u)}touchmove(t,n,u){if(this._active){if(!this._shouldBePrevented(u.length))return t.preventDefault(),this._calculateTransform(t,n,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,n,u){this._calculateTransform(t,n,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,u){u.length>0&&(this._active=!0);const p=Hl(u,n),y=new s.P(0,0),x=new s.P(0,0);let M=0;for(const z in p){const R=p[z],j=this._touches[z];j&&(y._add(R),x._add(R.sub(j)),M++,p[z]=R)}if(this._touches=p,this._shouldBePrevented(M)||!x.mag())return;const E=x.div(M);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(M),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,u){if(!this._firstTwoTouches)return;t.preventDefault();const[p,y]=this._firstTwoTouches,x=Ku(u,n,p),M=Ku(u,n,y);if(!x||!M)return;const E=this._aroundCenter?null:x.add(M).div(2);return this._move([x,M],E,t)}touchend(t,n,u){if(!this._firstTwoTouches)return;const[p,y]=this._firstTwoTouches,x=Ku(u,n,p),M=Ku(u,n,y);x&&M||(this._active&&me.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ku(g,t,n){for(let u=0;u<g.length;u++)if(g[u].identifier===n)return t[u]}function Jc(g,t){return Math.log(g/t)/Math.LN2}class _p extends Yu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Jc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jc(this._distance,u),pinchAround:n}}}function yp(g,t){return 180*g.angleWith(t)/Math.PI}class xa extends Yu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,u){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:yp(this._vector,p),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,u=yp(t,this._startVector);return Math.abs(u)<n}}function Si(g){return Math.abs(g.y)>Math.abs(g.x)}class vp extends Yu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,u){super.touchstart(t,n,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,Si(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),y=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,y,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,y=n.mag()>=2;if(!p&&!y)return;if(!p||!y)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=t.y>0==n.y>0;return Si(t)&&Si(n)&&x}}const Ju={panStep:100,bearingStep:15,pitchStep:10};class Yl{constructor(t){this._tr=new st(t);const n=Ju;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,u=0,p=0,y=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:M=>{const E=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Qc,zoom:n?Math.round(E.zoom)+n*(t.shiftKey?2:1):E.zoom,bearing:E.bearing+u*this._bearingStep,pitch:E.pitch+p*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:E.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qc(g){return g*(2-g)}const eh=4.000244140625,xp=1/450;class th{constructor(t,n){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new st(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=xp}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=be(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,n!==0&&n%eh==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=me.mousePos(this._map.getCanvas(),t),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(s.V.convert(u.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const M=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=M),typeof this._targetZoom=="number"&&(this._targetZoom+=M)}if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>eh?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&E!==0&&(E=1/E);const z=typeof this._targetZoom!="number"?t.scale:s.ar(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),s.au(z*E)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,u=this._startZoom,p=this._easing;let y,x=!1;if(this._type==="wheel"&&u&&p){const M=be()-this._lastWheelEventTime,E=Math.min((M+5)/200,1),z=p(E);y=s.G.number(u,n,z),E<1?this._frameId||(this._frameId=!0):x=!0}else y=n,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!x,zoomDelta:y-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=s.cz;if(this._prevEase){const u=this._prevEase,p=(be()-u.start)/u.duration,y=u.easing(p+.01)-u.easing(p),x=.27/Math.sqrt(y*y+1e-4)*.01,M=Math.sqrt(.0729-x*x);n=s.cx(x,M,.25,1)}return this._prevEase={start:be(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class bp{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wo{constructor(t){this._tr=new st(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qu{constructor(){this._tap=new Ds({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,u){if(!this._swipePoint)if(this._tapTime){const p=n[0],y=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(p)<30;y&&x?u.length>0&&(this._swipePoint=p,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,n,u)}touchmove(t,n,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=n[0],y=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,n,u)}touchend(t,n,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const p=this._tap.touchend(t,n,u);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yt{constructor(t,n,u){this._el=t,this._mousePan=n,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class St{constructor(t,n,u,p){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=n,this._mousePitch=u,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class yl{constructor(t,n,u,p){this._el=t,this._touchZoom=n,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ih{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=me.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=n,this._container.appendChild(p);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=u,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(me.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,n){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:t,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Bs=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class wn extends s.l{}function Un(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class wp{constructor(t,n){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,y)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=p.type==="renderFrame"?void 0:p,M={needsRenderFrame:!1},E={},z={};for(const{handlerName:N,handler:G,allowed:X}of this._handlers){if(!G.isEnabled())continue;let ie;if(this._blockedByActive(z,X,N))G.reset();else if(G[y||p.type]){if(s.cA(p,y||p.type)){const ne=me.mousePos(this._map.getCanvas(),p);ie=G[y||p.type](p,ne)}else if(s.cB(p,y||p.type)){const ne=this._getMapTouches(p.touches),re=me.touchPos(this._map.getCanvas(),ne);ie=G[y||p.type](p,re,ne)}else s.cC(y||p.type)||(ie=G[y||p.type](p));this.mergeHandlerResult(M,E,ie,N,x),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()}(ie||G.isActive())&&(z[N]=G)}const R={};for(const N in this._previousActiveHandlers)z[N]||(R[N]=x);this._previousActiveHandlers=z,(Object.keys(R).length||Un(M))&&(this._changes.push([M,E,R]),this._triggerRenderFrame()),(Object.keys(z).length||Un(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=M;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _l(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,y,x]of this._listeners)me.addEventListener(p,y,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,n,u]of this._listeners)me.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const n=this._map,u=n.getCanvasContainer();this._add("mapEvent",new Wl(n,t));const p=n.boxZoom=new Yc(n,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const y=n.cooperativeGestures=new ih(n,t.cooperativeGestures);this._add("cooperativeGestures",y),t.cooperativeGestures&&y.enable();const x=new Xl(n),M=new Wo(n);n.doubleClickZoom=new bp(M,x),this._add("tapZoom",x),this._add("clickZoom",M),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const E=new Qu;this._add("tapDragZoom",E);const z=n.touchPitch=new vp(n);this._add("touchPitch",z),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const R=()=>n.project(n.getCenter()),j=(function({enable:se,clickTolerance:de,aroundCenter:ve=!0,minPixelCenterThreshold:ce=100,rotateDegreesPerPixelMoved:Te=.8},Re){const Ce=new Fs({checkCorrectEvent:ze=>me.mouseButton(ze)===0&&ze.ctrlKey||me.mouseButton(ze)===2&&!ze.ctrlKey});return new Rs({clickTolerance:de,move:(ze,Oe)=>{const He=Re();if(ve&&Math.abs(He.y-ze.y)>ce)return{bearingDelta:s.cy(new s.P(ze.x,Oe.y),Oe,He)};let et=(Oe.x-ze.x)*Te;return ve&&Oe.y<He.y&&(et=-et),{bearingDelta:et}},moveStateManager:Ce,enable:se,assignEvents:Xu})})(t,R),N=(function({enable:se,clickTolerance:de,pitchDegreesPerPixelMoved:ve=-.5}){const ce=new Fs({checkCorrectEvent:Te=>me.mouseButton(Te)===0&&Te.ctrlKey||me.mouseButton(Te)===2});return new Rs({clickTolerance:de,move:(Te,Re)=>({pitchDelta:(Re.y-Te.y)*ve}),moveStateManager:ce,enable:se,assignEvents:Xu})})(t),G=(function({enable:se,clickTolerance:de,rollDegreesPerPixelMoved:ve=.3},ce){const Te=new Fs({checkCorrectEvent:Re=>me.mouseButton(Re)===2&&Re.ctrlKey});return new Rs({clickTolerance:de,move:(Re,Ce)=>{const ze=ce();let Oe=(Ce.x-Re.x)*ve;return Ce.y<ze.y&&(Oe=-Oe),{rollDelta:Oe}},moveStateManager:Te,enable:se,assignEvents:Xu})})(t,R);n.dragRotate=new St(t,j,N,G),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",G,["mousePitch"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const X=(function({enable:se,clickTolerance:de}){const ve=new Fs({checkCorrectEvent:ce=>me.mouseButton(ce)===0&&!ce.ctrlKey});return new Rs({clickTolerance:de,move:(ce,Te)=>({around:Te,panDelta:Te.sub(ce)}),activateOnStart:!0,moveStateManager:ve,enable:se,assignEvents:Xu})})(t),ie=new Wd(t,n);n.dragPan=new yt(u,X,ie),this._add("mousePan",X),this._add("touchPan",ie,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const ne=new xa,re=new _p;n.touchZoomRotate=new yl(u,re,ne,E),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new va(n));const ae=n.scrollZoom=new th(n,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ae,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const he=n.keyboard=new Yl(n);this._add("keyboard",he),t.interactive&&t.keyboard&&n.keyboard.enable()}_add(t,n,u){this._handlers.push({handlerName:t,handler:n,allowed:u}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bs(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,u){for(const p in t)if(p!==u&&(!n||n.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const u of t)this._el.contains(u.target)&&n.push(u);return n}mergeHandlerResult(t,n,u,p,y){if(!u)return;s.e(t,u);const x={handlerName:p,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(n.zoom=x),u.panDelta!==void 0&&(n.drag=x),u.rollDelta!==void 0&&(n.roll=x),u.pitchDelta!==void 0&&(n.pitch=x),u.bearingDelta!==void 0&&(n.rotate=x)}_applyChanges(){const t={},n={},u={};for(const[p,y,x]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(t.rollDelta=(t.rollDelta||0)+p.rollDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),s.e(n,y),s.e(u,x);this._updateMapTransform(t,n,u),this._changes=[]}_updateMapTransform(t,n,u){const p=this._map,y=p._getTransformForUpdate(),x=p.terrain;if(!(Un(t)||x&&this._terrainMovement))return this._fireEvents(n,u,!0);p._stop(!0);let{panDelta:M,zoomDelta:E,bearingDelta:z,pitchDelta:R,rollDelta:j,around:N,pinchAround:G}=t;G!==void 0&&(N=G),N=N||p.transform.centerPoint,x&&!y.isPointOnMapSurface(N)&&(N=y.centerPoint);const X={panDelta:M,zoomDelta:E,rollDelta:j,pitchDelta:R,bearingDelta:z,around:N};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(N)&&(N=y.centerPoint);const ie=N.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(M?N.sub(M):N);this._handleMapControls({terrain:x,tr:y,deltasForHelper:X,preZoomAroundLoc:ie,combinedEventsInProgress:n,panDelta:M}),p._applyUpdatedTransform(y),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,u,!0)}_handleMapControls({terrain:t,tr:n,deltasForHelper:u,preZoomAroundLoc:p,combinedEventsInProgress:y,panDelta:x}){const M=this._map.cameraHelper;if(M.handleMapControlsRollPitchBearingZoom(u,n),t)return M.useGlobeControls?(this._terrainMovement||!y.drag&&!y.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void M.handleMapControlsPan(u,n,p)):this._terrainMovement||!y.drag&&!y.zoom?void(y.drag&&this._terrainMovement&&x?n.setCenter(n.screenPointToLocation(n.centerPoint.sub(x))):M.handleMapControlsPan(u,n,p)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void M.handleMapControlsPan(u,n,p));M.handleMapControlsPan(u,n,p)}_fireEvents(t,n,u){const p=Bs(this._eventsInProgress),y=Bs(t),x={};for(const j in t){const{originalEvent:N}=t[j];this._eventsInProgress[j]||(x[`${j}start`]=N),this._eventsInProgress[j]=t[j]}!p&&y&&this._fireEvent("movestart",y.originalEvent);for(const j in x)this._fireEvent(j,x[j]);y&&this._fireEvent("move",y.originalEvent);for(const j in t){const{originalEvent:N}=t[j];this._fireEvent(j,N)}const M={};let E;for(const j in this._eventsInProgress){const{handlerName:N,originalEvent:G}=this._eventsInProgress[j];this._handlersById[N].isActive()||(delete this._eventsInProgress[j],E=n[N]||G,M[`${j}end`]=E)}for(const j in M)this._fireEvent(j,M[j]);const z=Bs(this._eventsInProgress),R=(p||y)&&!z;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const j=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&j.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(j)}if(u&&R){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!j||!j.essential&&ge.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:E})),N(this._map.getBearing())&&this._map.resetNorth()):(N(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new s.l(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new wn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Hd extends s.E{constructor(t,n,u){super(),this._renderFrameCallback=()=>{const p=Math.min((be()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=u.bearingSnap,this.cameraHelper=n,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,n){t.apply(this.transform),this.transform=t,this.cameraHelper=n}getCenter(){return new s.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,n){return this.jumpTo({elevation:t},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,n,u){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.e({offset:t},n),u)}panTo(t,n,u){return this.easeTo(s.e({center:t},n),u)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,u){return this.easeTo(s.e({zoom:t},n),u)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,n){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new s.l("movestart",n)).fire(new s.l("move",n)).fire(new s.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,u){return this.easeTo(s.e({bearing:t},n),u)}resetNorth(t,n){return this.rotateTo(0,s.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}getRoll(){return this.transform.roll}setRoll(t,n){return this.jumpTo({roll:t},n),this}cameraForBounds(t,n){t=Li.convert(t).adjustAntiMeridian();const u=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,n)}_cameraForBoxAndBearing(t,n,u,p){const y={top:0,bottom:0,right:0,left:0};if(typeof(p=s.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const z=p.padding;p.padding={top:z,bottom:z,right:z,left:z}}const x=s.e(y,p.padding);p.padding=x;const M=this.transform,E=new Li(t,n);return this.cameraHelper.cameraForBoxAndBearing(p,x,E,u,M)}fitBounds(t,n,u){return this._fitInternal(this.cameraForBounds(t,n),n,u)}fitScreenCoordinates(t,n,u,p,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(t)),this.transform.screenPointToLocation(s.P.convert(n)),u,p),p,y)}_fitInternal(t,n,u){return t?(delete(n=s.e(t,n)).padding,n.linear?this.easeTo(n,u):this.flyTo(n,u)):this}jumpTo(t,n){this.stop();const u=this._getTransformForUpdate();let p=!1,y=!1,x=!1;const M=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,t);const E=u.zoom!==M;return"elevation"in t&&u.elevation!==+t.elevation&&u.setElevation(+t.elevation),"bearing"in t&&u.bearing!==+t.bearing&&(p=!0,u.setBearing(+t.bearing)),"pitch"in t&&u.pitch!==+t.pitch&&(y=!0,u.setPitch(+t.pitch)),"roll"in t&&u.roll!==+t.roll&&(x=!0,u.setRoll(+t.roll)),t.padding==null||u.isPaddingEqual(t.padding)||u.setPadding(t.padding),this._applyUpdatedTransform(u),this.fire(new s.l("movestart",n)).fire(new s.l("move",n)),E&&this.fire(new s.l("zoomstart",n)).fire(new s.l("zoom",n)).fire(new s.l("zoomend",n)),p&&this.fire(new s.l("rotatestart",n)).fire(new s.l("rotate",n)).fire(new s.l("rotateend",n)),y&&this.fire(new s.l("pitchstart",n)).fire(new s.l("pitch",n)).fire(new s.l("pitchend",n)),x&&this.fire(new s.l("rollstart",n)).fire(new s.l("roll",n)).fire(new s.l("rollend",n)),this.fire(new s.l("moveend",n))}calculateCameraOptionsFromTo(t,n,u,p=0){const y=s.ab.fromLngLat(t,n),x=s.ab.fromLngLat(u,p),M=x.x-y.x,E=x.y-y.y,z=x.z-y.z,R=Math.hypot(M,E,z);if(R===0)throw new Error("Can't calculate camera options with same From and To");const j=Math.hypot(M,E),N=s.au(this.transform.cameraToCenterDistance/R/this.transform.tileSize),G=180*Math.atan2(M,-E)/Math.PI;let X=180*Math.acos(j/R)/Math.PI;return X=z<0?90-X:90+X,{center:x.toLngLat(),elevation:p,zoom:N,pitch:X,bearing:G}}calculateCameraOptionsFromCameraLngLatAltRotation(t,n,u,p,y){const x=this.transform.calculateCenterFromCameraLngLatAlt(t,n,u,p);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:u,pitch:p,roll:y}}easeTo(t,n){this._stop(!1,t.easeId),((t=s.e({offset:[0,0],duration:500,easing:s.cz},t)).animate===!1||!t.essential&&ge.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),p=this.getBearing(),y=u.pitch,x=u.roll,M="bearing"in t?this._normalizeBearing(t.bearing,p):p,E="pitch"in t?+t.pitch:y,z="roll"in t?this._normalizeBearing(t.roll,x):x,R="padding"in t?t.padding:u.padding,j=s.P.convert(t.offset);let N,G;t.around&&(N=s.V.convert(t.around),G=u.locationToScreenPoint(N));const X={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ie=this.cameraHelper.handleEaseTo(u,{bearing:M,pitch:E,roll:z,padding:R,around:N,aroundPoint:G,offsetAsPoint:j,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||p!==M,this._pitching=this._pitching||E!==y,this._rolling=this._rolling||z!==x,this._padding=!u.isPaddingEqual(R),this._zooming=this._zooming||ie.isZooming,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,X),this.terrain&&this._prepareElevation(ie.elevationCenter),this._ease((ne=>{ie.easeFunc(ne),this.terrain&&!t.freezeElevation&&this._updateElevation(ne),this._applyUpdatedTransform(u),this._fireMoveEvents(n)}),(ne=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n,ne)}),t),this}_prepareEase(t,n,u={}){this._moving=!0,n||u.moving||this.fire(new s.l("movestart",t)),this._zooming&&!u.zooming&&this.fire(new s.l("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new s.l("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new s.l("pitchstart",t)),this._rolling&&!u.rolling&&this.fire(new s.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(n-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.setElevation(s.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const n=t.getCameraLngLat(),u=t.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(n,t.zoom):0;if(u<p){const y=this.calculateCameraOptionsFromTo(n,p,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const n=[];if(n.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&n.push((p=>this.transformCameraUpdate(p))),!n.length)return;const u=t.clone();for(const p of n){const y=u.clone(),{center:x,zoom:M,roll:E,pitch:z,bearing:R,elevation:j}=p(y);x&&y.setCenter(x),j!==void 0&&y.setElevation(j),M!==void 0&&y.setZoom(M),E!==void 0&&y.setRoll(E),z!==void 0&&y.setPitch(z),R!==void 0&&y.setBearing(R),u.apply(y)}this.transform.apply(u)}_fireMoveEvents(t){this.fire(new s.l("move",t)),this._zooming&&this.fire(new s.l("zoom",t)),this._rotating&&this.fire(new s.l("rotate",t)),this._pitching&&this.fire(new s.l("pitch",t)),this._rolling&&this.fire(new s.l("roll",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const u=this._zooming,p=this._rotating,y=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new s.l("zoomend",t)),p&&this.fire(new s.l("rotateend",t)),y&&this.fire(new s.l("pitchend",t)),x&&this.fire(new s.l("rollend",t)),this.fire(new s.l("moveend",t))}flyTo(t,n){if(!t.essential&&ge.prefersReducedMotion){const Oe=s.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Oe,n)}this.stop(),t=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cz},t);const u=this._getTransformForUpdate(),p=u.bearing,y=u.pitch,x=u.roll,M=u.padding,E="bearing"in t?this._normalizeBearing(t.bearing,p):p,z="pitch"in t?+t.pitch:y,R="roll"in t?this._normalizeBearing(t.roll,x):x,j="padding"in t?t.padding:u.padding,N=s.P.convert(t.offset);let G=u.centerPoint.add(N);const X=u.screenPointToLocation(G),ie=this.cameraHelper.handleFlyTo(u,{bearing:E,pitch:z,roll:R,padding:j,locationAtOffset:X,offsetAsPoint:N,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ne=t.curve;const re=Math.max(u.width,u.height),ae=re/ie.scaleOfZoom,he=ie.pixelPathLength;typeof ie.scaleOfMinZoom=="number"&&(ne=Math.sqrt(re/ie.scaleOfMinZoom/he*2));const se=ne*ne;function de(Oe){const He=(ae*ae-re*re+(Oe?-1:1)*se*se*he*he)/(2*(Oe?ae:re)*se*he);return Math.log(Math.sqrt(He*He+1)-He)}function ve(Oe){return(Math.exp(Oe)-Math.exp(-Oe))/2}function ce(Oe){return(Math.exp(Oe)+Math.exp(-Oe))/2}const Te=de(!1);let Re=function(Oe){return ce(Te)/ce(Te+ne*Oe)},Ce=function(Oe){return re*((ce(Te)*(ve(He=Te+ne*Oe)/ce(He))-ve(Te))/se)/he;var He},ze=(de(!0)-Te)/ne;if(Math.abs(he)<2e-6||!isFinite(ze)){if(Math.abs(re-ae)<1e-6)return this.easeTo(t,n);const Oe=ae<re?-1:1;ze=Math.abs(Math.log(ae/re))/ne,Ce=()=>0,Re=He=>Math.exp(Oe*ne*He)}return t.duration="duration"in t?+t.duration:1e3*ze/("screenSpeed"in t?+t.screenSpeed/ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==E,this._pitching=z!==y,this._rolling=R!==x,this._padding=!u.isPaddingEqual(j),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(ie.targetCenter),this._ease((Oe=>{const He=Oe*ze,et=1/Re(He),We=Ce(He);this._rotating&&u.setBearing(s.G.number(p,E,Oe)),this._pitching&&u.setPitch(s.G.number(y,z,Oe)),this._rolling&&u.setRoll(s.G.number(x,R,Oe)),this._padding&&(u.interpolatePadding(M,j,Oe),G=u.centerPoint.add(N)),ie.easeFunc(Oe,et,We,G),this.terrain&&!t.freezeElevation&&this._updateElevation(Oe),this._applyUpdatedTransform(u),this._fireMoveEvents(n)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(n)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,n)}return t||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(t,n,u){u.animate===!1||u.duration===0?(t(1),n()):(this._easeStart=be(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=s.W(t,-180,180);const u=Math.abs(t-n);return Math.abs(t-360-n)<u&&(t-=360),Math.abs(t+360-n)<u&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(s.V.convert(t)):null}}const Tp={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Sp{constructor(t=Tp){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=me.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=me.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){me.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const u=this._map._getUIString(`AttributionControl.${n}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const n=this._map.style.tileManagers;for(const p in n){const y=n[p];if(y.used||y.usedForTerrain){const x=y.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter((p=>String(p).trim())),t.sort(((p,y)=>p.length-y.length)),t=t.filter(((p,y)=>{for(let x=y+1;x<t.length;x++)if(t[x].indexOf(p)>=0)return!1;return!0}));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=me.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class vl{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const u=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=me.create("div","maplibregl-ctrl");const n=me.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){me.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Wi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,u=n?this._queue.concat(n):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const u of n)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var rr=s.aV([{name:"a_pos3d",type:"Int16",components:3}]);class Pp extends s.E{constructor(t){super(),this._lastTilesetChange=be(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,n){this.tileManager.update(t,n),this._renderableTilesKeys=[];const u={};for(const p of Zi(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.tileManager._source.calculateTileZoom}))u[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),s.c8(p.terrainRttPosMatrix32f,0,s.a5,s.a5,0,0,1),this._tiles[p.key]=new Xe(p,this.tileSize),this._lastTilesetChange=be());for(const p in this._tiles)u[p]||delete this._tiles[p]}freeRtt(t){for(const n in this._tiles){const u=this._tiles[n];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,n){return n?this._getTerrainCoordsForTileRanges(t,n):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const n={};for(const u of this._renderableTilesKeys){const p=this._tiles[u].tileID,y=t.clone(),x=s.bl();if(p.canonical.equals(t.canonical))s.c8(x,0,s.a5,s.a5,0,0,1);else if(p.canonical.isChildOf(t.canonical)){const M=p.canonical.z-t.canonical.z,E=p.canonical.x-(p.canonical.x>>M<<M),z=p.canonical.y-(p.canonical.y>>M<<M),R=s.a5>>M;s.c8(x,0,R,R,0,0,1),s.O(x,x,[-E*R,-z*R,0])}else{if(!t.canonical.isChildOf(p.canonical))continue;{const M=t.canonical.z-p.canonical.z,E=t.canonical.x-(t.canonical.x>>M<<M),z=t.canonical.y-(t.canonical.y>>M<<M),R=s.a5>>M;s.c8(x,0,s.a5,s.a5,0,0,1),s.O(x,x,[E*R,z*R,0]),s.Q(x,x,[1/2**M,1/2**M,0])}}y.terrainRttPosMatrix32f=new Float32Array(x),n[u]=y}return n}_getTerrainCoordsForTileRanges(t,n){const u={};for(const p of this._renderableTilesKeys){const y=this._tiles[p].tileID;if(!this._isWithinTileRanges(y,n))continue;const x=t.clone(),M=s.bl();if(y.canonical.z===t.canonical.z){const E=t.canonical.x-y.canonical.x,z=t.canonical.y-y.canonical.y;s.c8(M,0,s.a5,s.a5,0,0,1),s.O(M,M,[E*s.a5,z*s.a5,0])}else if(y.canonical.z>t.canonical.z){const E=y.canonical.z-t.canonical.z,z=y.canonical.x-(y.canonical.x>>E<<E),R=y.canonical.y-(y.canonical.y>>E<<E),j=t.canonical.x-(y.canonical.x>>E),N=t.canonical.y-(y.canonical.y>>E),G=s.a5>>E;s.c8(M,0,G,G,0,0,1),s.O(M,M,[-z*G+j*s.a5,-R*G+N*s.a5,0])}else{const E=t.canonical.z-y.canonical.z,z=t.canonical.x-(t.canonical.x>>E<<E),R=t.canonical.y-(t.canonical.y>>E<<E),j=(t.canonical.x>>E)-y.canonical.x,N=(t.canonical.y>>E)-y.canonical.y,G=s.a5<<E;s.c8(M,0,G,G,0,0,1),s.O(M,M,[z*s.a5+j*G,R*s.a5+N*G,0])}x.terrainRttPosMatrix32f=new Float32Array(M),u[p]=x}return u}getSourceTile(t,n){const u=this.tileManager._source;let p=t.overscaledZ-this.deltaZoom;if(p>u.maxzoom&&(p=u.maxzoom),p<u.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let y=this.findTileInCaches(this._sourceTileCache[t.key]);if(!y?.dem&&n)for(;p>=u.minzoom&&!y?.dem;)y=this.findTileInCaches(t.scaledTo(p--).key);return y}findTileInCaches(t){let n=this.tileManager.getTileByID(t);return n||(n=this.tileManager._outOfViewCache.getByKey(t),n)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,n){return n[t.canonical.z]&&t.canonical.x>=n[t.canonical.z].minTileX&&t.canonical.x<=n[t.canonical.z].maxTileX&&t.canonical.y>=n[t.canonical.z].minTileY&&t.canonical.y<=n[t.canonical.z].maxTileY}}class Kl{constructor(t,n,u){this._meshCache={},this.painter=t,this.tileManager=new Pp(n),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,u,p=s.a5){var y;if(!(n>=0&&n<p&&u>=0&&u<p))return 0;const x=this.getTerrainData(t),M=(y=x.tile)===null||y===void 0?void 0:y.dem;if(!M)return 0;const E=s.cD([],[n/p*s.a5,u/p*s.a5],x.u_terrain_matrix),z=[E[0]*M.dim,E[1]*M.dim],R=Math.floor(z[0]),j=Math.floor(z[1]),N=z[0]-R,G=z[1]-j;return M.get(R,j)*(1-N)*(1-G)+M.get(R+1,j)*N*(1-G)+M.get(R,j+1)*(1-N)*G+M.get(R+1,j+1)*N*G}getElevationForLngLatZoom(t,n){if(!s.cE(n,t.wrap()))return 0;const{tileID:u,mercatorX:p,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(u,p%s.a5,y%s.a5,s.a5)}getElevationForLngLat(t){return this.getElevationForLngLatZoom(t,this.tileManager.maxzoom)}getElevation(t,n,u,p=s.a5){return this.getDEMElevation(t,n,u,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,y=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new s.T(p,y,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new s.T(p,new s.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.as([])}const n=this.tileManager.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const p=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new s.T(p,n.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),n.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const u=n&&n+n.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const p=this.tileManager.getSource().maxzoom;let y=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?y=t.canonical.z-p:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>y<<y),M=t.canonical.y-(t.canonical.y>>y<<y),E=s.cF(new Float64Array(16),[1/(s.a5<<y),1/(s.a5<<y),0]);s.O(E,E,[x*s.a5,M*s.a5,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,u=n.width/devicePixelRatio,p=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new s.T(n.context,{width:u,height:p,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new s.T(n.context,{width:u,height:p,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(u,p,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,u,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,x=0;y<this._coordsTextureSize;y++)for(let M=0;M<this._coordsTextureSize;M++,x+=4)n[x+0]=255&M,n[x+1]=255&y,n[x+2]=M>>8<<4|y>>8,n[x+3]=0;const u=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),p=new s.T(t,u,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),u=this.painter.context,p=u.gl,y=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(y,M-x-1,1,1,p.RGBA,p.UNSIGNED_BYTE,n),u.bindFramebuffer.set(null);const E=n[0]+(n[2]>>4<<8),z=n[1]+((15&n[2])<<8),R=this.coordsIndex[255-n[3]],j=R&&this.tileManager.getTileByID(R);if(!j)return null;const N=this._coordsTextureSize,G=(1<<j.tileID.canonical.z)*N;return new s.ab((j.tileID.canonical.x*N+E)/G+j.tileID.wrap,(j.tileID.canonical.y*N+z)/G,this.getElevation(j.tileID,E,z,N))}depthAtPoint(t){const n=new Uint8Array(4),u=this.painter.context,p=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,n),u.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(t){var n;const u=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,p=u&&t.canonical.y===0,y=u&&t.canonical.y===(1<<t.canonical.z)-1,x=`m_${p?"n":""}_${y?"s":""}`;if(this._meshCache[x])return this._meshCache[x];const M=this.painter.context,E=new s.cG,z=new s.aZ,R=this.meshSize,j=s.a5/R,N=R*R;for(let ce=0;ce<=R;ce++)for(let Te=0;Te<=R;Te++)E.emplaceBack(Te*j,ce*j,0);for(let ce=0;ce<N;ce+=R+1)for(let Te=0;Te<R;Te++)z.emplaceBack(Te+ce,R+Te+ce+1,R+Te+ce+2),z.emplaceBack(Te+ce,R+Te+ce+2,Te+ce+1);const G=E.length,X=G+(R+1),ie=(R+1)*R,ne=p?s.bs:0,re=p?0:1,ae=y?s.bt:s.a5,he=y?0:1;for(let ce=0;ce<=R;ce++)E.emplaceBack(ce*j,ne,re);for(let ce=0;ce<=R;ce++)E.emplaceBack(ce*j,ae,he);for(let ce=0;ce<R;ce++)z.emplaceBack(ie+ce,X+ce,X+ce+1),z.emplaceBack(ie+ce,X+ce+1,ie+ce+1),z.emplaceBack(0+ce,G+ce+1,G+ce),z.emplaceBack(0+ce,0+ce+1,G+ce+1);const se=E.length,de=se+2*(R+1);for(const ce of[0,1])for(let Te=0;Te<=R;Te++)for(const Re of[0,1])E.emplaceBack(ce*s.a5,Te*j,Re);for(let ce=0;ce<2*R;ce+=2)z.emplaceBack(se+ce,se+ce+1,se+ce+3),z.emplaceBack(se+ce,se+ce+3,se+ce+2),z.emplaceBack(de+ce,de+ce+3,de+ce+1),z.emplaceBack(de+ce,de+ce+2,de+ce+3);const ve=new _i(M.createVertexBuffer(E,rr.members),M.createIndexBuffer(z),s.aY.simpleSegment(0,0,E.length,z.length));return this._meshCache[x]=ve,ve}getMeshFrameDelta(t){return 2*Math.PI*s.bF/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,n){var u;if(!s.cE(n,t.wrap()))return 0;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(u=this.getMinMaxElevation(p).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return n&&n.dem&&(u.minElevation=n.dem.min*this.exaggeration,u.maxElevation=n.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,n){const u=s.ab.fromLngLat(t.wrap()),p=(1<<n)*s.a5,y=u.x*p,x=u.y*p,M=Math.floor(y/s.a5),E=Math.floor(x/s.a5);return{tileID:new s.a2(n,0,n,M,E),mercatorX:y,mercatorY:x}}}class ec{constructor(t,n,u){this._context=t,this._size=n,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new s.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(u.texture),{id:t,fbo:n,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((n=>t.id!==n)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const ns={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class rh{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new ec(t.context,30,n.tileManager.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((u=>!t._layers[u].isHidden(n))),this._coordsAscending={};for(const u in t.tileManagers){this._coordsAscending[u]={};const p=t.tileManagers[u].getVisibleCoordinates(),y=t.tileManagers[u].getSource(),x=y instanceof en?y.terrainTileRanges:null;for(const M of p){const E=this.terrain.tileManager.getTerrainCoords(M,x);for(const z in E)this._coordsAscending[u][z]||(this._coordsAscending[u][z]=[]),this._coordsAscending[u][z].push(E[z])}}this._coordsAscendingStr={};for(const u of t._order){const p=t._layers[u],y=p.source;if(ns[p.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const x in this._coordsAscending[y])this._coordsAscendingStr[y][x]=this._coordsAscending[y][x].map((M=>M.key)).sort().join()}}for(const u of this._renderableTiles)for(const p in this._coordsAscendingStr){const y=this._coordsAscendingStr[p][u.tileID.key];y&&y!==u.rttCoords[p]&&(u.rtt=[])}}renderLayer(t,n){if(t.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),p=t.type,y=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ns[p]&&(this._prevType&&ns[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(t.id),!x))return!0;if(ns[this._prevType]||ns[p]&&x){this._prevType=p;const M=this._stacks.length-1,E=this._stacks[M]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(qc(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[M]){const j=this.pool.getObjectForId(z.rtt[M].id);if(j.stamp===z.rtt[M].stamp){this.pool.useObject(j);continue}}const R=this.pool.getOrCreateFreeObject();this.pool.useObject(R),this.pool.stampObject(R),z.rtt[M]={id:R.id,stamp:R.stamp},y.context.bindFramebuffer.set(R.fbo.framebuffer),y.context.clear({color:s.bq.transparent,stencil:0}),y.currentStencilSource=void 0;for(let j=0;j<E.length;j++){const N=y.style._layers[E[j]],G=N.source?this._coordsAscending[N.source][z.tileID.key]:[z.tileID];y.context.viewport.set([0,0,R.fbo.width,R.fbo.height]),y._renderTileClippingMasks(N,G,!0),y.renderLayer(y,y.style.tileManagers[N.source],N,G,u),N.source&&(z.rttCoords[N.source]=this._coordsAscendingStr[N.source][z.tileID.key])}}return qc(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),ns[p]}return!1}}const nh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Jl=F,tc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Tp,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},oh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ah{constructor(t,n,u=!1){this.mousedown=y=>{this.startMove(y,me.mousePos(this.element,y)),me.addEventListener(window,"mousemove",this.mousemove),me.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,me.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHandler.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=me.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),me.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=me.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const p=new gp;this._rotatePitchHandler=new Rs({clickTolerance:3,move:(y,x)=>{const M=n.getBoundingClientRect(),E=new s.P((M.bottom-M.top)/2,(M.right-M.left)/2);return{bearingDelta:s.cy(new s.P(y.x,x.y),x,E),pitchDelta:u?-.5*(x.y-y.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=t,me.addEventListener(n,"mousedown",this.mousedown),me.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),me.addEventListener(n,"touchcancel",this.reset)}startMove(t,n){this._rotatePitchHandler.dragStart(t,n),me.disableDrag()}move(t,n){const u=this.map,{bearingDelta:p,pitchDelta:y}=this._rotatePitchHandler.dragMove(t,n)||{};p&&u.setBearing(u.getBearing()+p),y&&u.setPitch(u.getPitch()+y)}off(){const t=this.element;me.removeEventListener(t,"mousedown",this.mousedown),me.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),me.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.removeEventListener(window,"touchend",this.touchend),me.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){me.enableDrag(),me.removeEventListener(window,"mousemove",this.mousemove),me.removeEventListener(window,"mouseup",this.mouseup),me.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.removeEventListener(window,"touchend",this.touchend)}}let ba;function ic(g,t,n,u=!1){if(u||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return g?.wrap();const p=new s.V(g.lng,g.lat);if(g=new s.V(g.lng,g.lat),t){const y=new s.V(g.lng-360,g.lat),x=new s.V(g.lng+360,g.lat),M=n.locationToScreenPoint(g).distSqr(t);n.locationToScreenPoint(y).distSqr(t)<M?g=y:n.locationToScreenPoint(x).distSqr(t)<M&&(g=x)}for(;Math.abs(g.lng-n.center.lng)>180;){const y=n.locationToScreenPoint(g);if(y.x>=0&&y.y>=0&&y.x<=n.width&&y.y<=n.height)break;g.lng>n.center.lng?g.lng-=360:g.lng+=360}return g.lng!==p.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(g))?g:p}const Ql={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rc(g,t,n){const u=g.classList;for(const p in Ql)u.remove(`maplibregl-${n}-anchor-${p}`);u.add(`maplibregl-${n}-anchor-${t}`)}class eu extends s.E{constructor(t){if(super(),this._onKeyPress=n=>{const u=n.code,p=n.charCode||n.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=n=>{const u=n.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=ic(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),me.setTransform(this._element,`${Ql[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${p}`),ge.frameAsync(new AbortController).then((()=>{this._updateOpacity(n&&n.type==="moveend")})).catch((()=>{}))},this._onMove=n=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=me.create("div");const n=me.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${u}px`),n.setAttributeNS(null,"width",`${p}px`),n.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const y=me.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const x=me.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const M=me.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of E){const ae=me.createNS("http://www.w3.org/2000/svg","ellipse");ae.setAttributeNS(null,"opacity","0.04"),ae.setAttributeNS(null,"cx","10.5"),ae.setAttributeNS(null,"cy","5.80029008"),ae.setAttributeNS(null,"rx",re.rx),ae.setAttributeNS(null,"ry",re.ry),M.appendChild(ae)}const z=me.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const R=me.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(R);const j=me.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const N=me.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(N);const G=me.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const X=me.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ie=me.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");const ne=me.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#FFFFFF"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962"),X.appendChild(ie),X.appendChild(ne),x.appendChild(M),x.appendChild(z),x.appendChild(j),x.appendChild(G),x.appendChild(X),n.appendChild(x),n.setAttributeNS(null,"height",u*this._scale+"px"),n.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(n),this._offset=s.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(n=>{n.preventDefault()})),this._element.addEventListener("mousedown",(n=>{n.preventDefault()})),rc(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),me.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var n,u;const p=(n=this._map)===null||n===void 0?void 0:n.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!p||y){const G=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==G&&(this._element.style.opacity=G))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const x=this._map,M=x.terrain.depthAtPoint(this._pos),E=x.terrain.getElevationForLngLat(this._lngLat);if(x.transform.lngLatToCameraDepth(this._lngLat,E)-M<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/x.transform.pixelsPerMeter,R=Math.sin(x.getPitch()*Math.PI/180)*z,j=x.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),N=x.transform.lngLatToCameraDepth(this._lngLat,E+R)-j>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return(this._opacity===void 0||t===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const sh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Os=0,Ns=!1;const lh={maxWidth:100,unit:"metric"};function tu(g,t,n){const u=n&&n.maxWidth||100,p=g._container.clientHeight/2,y=g._container.clientWidth/2,x=g.unproject([y-u/2,p]),M=g.unproject([y+u/2,p]),E=Math.round(g.project(M).x-g.project(x).x),z=Math.min(u,E,g._container.clientWidth),R=x.distanceTo(M);if(n&&n.unit==="imperial"){const j=3.2808*R;j>5280?js(t,z,j/5280,g._getUIString("ScaleControl.Miles")):js(t,z,j,g._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?js(t,z,R/1852,g._getUIString("ScaleControl.NauticalMiles")):R>=1e3?js(t,z,R/1e3,g._getUIString("ScaleControl.Kilometers")):js(t,z,R,g._getUIString("ScaleControl.Meters"))}function js(g,t,n,u){const p=(function(y){const x=Math.pow(10,`${Math.floor(y)}`.length-1);let M=y/x;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:(function(E){const z=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*z)/z})(M),x*M})(n);g.style.width=t*(p/n)+"px",g.innerHTML=`${p}&nbsp;${u}`}const uh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ch=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nc(g){if(g){if(typeof g=="number"){const t=Math.round(Math.abs(g)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,g),"top-left":new s.P(t,t),"top-right":new s.P(-t,t),bottom:new s.P(0,-g),"bottom-left":new s.P(t,-t),"bottom-right":new s.P(-t,-t),left:new s.P(g,0),right:new s.P(-g,0)}}if(g instanceof s.P||Array.isArray(g)){const t=s.P.convert(g);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.P.convert(g.center||[0,0]),top:s.P.convert(g.top||[0,0]),"top-left":s.P.convert(g["top-left"]||[0,0]),"top-right":s.P.convert(g["top-right"]||[0,0]),bottom:s.P.convert(g.bottom||[0,0]),"bottom-left":s.P.convert(g["bottom-left"]||[0,0]),"bottom-right":s.P.convert(g["bottom-right"]||[0,0]),left:s.P.convert(g.left||[0,0]),right:s.P.convert(g.right||[0,0])}}return nc(new s.P(0,0))}const hh=F;b.AJAXError=s.cJ,b.Event=s.l,b.Evented=s.E,b.LngLat=s.V,b.MercatorCoordinate=s.ab,b.Point=s.P,b.addProtocol=s.cK,b.config=s.c,b.removeProtocol=s.cL,b.AttributionControl=Sp,b.BoxZoomHandler=Yc,b.CanvasSource=H,b.CooperativeGesturesHandler=ih,b.DoubleClickZoomHandler=bp,b.DragPanHandler=yt,b.DragRotateHandler=St,b.EdgeInsets=No,b.FullscreenControl=class extends s.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var t;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=n?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){me.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=me.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);me.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=Da,b.GeolocateControl=class extends s.E{constructor(g){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new s.V(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,p=this._map.getBearing(),y=s.e({bearing:p},this.options.fitBoundsOptions),x=Li.fromLngLat(n,u);this._map.fitBounds(x,y,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new s.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Ns)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=me.create("button","maplibregl-ctrl-geolocate",this._container),me.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new eu({element:this._dotElement}),this._circleElement=me.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new eu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{const u=n?.[0]instanceof ResizeObserverEntry;n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))}))}},this.options=s.e({},sh,g)}onAdd(g){return this._map=g,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return s._(this,arguments,void 0,(function*(t=!1){if(ba!==void 0&&!t)return ba;if(window.navigator.permissions===void 0)return ba=!!window.navigator.geolocation,ba;try{ba=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ba=!!window.navigator.geolocation}return ba}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),me.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Os=0,Ns=!1}_isOutOfMapMaxBounds(g){const t=this._map.getMaxBounds(),n=g.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const g=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&g))return;const t=this._map.project(g),n=this._map.unproject([t.x+100,t.y]),u=g.distanceTo(n)/100,p=2*this._accuracy/u;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Os--,Ns=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Os++,Os>1?(g={maximumAge:6e5,timeout:0},Ns=!0):(g=this.options.positionOptions,Ns=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const t=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=me.create("button","maplibregl-ctrl-globe",this._container),me.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){me.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},b.Hash=Zl,b.ImageSource=en,b.KeyboardHandler=Yl,b.LngLatBounds=Li,b.LogoControl=vl,b.Map=class extends Hd{constructor(g){var t,n;s.cH.mark(s.cI.create);const u=Object.assign(Object.assign(Object.assign({},tc),g),{canvasContextAttributes:Object.assign(Object.assign({},tc.canvasContextAttributes),g.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new jo,y=new $t;if(u.minZoom!==void 0&&p.setMinZoom(u.minZoom),u.maxZoom!==void 0&&p.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&p.setMinPitch(u.minPitch),u.maxPitch!==void 0&&p.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&p.setRenderWorldCopies(u.renderWorldCopies),u.transformConstrain!==null&&p.setConstrainOverride(u.transformConstrain),super(p,y,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Wi,this._controls=[],this._mapId=s.ah(),this._lostContextStyle={style:null,images:null},this._contextLost=M=>{M.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const E of Object.values(this.style._layers))if(E.type==="custom"&&console.warn(`Custom layer with id '${E.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),E._listeners)for(const[z]of Object.entries(E._listeners))console.warn(`Custom layer with id '${E.id}' had event listeners for event '${z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new s.l("webglcontextlost",{originalEvent:M}))},this._contextRestored=M=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:M}))},this._onMapScroll=M=>{if(M.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},nh),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this._zoomLevelsToOverscale=u.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=u.transformCameraUpdate,this.transformConstrain=u.transformConstrain,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,u.reduceMotion!==void 0&&(ge.prefersReducedMotion=u.reduceMotion),this._imageQueueHandle=ht.addThrottleControl((()=>this.isMoving())),this._requestManager=new wt(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let M=!1;const E=Hc((z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((z=>{M?E(z):M=!0})),this._resizeObserver.observe(this._container)}this.handlers=new wp(this,u),this._hash=u.hash&&new Zl(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,s.e({},u.fitBoundsOptions,{duration:0}))));const x=typeof u.style=="string"||((n=(t=u.style)===null||t===void 0?void 0:t.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Sp(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new vl,u.logoPosition),this.on("style.load",(()=>{if(x||this._resizeTransform(),this.transform.unmodified){const M=s.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(M)}})),this.on("data",(M=>{this._update(M.dataType==="style"),this.fire(new s.l(`${M.dataType}data`,M))})),this.on("dataloading",(M=>{this.fire(new s.l(`${M.dataType}dataloading`,M))})),this.on("dataabort",(M=>{this.fire(new s.l("sourcedataabort",M))}))}_getMapId(){return this._mapId}setGlobalStateProperty(g,t){return this.style.setGlobalStateProperty(g,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,t){if(t===void 0&&(t=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=g.onAdd(this);this._controls.push(g);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(n,u.firstChild):u.appendChild(n),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(g);return t>-1&&this._controls.splice(t,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}coveringTiles(g){return Zi(this.transform,g)}calculateCameraOptionsFromTo(g,t,n,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLat(n)),super.calculateCameraOptionsFromTo(g,t,n,u)}resize(g,t=!0){const[n,u]=this._containerDimensions(),p=this._getClampedPixelRatio(n,u);if(this._resizeCanvas(n,u,p),this.painter.resize(n,u,p),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const M=this._getClampedPixelRatio(n,u);this._resizeCanvas(n,u,M),this.painter.resize(n,u,M)}this._resizeTransform(t);const y=!this._moving;return y&&(this.stop(),this.fire(new s.l("movestart",g)).fire(new s.l("move",g))),this.fire(new s.l("resize",g)),y&&this.fire(new s.l("moveend",g)),this}_resizeTransform(g=!0){var t;const[n,u]=this._containerDimensions();this.transform.resize(n,u,g),(t=this._requestedCameraState)===null||t===void 0||t.resize(n,u,g)}_getClampedPixelRatio(g,t){const{0:n,1:u}=this._maxCanvasSize,p=this.getPixelRatio(),y=g*p,x=t*p;return Math.min(y>n?n/y:1,x>u?u/x:1)*p}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Li.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}setTransformConstrain(g){return this.transform.setConstrainOverride(g),this._update()}project(g){return this.transform.locationToScreenPoint(s.V.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(s.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,t,n){if(g==="mouseenter"||g==="mouseover"){let u=!1;return{layers:t,listener:n,delegates:{mousemove:y=>{const x=t.filter((E=>this.getLayer(E))),M=x.length!==0?this.queryRenderedFeatures(y.point,{layers:x}):[];M.length?u||(u=!0,n.call(this,new Vn(g,this,y.originalEvent,{features:M}))):u=!1},mouseout:()=>{u=!1}}}}if(g==="mouseleave"||g==="mouseout"){let u=!1;return{layers:t,listener:n,delegates:{mousemove:x=>{const M=t.filter((E=>this.getLayer(E)));(M.length!==0?this.queryRenderedFeatures(x.point,{layers:M}):[]).length?u=!0:u&&(u=!1,n.call(this,new Vn(g,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,n.call(this,new Vn(g,this,x.originalEvent)))}}}}{const u=p=>{const y=t.filter((M=>this.getLayer(M))),x=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];x.length&&(p.features=x,n.call(this,p),delete p.features)};return{layers:t,listener:n,delegates:{[g]:u}}}}_saveDelegatedListener(g,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(t)}_removeDelegatedListener(g,t,n){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const u=this._delegatedListeners[g];for(let p=0;p<u.length;p++){const y=u[p];if(y.listener===n&&y.layers.length===t.length&&y.layers.every((x=>t.includes(x)))){for(const x in y.delegates)this.off(x,y.delegates[x]);return void u.splice(p,1)}}}on(g,t,n){if(n===void 0)return super.on(g,t);const u=typeof t=="string"?[t]:t,p=this._createDelegatedListener(g,u,n);this._saveDelegatedListener(g,p);for(const y in p.delegates)this.on(y,p.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(g,u,n)}}}once(g,t,n){if(n===void 0)return super.once(g,t);const u=typeof t=="string"?[t]:t,p=this._createDelegatedListener(g,u,n);for(const y in p.delegates){const x=p.delegates[y];p.delegates[y]=(...M)=>{this._removeDelegatedListener(g,u,n),x(...M)}}this._saveDelegatedListener(g,p);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(g,t,n){return n===void 0?super.off(g,t):(this._removeDelegatedListener(g,typeof t=="string"?[t]:t,n),this)}queryRenderedFeatures(g,t){if(!this.style)return[];let n;const u=g instanceof s.P||Array.isArray(g),p=u?g:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:g)||{},p instanceof s.P||typeof p[0]=="number")n=[s.P.convert(p)];else{const y=s.P.convert(p[0]),x=s.P.convert(p[1]);n=[y,new s.P(x.x,y.y),x,new s.P(y.x,x.y),y]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(g,t){return this.style.querySourceFeatures(g,t)}setStyle(g,t){return(t=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(g,t))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const t=this._locale[g];if(t==null)throw new Error(`Missing UI string '${g}'`);return t}_updateStyle(g,t){var n,u;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(g,t)));const p=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new _o(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,t,p):this.style.loadJSON(g,t,p),this):((u=(n=this.style)===null||n===void 0?void 0:n.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new _o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,t){if(typeof g=="string"){const n=this._requestManager.transformRequest(g,"Style");s.j(n,new AbortController).then((u=>{this._updateDiff(u.data,t)})).catch((u=>{u&&this.fire(new s.k(u))}))}else typeof g=="object"&&this._updateDiff(g,t)}_updateDiff(g,t){try{this.style.setState(g,t)&&this._update(!0)}catch(n){s.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(g,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(g,t){return this._lazyInitEmptyStyle(),this.style.addSource(g,t),this._update(!0)}isSourceLoaded(g){const t=this.style&&this.style.tileManagers[g];if(t!==void 0)return t.loaded();this.fire(new s.k(new Error(`There is no tile manager with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const t=this.style.tileManagers[g.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const u=this.style._layers[n];u.type==="hillshade"&&u.source===g.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===g.source&&s.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Kl(this.painter,t,g),this.painter.renderToTexture=new rh(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var u;n.dataType==="style"?this.terrain.tileManager.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=n.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:g})),this}getTerrain(){var g,t;return(t=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const g=this.style&&this.style.tileManagers;for(const t of Object.values(g))if(!t.areTilesLoaded())return!1;return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,t,n){if(n){const u=this.getSource(n);if(!u)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);u.calculateTileZoom=hi(Math.max(1,g),Math.max(1,t))}else for(const u in this.style.tileManagers)this.style.tileManagers[u].getSource().calculateTileZoom=hi(Math.max(1,g),Math.max(1,t));return this._update(!0),this}refreshTiles(g,t){const n=this.style.tileManagers[g];if(!n)throw new Error(`There is no tile manager with ID "${g}", cannot refresh tile`);t===void 0?n.reload(!0):n.refreshTiles(t.map((u=>new s.ae(u.z,u.x,u.y))))}addImage(g,t,n={}){const{pixelRatio:u=1,sdf:p=!1,stretchX:y,stretchY:x,content:M,textFitWidth:E,textFitHeight:z}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||s.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:j,data:N}=t,G=t;return this.style.addImage(g,{data:new s.R({width:R,height:j},new Uint8Array(N)),pixelRatio:u,stretchX:y,stretchY:x,content:M,textFitWidth:E,textFitHeight:z,sdf:p,version:0,userImage:G}),G.onAdd&&G.onAdd(this,g),this}}{const{width:R,height:j,data:N}=ge.getImageData(t);this.style.addImage(g,{data:new s.R({width:R,height:j},N),pixelRatio:u,stretchX:y,stretchY:x,content:M,textFitWidth:E,textFitHeight:z,sdf:p,version:0})}}updateImage(g,t){const n=this.style.getImage(g);if(!n)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||s.b(t)?ge.getImageData(t):t,{width:p,height:y,data:x}=u;if(p===void 0||y===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==n.data.width||y!==n.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(t instanceof HTMLImageElement||s.b(t));return n.data.replace(x,M),this.style.updateImage(g,n),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return ht.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,t){return this._lazyInitEmptyStyle(),this.style.addLayer(g,t),this._update(!0)}moveLayer(g,t){return this.style.moveLayer(g,t),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,t,n){return this.style.setLayerZoomRange(g,t,n),this._update(!0)}setFilter(g,t,n={}){return this.style.setFilter(g,t,n),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,t,n,u={}){return this.style.setPaintProperty(g,t,n,u),this._update(!0)}getPaintProperty(g,t){return this.style.getPaintProperty(g,t)}setLayoutProperty(g,t,n,u={}){return this.style.setLayoutProperty(g,t,n,u),this._update(!0)}getLayoutProperty(g,t){return this.style.getLayoutProperty(g,t)}setGlyphs(g,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,t,n,(u=>{u||this._update(!0)})),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,t,(n=>{n||this._update(!0)})),this}setLight(g,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,t){return this.style.setFeatureState(g,t),this._update()}removeFeatureState(g,t){return this.style.removeFeatureState(g,t),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,t=0;return this._container&&(g=this._container.clientWidth||400,t=this._container.clientHeight||300),[g,t]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const t=this._canvasContainer=me.create("div","maplibregl-canvas-container",g);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=me.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),u=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],u);const p=this._controlContainer=me.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((x=>{y[x]=me.create("div",`maplibregl-ctrl-${x} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,t,n){this._canvas.width=Math.floor(n*g),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{t={requestedAttributes:g},u&&(t.statusMessage=u.statusMessage,t.type=u.type)}),{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!n){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new pp(n,this.transform),nt.testSupport(n)}migrateProjection(g,t){super.migrateProjection(g,t),this.painter.transform=g,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var t,n,u,p,y;const x=this._idleTriggered?this._fadeDuration:0,M=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,N=be();this.style.zoomHistory.update(j,N);const G=new s.H(j,{now:N,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),X=G.crossFadingFactor();X===1&&X===this._crossFadingFactor||(E=!0,this._crossFadingFactor=X),this.style.update(G)}const z=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==M;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cH.mark(s.cI.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const R=this._sourcesDirty||this._styleDirty||this._placementDirty;return R||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,s.cH.mark(s.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ht.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),me.remove(this._canvasContainer),me.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cH.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ge.frame(this._frameRequest,(g=>{s.cH.frame(g),this._frameRequest=null;try{this._render(g)}catch(t){if(!s.Z(t)&&!(function(n){return n.message===k})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return Jl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},b.MapMouseEvent=Vn,b.MapTouchEvent=ql,b.MapWheelEvent=Xc,b.Marker=eu,b.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,n)=>{const u=this._map._getUIString(`NavigationControl.${n}`);t.title=u,t.setAttribute("aria-label",u)},this.options=s.e({},oh,g),this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),me.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),me.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=me.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ah(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){me.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,t){const n=me.create("button",g,this._container);return n.type="button",n.addEventListener("click",t),n}},b.Popup=class extends s.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&me.remove(this._content),this._container&&(me.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=me.create("div","maplibregl-popup",this._map.getContainer()),this._tip=me.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ic(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const n=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const p=nc(this.options.offset);if(!u){const x=this._container.offsetWidth,M=this._container.offsetHeight;let E;E=n.y+p.bottom.y<M?["top"]:n.y>this._map.transform.height-M?["bottom"]:[],n.x<x/2?E.push("left"):n.x>this._map.transform.width-x/2&&E.push("right"),u=E.length===0?"bottom":E.join("-")}let y=n.add(p[u]);this.options.subpixelPositioning||(y=y.round()),me.setTransform(this._container,`${Ql[u]} translate(${y.x}px,${y.y}px)`),rc(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(uh),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=s.V.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const t=document.createDocumentFragment(),n=document.createElement("body");let u;for(n.innerHTML=g;u=n.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=me.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=me.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(ch);g&&g.focus()}},b.RasterDEMTileSource=Xn,b.RasterTileSource=ra,b.ScaleControl=class{constructor(g){this._onMove=()=>{tu(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,tu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},lh),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){me.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=th,b.Style=_o,b.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=me.create("button","maplibregl-ctrl-terrain",this._container),me.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){me.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=vp,b.TwoFingersTouchRotateHandler=xa,b.TwoFingersTouchZoomHandler=_p,b.TwoFingersTouchZoomRotateHandler=yl,b.VectorTileSource=ia,b.VideoSource=Pe,b.addSourceType=(g,t)=>s._(void 0,void 0,void 0,(function*(){if(ee(g))throw new Error(`A source type called "${g}" already exists.`);((n,u)=>{W[n]=u})(g,t)})),b.clearPrewarmedResources=function(){const g=Mr;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Mi),Mr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.createTileMesh=nl,b.getMaxParallelImageRequests=function(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return Se().getRTLTextPluginStatus()},b.getVersion=function(){return hh},b.getWorkerCount=function(){return jt.workerCount},b.getWorkerUrl=function(){return s.c.WORKER_URL},b.importScriptInWorkers=function(g){return ea().broadcast("IS",g)},b.isTimeFrozen=function(){return Me.isFrozen()},b.now=be,b.prewarm=function(){Ro().acquire(Mi)},b.restoreNow=function(){Me.restoreNow()},b.setMaxParallelImageRequests=function(g){s.c.MAX_PARALLEL_IMAGE_REQUESTS=g},b.setNow=function(g){Me.setNow(g)},b.setRTLTextPlugin=function(g,t){return Se().setRTLTextPlugin(g,t)},b.setWorkerCount=function(g){jt.workerCount=g},b.setWorkerUrl=function(g){s.c.WORKER_URL=g}}));var A=d;return A}))})(ld)),ld.exports}var z1=k1();const xt=Dm(z1),kv="3.7.8",D1=kv,Rc=typeof Buffer=="function",wy=typeof TextDecoder=="function"?new TextDecoder:void 0,Ty=typeof TextEncoder=="function"?new TextEncoder:void 0,R1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Oh=Array.prototype.slice.call(R1),ed=(h=>{let a={};return h.forEach((d,w)=>a[d]=w),a})(Oh),F1=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Mn=String.fromCharCode.bind(String),Sy=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):h=>new Uint8Array(Array.prototype.slice.call(h,0)),zv=h=>h.replace(/=/g,"").replace(/[+\/]/g,a=>a=="+"?"-":"_"),Dv=h=>h.replace(/[^A-Za-z0-9\+\/]/g,""),Rv=h=>{let a,d,w,S,A="";const b=h.length%3;for(let s=0;s<h.length;){if((d=h.charCodeAt(s++))>255||(w=h.charCodeAt(s++))>255||(S=h.charCodeAt(s++))>255)throw new TypeError("invalid character found");a=d<<16|w<<8|S,A+=Oh[a>>18&63]+Oh[a>>12&63]+Oh[a>>6&63]+Oh[a&63]}return b?A.slice(0,b-3)+"===".substring(b):A},Rm=typeof btoa=="function"?h=>btoa(h):Rc?h=>Buffer.from(h,"binary").toString("base64"):Rv,hm=Rc?h=>Buffer.from(h).toString("base64"):h=>{let d=[];for(let w=0,S=h.length;w<S;w+=4096)d.push(Mn.apply(null,h.subarray(w,w+4096)));return Rm(d.join(""))},ud=(h,a=!1)=>a?zv(hm(h)):hm(h),B1=h=>{if(h.length<2){var a=h.charCodeAt(0);return a<128?h:a<2048?Mn(192|a>>>6)+Mn(128|a&63):Mn(224|a>>>12&15)+Mn(128|a>>>6&63)+Mn(128|a&63)}else{var a=65536+(h.charCodeAt(0)-55296)*1024+(h.charCodeAt(1)-56320);return Mn(240|a>>>18&7)+Mn(128|a>>>12&63)+Mn(128|a>>>6&63)+Mn(128|a&63)}},O1=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Fv=h=>h.replace(O1,B1),Py=Rc?h=>Buffer.from(h,"utf8").toString("base64"):Ty?h=>hm(Ty.encode(h)):h=>Rm(Fv(h)),Ac=(h,a=!1)=>a?zv(Py(h)):Py(h),My=h=>Ac(h,!0),N1=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,j1=h=>{switch(h.length){case 4:var a=(7&h.charCodeAt(0))<<18|(63&h.charCodeAt(1))<<12|(63&h.charCodeAt(2))<<6|63&h.charCodeAt(3),d=a-65536;return Mn((d>>>10)+55296)+Mn((d&1023)+56320);case 3:return Mn((15&h.charCodeAt(0))<<12|(63&h.charCodeAt(1))<<6|63&h.charCodeAt(2));default:return Mn((31&h.charCodeAt(0))<<6|63&h.charCodeAt(1))}},Bv=h=>h.replace(N1,j1),Ov=h=>{if(h=h.replace(/\s+/g,""),!F1.test(h))throw new TypeError("malformed base64.");h+="==".slice(2-(h.length&3));let a,d,w,S=[];for(let A=0;A<h.length;)a=ed[h.charAt(A++)]<<18|ed[h.charAt(A++)]<<12|(d=ed[h.charAt(A++)])<<6|(w=ed[h.charAt(A++)]),d===64?S.push(Mn(a>>16&255)):w===64?S.push(Mn(a>>16&255,a>>8&255)):S.push(Mn(a>>16&255,a>>8&255,a&255));return S.join("")},Fm=typeof atob=="function"?h=>atob(Dv(h)):Rc?h=>Buffer.from(h,"base64").toString("binary"):Ov,Nv=Rc?h=>Sy(Buffer.from(h,"base64")):h=>Sy(Fm(h).split("").map(a=>a.charCodeAt(0))),jv=h=>Nv(Vv(h)),V1=Rc?h=>Buffer.from(h,"base64").toString("utf8"):wy?h=>wy.decode(Nv(h)):h=>Bv(Fm(h)),Vv=h=>Dv(h.replace(/[-_]/g,a=>a=="-"?"+":"/")),pm=h=>V1(Vv(h)),U1=h=>{if(typeof h!="string")return!1;const a=h.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(a)||!/[^\s0-9a-zA-Z\-_]/.test(a)},Uv=h=>({value:h,enumerable:!1,writable:!0,configurable:!0}),Zv=function(){const h=(a,d)=>Object.defineProperty(String.prototype,a,Uv(d));h("fromBase64",function(){return pm(this)}),h("toBase64",function(a){return Ac(this,a)}),h("toBase64URI",function(){return Ac(this,!0)}),h("toBase64URL",function(){return Ac(this,!0)}),h("toUint8Array",function(){return jv(this)})},Gv=function(){const h=(a,d)=>Object.defineProperty(Uint8Array.prototype,a,Uv(d));h("toBase64",function(a){return ud(this,a)}),h("toBase64URI",function(){return ud(this,!0)}),h("toBase64URL",function(){return ud(this,!0)})},Z1=()=>{Zv(),Gv()},G1={version:kv,VERSION:D1,atob:Fm,atobPolyfill:Ov,btoa:Rm,btoaPolyfill:Rv,fromBase64:pm,toBase64:Ac,encode:Ac,encodeURI:My,encodeURL:My,utob:Fv,btou:Bv,decode:pm,isValid:U1,fromUint8Array:ud,toUint8Array:jv,extendString:Zv,extendUint8Array:Gv,extendBuiltins:Z1};var td={exports:{}},Iy;function $1(){if(Iy)return td.exports;Iy=1;var h=typeof Reflect=="object"?Reflect:null,a=h&&typeof h.apply=="function"?h.apply:function(ke,$e,ht){return Function.prototype.apply.call(ke,$e,ht)},d;h&&typeof h.ownKeys=="function"?d=h.ownKeys:Object.getOwnPropertySymbols?d=function(ke){return Object.getOwnPropertyNames(ke).concat(Object.getOwnPropertySymbols(ke))}:d=function(ke){return Object.getOwnPropertyNames(ke)};function w(Ue){console&&console.warn&&console.warn(Ue)}var S=Number.isNaN||function(ke){return ke!==ke};function A(){A.init.call(this)}td.exports=A,td.exports.once=nt,A.EventEmitter=A,A.prototype._events=void 0,A.prototype._eventsCount=0,A.prototype._maxListeners=void 0;var b=10;function s(Ue){if(typeof Ue!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ue)}Object.defineProperty(A,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(Ue){if(typeof Ue!="number"||Ue<0||S(Ue))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ue+".");b=Ue}}),A.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},A.prototype.setMaxListeners=function(ke){if(typeof ke!="number"||ke<0||S(ke))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ke+".");return this._maxListeners=ke,this};function F(Ue){return Ue._maxListeners===void 0?A.defaultMaxListeners:Ue._maxListeners}A.prototype.getMaxListeners=function(){return F(this)},A.prototype.emit=function(ke){for(var $e=[],ht=1;ht<arguments.length;ht++)$e.push(arguments[ht]);var wt=ke==="error",Vt=this._events;if(Vt!==void 0)wt=wt&&Vt.error===void 0;else if(!wt)return!1;if(wt){var Pt;if($e.length>0&&(Pt=$e[0]),Pt instanceof Error)throw Pt;var ei=new Error("Unhandled error."+(Pt?" ("+Pt.message+")":""));throw ei.context=Pt,ei}var mi=Vt[ke];if(mi===void 0)return!1;if(typeof mi=="function")a(mi,this,$e);else for(var Gr=mi.length,Pr=Me(mi,Gr),ht=0;ht<Gr;++ht)a(Pr[ht],this,$e);return!0};function $(Ue,ke,$e,ht){var wt,Vt,Pt;if(s($e),Vt=Ue._events,Vt===void 0?(Vt=Ue._events=Object.create(null),Ue._eventsCount=0):(Vt.newListener!==void 0&&(Ue.emit("newListener",ke,$e.listener?$e.listener:$e),Vt=Ue._events),Pt=Vt[ke]),Pt===void 0)Pt=Vt[ke]=$e,++Ue._eventsCount;else if(typeof Pt=="function"?Pt=Vt[ke]=ht?[$e,Pt]:[Pt,$e]:ht?Pt.unshift($e):Pt.push($e),wt=F(Ue),wt>0&&Pt.length>wt&&!Pt.warned){Pt.warned=!0;var ei=new Error("Possible EventEmitter memory leak detected. "+Pt.length+" "+String(ke)+" listeners added. Use emitter.setMaxListeners() to increase limit");ei.name="MaxListenersExceededWarning",ei.emitter=Ue,ei.type=ke,ei.count=Pt.length,w(ei)}return Ue}A.prototype.addListener=function(ke,$e){return $(this,ke,$e,!1)},A.prototype.on=A.prototype.addListener,A.prototype.prependListener=function(ke,$e){return $(this,ke,$e,!0)};function Q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function oe(Ue,ke,$e){var ht={fired:!1,wrapFn:void 0,target:Ue,type:ke,listener:$e},wt=Q.bind(ht);return wt.listener=$e,ht.wrapFn=wt,wt}A.prototype.once=function(ke,$e){return s($e),this.on(ke,oe(this,ke,$e)),this},A.prototype.prependOnceListener=function(ke,$e){return s($e),this.prependListener(ke,oe(this,ke,$e)),this},A.prototype.removeListener=function(ke,$e){var ht,wt,Vt,Pt,ei;if(s($e),wt=this._events,wt===void 0)return this;if(ht=wt[ke],ht===void 0)return this;if(ht===$e||ht.listener===$e)--this._eventsCount===0?this._events=Object.create(null):(delete wt[ke],wt.removeListener&&this.emit("removeListener",ke,ht.listener||$e));else if(typeof ht!="function"){for(Vt=-1,Pt=ht.length-1;Pt>=0;Pt--)if(ht[Pt]===$e||ht[Pt].listener===$e){ei=ht[Pt].listener,Vt=Pt;break}if(Vt<0)return this;Vt===0?ht.shift():be(ht,Vt),ht.length===1&&(wt[ke]=ht[0]),wt.removeListener!==void 0&&this.emit("removeListener",ke,ei||$e)}return this},A.prototype.off=A.prototype.removeListener,A.prototype.removeAllListeners=function(ke){var $e,ht,wt;if(ht=this._events,ht===void 0)return this;if(ht.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ht[ke]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete ht[ke]),this;if(arguments.length===0){var Vt=Object.keys(ht),Pt;for(wt=0;wt<Vt.length;++wt)Pt=Vt[wt],Pt!=="removeListener"&&this.removeAllListeners(Pt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if($e=ht[ke],typeof $e=="function")this.removeListener(ke,$e);else if($e!==void 0)for(wt=$e.length-1;wt>=0;wt--)this.removeListener(ke,$e[wt]);return this};function xe(Ue,ke,$e){var ht=Ue._events;if(ht===void 0)return[];var wt=ht[ke];return wt===void 0?[]:typeof wt=="function"?$e?[wt.listener||wt]:[wt]:$e?me(wt):Me(wt,wt.length)}A.prototype.listeners=function(ke){return xe(this,ke,!0)},A.prototype.rawListeners=function(ke){return xe(this,ke,!1)},A.listenerCount=function(Ue,ke){return typeof Ue.listenerCount=="function"?Ue.listenerCount(ke):ge.call(Ue,ke)},A.prototype.listenerCount=ge;function ge(Ue){var ke=this._events;if(ke!==void 0){var $e=ke[Ue];if(typeof $e=="function")return 1;if($e!==void 0)return $e.length}return 0}A.prototype.eventNames=function(){return this._eventsCount>0?d(this._events):[]};function Me(Ue,ke){for(var $e=new Array(ke),ht=0;ht<ke;++ht)$e[ht]=Ue[ht];return $e}function be(Ue,ke){for(;ke+1<Ue.length;ke++)Ue[ke]=Ue[ke+1];Ue.pop()}function me(Ue){for(var ke=new Array(Ue.length),$e=0;$e<ke.length;++$e)ke[$e]=Ue[$e].listener||Ue[$e];return ke}function nt(Ue,ke){return new Promise(function($e,ht){function wt(Pt){Ue.removeListener(ke,Vt),ht(Pt)}function Vt(){typeof Ue.removeListener=="function"&&Ue.removeListener("error",wt),$e([].slice.call(arguments))}Je(Ue,ke,Vt,{once:!0}),ke!=="error"&&Ke(Ue,wt,{once:!0})})}function Ke(Ue,ke,$e){typeof Ue.on=="function"&&Je(Ue,"error",ke,$e)}function Je(Ue,ke,$e,ht){if(typeof Ue.on=="function")ht.once?Ue.once(ke,$e):Ue.on(ke,$e);else if(typeof Ue.addEventListener=="function")Ue.addEventListener(ke,function wt(Vt){ht.once&&Ue.removeEventListener(ke,wt),$e(Vt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ue)}return td.exports}var q1=$1();const W1=Dm(q1);function H1(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class X1{constructor(){this._apiKey="",this._fetch=H1(),this.tileCacheSize=200}set apiKey(a){this._apiKey=a}get apiKey(){return this._apiKey}set fetch(a){this._fetch=a}get fetch(){return this._fetch}}const Ec=new X1,Y1={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},K1={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},tp={...Y1,...K1};function J1(h,a=tp){return h in a?h[h]:null}function dm(h,a=tp){for(const d of Object.values(a))if(d.code===h)return d;return null}function fm(h,a=tp){for(const d of Object.values(a))if(d.flag===h)return d;return null}function Q1(h){return h!==null&&typeof h=="object"&&"code"in h&&"flag"in h&&"name"in h&&"latin"in h&&"isMode"in h&&"geocoding"in h&&(typeof h.code=="string"||h.code===null)&&typeof h.flag=="string"&&typeof h.name=="string"&&typeof h.latin=="boolean"&&typeof h.isMode=="boolean"&&typeof h.geocoding=="boolean"}function Ay(h,a=tp){return Q1(h)?fm(h.flag,a):typeof h!="string"?null:J1(h,a)||dm(h,a)||fm(h,a)||null}async function ew(h,a={}){if(Ec.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(h).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return Ec.fetch(h,a)}const $v={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze($v);class tw extends Error{constructor(a,d=""){super(`Call to enpoint ${a.url} failed with the status code ${a.status}. ${d}`),this.res=a}}const Ey={403:"Key is missing, invalid or restricted"};async function iw(h={}){const a=new URL("geolocation/ip.json",$v.maptilerApiURL);a.searchParams.set("key",h.apiKey??Ec.apiKey),"elevation"in h&&a.searchParams.set("elevation",h.elevation?"true":"false");const d=a.toString(),w=await ew(d);if(!w.ok)throw new tw(w,w.status in Ey?Ey[w.status]:"");return await w.json()}const Cy={info:iw};function qv(h){const a=/^maptiler:\/\/(.*)/;let d;const w=h.trim();let S;return w.startsWith("http://")||w.startsWith("https://")?S=w:(d=a.exec(w))!==null?S=`https://api.maptiler.com/maps/${d[1]}/style.json`:S=`https://api.maptiler.com/maps/${w}/style.json`,S}class Wv{constructor(a,d,w,S,A,b,s=!1,F){this.name=a,this.variantType=d,this.id=w,this.referenceStyle=S,this.description=A,this.imageURL=b,this.deprecated=s,this.deprecationMessage=F}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(a){return this.referenceStyle.hasVariant(a)}getVariant(a){const d=this.referenceStyle.getVariant(a);return this.warnIfDeprecated(d),d}getVariants(){return this.referenceStyle.getVariants().filter(a=>a!==this).map(a=>(this.warnIfDeprecated(a),a))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return qv(this.getId())}warnIfDeprecated(a=this){if(!a.deprecated)return a;if(a.deprecationMessage)console.warn(a.deprecationMessage);else{const d=a.getFullName();console.warn(`Style "${d}" is deprecated and will be removed in a future version.`)}return a}}class Hv{constructor(a,d){this.name=a,this.id=d,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(a){this.variants[a.getType()]=a,this.orderedVariants.push(a)}hasVariant(a){return a in this.variants}getVariant(a){return a in this.variants?this.variants[a]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const Ll=[{referenceStyleID:"STREETS_V2",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default v2",variantType:"DEFAULT",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"streets-v2" is deprecated, use "streets-v4" instead'},{id:"streets-v2-dark",name:"Dark v2",variantType:"DARK",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"streets-v2-dark" is deprecated, use "streets-v4-dark" instead'},{id:"streets-v2-light",name:"Light v2",variantType:"LIGHT",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"streets-v2-light" is deprecated, use "streets-v4-light" instead'},{id:"streets-v2-night",name:"Night v2",variantType:"NIGHT",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"streets-v2-night" is deprecated, use "streets-v4-night" instead'},{id:"streets-v2-pastel",name:"Pastel v2",variantType:"PASTEL",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"streets-v2-pastel" is deprecated, use "streets-v4-pastel" instead'}]},{referenceStyleID:"STREETS_V4",name:"Streets",description:"",variants:[{id:"streets-v4",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v4-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v4-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"BASE_V4",name:"Base",description:"",variants:[{id:"base-v4",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"base-v4-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"base-v4-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"base-v4-ai",name:"Base AI",variantType:"NIGHT",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC_V2",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"basic-v2" is deprecated, use "basic-v4" instead'},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE_V2",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"landscape" is deprecated, use "landscape-v4" instead'},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"landscape-dark" is deprecated, use "landscape-v4-dark" instead'},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:"",deprecated:!0,deprecationMessage:'"landscape-vivid" is deprecated, use "landscape-v4-vivid" instead'}]},{referenceStyleID:"LANDSCAPE_V4",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape-v4",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-v4-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-v4-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}],rw={STREETS:"STREETS_V2",BASIC:"BASIC_V2",LANDSCAPE:"LANDSCAPE_V2"};function nw(h,a){Ll.find(S=>S.referenceStyleID===h)&&console.warn(`Default reference style ${h} already exists, it will be overwritten...`);const d=Ll.find(S=>S.referenceStyleID===a);if(!d)throw new Error(`Versioned map style not found for reference style: ${a}`);const w={...d,referenceStyleID:h};Ll.push(w)}Object.entries(rw).forEach(([h,a])=>{nw(h,a)});function ow(h){return new Proxy(h,{get(a,d,w){return a.hasVariant(d)?a.getVariant(d):d.toString().toUpperCase()===d?h.getDefaultVariant():Reflect.get(a,d,w)}})}function aw(){const h={};for(let a=0;a<Ll.length;a+=1){const d=Ll[a],w=ow(new Hv(d.name,d.referenceStyleID));for(let S=0;S<d.variants.length;S+=1){const A=d.variants[S],b=new Wv(A.name,A.variantType,A.id,w,A.description,A.imageURL,A.deprecated);w.addVariant(b)}h[d.referenceStyleID]=w}return h}const Cc=aw(),Pn=[];for(let h=0;h<256;++h)Pn.push((h+256).toString(16).slice(1));function sw(h,a=0){return(Pn[h[a+0]]+Pn[h[a+1]]+Pn[h[a+2]]+Pn[h[a+3]]+"-"+Pn[h[a+4]]+Pn[h[a+5]]+"-"+Pn[h[a+6]]+Pn[h[a+7]]+"-"+Pn[h[a+8]]+Pn[h[a+9]]+"-"+Pn[h[a+10]]+Pn[h[a+11]]+Pn[h[a+12]]+Pn[h[a+13]]+Pn[h[a+14]]+Pn[h[a+15]]).toLowerCase()}let Hf;const lw=new Uint8Array(16);function uw(){if(!Hf){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Hf=crypto.getRandomValues.bind(crypto)}return Hf(lw)}const cw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ly={randomUUID:cw};function hw(h,a,d){if(Ly.randomUUID&&!h)return Ly.randomUUID();h=h||{};const w=h.random??h.rng?.()??uw();if(w.length<16)throw new Error("Random bytes length must be >= 16");return w[6]=w[6]&15|64,w[8]=w[8]&63|128,sw(w)}var pw=Object.defineProperty,Xv=h=>{throw TypeError(h)},dw=(h,a,d)=>a in h?pw(h,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):h[a]=d,mt=(h,a,d)=>dw(h,typeof a!="symbol"?a+"":a,d),Bm=(h,a,d)=>a.has(h)||Xv("Cannot "+d),bt=(h,a,d)=>(Bm(h,a,"read from private field"),d?d.call(h):a.get(h)),so=(h,a,d)=>a.has(h)?Xv("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(h):a.set(h,d),Lo=(h,a,d,w)=>(Bm(h,a,"write to private field"),a.set(h,d),d),Eo=(h,a,d)=>(Bm(h,a,"access private method"),d);(class extends xt.Marker{addTo(h){return super.addTo(h)}});class dP extends xt.Popup{addTo(a){return super.addTo(a)}}class fP extends xt.Style{constructor(a,d={}){super(a,d)}}class mP extends xt.CanvasSource{onAdd(a){super.onAdd(a)}}class gP extends xt.GeoJSONSource{onAdd(a){super.onAdd(a)}}class _P extends xt.ImageSource{onAdd(a){super.onAdd(a)}}class yP extends xt.RasterTileSource{onAdd(a){super.onAdd(a)}}class vP extends xt.RasterDEMTileSource{onAdd(a){super.onAdd(a)}}class xP extends xt.VectorTileSource{onAdd(a){super.onAdd(a)}}class bP extends xt.VideoSource{onAdd(a){super.onAdd(a)}}class fw extends xt.NavigationControl{onAdd(a){return super.onAdd(a)}}class mw extends xt.GeolocateControl{onAdd(a){return super.onAdd(a)}}class wP extends xt.AttributionControl{onAdd(a){return super.onAdd(a)}}class gw extends xt.LogoControl{onAdd(a){return super.onAdd(a)}}class _w extends xt.ScaleControl{onAdd(a){return super.onAdd(a)}}class yw extends xt.FullscreenControl{onAdd(a){return super.onAdd(a)}}class TP extends xt.TerrainControl{onAdd(a){return super.onAdd(a)}}class SP extends xt.BoxZoomHandler{constructor(a,d){super(a,d)}}class PP extends xt.ScrollZoomHandler{constructor(a,d){super(a,d)}}class MP extends xt.CooperativeGesturesHandler{constructor(a,d){super(a,d)}}class IP extends xt.KeyboardHandler{constructor(a){super(a)}}class AP extends xt.TwoFingersTouchPitchHandler{constructor(a){super(a)}}class EP extends xt.MapWheelEvent{constructor(a,d,w){super(a,d,w)}}class CP extends xt.MapTouchEvent{constructor(a,d,w){super(a,d,w)}}class LP extends xt.MapMouseEvent{constructor(a,d,w,S={}){super(a,d,w,S)}}const ui={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...tp};function ky(){if(typeof navigator>"u"){const h=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return dm(h)||ui.ENGLISH}return Array.from(new Set(navigator.languages.map(h=>h.split("-")[0]))).map(h=>dm(h)).filter(h=>h)[0]??ui.LOCAL}const Hn={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:ui.STYLE,secondaryLanguage:ui.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(Hn);const Om=hw();class vw extends W1{constructor(){super(...arguments),mt(this,"primaryLanguage",Hn.primaryLanguage),mt(this,"secondaryLanguage"),mt(this,"session",!0),mt(this,"caching",!0),mt(this,"telemetry",!0),mt(this,"_unit","metric"),mt(this,"_apiKey","")}set unit(a){this._unit=a,this.emit("unit",a)}get unit(){return this._unit}set apiKey(a){this._apiKey=a,Ec.apiKey=a,this.emit("apiKey",a)}get apiKey(){return this._apiKey}set fetch(a){Ec.fetch=a}get fetch(){return Ec.fetch}}const Tr=new vw;class zy extends gw{constructor(a={}){super(a),mt(this,"logoURL",""),mt(this,"linkURL",""),this.logoURL=a.logoURL??Hn.maptilerLogoURL,this.linkURL=a.linkURL??Hn.maptilerURL}onAdd(a){this._map=a,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const d=window.document.createElement("a");return d.style.backgroundRepeat="no-repeat",d.style.cursor="pointer",d.style.display="block",d.style.height="23px",d.style.margin="0 0 -4px -4px",d.style.overflow="hidden",d.style.width="88px",d.style.backgroundImage=`url(${this.logoURL})`,d.style.backgroundSize="100px 30px",d.style.width="100px",d.style.height="30px",d.target="_blank",d.rel="noopener",d.href=this.linkURL,d.setAttribute("aria-label","MapTiler logo"),d.setAttribute("rel","noopener"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}const mm="localcache_source",gm="localcache",xw="maptiler_sdk",bw=1e3,ww=100,_m=typeof caches<"u",{addProtocol:Dy}=xt;function Tw(h,a){if(_m&&Tr.caching&&Tr.session&&h.host===Hn.maptilerApiHost){if(a==="Source"&&h.href.includes("tiles.json"))return h.href.replace("https://",`${mm}://`);if(a==="Tile"||a==="Glyphs")return h.href.replace("https://",`${gm}://`)}return h.href}let Xf;async function Yv(){return Xf||(Xf=await caches.open(xw)),Xf}let Ry=0;async function Sw(){const h=await Yv(),a=await h.keys(),d=a.slice(0,Math.max(a.length-bw,0));for(const w of d)h.delete(w)}function Pw(){Dy(mm,async(h,a)=>{if(!h.url)throw new Error("");h.url=h.url.replace(`${mm}://`,"https://");const d=h;d.signal=a.signal;const w=await fetch(h.url,d),S=await w.json();return S.tiles&&S.tiles.length>0&&(S.tiles[0]+=`&last-modified=${w.headers.get("Last-Modified")}`),{data:S,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}}),Dy(gm,async(h,a)=>{if(!h.url)throw new Error("");h.url=h.url.replace(`${gm}://`,"https://");const d=new URL(h.url),w=new URL(d);w.searchParams.delete("mtsid"),w.searchParams.delete("key");const S=w.toString(),A=new URL(d);A.searchParams.delete("last-modified");const b=A.toString(),s=async xe=>({data:await xe.arrayBuffer(),cacheControl:xe.headers.get("Cache-Control"),expires:xe.headers.get("Expires")}),F=await Yv(),$=await F.match(S);if($)return s($);const Q=h;Q.signal=a.signal;const oe=await fetch(b,Q);return oe.status>=200&&oe.status<300&&(F.put(S,oe.clone()).catch(()=>{}),++Ry>ww&&(Sw(),Ry=0)),s(oe)})}async function Mw(h){if(typeof window>"u")return;const a=xt.getRTLTextPluginStatus();if(a==="unavailable"||a==="requested")try{await xt.setRTLTextPlugin(h??Hn.rtlPluginURL,!0)}catch(d){console.error("Error enabling RTL plugin. It is enabled by default and cannot be unset after. Are you attempting to enable it twice?",d)}}function Iw(h,a){for(const d of h)typeof a[d]=="function"&&(a[d]=a[d].bind(a))}function Fy(h,a){let d=null;try{d=new URL(h)}catch{return{url:h}}return d.host===Hn.maptilerApiHost&&(d.searchParams.has("key")||d.searchParams.append("key",Tr.apiKey),Tr.session&&d.searchParams.append("mtsid",Om)),{url:Tw(d,a)}}function By(h){return(a,d)=>{if(h!=null){const w=h(a,d),S=Fy(w?.url??"",d);return{...w,...S}}return Fy(a,d)}}function Kv(){return Math.random().toString(36).substring(2)}function Md(h){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(h)}function Aw(h){try{return JSON.parse(h)}catch{}return null}function Ew(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function Cw(h){const a=Ew();if(!a)return;let d=null;if(typeof h=="string"?d=document.getElementById(h):h instanceof HTMLElement&&(d=h),!d)throw new Error("The Map container must be provided.");const w=document.createElement("div");throw w.innerHTML=a,w.classList.add("webgl-warning-div"),d.appendChild(w),new Error(a)}function Oy(h,a){return!(!Array.isArray(h)||h.length!==2||h[0]!=="get"||typeof h[1]!="string"||a&&!h[1].startsWith("name:")||!a&&h[1]!=="name")}function Lw(h,a,d){const w=structuredClone(h),S=A=>{if(typeof A!="string")for(let b=0;b<A.length;b+=1)Oy(A[b],d)?A[b]=structuredClone(a):S(A[b])};return Oy(w,d)?a:(S(w),w)}function kw(h,a){const d=a?/\{name:\S+\}/:/\{name\}/;return{contains:d.test(h),exactMatch:new RegExp(`^${d.source}$`).test(h)}}function zw(h,a,d){const w=d?/\{name:\S+\}/:/\{name\}/,S=h.split(w);return["concat",...S.flatMap((A,b)=>b===S.length-1?[A]:[A,a])]}function Dw(h){var a;const d=/\{name(?::(?<language>\S+))?\}/g,w=[];for(;;){const S=d.exec(h);if(!S)break;const A=((a=S.groups)==null?void 0:a.language)??null;w.push(A)}return w}function Rw(h){return!Array.isArray(h)||h.length!==2||h[0]!=="get"||typeof h[1]!="string"?null:h[1].trim()==="name"?{isLanguage:!0,localization:null}:h[1].trim().startsWith("name:")?{isLanguage:!0,localization:h[1].trim().split(":").pop()}:null}function Fw(h){const a=[],d=structuredClone(h),w=S=>{if(typeof S!="string")for(let A=0;A<S.length;A+=1){const b=Rw(S[A]);b?a.push(b.localization):w(S[A])}};return w([d]),a}function Bw(h,a){const d=[];for(const A of h){if(A.type!=="symbol")continue;const b=A,{id:s,layout:F}=b;if(!F||!("text-field"in F))continue;const $=a.getLayoutProperty(s,"text-field");if($)if(typeof $=="string"){const Q=Dw($);d.push(Q)}else{const Q=Fw($);d.push(Q)}}const w=d.flat(),S={unlocalized:0,localized:{}};for(const A of w)A===null?S.unlocalized+=1:(A in S.localized||(S.localized[A]=0),S.localized[A]+=1);return S}var Ow=8,Nw={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},jw={"*":{type:"source"}},Vw=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],Uw={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},Zw={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Gw={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},$w={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},qw={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Ww={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Hw={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},Xw=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],Yw={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Kw={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Jw={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Qw={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},e2={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},t2={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},i2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},r2={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},n2={type:"array",value:"*"},o2={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},a2={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},s2={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},l2={type:"array",value:"*",minimum:1},u2={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},c2={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},h2={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},p2={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},d2=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],f2={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},m2={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},g2={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},_2={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},y2={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},v2={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},x2={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},b2={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},w2={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},T2={"*":{type:"string"}},S2={$version:Ow,$root:Nw,sources:jw,source:Vw,source_vector:Uw,source_raster:Zw,source_raster_dem:Gw,source_geojson:$w,source_video:qw,source_image:Ww,layer:Hw,layout:Xw,layout_background:Yw,layout_fill:Kw,layout_circle:Jw,layout_heatmap:Qw,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:e2,layout_symbol:t2,layout_raster:i2,layout_hillshade:r2,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:n2,filter_operator:o2,geometry_type:a2,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:s2,expression:l2,light:u2,sky:c2,terrain:h2,projection:p2,paint:d2,paint_fill:f2,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:m2,paint_circle:g2,paint_heatmap:_2,paint_symbol:y2,paint_raster:v2,paint_hillshade:x2,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:b2,transition:w2,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:T2};class it{constructor(a,d,w,S){this.message=(a?`${a}: `:"")+w,S&&(this.identifier=S),d!=null&&d.__line__&&(this.line=d.__line__)}}function gd(h,...a){for(const d of a)for(const w in d)h[w]=d[w];return h}class us extends Error{constructor(a,d){super(d),this.message=d,this.key=a}}class Nm{constructor(a,d=[]){this.parent=a,this.bindings={};for(const[w,S]of d)this.bindings[w]=S}concat(a){return new Nm(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return this.bindings[a]?!0:this.parent?this.parent.has(a):!1}}const Id={kind:"null"},lt={kind:"number"},Qt={kind:"string"},Jt={kind:"boolean"},cs={kind:"color"},Ad={kind:"projectionDefinition"},yu={kind:"object"},Ht={kind:"value"},P2={kind:"error"},Ed={kind:"collator"},Cd={kind:"formatted"},Ld={kind:"padding"},$h={kind:"colorArray"},kd={kind:"numberArray"},ip={kind:"resolvedImage"},zd={kind:"variableAnchorOffsetCollection"};function ko(h,a){return{kind:"array",itemType:h,N:a}}function sr(h){if(h.kind==="array"){const a=sr(h.itemType);return typeof h.N=="number"?`array<${a}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${a}>`}else return h.kind}const M2=[Id,lt,Qt,Jt,cs,Ad,Cd,yu,ko(Ht),Ld,kd,$h,ip,zd];function qh(h,a){if(a.kind==="error")return null;if(h.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!qh(h.itemType,a.itemType))&&(typeof h.N!="number"||h.N===a.N))return null}else{if(h.kind===a.kind)return null;if(h.kind==="value"){for(const d of M2)if(!qh(d,a))return null}}return`Expected ${sr(h)} but found ${sr(a)} instead.`}function jm(h,a){return a.some(d=>d.kind===h.kind)}function vu(h,a){return a.some(d=>d==="null"?h===null:d==="array"?Array.isArray(h):d==="object"?h&&!Array.isArray(h)&&typeof h=="object":d===typeof h)}function Al(h,a){return h.kind==="array"&&a.kind==="array"?h.itemType.kind===a.itemType.kind&&typeof h.N=="number":h.kind===a.kind}const Jv=.96422,Qv=1,e0=.82521,t0=4/29,Lc=6/29,i0=3*Lc*Lc,I2=Lc*Lc*Lc,A2=Math.PI/180,E2=180/Math.PI;function r0(h){return h=h%360,h<0&&(h+=360),h}function n0([h,a,d,w]){h=Yf(h),a=Yf(a),d=Yf(d);let S,A;const b=Kf((.2225045*h+.7168786*a+.0606169*d)/Qv);h===a&&a===d?S=A=b:(S=Kf((.4360747*h+.3850649*a+.1430804*d)/Jv),A=Kf((.0139322*h+.0971045*a+.7141733*d)/e0));const s=116*b-16;return[s<0?0:s,500*(S-b),200*(b-A),w]}function Yf(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function Kf(h){return h>I2?Math.pow(h,1/3):h/i0+t0}function o0([h,a,d,w]){let S=(h+16)/116,A=isNaN(a)?S:S+a/500,b=isNaN(d)?S:S-d/200;return S=Qv*Qf(S),A=Jv*Qf(A),b=e0*Qf(b),[Jf(3.1338561*A-1.6168667*S-.4906146*b),Jf(-.9787684*A+1.9161415*S+.033454*b),Jf(.0719453*A-.2289914*S+1.4052427*b),w]}function Jf(h){return h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055,h<0?0:h>1?1:h}function Qf(h){return h>Lc?h*h*h:i0*(h-t0)}function C2(h){const[a,d,w,S]=n0(h),A=Math.sqrt(d*d+w*w);return[Math.round(A*1e4)?r0(Math.atan2(w,d)*E2):NaN,A,a,S]}function L2([h,a,d,w]){return h=isNaN(h)?0:h*A2,o0([d,Math.cos(h)*a,Math.sin(h)*a,w])}function k2([h,a,d,w]){h=r0(h),a/=100,d/=100;function S(A){const b=(A+h/30)%12,s=a*Math.min(d,1-d);return d-s*Math.max(-1,Math.min(b-3,9-b,1))}return[S(0),S(8),S(4),w]}const z2=Object.hasOwn||function(h,a){return Object.prototype.hasOwnProperty.call(h,a)};function Uh(h,a){return z2(h,a)?h[a]:void 0}function D2(h){if(h=h.toLowerCase().trim(),h==="transparent")return[0,0,0,0];const a=Uh(R2,h);if(a){const[S,A,b]=a;return[S/255,A/255,b/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const S=h.length<6?1:2;let A=1;return[id(h.slice(A,A+=S)),id(h.slice(A,A+=S)),id(h.slice(A,A+=S)),id(h.slice(A,A+S)||"ff")]}if(h.startsWith("rgb")){const S=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,A=h.match(S);if(A){const[b,s,F,$,Q,oe,xe,ge,Me,be,me,nt]=A,Ke=[$||" ",xe||" ",be].join("");if(Ke==="  "||Ke==="  /"||Ke===",,"||Ke===",,,"){const Je=[F,oe,Me].join(""),Ue=Je==="%%%"?100:Je===""?255:0;if(Ue){const ke=[Pc(+s/Ue,0,1),Pc(+Q/Ue,0,1),Pc(+ge/Ue,0,1),me?Ny(+me,nt):1];if(jy(ke))return ke}}return}}const d=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,w=h.match(d);if(w){const[S,A,b,s,F,$,Q,oe,xe]=w,ge=[b||" ",F||" ",Q].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const Me=[+A,Pc(+s,0,100),Pc(+$,0,100),oe?Ny(+oe,xe):1];if(jy(Me))return k2(Me)}}}function id(h){return parseInt(h.padEnd(2,h),16)/255}function Ny(h,a){return Pc(a?h/100:h,0,1)}function Pc(h,a,d){return Math.min(Math.max(a,h),d)}function jy(h){return!h.some(Number.isNaN)}const R2={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function xu(h,a,d){return h+d*(a-h)}function Wh(h,a,d){return h.map((w,S)=>xu(w,a[S],d))}class Ci{constructor(a,d,w,S=1,A=!0){this.r=a,this.g=d,this.b=w,this.a=S,A||(this.r*=S,this.g*=S,this.b*=S,S||this.overwriteGetter("rgb",[a,d,w,S]))}static parse(a){if(a instanceof Ci)return a;if(typeof a!="string")return;const d=D2(a);if(d)return new Ci(...d,!1)}get rgb(){const{r:a,g:d,b:w,a:S}=this,A=S||1/0;return this.overwriteGetter("rgb",[a/A,d/A,w/A,S])}get hcl(){return this.overwriteGetter("hcl",C2(this.rgb))}get lab(){return this.overwriteGetter("lab",n0(this.rgb))}overwriteGetter(a,d){return Object.defineProperty(this,a,{value:d}),d}toString(){const[a,d,w,S]=this.rgb;return`rgba(${[a,d,w].map(A=>Math.round(A*255)).join(",")},${S})`}static interpolate(a,d,w,S="rgb"){switch(S){case"rgb":{const[A,b,s,F]=Wh(a.rgb,d.rgb,w);return new Ci(A,b,s,F,!1)}case"hcl":{const[A,b,s,F]=a.hcl,[$,Q,oe,xe]=d.hcl;let ge,Me;if(!isNaN(A)&&!isNaN($)){let Je=$-A;$>A&&Je>180?Je-=360:$<A&&A-$>180&&(Je+=360),ge=A+w*Je}else isNaN(A)?isNaN($)?ge=NaN:(ge=$,(s===1||s===0)&&(Me=Q)):(ge=A,(oe===1||oe===0)&&(Me=b));const[be,me,nt,Ke]=L2([ge,Me??xu(b,Q,w),xu(s,oe,w),xu(F,xe,w)]);return new Ci(be,me,nt,Ke,!1)}case"lab":{const[A,b,s,F]=o0(Wh(a.lab,d.lab,w));return new Ci(A,b,s,F,!1)}}}}Ci.black=new Ci(0,0,0,1);Ci.white=new Ci(1,1,1,1);Ci.transparent=new Ci(0,0,0,0);Ci.red=new Ci(1,0,0,1);class Vm{constructor(a,d,w){a?this.sensitivity=d?"variant":"case":this.sensitivity=d?"accent":"base",this.locale=w,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,d){return this.collator.compare(a,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const F2=["bottom","center","top"];class ym{constructor(a,d,w,S,A,b){this.text=a,this.image=d,this.scale=w,this.fontStack=S,this.textColor=A,this.verticalAlign=b}}class Xs{constructor(a){this.sections=a}static fromString(a){return new Xs([new ym(a,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof Xs?a:Xs.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class Ea{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Ea)return a;if(typeof a=="number")return new Ea([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const d of a)if(typeof d!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]];break}return new Ea(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,d,w){return new Ea(Wh(a.values,d.values,w))}}class Ca{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Ca)return a;if(typeof a=="number")return new Ca([a]);if(Array.isArray(a)){for(const d of a)if(typeof d!="number")return;return new Ca(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,d,w){return new Ca(Wh(a.values,d.values,w))}}class zo{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof zo)return a;if(typeof a=="string"){const w=Ci.parse(a);return w?new zo([w]):void 0}if(!Array.isArray(a))return;const d=[];for(const w of a){if(typeof w!="string")return;const S=Ci.parse(w);if(!S)return;d.push(S)}return new zo(d)}toString(){return JSON.stringify(this.values)}static interpolate(a,d,w,S="rgb"){const A=[];if(a.values.length!=d.values.length)throw new Error(`colorArray: Arrays have mismatched length (${a.values.length} vs. ${d.values.length}), cannot interpolate.`);for(let b=0;b<a.values.length;b++)A.push(Ci.interpolate(a.values[b],d.values[b],w,S));return new zo(A)}}class mr extends Error{constructor(a){super(a),this.name="RuntimeError"}toJSON(){return this.message}}const B2=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class hs{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof hs)return a;if(!(!Array.isArray(a)||a.length<1||a.length%2!==0)){for(let d=0;d<a.length;d+=2){const w=a[d],S=a[d+1];if(typeof w!="string"||!B2.has(w)||!Array.isArray(S)||S.length!==2||typeof S[0]!="number"||typeof S[1]!="number")return}return new hs(a)}}toString(){return JSON.stringify(this.values)}static interpolate(a,d,w){const S=a.values,A=d.values;if(S.length!==A.length)throw new mr(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${d.toString()}`);const b=[];for(let s=0;s<S.length;s+=2){if(S[s]!==A[s])throw new mr(`Cannot interpolate values containing mismatched anchors. from[${s}]: ${S[s]}, to[${s}]: ${A[s]}`);b.push(S[s]);const[F,$]=S[s+1],[Q,oe]=A[s+1];b.push([xu(F,Q,w),xu($,oe,w)])}return new hs(b)}}class zl{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new zl({name:a,available:!1}):null}}class Ia{constructor(a,d,w){this.from=a,this.to=d,this.transition=w}static interpolate(a,d,w){return new Ia(a,d,w)}static parse(a){if(a instanceof Ia)return a;if(Array.isArray(a)&&a.length===3&&typeof a[0]=="string"&&typeof a[1]=="string"&&typeof a[2]=="number")return new Ia(a[0],a[1],a[2]);if(typeof a=="object"&&typeof a.from=="string"&&typeof a.to=="string"&&typeof a.transition=="number")return new Ia(a.from,a.to,a.transition);if(typeof a=="string")return new Ia(a,a,1)}}function a0(h,a,d,w){return typeof h=="number"&&h>=0&&h<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof d=="number"&&d>=0&&d<=255?typeof w>"u"||typeof w=="number"&&w>=0&&w<=1?null:`Invalid rgba value [${[h,a,d,w].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof w=="number"?[h,a,d,w]:[h,a,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Hh(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof Ia||h instanceof Ci||h instanceof Vm||h instanceof Xs||h instanceof Ea||h instanceof Ca||h instanceof zo||h instanceof hs||h instanceof zl)return!0;if(Array.isArray(h)){for(const a of h)if(!Hh(a))return!1;return!0}else if(typeof h=="object"){for(const a in h)if(!Hh(h[a]))return!1;return!0}else return!1}function Zr(h){if(h===null)return Id;if(typeof h=="string")return Qt;if(typeof h=="boolean")return Jt;if(typeof h=="number")return lt;if(h instanceof Ci)return cs;if(h instanceof Ia)return Ad;if(h instanceof Vm)return Ed;if(h instanceof Xs)return Cd;if(h instanceof Ea)return Ld;if(h instanceof Ca)return kd;if(h instanceof zo)return $h;if(h instanceof hs)return zd;if(h instanceof zl)return ip;if(Array.isArray(h)){const a=h.length;let d;for(const w of h){const S=Zr(w);if(!d)d=S;else{if(d===S)continue;d=Ht;break}}return ko(d||Ht,a)}else return yu}function Zh(h){const a=typeof h;return h===null?"":a==="string"||a==="number"||a==="boolean"?String(h):h instanceof Ci||h instanceof Ia||h instanceof Xs||h instanceof Ea||h instanceof Ca||h instanceof zo||h instanceof hs||h instanceof zl?h.toString():JSON.stringify(h)}class kc{constructor(a,d){this.type=a,this.value=d}static parse(a,d){if(a.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Hh(a[1]))return d.error("invalid value");const w=a[1];let S=Zr(w);const A=d.expectedType;return S.kind==="array"&&S.N===0&&A&&A.kind==="array"&&(typeof A.N!="number"||A.N===0)&&(S=A),new kc(S,w)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const rd={string:Qt,number:lt,boolean:Jt,object:yu};class Aa{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");let w=1,S;const A=a[0];if(A==="array"){let s;if(a.length>2){const $=a[1];if(typeof $!="string"||!($ in rd)||$==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);s=rd[$],w++}else s=Ht;let F;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return d.error('The length argument to "array" must be a positive integer literal',2);F=a[2],w++}S=ko(s,F)}else{if(!rd[A])throw new Error(`Types doesn't contain name = ${A}`);S=rd[A]}const b=[];for(;w<a.length;w++){const s=d.parse(a[w],w,Ht);if(!s)return null;b.push(s)}return new Aa(S,b)}evaluate(a){for(let d=0;d<this.args.length;d++){const w=this.args[d].evaluate(a);if(qh(this.type,Zr(w))){if(d===this.args.length-1)throw new mr(`Expected value to be of type ${sr(this.type)}, but found ${sr(Zr(w))} instead.`)}else return w}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const Vy={"to-boolean":Jt,"to-color":cs,"to-number":lt,"to-string":Qt};class El{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");const w=a[0];if(!Vy[w])throw new Error(`Can't parse ${w} as it is not part of the known types`);if((w==="to-boolean"||w==="to-string")&&a.length!==2)return d.error("Expected one argument.");const S=Vy[w],A=[];for(let b=1;b<a.length;b++){const s=d.parse(a[b],b,Ht);if(!s)return null;A.push(s)}return new El(S,A)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let d,w;for(const S of this.args){if(d=S.evaluate(a),w=null,d instanceof Ci)return d;if(typeof d=="string"){const A=a.parseColor(d);if(A)return A}else if(Array.isArray(d)&&(d.length<3||d.length>4?w=`Invalid rgba value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:w=a0(d[0],d[1],d[2],d[3]),!w))return new Ci(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new mr(w||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(const w of this.args){d=w.evaluate(a);const S=Ea.parse(d);if(S)return S}throw new mr(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"numberArray":{let d;for(const w of this.args){d=w.evaluate(a);const S=Ca.parse(d);if(S)return S}throw new mr(`Could not parse numberArray from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"colorArray":{let d;for(const w of this.args){d=w.evaluate(a);const S=zo.parse(d);if(S)return S}throw new mr(`Could not parse colorArray from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(const w of this.args){d=w.evaluate(a);const S=hs.parse(d);if(S)return S}throw new mr(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(const w of this.args){if(d=w.evaluate(a),d===null)return 0;const S=Number(d);if(!isNaN(S))return S}throw new mr(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return Xs.fromString(Zh(this.args[0].evaluate(a)));case"resolvedImage":return zl.fromString(Zh(this.args[0].evaluate(a)));case"projectionDefinition":return this.args[0].evaluate(a);default:return Zh(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const O2=["Unknown","Point","LineString","Polygon"];class s0{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?O2[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let d=this._parseColorCache.get(a);return d||(d=Ci.parse(a),this._parseColorCache.set(a,d)),d}}class Dd{constructor(a,d,w=[],S,A=new Nm,b=[]){this.registry=a,this.path=w,this.key=w.map(s=>`[${s}]`).join(""),this.scope=A,this.errors=b,this.expectedType=S,this._isConstant=d}parse(a,d,w,S,A={}){return d?this.concat(d,w,S)._parse(a,A):this._parse(a,A)}_parse(a,d){(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number")&&(a=["literal",a]);function w(S,A,b){return b==="assert"?new Aa(A,[S]):b==="coerce"?new El(A,[S]):S}if(Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const S=a[0];if(typeof S!="string")return this.error(`Expression name must be a string, but found ${typeof S} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const A=this.registry[S];if(A){let b=A.parse(a,this);if(!b)return null;if(this.expectedType){const s=this.expectedType,F=b.type;if((s.kind==="string"||s.kind==="number"||s.kind==="boolean"||s.kind==="object"||s.kind==="array")&&F.kind==="value")b=w(b,s,d.typeAnnotation||"assert");else if(s.kind==="projectionDefinition"&&["string","array"].includes(F.kind)||["color","formatted","resolvedImage"].includes(s.kind)&&["value","string"].includes(F.kind)||["padding","numberArray"].includes(s.kind)&&["value","number","array"].includes(F.kind)||s.kind==="colorArray"&&["value","string","array"].includes(F.kind)||s.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(F.kind))b=w(b,s,d.typeAnnotation||"coerce");else if(this.checkSubtype(s,F))return null}if(!(b instanceof kc)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const s=new s0;try{b=new kc(b.type,b.evaluate(s))}catch(F){return this.error(F.message),null}}return b}return this.error(`Unknown expression "${S}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof a>"u"?this.error("'undefined' value invalid. Use null instead."):typeof a=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof a} instead.`)}concat(a,d,w){const S=typeof a=="number"?this.path.concat(a):this.path,A=w?this.scope.concat(w):this.scope;return new Dd(this.registry,this._isConstant,S,d||null,A,this.errors)}error(a,...d){const w=`${this.key}${d.map(S=>`[${S}]`).join("")}`;this.errors.push(new us(w,a))}checkSubtype(a,d){const w=qh(a,d);return w&&this.error(w),w}}class Rd{constructor(a,d){this.type=d.type,this.bindings=[].concat(a),this.result=d}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const d of this.bindings)a(d[1]);a(this.result)}static parse(a,d){if(a.length<4)return d.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const w=[];for(let A=1;A<a.length-1;A+=2){const b=a[A];if(typeof b!="string")return d.error(`Expected string, but found ${typeof b} instead.`,A);if(/[^a-zA-Z0-9_]/.test(b))return d.error("Variable names must contain only alphanumeric characters or '_'.",A);const s=d.parse(a[A+1],A+1);if(!s)return null;w.push([b,s])}const S=d.parse(a[a.length-1],a.length-1,d.expectedType,w);return S?new Rd(w,S):null}outputDefined(){return this.result.outputDefined()}}class Fd{constructor(a,d){this.type=d.type,this.name=a,this.boundExpression=d}static parse(a,d){if(a.length!==2||typeof a[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const w=a[1];return d.scope.has(w)?new Fd(w,d.scope.get(w)):d.error(`Unknown variable "${w}". Make sure "${w}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class Um{constructor(a,d,w){this.type=a,this.index=d,this.input=w}static parse(a,d){if(a.length!==3)return d.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const w=d.parse(a[1],1,lt),S=d.parse(a[2],2,ko(d.expectedType||Ht));if(!w||!S)return null;const A=S.type;return new Um(A.itemType,w,S)}evaluate(a){const d=this.index.evaluate(a),w=this.input.evaluate(a);if(d<0)throw new mr(`Array index out of bounds: ${d} < 0.`);if(d>=w.length)throw new mr(`Array index out of bounds: ${d} > ${w.length-1}.`);if(d!==Math.floor(d))throw new mr(`Array index must be an integer, but found ${d} instead.`);return w[d]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class Zm{constructor(a,d){this.type=Jt,this.needle=a,this.haystack=d}static parse(a,d){if(a.length!==3)return d.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const w=d.parse(a[1],1,Ht),S=d.parse(a[2],2,Ht);return!w||!S?null:jm(w.type,[Jt,Qt,lt,Id,Ht])?new Zm(w,S):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${sr(w.type)} instead`)}evaluate(a){const d=this.needle.evaluate(a),w=this.haystack.evaluate(a);if(!w)return!1;if(!vu(d,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${sr(Zr(d))} instead.`);if(!vu(w,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${sr(Zr(w))} instead.`);return w.indexOf(d)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class _d{constructor(a,d,w){this.type=lt,this.needle=a,this.haystack=d,this.fromIndex=w}static parse(a,d){if(a.length<=2||a.length>=5)return d.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const w=d.parse(a[1],1,Ht),S=d.parse(a[2],2,Ht);if(!w||!S)return null;if(!jm(w.type,[Jt,Qt,lt,Id,Ht]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${sr(w.type)} instead`);if(a.length===4){const A=d.parse(a[3],3,lt);return A?new _d(w,S,A):null}else return new _d(w,S)}evaluate(a){const d=this.needle.evaluate(a),w=this.haystack.evaluate(a);if(!vu(d,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${sr(Zr(d))} instead.`);let S;if(this.fromIndex&&(S=this.fromIndex.evaluate(a)),vu(w,["string"])){const A=w.indexOf(d,S);return A===-1?-1:[...w.slice(0,A)].length}else{if(vu(w,["array"]))return w.indexOf(d,S);throw new mr(`Expected second argument to be of type array or string, but found ${sr(Zr(w))} instead.`)}}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class Gm{constructor(a,d,w,S,A,b){this.inputType=a,this.type=d,this.input=w,this.cases=S,this.outputs=A,this.otherwise=b}static parse(a,d){if(a.length<5)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!==1)return d.error("Expected an even number of arguments.");let w,S;d.expectedType&&d.expectedType.kind!=="value"&&(S=d.expectedType);const A={},b=[];for(let $=2;$<a.length-1;$+=2){let Q=a[$];const oe=a[$+1];Array.isArray(Q)||(Q=[Q]);const xe=d.concat($);if(Q.length===0)return xe.error("Expected at least one branch label.");for(const Me of Q){if(typeof Me!="number"&&typeof Me!="string")return xe.error("Branch labels must be numbers or strings.");if(typeof Me=="number"&&Math.abs(Me)>Number.MAX_SAFE_INTEGER)return xe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Me=="number"&&Math.floor(Me)!==Me)return xe.error("Numeric branch labels must be integer values.");if(!w)w=Zr(Me);else if(xe.checkSubtype(w,Zr(Me)))return null;if(typeof A[String(Me)]<"u")return xe.error("Branch labels must be unique.");A[String(Me)]=b.length}const ge=d.parse(oe,$,S);if(!ge)return null;S=S||ge.type,b.push(ge)}const s=d.parse(a[1],1,Ht);if(!s)return null;const F=d.parse(a[a.length-1],a.length-1,S);return!F||s.type.kind!=="value"&&d.concat(1).checkSubtype(w,s.type)?null:new Gm(w,S,s,A,b,F)}evaluate(a){const d=this.input.evaluate(a);return(Zr(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class $m{constructor(a,d,w){this.type=a,this.branches=d,this.otherwise=w}static parse(a,d){if(a.length<4)return d.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!==0)return d.error("Expected an odd number of arguments.");let w;d.expectedType&&d.expectedType.kind!=="value"&&(w=d.expectedType);const S=[];for(let b=1;b<a.length-1;b+=2){const s=d.parse(a[b],b,Jt);if(!s)return null;const F=d.parse(a[b+1],b+1,w);if(!F)return null;S.push([s,F]),w=w||F.type}const A=d.parse(a[a.length-1],a.length-1,w);if(!A)return null;if(!w)throw new Error("Can't infer output type");return new $m(w,S,A)}evaluate(a){for(const[d,w]of this.branches)if(d.evaluate(a))return w.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[d,w]of this.branches)a(d),a(w);a(this.otherwise)}outputDefined(){return this.branches.every(([a,d])=>d.outputDefined())&&this.otherwise.outputDefined()}}class yd{constructor(a,d,w,S){this.type=a,this.input=d,this.beginIndex=w,this.endIndex=S}static parse(a,d){if(a.length<=2||a.length>=5)return d.error(`Expected 2 or 3 arguments, but found ${a.length-1} instead.`);const w=d.parse(a[1],1,Ht),S=d.parse(a[2],2,lt);if(!w||!S)return null;if(!jm(w.type,[ko(Ht),Qt,Ht]))return d.error(`Expected first argument to be of type array or string, but found ${sr(w.type)} instead`);if(a.length===4){const A=d.parse(a[3],3,lt);return A?new yd(w.type,w,S,A):null}else return new yd(w.type,w,S)}evaluate(a){const d=this.input.evaluate(a),w=this.beginIndex.evaluate(a);let S;if(this.endIndex&&(S=this.endIndex.evaluate(a)),vu(d,["string"]))return[...d].slice(w,S).join("");if(vu(d,["array"]))return d.slice(w,S);throw new mr(`Expected first argument to be of type array or string, but found ${sr(Zr(d))} instead.`)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function l0(h,a){const d=h.length-1;let w=0,S=d,A=0,b,s;for(;w<=S;)if(A=Math.floor((w+S)/2),b=h[A],s=h[A+1],b<=a){if(A===d||a<s)return A;w=A+1}else if(b>a)S=A-1;else throw new mr("Input is not a number.");return 0}class Bd{constructor(a,d,w){this.type=a,this.input=d,this.labels=[],this.outputs=[];for(const[S,A]of w)this.labels.push(S),this.outputs.push(A)}static parse(a,d){if(a.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!==0)return d.error("Expected an even number of arguments.");const w=d.parse(a[1],1,lt);if(!w)return null;const S=[];let A=null;d.expectedType&&d.expectedType.kind!=="value"&&(A=d.expectedType);for(let b=1;b<a.length;b+=2){const s=b===1?-1/0:a[b],F=a[b+1],$=b,Q=b+1;if(typeof s!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(S.length&&S[S.length-1][0]>=s)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',$);const oe=d.parse(F,Q,A);if(!oe)return null;A=A||oe.type,S.push([s,oe])}return new Bd(A,w,S)}evaluate(a){const d=this.labels,w=this.outputs;if(d.length===1)return w[0].evaluate(a);const S=this.input.evaluate(a);if(S<=d[0])return w[0].evaluate(a);const A=d.length;if(S>=d[A-1])return w[A-1].evaluate(a);const b=l0(d,S);return w[b].evaluate(a)}eachChild(a){a(this.input);for(const d of this.outputs)a(d)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function N2(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var em,Uy;function j2(){if(Uy)return em;Uy=1,em=h;function h(a,d,w,S){this.cx=3*a,this.bx=3*(w-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(S-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=d,this.p2x=w,this.p2y=S}return h.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,d){if(d===void 0&&(d=1e-6),a<0)return 0;if(a>1)return 1;for(var w=a,S=0;S<8;S++){var A=this.sampleCurveX(w)-a;if(Math.abs(A)<d)return w;var b=this.sampleCurveDerivativeX(w);if(Math.abs(b)<1e-6)break;w=w-A/b}var s=0,F=1;for(w=a,S=0;S<20&&(A=this.sampleCurveX(w),!(Math.abs(A-a)<d));S++)a>A?s=w:F=w,w=(F-s)*.5+s;return w},solve:function(a,d){return this.sampleCurveY(this.solveCurveX(a,d))}},em}var V2=j2(),U2=N2(V2);class ps{constructor(a,d,w,S,A){this.type=a,this.operator=d,this.interpolation=w,this.input=S,this.labels=[],this.outputs=[];for(const[b,s]of A)this.labels.push(b),this.outputs.push(s)}static interpolationFactor(a,d,w,S){let A=0;if(a.name==="exponential")A=tm(d,a.base,w,S);else if(a.name==="linear")A=tm(d,1,w,S);else if(a.name==="cubic-bezier"){const b=a.controlPoints;A=new U2(b[0],b[1],b[2],b[3]).solve(tm(d,1,w,S))}return A}static parse(a,d){let[w,S,A,...b]=a;if(!Array.isArray(S)||S.length===0)return d.error("Expected an interpolation type expression.",1);if(S[0]==="linear")S={name:"linear"};else if(S[0]==="exponential"){const $=S[1];if(typeof $!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);S={name:"exponential",base:$}}else if(S[0]==="cubic-bezier"){const $=S.slice(1);if($.length!==4||$.some(Q=>typeof Q!="number"||Q<0||Q>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);S={name:"cubic-bezier",controlPoints:$}}else return d.error(`Unknown interpolation type ${String(S[0])}`,1,0);if(a.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!==0)return d.error("Expected an even number of arguments.");if(A=d.parse(A,2,lt),!A)return null;const s=[];let F=null;(w==="interpolate-hcl"||w==="interpolate-lab")&&d.expectedType!=$h?F=cs:d.expectedType&&d.expectedType.kind!=="value"&&(F=d.expectedType);for(let $=0;$<b.length;$+=2){const Q=b[$],oe=b[$+1],xe=$+3,ge=$+4;if(typeof Q!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xe);if(s.length&&s[s.length-1][0]>=Q)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',xe);const Me=d.parse(oe,ge,F);if(!Me)return null;F=F||Me.type,s.push([Q,Me])}return!Al(F,lt)&&!Al(F,Ad)&&!Al(F,cs)&&!Al(F,Ld)&&!Al(F,kd)&&!Al(F,$h)&&!Al(F,zd)&&!Al(F,ko(lt))?d.error(`Type ${sr(F)} is not interpolatable.`):new ps(F,w,S,A,s)}evaluate(a){const d=this.labels,w=this.outputs;if(d.length===1)return w[0].evaluate(a);const S=this.input.evaluate(a);if(S<=d[0])return w[0].evaluate(a);const A=d.length;if(S>=d[A-1])return w[A-1].evaluate(a);const b=l0(d,S),s=d[b],F=d[b+1],$=ps.interpolationFactor(this.interpolation,S,s,F),Q=w[b].evaluate(a),oe=w[b+1].evaluate(a);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return xu(Q,oe,$);case"color":return Ci.interpolate(Q,oe,$);case"padding":return Ea.interpolate(Q,oe,$);case"colorArray":return zo.interpolate(Q,oe,$);case"numberArray":return Ca.interpolate(Q,oe,$);case"variableAnchorOffsetCollection":return hs.interpolate(Q,oe,$);case"array":return Wh(Q,oe,$);case"projectionDefinition":return Ia.interpolate(Q,oe,$)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ci.interpolate(Q,oe,$,"hcl");case"colorArray":return zo.interpolate(Q,oe,$,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ci.interpolate(Q,oe,$,"lab");case"colorArray":return zo.interpolate(Q,oe,$,"lab")}}}eachChild(a){a(this.input);for(const d of this.outputs)a(d)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function tm(h,a,d,w){const S=w-d,A=h-d;return S===0?0:a===1?A/S:(Math.pow(a,A)-1)/(Math.pow(a,S)-1)}class Xh{constructor(a,d){this.type=a,this.args=d}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");let w=null;const S=d.expectedType;S&&S.kind!=="value"&&(w=S);const A=[];for(const b of a.slice(1)){const s=d.parse(b,1+A.length,w,void 0,{typeAnnotation:"omit"});if(!s)return null;w=w||s.type,A.push(s)}if(!w)throw new Error("No output type");return S&&A.some(b=>qh(S,b.type))?new Xh(Ht,A):new Xh(w,A)}evaluate(a){let d=null,w=0,S;for(const A of this.args)if(w++,d=A.evaluate(a),d&&d instanceof zl&&!d.available&&(S||(S=d.name),d=null,w===this.args.length&&(d=S)),d!==null)break;return d}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}function Zy(h,a){return h==="=="||h==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Z2(h,a,d){return a===d}function G2(h,a,d){return a!==d}function $2(h,a,d){return a<d}function q2(h,a,d){return a>d}function W2(h,a,d){return a<=d}function H2(h,a,d){return a>=d}function u0(h,a,d,w){return w.compare(a,d)===0}function X2(h,a,d,w){return!u0(h,a,d,w)}function Y2(h,a,d,w){return w.compare(a,d)<0}function K2(h,a,d,w){return w.compare(a,d)>0}function J2(h,a,d,w){return w.compare(a,d)<=0}function Q2(h,a,d,w){return w.compare(a,d)>=0}function Fc(h,a,d){const w=h!=="=="&&h!=="!=";return class c0{constructor(A,b,s){this.type=Jt,this.lhs=A,this.rhs=b,this.collator=s,this.hasUntypedArgument=A.type.kind==="value"||b.type.kind==="value"}static parse(A,b){if(A.length!==3&&A.length!==4)return b.error("Expected two or three arguments.");const s=A[0];let F=b.parse(A[1],1,Ht);if(!F)return null;if(!Zy(s,F.type))return b.concat(1).error(`"${s}" comparisons are not supported for type '${sr(F.type)}'.`);let $=b.parse(A[2],2,Ht);if(!$)return null;if(!Zy(s,$.type))return b.concat(2).error(`"${s}" comparisons are not supported for type '${sr($.type)}'.`);if(F.type.kind!==$.type.kind&&F.type.kind!=="value"&&$.type.kind!=="value")return b.error(`Cannot compare types '${sr(F.type)}' and '${sr($.type)}'.`);w&&(F.type.kind==="value"&&$.type.kind!=="value"?F=new Aa($.type,[F]):F.type.kind!=="value"&&$.type.kind==="value"&&($=new Aa(F.type,[$])));let Q=null;if(A.length===4){if(F.type.kind!=="string"&&$.type.kind!=="string"&&F.type.kind!=="value"&&$.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(Q=b.parse(A[3],3,Ed),!Q)return null}return new c0(F,$,Q)}evaluate(A){const b=this.lhs.evaluate(A),s=this.rhs.evaluate(A);if(w&&this.hasUntypedArgument){const F=Zr(b),$=Zr(s);if(F.kind!==$.kind||!(F.kind==="string"||F.kind==="number"))throw new mr(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${F.kind}, ${$.kind}) instead.`)}if(this.collator&&!w&&this.hasUntypedArgument){const F=Zr(b),$=Zr(s);if(F.kind!=="string"||$.kind!=="string")return a(A,b,s)}return this.collator?d(A,b,s,this.collator.evaluate(A)):a(A,b,s)}eachChild(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)}outputDefined(){return!0}}}const eT=Fc("==",Z2,u0),tT=Fc("!=",G2,X2),iT=Fc("<",$2,Y2),rT=Fc(">",q2,K2),nT=Fc("<=",W2,J2),oT=Fc(">=",H2,Q2);class Od{constructor(a,d,w){this.type=Ed,this.locale=w,this.caseSensitive=a,this.diacriticSensitive=d}static parse(a,d){if(a.length!==2)return d.error("Expected one argument.");const w=a[1];if(typeof w!="object"||Array.isArray(w))return d.error("Collator options argument must be an object.");const S=d.parse(w["case-sensitive"]===void 0?!1:w["case-sensitive"],1,Jt);if(!S)return null;const A=d.parse(w["diacritic-sensitive"]===void 0?!1:w["diacritic-sensitive"],1,Jt);if(!A)return null;let b=null;return w.locale&&(b=d.parse(w.locale,1,Qt),!b)?null:new Od(S,A,b)}evaluate(a){return new Vm(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}class qm{constructor(a,d,w,S,A){this.type=Qt,this.number=a,this.locale=d,this.currency=w,this.minFractionDigits=S,this.maxFractionDigits=A}static parse(a,d){if(a.length!==3)return d.error("Expected two arguments.");const w=d.parse(a[1],1,lt);if(!w)return null;const S=a[2];if(typeof S!="object"||Array.isArray(S))return d.error("NumberFormat options argument must be an object.");let A=null;if(S.locale&&(A=d.parse(S.locale,1,Qt),!A))return null;let b=null;if(S.currency&&(b=d.parse(S.currency,1,Qt),!b))return null;let s=null;if(S["min-fraction-digits"]&&(s=d.parse(S["min-fraction-digits"],1,lt),!s))return null;let F=null;return S["max-fraction-digits"]&&(F=d.parse(S["max-fraction-digits"],1,lt),!F)?null:new qm(w,A,b,s,F)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Wm{constructor(a){this.type=Cd,this.sections=a}static parse(a,d){if(a.length<2)return d.error("Expected at least one argument.");const w=a[1];if(!Array.isArray(w)&&typeof w=="object")return d.error("First argument must be an image or text section.");const S=[];let A=!1;for(let b=1;b<=a.length-1;++b){const s=a[b];if(A&&typeof s=="object"&&!Array.isArray(s)){A=!1;let F=null;if(s["font-scale"]&&(F=d.parse(s["font-scale"],1,lt),!F))return null;let $=null;if(s["text-font"]&&($=d.parse(s["text-font"],1,ko(Qt)),!$))return null;let Q=null;if(s["text-color"]&&(Q=d.parse(s["text-color"],1,cs),!Q))return null;let oe=null;if(s["vertical-align"]){if(typeof s["vertical-align"]=="string"&&!F2.includes(s["vertical-align"]))return d.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${s["vertical-align"]}' instead.`);if(oe=d.parse(s["vertical-align"],1,Qt),!oe)return null}const xe=S[S.length-1];xe.scale=F,xe.font=$,xe.textColor=Q,xe.verticalAlign=oe}else{const F=d.parse(a[b],1,Ht);if(!F)return null;const $=F.type.kind;if($!=="string"&&$!=="value"&&$!=="null"&&$!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");A=!0,S.push({content:F,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Wm(S)}evaluate(a){const d=w=>{const S=w.content.evaluate(a);return Zr(S)===ip?new ym("",S,null,null,null,w.verticalAlign?w.verticalAlign.evaluate(a):null):new ym(Zh(S),null,w.scale?w.scale.evaluate(a):null,w.font?w.font.evaluate(a).join(","):null,w.textColor?w.textColor.evaluate(a):null,w.verticalAlign?w.verticalAlign.evaluate(a):null)};return new Xs(this.sections.map(d))}eachChild(a){for(const d of this.sections)a(d.content),d.scale&&a(d.scale),d.font&&a(d.font),d.textColor&&a(d.textColor),d.verticalAlign&&a(d.verticalAlign)}outputDefined(){return!1}}class Hm{constructor(a){this.type=ip,this.input=a}static parse(a,d){if(a.length!==2)return d.error("Expected two arguments.");const w=d.parse(a[1],1,Qt);return w?new Hm(w):d.error("No image name provided.")}evaluate(a){const d=this.input.evaluate(a),w=zl.fromString(d);return w&&a.availableImages&&(w.available=a.availableImages.indexOf(d)>-1),w}eachChild(a){a(this.input)}outputDefined(){return!1}}class Xm{constructor(a){this.type=lt,this.input=a}static parse(a,d){if(a.length!==2)return d.error(`Expected 1 argument, but found ${a.length-1} instead.`);const w=d.parse(a[1],1);return w?w.type.kind!=="array"&&w.type.kind!=="string"&&w.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${sr(w.type)} instead.`):new Xm(w):null}evaluate(a){const d=this.input.evaluate(a);if(typeof d=="string")return[...d].length;if(Array.isArray(d))return d.length;throw new mr(`Expected value to be of type string or array, but found ${sr(Zr(d))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const ds=8192;function aT(h,a){const d=sT(h[0]),w=uT(h[1]),S=Math.pow(2,a.z);return[Math.round(d*S*ds),Math.round(w*S*ds)]}function Ym(h,a){const d=Math.pow(2,a.z),w=(h[0]/ds+a.x)/d,S=(h[1]/ds+a.y)/d;return[lT(w),cT(S)]}function sT(h){return(180+h)/360}function lT(h){return h*360-180}function uT(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function cT(h){return 360/Math.PI*Math.atan(Math.exp((180-h*360)*Math.PI/180))-90}function rp(h,a){h[0]=Math.min(h[0],a[0]),h[1]=Math.min(h[1],a[1]),h[2]=Math.max(h[2],a[0]),h[3]=Math.max(h[3],a[1])}function Yh(h,a){return!(h[0]<=a[0]||h[2]>=a[2]||h[1]<=a[1]||h[3]>=a[3])}function hT(h,a,d){return a[1]>h[1]!=d[1]>h[1]&&h[0]<(d[0]-a[0])*(h[1]-a[1])/(d[1]-a[1])+a[0]}function pT(h,a,d){const w=h[0]-a[0],S=h[1]-a[1],A=h[0]-d[0],b=h[1]-d[1];return w*b-A*S===0&&w*A<=0&&S*b<=0}function Nd(h,a,d,w){const S=[a[0]-h[0],a[1]-h[1]],A=[w[0]-d[0],w[1]-d[1]];return gT(A,S)===0?!1:!!(Gy(h,a,d,w)&&Gy(d,w,h,a))}function dT(h,a,d){for(const w of d)for(let S=0;S<w.length-1;++S)if(Nd(h,a,w[S],w[S+1]))return!0;return!1}function Bc(h,a,d=!1){let w=!1;for(const S of a)for(let A=0;A<S.length-1;A++){if(pT(h,S[A],S[A+1]))return d;hT(h,S[A],S[A+1])&&(w=!w)}return w}function fT(h,a){for(const d of a)if(Bc(h,d))return!0;return!1}function h0(h,a){for(const d of h)if(!Bc(d,a))return!1;for(let d=0;d<h.length-1;++d)if(dT(h[d],h[d+1],a))return!1;return!0}function mT(h,a){for(const d of a)if(h0(h,d))return!0;return!1}function gT(h,a){return h[0]*a[1]-h[1]*a[0]}function Gy(h,a,d,w){const S=h[0]-d[0],A=h[1]-d[1],b=a[0]-d[0],s=a[1]-d[1],F=w[0]-d[0],$=w[1]-d[1],Q=S*$-F*A,oe=b*$-F*s;return Q>0&&oe<0||Q<0&&oe>0}function Km(h,a,d){const w=[];for(let S=0;S<h.length;S++){const A=[];for(let b=0;b<h[S].length;b++){const s=aT(h[S][b],d);rp(a,s),A.push(s)}w.push(A)}return w}function p0(h,a,d){const w=[];for(let S=0;S<h.length;S++){const A=Km(h[S],a,d);w.push(A)}return w}function d0(h,a,d,w){if(h[0]<d[0]||h[0]>d[2]){const S=w*.5;let A=h[0]-d[0]>S?-w:d[0]-h[0]>S?w:0;A===0&&(A=h[0]-d[2]>S?-w:d[2]-h[0]>S?w:0),h[0]+=A}rp(a,h)}function _T(h){h[0]=h[1]=1/0,h[2]=h[3]=-1/0}function $y(h,a,d,w){const S=Math.pow(2,w.z)*ds,A=[w.x*ds,w.y*ds],b=[];for(const s of h)for(const F of s){const $=[F.x+A[0],F.y+A[1]];d0($,a,d,S),b.push($)}return b}function qy(h,a,d,w){const S=Math.pow(2,w.z)*ds,A=[w.x*ds,w.y*ds],b=[];for(const s of h){const F=[];for(const $ of s){const Q=[$.x+A[0],$.y+A[1]];rp(a,Q),F.push(Q)}b.push(F)}if(a[2]-a[0]<=S/2){_T(a);for(const s of b)for(const F of s)d0(F,a,d,S)}return b}function yT(h,a){const d=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=h.canonicalID();if(a.type==="Polygon"){const A=Km(a.coordinates,w,S),b=$y(h.geometry(),d,w,S);if(!Yh(d,w))return!1;for(const s of b)if(!Bc(s,A))return!1}if(a.type==="MultiPolygon"){const A=p0(a.coordinates,w,S),b=$y(h.geometry(),d,w,S);if(!Yh(d,w))return!1;for(const s of b)if(!fT(s,A))return!1}return!0}function vT(h,a){const d=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=h.canonicalID();if(a.type==="Polygon"){const A=Km(a.coordinates,w,S),b=qy(h.geometry(),d,w,S);if(!Yh(d,w))return!1;for(const s of b)if(!h0(s,A))return!1}if(a.type==="MultiPolygon"){const A=p0(a.coordinates,w,S),b=qy(h.geometry(),d,w,S);if(!Yh(d,w))return!1;for(const s of b)if(!mT(s,A))return!1}return!0}class bu{constructor(a,d){this.type=Jt,this.geojson=a,this.geometries=d}static parse(a,d){if(a.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Hh(a[1])){const w=a[1];if(w.type==="FeatureCollection"){const S=[];for(const A of w.features){const{type:b,coordinates:s}=A.geometry;b==="Polygon"&&S.push(s),b==="MultiPolygon"&&S.push(...s)}if(S.length){const A={type:"MultiPolygon",coordinates:S};return new bu(w,A)}}else if(w.type==="Feature"){const S=w.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new bu(w,w.geometry)}else if(w.type==="Polygon"||w.type==="MultiPolygon")return new bu(w,w)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return yT(a,this.geometries);if(a.geometryType()==="LineString")return vT(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class f0{constructor(a=[],d=(w,S)=>w<S?-1:w>S?1:0){if(this.data=a,this.length=this.data.length,this.compare=d,this.length>0)for(let w=(this.length>>1)-1;w>=0;w--)this._down(w)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],d=this.data.pop();return--this.length>0&&(this.data[0]=d,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:d,compare:w}=this,S=d[a];for(;a>0;){const A=a-1>>1,b=d[A];if(w(S,b)>=0)break;d[a]=b,a=A}d[a]=S}_down(a){const{data:d,compare:w}=this,S=this.length>>1,A=d[a];for(;a<S;){let b=(a<<1)+1;const s=b+1;if(s<this.length&&w(d[s],d[b])<0&&(b=s),w(d[b],A)>=0)break;d[a]=d[b],a=b}d[a]=A}}function xT(h,a){if(h.length<=1)return[h];const d=[];let w,S;for(const A of h){const b=bT(A);b!==0&&(A.area=Math.abs(b),S===void 0&&(S=b<0),S===b<0?(w&&d.push(w),w=[A]):w.push(A))}return w&&d.push(w),d}function bT(h){let a=0;for(let d=0,w=h.length,S=w-1,A,b;d<w;S=d++)A=h[d],b=h[S],a+=(b.x-A.x)*(A.y+b.y);return a}const wT=6378.137,Wy=1/298.257223563,Hy=Wy*(2-Wy),Xy=Math.PI/180;class Jm{constructor(a){const d=Xy*wT*1e3,w=Math.cos(a*Xy),S=1/(1-Hy*(1-w*w)),A=Math.sqrt(S);this.kx=d*A*w,this.ky=d*A*S*(1-Hy)}distance(a,d){const w=this.wrap(a[0]-d[0])*this.kx,S=(a[1]-d[1])*this.ky;return Math.sqrt(w*w+S*S)}pointOnLine(a,d){let w=1/0,S,A,b,s;for(let F=0;F<a.length-1;F++){let $=a[F][0],Q=a[F][1],oe=this.wrap(a[F+1][0]-$)*this.kx,xe=(a[F+1][1]-Q)*this.ky,ge=0;(oe!==0||xe!==0)&&(ge=(this.wrap(d[0]-$)*this.kx*oe+(d[1]-Q)*this.ky*xe)/(oe*oe+xe*xe),ge>1?($=a[F+1][0],Q=a[F+1][1]):ge>0&&($+=oe/this.kx*ge,Q+=xe/this.ky*ge)),oe=this.wrap(d[0]-$)*this.kx,xe=(d[1]-Q)*this.ky;const Me=oe*oe+xe*xe;Me<w&&(w=Me,S=$,A=Q,b=F,s=ge)}return{point:[S,A],index:b,t:Math.max(0,Math.min(1,s))}}wrap(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}}const vm=100,xm=50;function m0(h,a){return a[0]-h[0]}function vd(h){return h[1]-h[0]+1}function Ks(h,a){return h[1]>=h[0]&&h[1]<a}function bm(h,a){if(h[0]>h[1])return[null,null];const d=vd(h);if(a){if(d===2)return[h,null];const S=Math.floor(d/2);return[[h[0],h[0]+S],[h[0]+S,h[1]]]}if(d===1)return[h,null];const w=Math.floor(d/2)-1;return[[h[0],h[0]+w],[h[0]+w+1,h[1]]]}function wm(h,a){if(!Ks(a,h.length))return[1/0,1/0,-1/0,-1/0];const d=[1/0,1/0,-1/0,-1/0];for(let w=a[0];w<=a[1];++w)rp(d,h[w]);return d}function Tm(h){const a=[1/0,1/0,-1/0,-1/0];for(const d of h)for(const w of d)rp(a,w);return a}function Yy(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function Qm(h,a,d){if(!Yy(h)||!Yy(a))return NaN;let w=0,S=0;return h[2]<a[0]&&(w=a[0]-h[2]),h[0]>a[2]&&(w=h[0]-a[2]),h[1]>a[3]&&(S=h[1]-a[3]),h[3]<a[1]&&(S=a[1]-h[3]),d.distance([0,0],[w,S])}function _u(h,a,d){const w=d.pointOnLine(a,h);return d.distance(h,w.point)}function eg(h,a,d,w,S){const A=Math.min(_u(h,[d,w],S),_u(a,[d,w],S)),b=Math.min(_u(d,[h,a],S),_u(w,[h,a],S));return Math.min(A,b)}function TT(h,a,d,w,S){if(!(Ks(a,h.length)&&Ks(w,d.length)))return 1/0;let A=1/0;for(let b=a[0];b<a[1];++b){const s=h[b],F=h[b+1];for(let $=w[0];$<w[1];++$){const Q=d[$],oe=d[$+1];if(Nd(s,F,Q,oe))return 0;A=Math.min(A,eg(s,F,Q,oe,S))}}return A}function ST(h,a,d,w,S){if(!(Ks(a,h.length)&&Ks(w,d.length)))return NaN;let A=1/0;for(let b=a[0];b<=a[1];++b)for(let s=w[0];s<=w[1];++s)if(A=Math.min(A,S.distance(h[b],d[s])),A===0)return A;return A}function PT(h,a,d){if(Bc(h,a,!0))return 0;let w=1/0;for(const S of a){const A=S[0],b=S[S.length-1];if(A!==b&&(w=Math.min(w,_u(h,[b,A],d)),w===0))return w;const s=d.pointOnLine(S,h);if(w=Math.min(w,d.distance(h,s.point)),w===0)return w}return w}function MT(h,a,d,w){if(!Ks(a,h.length))return NaN;for(let A=a[0];A<=a[1];++A)if(Bc(h[A],d,!0))return 0;let S=1/0;for(let A=a[0];A<a[1];++A){const b=h[A],s=h[A+1];for(const F of d)for(let $=0,Q=F.length,oe=Q-1;$<Q;oe=$++){const xe=F[oe],ge=F[$];if(Nd(b,s,xe,ge))return 0;S=Math.min(S,eg(b,s,xe,ge,w))}}return S}function Ky(h,a){for(const d of h)for(const w of d)if(Bc(w,a,!0))return!0;return!1}function IT(h,a,d,w=1/0){const S=Tm(h),A=Tm(a);if(w!==1/0&&Qm(S,A,d)>=w)return w;if(Yh(S,A)){if(Ky(h,a))return 0}else if(Ky(a,h))return 0;let b=1/0;for(const s of h)for(let F=0,$=s.length,Q=$-1;F<$;Q=F++){const oe=s[Q],xe=s[F];for(const ge of a)for(let Me=0,be=ge.length,me=be-1;Me<be;me=Me++){const nt=ge[me],Ke=ge[Me];if(Nd(oe,xe,nt,Ke))return 0;b=Math.min(b,eg(oe,xe,nt,Ke,d))}}return b}function Jy(h,a,d,w,S,A){if(!A)return;const b=Qm(wm(w,A),S,d);b<a&&h.push([b,A,[0,0]])}function nd(h,a,d,w,S,A,b){if(!A||!b)return;const s=Qm(wm(w,A),wm(S,b),d);s<a&&h.push([s,A,b])}function xd(h,a,d,w,S=1/0){let A=Math.min(w.distance(h[0],d[0][0]),S);if(A===0)return A;const b=new f0([[0,[0,h.length-1],[0,0]]],m0),s=Tm(d);for(;b.length>0;){const F=b.pop();if(F[0]>=A)continue;const $=F[1],Q=a?xm:vm;if(vd($)<=Q){if(!Ks($,h.length))return NaN;if(a){const oe=MT(h,$,d,w);if(isNaN(oe)||oe===0)return oe;A=Math.min(A,oe)}else for(let oe=$[0];oe<=$[1];++oe){const xe=PT(h[oe],d,w);if(A=Math.min(A,xe),A===0)return 0}}else{const oe=bm($,a);Jy(b,A,w,h,s,oe[0]),Jy(b,A,w,h,s,oe[1])}}return A}function bd(h,a,d,w,S,A=1/0){let b=Math.min(A,S.distance(h[0],d[0]));if(b===0)return b;const s=new f0([[0,[0,h.length-1],[0,d.length-1]]],m0);for(;s.length>0;){const F=s.pop();if(F[0]>=b)continue;const $=F[1],Q=F[2],oe=a?xm:vm,xe=w?xm:vm;if(vd($)<=oe&&vd(Q)<=xe){if(!Ks($,h.length)&&Ks(Q,d.length))return NaN;let ge;if(a&&w)ge=TT(h,$,d,Q,S),b=Math.min(b,ge);else if(a&&!w){const Me=h.slice($[0],$[1]+1);for(let be=Q[0];be<=Q[1];++be)if(ge=_u(d[be],Me,S),b=Math.min(b,ge),b===0)return b}else if(!a&&w){const Me=d.slice(Q[0],Q[1]+1);for(let be=$[0];be<=$[1];++be)if(ge=_u(h[be],Me,S),b=Math.min(b,ge),b===0)return b}else ge=ST(h,$,d,Q,S),b=Math.min(b,ge)}else{const ge=bm($,a),Me=bm(Q,w);nd(s,b,S,h,d,ge[0],Me[0]),nd(s,b,S,h,d,ge[0],Me[1]),nd(s,b,S,h,d,ge[1],Me[0]),nd(s,b,S,h,d,ge[1],Me[1])}}return b}function AT(h,a){const d=h.geometry(),w=d.flat().map(b=>Ym([b.x,b.y],h.canonical));if(d.length===0)return NaN;const S=new Jm(w[0][1]);let A=1/0;for(const b of a){switch(b.type){case"Point":A=Math.min(A,bd(w,!1,[b.coordinates],!1,S,A));break;case"LineString":A=Math.min(A,bd(w,!1,b.coordinates,!0,S,A));break;case"Polygon":A=Math.min(A,xd(w,!1,b.coordinates,S,A));break}if(A===0)return A}return A}function ET(h,a){const d=h.geometry(),w=d.flat().map(b=>Ym([b.x,b.y],h.canonical));if(d.length===0)return NaN;const S=new Jm(w[0][1]);let A=1/0;for(const b of a){switch(b.type){case"Point":A=Math.min(A,bd(w,!0,[b.coordinates],!1,S,A));break;case"LineString":A=Math.min(A,bd(w,!0,b.coordinates,!0,S,A));break;case"Polygon":A=Math.min(A,xd(w,!0,b.coordinates,S,A));break}if(A===0)return A}return A}function CT(h,a){const d=h.geometry();if(d.length===0||d[0].length===0)return NaN;const w=xT(d).map(b=>b.map(s=>s.map(F=>Ym([F.x,F.y],h.canonical)))),S=new Jm(w[0][0][0][1]);let A=1/0;for(const b of a)for(const s of w){switch(b.type){case"Point":A=Math.min(A,xd([b.coordinates],!1,s,S,A));break;case"LineString":A=Math.min(A,xd(b.coordinates,!0,s,S,A));break;case"Polygon":A=Math.min(A,IT(s,b.coordinates,S,A));break}if(A===0)return A}return A}function im(h){return h.type==="MultiPolygon"?h.coordinates.map(a=>({type:"Polygon",coordinates:a})):h.type==="MultiLineString"?h.coordinates.map(a=>({type:"LineString",coordinates:a})):h.type==="MultiPoint"?h.coordinates.map(a=>({type:"Point",coordinates:a})):[h]}class wu{constructor(a,d){this.type=lt,this.geojson=a,this.geometries=d}static parse(a,d){if(a.length!==2)return d.error(`'distance' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Hh(a[1])){const w=a[1];if(w.type==="FeatureCollection")return new wu(w,w.features.map(S=>im(S.geometry)).flat());if(w.type==="Feature")return new wu(w,im(w.geometry));if("type"in w&&"coordinates"in w)return new wu(w,im(w))}return d.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return AT(a,this.geometries);if(a.geometryType()==="LineString")return ET(a,this.geometries);if(a.geometryType()==="Polygon")return CT(a,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class np{constructor(a){this.type=Ht,this.key=a}static parse(a,d){if(a.length!==2)return d.error(`Expected 1 argument, but found ${a.length-1} instead.`);const w=a[1];return w==null?d.error("Global state property must be defined."):typeof w!="string"?d.error(`Global state property must be string, but found ${typeof a[1]} instead.`):new np(w)}evaluate(a){var d;const w=(d=a.globals)===null||d===void 0?void 0:d.globalState;return!w||Object.keys(w).length===0?null:Uh(w,this.key)}eachChild(){}outputDefined(){return!1}}const tg={"==":eT,"!=":tT,">":rT,"<":iT,">=":oT,"<=":nT,array:Aa,at:Um,boolean:Aa,case:$m,coalesce:Xh,collator:Od,format:Wm,image:Hm,in:Zm,"index-of":_d,interpolate:ps,"interpolate-hcl":ps,"interpolate-lab":ps,length:Xm,let:Rd,literal:kc,match:Gm,number:Aa,"number-format":qm,object:Aa,slice:yd,step:Bd,string:Aa,"to-boolean":El,"to-color":El,"to-number":El,"to-string":El,var:Fd,within:bu,distance:wu,"global-state":np};class La{constructor(a,d,w,S){this.name=a,this.type=d,this._evaluate=w,this.args=S}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,d){const w=a[0],S=La.definitions[w];if(!S)return d.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0);const A=Array.isArray(S)?S[0]:S.type,b=Array.isArray(S)?[[S[1],S[2]]]:S.overloads,s=b.filter(([$])=>!Array.isArray($)||$.length===a.length-1);let F=null;for(const[$,Q]of s){F=new Dd(d.registry,wd,d.path,null,d.scope);const oe=[];let xe=!1;for(let ge=1;ge<a.length;ge++){const Me=a[ge],be=Array.isArray($)?$[ge-1]:$.type,me=F.parse(Me,1+oe.length,be);if(!me){xe=!0;break}oe.push(me)}if(!xe){if(Array.isArray($)&&$.length!==oe.length){F.error(`Expected ${$.length} arguments, but found ${oe.length} instead.`);continue}for(let ge=0;ge<oe.length;ge++){const Me=Array.isArray($)?$[ge]:$.type,be=oe[ge];F.concat(ge+1).checkSubtype(Me,be.type)}if(F.errors.length===0)return new La(w,A,Q,oe)}}if(s.length===1)d.errors.push(...F.errors);else{const $=(s.length?s:b).map(([oe])=>kT(oe)).join(" | "),Q=[];for(let oe=1;oe<a.length;oe++){const xe=d.parse(a[oe],1+Q.length);if(!xe)return null;Q.push(sr(xe.type))}d.error(`Expected arguments of type ${$}, but found (${Q.join(", ")}) instead.`)}return null}static register(a,d){La.definitions=d;for(const w in d)a[w]=La}}function Qy(h,[a,d,w,S]){a=a.evaluate(h),d=d.evaluate(h),w=w.evaluate(h);const A=S?S.evaluate(h):1,b=a0(a,d,w,A);if(b)throw new mr(b);return new Ci(a/255,d/255,w/255,A,!1)}function ev(h,a){return h in a}function rm(h,a){const d=a[h];return typeof d>"u"?null:d}function LT(h,a,d,w){for(;d<=w;){const S=d+w>>1;if(a[S]===h)return!0;a[S]>h?w=S-1:d=S+1}return!1}function cu(h){return{type:h}}La.register(tg,{error:[P2,[Qt],(h,[a])=>{throw new mr(a.evaluate(h))}],typeof:[Qt,[Ht],(h,[a])=>sr(Zr(a.evaluate(h)))],"to-rgba":[ko(lt,4),[cs],(h,[a])=>{const[d,w,S,A]=a.evaluate(h).rgb;return[d*255,w*255,S*255,A]}],rgb:[cs,[lt,lt,lt],Qy],rgba:[cs,[lt,lt,lt,lt],Qy],has:{type:Jt,overloads:[[[Qt],(h,[a])=>ev(a.evaluate(h),h.properties())],[[Qt,yu],(h,[a,d])=>ev(a.evaluate(h),d.evaluate(h))]]},get:{type:Ht,overloads:[[[Qt],(h,[a])=>rm(a.evaluate(h),h.properties())],[[Qt,yu],(h,[a,d])=>rm(a.evaluate(h),d.evaluate(h))]]},"feature-state":[Ht,[Qt],(h,[a])=>rm(a.evaluate(h),h.featureState||{})],properties:[yu,[],h=>h.properties()],"geometry-type":[Qt,[],h=>h.geometryType()],id:[Ht,[],h=>h.id()],zoom:[lt,[],h=>h.globals.zoom],"heatmap-density":[lt,[],h=>h.globals.heatmapDensity||0],elevation:[lt,[],h=>h.globals.elevation||0],"line-progress":[lt,[],h=>h.globals.lineProgress||0],accumulated:[Ht,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[lt,cu(lt),(h,a)=>{let d=0;for(const w of a)d+=w.evaluate(h);return d}],"*":[lt,cu(lt),(h,a)=>{let d=1;for(const w of a)d*=w.evaluate(h);return d}],"-":{type:lt,overloads:[[[lt,lt],(h,[a,d])=>a.evaluate(h)-d.evaluate(h)],[[lt],(h,[a])=>-a.evaluate(h)]]},"/":[lt,[lt,lt],(h,[a,d])=>a.evaluate(h)/d.evaluate(h)],"%":[lt,[lt,lt],(h,[a,d])=>a.evaluate(h)%d.evaluate(h)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(h,[a,d])=>Math.pow(a.evaluate(h),d.evaluate(h))],sqrt:[lt,[lt],(h,[a])=>Math.sqrt(a.evaluate(h))],log10:[lt,[lt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN10],ln:[lt,[lt],(h,[a])=>Math.log(a.evaluate(h))],log2:[lt,[lt],(h,[a])=>Math.log(a.evaluate(h))/Math.LN2],sin:[lt,[lt],(h,[a])=>Math.sin(a.evaluate(h))],cos:[lt,[lt],(h,[a])=>Math.cos(a.evaluate(h))],tan:[lt,[lt],(h,[a])=>Math.tan(a.evaluate(h))],asin:[lt,[lt],(h,[a])=>Math.asin(a.evaluate(h))],acos:[lt,[lt],(h,[a])=>Math.acos(a.evaluate(h))],atan:[lt,[lt],(h,[a])=>Math.atan(a.evaluate(h))],min:[lt,cu(lt),(h,a)=>Math.min(...a.map(d=>d.evaluate(h)))],max:[lt,cu(lt),(h,a)=>Math.max(...a.map(d=>d.evaluate(h)))],abs:[lt,[lt],(h,[a])=>Math.abs(a.evaluate(h))],round:[lt,[lt],(h,[a])=>{const d=a.evaluate(h);return d<0?-Math.round(-d):Math.round(d)}],floor:[lt,[lt],(h,[a])=>Math.floor(a.evaluate(h))],ceil:[lt,[lt],(h,[a])=>Math.ceil(a.evaluate(h))],"filter-==":[Jt,[Qt,Ht],(h,[a,d])=>h.properties()[a.value]===d.value],"filter-id-==":[Jt,[Ht],(h,[a])=>h.id()===a.value],"filter-type-==":[Jt,[Qt],(h,[a])=>h.geometryType()===a.value],"filter-<":[Jt,[Qt,Ht],(h,[a,d])=>{const w=h.properties()[a.value],S=d.value;return typeof w==typeof S&&w<S}],"filter-id-<":[Jt,[Ht],(h,[a])=>{const d=h.id(),w=a.value;return typeof d==typeof w&&d<w}],"filter->":[Jt,[Qt,Ht],(h,[a,d])=>{const w=h.properties()[a.value],S=d.value;return typeof w==typeof S&&w>S}],"filter-id->":[Jt,[Ht],(h,[a])=>{const d=h.id(),w=a.value;return typeof d==typeof w&&d>w}],"filter-<=":[Jt,[Qt,Ht],(h,[a,d])=>{const w=h.properties()[a.value],S=d.value;return typeof w==typeof S&&w<=S}],"filter-id-<=":[Jt,[Ht],(h,[a])=>{const d=h.id(),w=a.value;return typeof d==typeof w&&d<=w}],"filter->=":[Jt,[Qt,Ht],(h,[a,d])=>{const w=h.properties()[a.value],S=d.value;return typeof w==typeof S&&w>=S}],"filter-id->=":[Jt,[Ht],(h,[a])=>{const d=h.id(),w=a.value;return typeof d==typeof w&&d>=w}],"filter-has":[Jt,[Ht],(h,[a])=>a.value in h.properties()],"filter-has-id":[Jt,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[Jt,[ko(Qt)],(h,[a])=>a.value.indexOf(h.geometryType())>=0],"filter-id-in":[Jt,[ko(Ht)],(h,[a])=>a.value.indexOf(h.id())>=0],"filter-in-small":[Jt,[Qt,ko(Ht)],(h,[a,d])=>d.value.indexOf(h.properties()[a.value])>=0],"filter-in-large":[Jt,[Qt,ko(Ht)],(h,[a,d])=>LT(h.properties()[a.value],d.value,0,d.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(h,[a,d])=>a.evaluate(h)&&d.evaluate(h)],[cu(Jt),(h,a)=>{for(const d of a)if(!d.evaluate(h))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(h,[a,d])=>a.evaluate(h)||d.evaluate(h)],[cu(Jt),(h,a)=>{for(const d of a)if(d.evaluate(h))return!0;return!1}]]},"!":[Jt,[Jt],(h,[a])=>!a.evaluate(h)],"is-supported-script":[Jt,[Qt],(h,[a])=>{const d=h.globals&&h.globals.isSupportedScript;return d?d(a.evaluate(h)):!0}],upcase:[Qt,[Qt],(h,[a])=>a.evaluate(h).toUpperCase()],downcase:[Qt,[Qt],(h,[a])=>a.evaluate(h).toLowerCase()],concat:[Qt,cu(Ht),(h,a)=>a.map(d=>Zh(d.evaluate(h))).join("")],"resolved-locale":[Qt,[Ed],(h,[a])=>a.evaluate(h).resolvedLocale()]});function kT(h){return Array.isArray(h)?`(${h.map(sr).join(", ")})`:`(${sr(h.type)}...)`}function wd(h){if(h instanceof Fd)return wd(h.boundExpression);if(h instanceof La&&h.name==="error"||h instanceof Od||h instanceof bu||h instanceof wu||h instanceof np)return!1;const a=h instanceof El||h instanceof Aa;let d=!0;return h.eachChild(w=>{a?d=d&&wd(w):d=d&&w instanceof kc}),d?jd(h)&&Vd(h,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function jd(h){if(h instanceof La&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof bu||h instanceof wu)return!1;let a=!0;return h.eachChild(d=>{a&&!jd(d)&&(a=!1)}),a}function Kh(h){if(h instanceof La&&h.name==="feature-state")return!1;let a=!0;return h.eachChild(d=>{a&&!Kh(d)&&(a=!1)}),a}function Vd(h,a){if(h instanceof La&&a.indexOf(h.name)>=0)return!1;let d=!0;return h.eachChild(w=>{d&&!Vd(w,a)&&(d=!1)}),d}function Sm(h){return{result:"success",value:h}}function Mc(h){return{result:"error",value:h}}function Td(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function g0(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function _0(h){return!!h.expression&&h.expression.interpolated}function ai(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function ig(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)&&Zr(h)===yu}class zT{constructor(a,d,w){this.expression=a,this._warningHistory={},this._evaluator=new s0,this._defaultValue=d?FT(d):null,this._enumValues=d&&d.type==="enum"?d.values:null,this._globalState=w}evaluateWithoutErrorHandling(a,d,w,S,A,b){return this._globalState&&(a=zc(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=d,this._evaluator.featureState=w,this._evaluator.canonical=S,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(a,d,w,S,A,b){this._globalState&&(a=zc(a,this._globalState)),this._evaluator.globals=a,this._evaluator.feature=d||null,this._evaluator.featureState=w||null,this._evaluator.canonical=S,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=b||null;try{const s=this.expression.evaluate(this._evaluator);if(s==null||typeof s=="number"&&s!==s)return this._defaultValue;if(this._enumValues&&!(s in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(s)} instead.`);return s}catch(s){return this._warningHistory[s.message]||(this._warningHistory[s.message]=!0,typeof console<"u"&&console.warn(s.message)),this._defaultValue}}}function y0(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in tg}function v0(h,a,d){const w=new Dd(tg,wd,[],a?RT(a):void 0),S=w.parse(h,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return S?Sm(new zT(S,a,d)):Mc(w.errors)}class tv{constructor(a,d,w){this.kind=a,this._styleExpression=d,this.isStateDependent=a!=="constant"&&!Kh(d.expression),this.globalStateRefs=rg(d.expression),this._globalState=w}evaluateWithoutErrorHandling(a,d,w,S,A,b){return this._globalState&&(a=zc(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,d,w,S,A,b)}evaluate(a,d,w,S,A,b){return this._globalState&&(a=zc(a,this._globalState)),this._styleExpression.evaluate(a,d,w,S,A,b)}}class iv{constructor(a,d,w,S,A){this.kind=a,this.zoomStops=w,this._styleExpression=d,this.isStateDependent=a!=="camera"&&!Kh(d.expression),this.globalStateRefs=rg(d.expression),this.interpolationType=S,this._globalState=A}evaluateWithoutErrorHandling(a,d,w,S,A,b){return this._globalState&&(a=zc(a,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(a,d,w,S,A,b)}evaluate(a,d,w,S,A,b){return this._globalState&&(a=zc(a,this._globalState)),this._styleExpression.evaluate(a,d,w,S,A,b)}interpolationFactor(a,d,w){return this.interpolationType?ps.interpolationFactor(this.interpolationType,a,d,w):0}}function DT(h,a,d){const w=v0(h,a,d);if(w.result==="error")return w;const S=w.value.expression,A=jd(S);if(!A&&!Td(a))return Mc([new us("","data expressions not supported")]);const b=Vd(S,["zoom"]);if(!b&&!g0(a))return Mc([new us("","zoom expressions not supported")]);const s=cd(S);if(!s&&!b)return Mc([new us("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(s instanceof us)return Mc([s]);if(s instanceof ps&&!_0(a))return Mc([new us("",'"interpolate" expressions cannot be used with this property')]);if(!s)return Sm(A?new tv("constant",w.value,d):new tv("source",w.value,d));const F=s instanceof ps?s.interpolation:void 0;return Sm(A?new iv("camera",w.value,s.labels,F,d):new iv("composite",w.value,s.labels,F,d))}function cd(h){let a=null;if(h instanceof Rd)a=cd(h.result);else if(h instanceof Xh){for(const d of h.args)if(a=cd(d),a)break}else(h instanceof Bd||h instanceof ps)&&h.input instanceof La&&h.input.name==="zoom"&&(a=h);return a instanceof us||h.eachChild(d=>{const w=cd(d);w instanceof us?a=w:!a&&w?a=new us("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&w&&a!==w&&(a=new us("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function rg(h,a=new Set){return h instanceof np&&a.add(h.key),h.eachChild(d=>{rg(d,a)}),a}function RT(h){const a={color:cs,string:Qt,number:lt,enum:Qt,boolean:Jt,formatted:Cd,padding:Ld,numberArray:kd,colorArray:$h,projectionDefinition:Ad,resolvedImage:ip,variableAnchorOffsetCollection:zd};return h.type==="array"?ko(a[h.value]||Ht,h.length):a[h.type]}function FT(h){if(h.type==="color"&&ig(h.default))return new Ci(0,0,0,0);switch(h.type){case"color":return Ci.parse(h.default)||null;case"padding":return Ea.parse(h.default)||null;case"numberArray":return Ca.parse(h.default)||null;case"colorArray":return zo.parse(h.default)||null;case"variableAnchorOffsetCollection":return hs.parse(h.default)||null;case"projectionDefinition":return Ia.parse(h.default)||null;default:return h.default===void 0?null:h.default}}function zc(h,a){const{zoom:d,heatmapDensity:w,elevation:S,lineProgress:A,isSupportedScript:b,accumulated:s}=h??{};return{zoom:d,heatmapDensity:w,elevation:S,lineProgress:A,isSupportedScript:b,accumulated:s,globalState:a}}function x0(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const a of h.slice(1))if(!x0(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}function b0(h){const a=h.key,d=h.value;return d?[new it(a,d,"constants have been deprecated as of v8")]:[]}function Sr(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Pu(h){if(Array.isArray(h))return h.map(Pu);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const a={};for(const d in h)a[d]=Pu(h[d]);return a}return Sr(h)}function Qo(h){const a=h.key,d=h.value,w=h.valueSpec||{},S=h.objectElementValidators||{},A=h.style,b=h.styleSpec,s=h.validateSpec;let F=[];const $=ai(d);if($!=="object")return[new it(a,d,`object expected, ${$} found`)];for(const Q in d){const oe=Q.split(".")[0],xe=Uh(w,oe)||w["*"];let ge;if(Uh(S,oe))ge=S[oe];else if(Uh(w,oe))ge=s;else if(S["*"])ge=S["*"];else if(w["*"])ge=s;else{F.push(new it(a,d[Q],`unknown property "${Q}"`));continue}F=F.concat(ge({key:(a&&`${a}.`)+Q,value:d[Q],valueSpec:xe,style:A,styleSpec:b,object:d,objectKey:Q,validateSpec:s},d))}for(const Q in w)S[Q]||w[Q].required&&w[Q].default===void 0&&d[Q]===void 0&&F.push(new it(a,d,`missing required property "${Q}"`));return F}function ng(h){const a=h.value,d=h.valueSpec,w=h.validateSpec,S=h.style,A=h.styleSpec,b=h.key,s=h.arrayElementValidator||w;if(ai(a)!=="array")return[new it(b,a,`array expected, ${ai(a)} found`)];if(d.length&&a.length!==d.length)return[new it(b,a,`array length ${d.length} expected, length ${a.length} found`)];if(d["min-length"]&&a.length<d["min-length"])return[new it(b,a,`array length at least ${d["min-length"]} expected, length ${a.length} found`)];let F={type:d.value,values:d.values};A.$version<7&&(F.function=d.function),ai(d.value)==="object"&&(F=d.value);let $=[];for(let Q=0;Q<a.length;Q++)$=$.concat(s({array:a,arrayIndex:Q,value:a[Q],valueSpec:F,validateSpec:h.validateSpec,style:S,styleSpec:A,key:`${b}[${Q}]`}));return $}function Ud(h){const a=h.key,d=h.value,w=h.valueSpec;let S=ai(d);return S==="number"&&d!==d&&(S="NaN"),S!=="number"?[new it(a,d,`number expected, ${S} found`)]:"minimum"in w&&d<w.minimum?[new it(a,d,`${d} is less than the minimum value ${w.minimum}`)]:"maximum"in w&&d>w.maximum?[new it(a,d,`${d} is greater than the maximum value ${w.maximum}`)]:[]}function w0(h){const a=h.valueSpec,d=Sr(h.value.type);let w,S={},A,b;const s=d!=="categorical"&&h.value.property===void 0,F=!s,$=ai(h.value.stops)==="array"&&ai(h.value.stops[0])==="array"&&ai(h.value.stops[0][0])==="object",Q=Qo({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:oe,default:Me}});return d==="identity"&&s&&Q.push(new it(h.key,h.value,'missing required property "property"')),d!=="identity"&&!h.value.stops&&Q.push(new it(h.key,h.value,'missing required property "stops"')),d==="exponential"&&h.valueSpec.expression&&!_0(h.valueSpec)&&Q.push(new it(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(F&&!Td(h.valueSpec)?Q.push(new it(h.key,h.value,"property functions not supported")):s&&!g0(h.valueSpec)&&Q.push(new it(h.key,h.value,"zoom functions not supported"))),(d==="categorical"||$)&&h.value.property===void 0&&Q.push(new it(h.key,h.value,'"property" property is required')),Q;function oe(be){if(d==="identity")return[new it(be.key,be.value,'identity function may not have a "stops" property')];let me=[];const nt=be.value;return me=me.concat(ng({key:be.key,value:nt,valueSpec:be.valueSpec,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec,arrayElementValidator:xe})),ai(nt)==="array"&&nt.length===0&&me.push(new it(be.key,nt,"array must have at least one stop")),me}function xe(be){let me=[];const nt=be.value,Ke=be.key;if(ai(nt)!=="array")return[new it(Ke,nt,`array expected, ${ai(nt)} found`)];if(nt.length!==2)return[new it(Ke,nt,`array length 2 expected, length ${nt.length} found`)];if($){if(ai(nt[0])!=="object")return[new it(Ke,nt,`object expected, ${ai(nt[0])} found`)];if(nt[0].zoom===void 0)return[new it(Ke,nt,"object stop key must have zoom")];if(nt[0].value===void 0)return[new it(Ke,nt,"object stop key must have value")];if(b&&b>Sr(nt[0].zoom))return[new it(Ke,nt[0].zoom,"stop zoom values must appear in ascending order")];Sr(nt[0].zoom)!==b&&(b=Sr(nt[0].zoom),A=void 0,S={}),me=me.concat(Qo({key:`${Ke}[0]`,value:nt[0],valueSpec:{zoom:{}},validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec,objectElementValidators:{zoom:Ud,value:ge}}))}else me=me.concat(ge({key:`${Ke}[0]`,value:nt[0],validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec},nt));return y0(Pu(nt[1]))?me.concat([new it(`${Ke}[1]`,nt[1],"expressions are not allowed in function stops.")]):me.concat(be.validateSpec({key:`${Ke}[1]`,value:nt[1],valueSpec:a,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec}))}function ge(be,me){const nt=ai(be.value),Ke=Sr(be.value),Je=be.value!==null?be.value:me;if(!w)w=nt;else if(nt!==w)return[new it(be.key,Je,`${nt} stop domain type must match previous stop domain type ${w}`)];if(nt!=="number"&&nt!=="string"&&nt!=="boolean")return[new it(be.key,Je,"stop domain value must be a number, string, or boolean")];if(nt!=="number"&&d!=="categorical"){let Ue=`number expected, ${nt} found`;return Td(a)&&d===void 0&&(Ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(be.key,Je,Ue)]}return d==="categorical"&&nt==="number"&&(!isFinite(Ke)||Math.floor(Ke)!==Ke)?[new it(be.key,Je,`integer expected, found ${Ke}`)]:d!=="categorical"&&nt==="number"&&A!==void 0&&Ke<A?[new it(be.key,Je,"stop domain values must appear in ascending order")]:(A=Ke,d==="categorical"&&Ke in S?[new it(be.key,Je,"stop domain values must be unique")]:(S[Ke]=!0,[]))}function Me(be){return be.validateSpec({key:be.key,value:be.value,valueSpec:a,validateSpec:be.validateSpec,style:be.style,styleSpec:be.styleSpec})}}function Dc(h){const a=(h.expressionContext==="property"?DT:v0)(Pu(h.value),h.valueSpec);if(a.result==="error")return a.value.map(w=>new it(`${h.key}${w.key}`,h.value,w.message));const d=a.value.expression||a.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!d.outputDefined())return[new it(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!Kh(d))return[new it(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!Kh(d))return[new it(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Vd(d,["zoom","feature-state"]))return[new it(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!jd(d))return[new it(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function BT(h){const a=h.value,d=h.key,w=ai(a);return w!=="boolean"?[new it(d,a,`boolean expected, ${w} found`)]:[]}function Pm(h){const a=h.key,d=h.value,w=ai(d);return w!=="string"?[new it(a,d,`color expected, ${w} found`)]:Ci.parse(String(d))?[]:[new it(a,d,`color expected, "${d}" found`)]}function Jh(h){const a=h.key,d=h.value,w=h.valueSpec,S=[];return Array.isArray(w.values)?w.values.indexOf(Sr(d))===-1&&S.push(new it(a,d,`expected one of [${w.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(w.values).indexOf(Sr(d))===-1&&S.push(new it(a,d,`expected one of [${Object.keys(w.values).join(", ")}], ${JSON.stringify(d)} found`)),S}function og(h){return x0(Pu(h.value))?Dc(gd({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):T0(h)}function T0(h){const a=h.value,d=h.key;if(ai(a)!=="array")return[new it(d,a,`array expected, ${ai(a)} found`)];const w=h.styleSpec;let S,A=[];if(a.length<1)return[new it(d,a,"filter array must have at least 1 element")];switch(A=A.concat(Jh({key:`${d}[0]`,value:a[0],valueSpec:w.filter_operator,style:h.style,styleSpec:h.styleSpec})),Sr(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Sr(a[1])==="$type"&&A.push(new it(d,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&A.push(new it(d,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(S=ai(a[1]),S!=="string"&&A.push(new it(`${d}[1]`,a[1],`string expected, ${S} found`)));for(let b=2;b<a.length;b++)S=ai(a[b]),Sr(a[1])==="$type"?A=A.concat(Jh({key:`${d}[${b}]`,value:a[b],valueSpec:w.geometry_type,style:h.style,styleSpec:h.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&A.push(new it(`${d}[${b}]`,a[b],`string, number, or boolean expected, ${S} found`));break;case"any":case"all":case"none":for(let b=1;b<a.length;b++)A=A.concat(T0({key:`${d}[${b}]`,value:a[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":S=ai(a[1]),a.length!==2?A.push(new it(d,a,`filter array for "${a[0]}" operator must have 2 elements`)):S!=="string"&&A.push(new it(`${d}[1]`,a[1],`string expected, ${S} found`));break}return A}function S0(h,a){const d=h.key,w=h.validateSpec,S=h.style,A=h.styleSpec,b=h.value,s=h.objectKey,F=A[`${a}_${h.layerType}`];if(!F)return[];const $=s.match(/^(.*)-transition$/);if(a==="paint"&&$&&F[$[1]]&&F[$[1]].transition)return w({key:d,value:b,valueSpec:A.transition,style:S,styleSpec:A});const Q=h.valueSpec||F[s];if(!Q)return[new it(d,b,`unknown property "${s}"`)];let oe;if(ai(b)==="string"&&Td(Q)&&!Q.tokens&&(oe=/^{([^}]+)}$/.exec(b)))return[new it(d,b,`"${s}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(oe[1])} }\`.`)];const xe=[];return h.layerType==="symbol"&&s==="text-font"&&ig(Pu(b))&&Sr(b.type)==="identity"&&xe.push(new it(d,b,'"text-font" does not support identity functions')),xe.concat(w({key:h.key,value:b,valueSpec:Q,style:S,styleSpec:A,expressionContext:"property",propertyType:a,propertyKey:s}))}function P0(h){return S0(h,"paint")}function M0(h){return S0(h,"layout")}function I0(h){let a=[];const d=h.value,w=h.key,S=h.style,A=h.styleSpec;if(ai(d)!=="object")return[new it(w,d,`object expected, ${ai(d)} found`)];!d.type&&!d.ref&&a.push(new it(w,d,'either "type" or "ref" is required'));let b=Sr(d.type);const s=Sr(d.ref);if(d.id){const F=Sr(d.id);for(let $=0;$<h.arrayIndex;$++){const Q=S.layers[$];Sr(Q.id)===F&&a.push(new it(w,d.id,`duplicate layer id "${d.id}", previously used at line ${Q.id.__line__}`))}}if("ref"in d){["type","source","source-layer","filter","layout"].forEach($=>{$ in d&&a.push(new it(w,d[$],`"${$}" is prohibited for ref layers`))});let F;S.layers.forEach($=>{Sr($.id)===s&&(F=$)}),F?F.ref?a.push(new it(w,d.ref,"ref cannot reference another ref layer")):b=Sr(F.type):a.push(new it(w,d.ref,`ref layer "${s}" not found`))}else if(b!=="background")if(!d.source)a.push(new it(w,d,'missing required property "source"'));else{const F=S.sources&&S.sources[d.source],$=F&&Sr(F.type);F?$==="vector"&&b==="raster"?a.push(new it(w,d.source,`layer "${d.id}" requires a raster source`)):$!=="raster-dem"&&b==="hillshade"?a.push(new it(w,d.source,`layer "${d.id}" requires a raster-dem source`)):$!=="raster-dem"&&b==="color-relief"?a.push(new it(w,d.source,`layer "${d.id}" requires a raster-dem source`)):$==="raster"&&b!=="raster"?a.push(new it(w,d.source,`layer "${d.id}" requires a vector source`)):$==="vector"&&!d["source-layer"]?a.push(new it(w,d,`layer "${d.id}" must specify a "source-layer"`)):$==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?a.push(new it(w,d.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b==="line"&&d.paint&&d.paint["line-gradient"]&&($!=="geojson"||!F.lineMetrics)&&a.push(new it(w,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new it(w,d.source,`source "${d.source}" not found`))}return a=a.concat(Qo({key:w,value:d,valueSpec:A.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*"(){return[]},type(){return h.validateSpec({key:`${w}.type`,value:d.type,valueSpec:A.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:d,objectKey:"type"})},filter:og,layout(F){return Qo({layer:d,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*"($){return M0(gd({layerType:b},$))}}})},paint(F){return Qo({layer:d,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*"($){return P0(gd({layerType:b},$))}}})}}})),a}function Mu(h){const a=h.value,d=h.key,w=ai(a);return w!=="string"?[new it(d,a,`string expected, ${w} found`)]:[]}function OT(h){var a;const d=(a=h.sourceName)!==null&&a!==void 0?a:"",w=h.value,S=h.styleSpec,A=S.source_raster_dem,b=h.style;let s=[];const F=ai(w);if(w===void 0)return s;if(F!=="object")return s.push(new it("source_raster_dem",w,`object expected, ${F} found`)),s;const $=Sr(w.encoding)==="custom",Q=["redFactor","greenFactor","blueFactor","baseShift"],oe=h.value.encoding?`"${h.value.encoding}"`:"Default";for(const xe in w)!$&&Q.includes(xe)?s.push(new it(xe,w[xe],`In "${d}": "${xe}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):A[xe]?s=s.concat(h.validateSpec({key:xe,value:w[xe],valueSpec:A[xe],validateSpec:h.validateSpec,style:b,styleSpec:S})):s.push(new it(xe,w[xe],`unknown property "${xe}"`));return s}const rv={promoteId:NT};function A0(h){const a=h.value,d=h.key,w=h.styleSpec,S=h.style,A=h.validateSpec;if(!a.type)return[new it(d,a,'"type" is required')];const b=Sr(a.type);let s;switch(b){case"vector":case"raster":return s=Qo({key:d,value:a,valueSpec:w[`source_${b.replace("-","_")}`],style:h.style,styleSpec:w,objectElementValidators:rv,validateSpec:A}),s;case"raster-dem":return s=OT({sourceName:d,value:a,style:h.style,styleSpec:w,validateSpec:A}),s;case"geojson":if(s=Qo({key:d,value:a,valueSpec:w.source_geojson,style:S,styleSpec:w,validateSpec:A,objectElementValidators:rv}),a.cluster)for(const F in a.clusterProperties){const[$,Q]=a.clusterProperties[F],oe=typeof $=="string"?[$,["accumulated"],["get",F]]:$;s.push(...Dc({key:`${d}.${F}.map`,value:Q,expressionContext:"cluster-map"})),s.push(...Dc({key:`${d}.${F}.reduce`,value:oe,expressionContext:"cluster-reduce"}))}return s;case"video":return Qo({key:d,value:a,valueSpec:w.source_video,style:S,validateSpec:A,styleSpec:w});case"image":return Qo({key:d,value:a,valueSpec:w.source_image,style:S,validateSpec:A,styleSpec:w});case"canvas":return[new it(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jh({key:`${d}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function NT({key:h,value:a}){if(ai(a)==="string")return Mu({key:h,value:a});{const d=[];for(const w in a)d.push(...Mu({key:`${h}.${w}`,value:a[w]}));return d}}function E0(h){const a=h.value,d=h.styleSpec,w=d.light,S=h.style;let A=[];const b=ai(a);if(a===void 0)return A;if(b!=="object")return A=A.concat([new it("light",a,`object expected, ${b} found`)]),A;for(const s in a){const F=s.match(/^(.*)-transition$/);F&&w[F[1]]&&w[F[1]].transition?A=A.concat(h.validateSpec({key:s,value:a[s],valueSpec:d.transition,validateSpec:h.validateSpec,style:S,styleSpec:d})):w[s]?A=A.concat(h.validateSpec({key:s,value:a[s],valueSpec:w[s],validateSpec:h.validateSpec,style:S,styleSpec:d})):A=A.concat([new it(s,a[s],`unknown property "${s}"`)])}return A}function C0(h){const a=h.value,d=h.styleSpec,w=d.sky,S=h.style,A=ai(a);if(a===void 0)return[];if(A!=="object")return[new it("sky",a,`object expected, ${A} found`)];let b=[];for(const s in a)w[s]?b=b.concat(h.validateSpec({key:s,value:a[s],valueSpec:w[s],style:S,styleSpec:d})):b=b.concat([new it(s,a[s],`unknown property "${s}"`)]);return b}function L0(h){const a=h.value,d=h.styleSpec,w=d.terrain,S=h.style;let A=[];const b=ai(a);if(a===void 0)return A;if(b!=="object")return A=A.concat([new it("terrain",a,`object expected, ${b} found`)]),A;for(const s in a)w[s]?A=A.concat(h.validateSpec({key:s,value:a[s],valueSpec:w[s],validateSpec:h.validateSpec,style:S,styleSpec:d})):A=A.concat([new it(s,a[s],`unknown property "${s}"`)]);return A}function jT(h){return Mu(h).length===0?[]:Dc(h)}function VT(h){return Mu(h).length===0?[]:Dc(h)}function UT(h){const a=h.key,d=h.value;if(ai(d)==="array"){if(d.length<1||d.length>4)return[new it(a,d,`padding requires 1 to 4 values; ${d.length} values found`)];const w={type:"number"};let S=[];for(let A=0;A<d.length;A++)S=S.concat(h.validateSpec({key:`${a}[${A}]`,value:d[A],validateSpec:h.validateSpec,valueSpec:w}));return S}else return Ud({key:a,value:d,valueSpec:{}})}function ZT(h){const a=h.key,d=h.value;if(ai(d)==="array"){const w={type:"number"};if(d.length<1)return[new it(a,d,"array length at least 1 expected, length 0 found")];let S=[];for(let A=0;A<d.length;A++)S=S.concat(h.validateSpec({key:`${a}[${A}]`,value:d[A],validateSpec:h.validateSpec,valueSpec:w}));return S}else return Ud({key:a,value:d,valueSpec:{}})}function GT(h){const a=h.key,d=h.value;if(ai(d)==="array"){if(d.length<1)return[new it(a,d,"array length at least 1 expected, length 0 found")];let w=[];for(let S=0;S<d.length;S++)w=w.concat(Pm({key:`${a}[${S}]`,value:d[S]}));return w}else return Pm({key:a,value:d})}function $T(h){const a=h.key,d=h.value,w=ai(d),S=h.styleSpec;if(w!=="array"||d.length<1||d.length%2!==0)return[new it(a,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let A=[];for(let b=0;b<d.length;b+=2)A=A.concat(Jh({key:`${a}[${b}]`,value:d[b],valueSpec:S.layout_symbol["text-anchor"]})),A=A.concat(ng({key:`${a}[${b+1}]`,value:d[b+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:S}));return A}function k0(h){let a=[];const d=h.value,w=h.key;if(Array.isArray(d)){const S=[],A=[];for(const b in d){d[b].id&&S.includes(d[b].id)&&a.push(new it(w,d,`all the sprites' ids must be unique, but ${d[b].id} is duplicated`)),S.push(d[b].id),d[b].url&&A.includes(d[b].url)&&a.push(new it(w,d,`all the sprites' URLs must be unique, but ${d[b].url} is duplicated`)),A.push(d[b].url);const s={id:{type:"string",required:!0},url:{type:"string",required:!0}};a=a.concat(Qo({key:`${w}[${b}]`,value:d[b],valueSpec:s,validateSpec:h.validateSpec}))}return a}else return Mu({key:w,value:d})}function qT(h){const a=h.value,d=h.styleSpec,w=d.projection,S=h.style,A=ai(a);if(a===void 0)return[];if(A!=="object")return[new it("projection",a,`object expected, ${A} found`)];let b=[];for(const s in a)w[s]?b=b.concat(h.validateSpec({key:s,value:a[s],valueSpec:w[s],style:S,styleSpec:d})):b=b.concat([new it(s,a[s],`unknown property "${s}"`)]);return b}function WT(h){const a=h.key;let d=h.value;d=d instanceof String?d.valueOf():d;const w=ai(d);return w==="array"&&!XT(d)&&!HT(d)?[new it(a,d,`projection expected, invalid array ${JSON.stringify(d)} found`)]:["array","string"].includes(w)?[]:[new it(a,d,`projection expected, invalid type "${w}" found`)]}function HT(h){return!!["interpolate","step","literal"].includes(h[0])}function XT(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"}function YT(h){return!!h&&h.constructor===Object}function z0(h){return YT(h.value)?[]:[new it(h.key,h.value,`object expected, ${ai(h.value)} found`)]}const nv={"*"(){return[]},array:ng,boolean:BT,number:Ud,color:Pm,constants:b0,enum:Jh,filter:og,function:w0,layer:I0,object:Qo,source:A0,light:E0,sky:C0,terrain:L0,projection:qT,projectionDefinition:WT,string:Mu,formatted:jT,resolvedImage:VT,padding:UT,numberArray:ZT,colorArray:GT,variableAnchorOffsetCollection:$T,sprite:k0,state:z0};function Sd(h){const a=h.value,d=h.valueSpec,w=h.styleSpec;return h.validateSpec=Sd,d.expression&&ig(Sr(a))?w0(h):d.expression&&y0(Pu(a))?Dc(h):d.type&&nv[d.type]?nv[d.type](h):Qo(gd({},h,{valueSpec:d.type?w[d.type]:d}))}function D0(h){const a=h.value,d=h.key,w=Mu(h);return w.length||(a.indexOf("{fontstack}")===-1&&w.push(new it(d,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&w.push(new it(d,a,'"glyphs" url must include a "{range}" token'))),w}function Do(h,a=S2){let d=[];return d=d.concat(Sd({key:"",value:h,valueSpec:a.$root,styleSpec:a,style:h,validateSpec:Sd,objectElementValidators:{glyphs:D0,"*"(){return[]}}})),h.constants&&(d=d.concat(b0({key:"constants",value:h.constants}))),R0(d)}Do.source=za(ka(A0));Do.sprite=za(ka(k0));Do.glyphs=za(ka(D0));Do.light=za(ka(E0));Do.sky=za(ka(C0));Do.terrain=za(ka(L0));Do.state=za(ka(z0));Do.layer=za(ka(I0));Do.filter=za(ka(og));Do.paintProperty=za(ka(P0));Do.layoutProperty=za(ka(M0));function ka(h){return function(a){return h(Object.assign({},a,{validateSpec:Sd}))}}function R0(h){return[].concat(h).sort((a,d)=>a.line-d.line)}function za(h){return function(...a){return R0(h.apply(this,a))}}function ov(h){if(!h)return{style:Cc[Ll[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof h=="string"){const a=JT(h);return a.isValidStyle?{style:a.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:a.isValidJSON?{style:Cc[Ll[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:h.startsWith("http")?{style:h,requiresUrlMonitoring:!0,isFallback:!1}:h.toLowerCase().includes(".json")?{style:KT(h),requiresUrlMonitoring:!0,isFallback:!1}:{style:qv(h),requiresUrlMonitoring:!0,isFallback:!1}}return h instanceof Wv?{style:h.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:h instanceof Hv?{style:h.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Do(h).length===0?{style:h,requiresUrlMonitoring:!1,isFallback:!1,isJSON:!0}:{style:Cc[Ll[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function KT(h){try{return new URL(h).href}catch{}return new URL(h,location.origin).href}function JT(h){try{const a=JSON.parse(h),d=Do(a);return{isValidJSON:!0,isValidStyle:d.length===0,styleObject:d.length===0?a:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function Ys(h,a,d){const w=window.document.createElement(h);return a!==void 0&&(w.className=a),d&&d.appendChild(w),w}function Qh(h){h.parentNode&&h.parentNode.removeChild(h)}class QT{constructor(){mt(this,"_map"),mt(this,"_container"),mt(this,"_terrainButton"),Iw(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(a){return this._map=a,this._container=Ys("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ys("button","maplibregl-ctrl-terrain",this._container),Ys("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Qh(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){F0(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function F0(h){h.hasTerrain()?h.disableTerrain():h.enableTerrain()}class eS extends fw{constructor(a={}){super({showCompass:a.showCompass??!0,showZoom:a.showZoom??!0,visualizePitch:a.visualizePitch??!0}),mt(this,"_rotateCompassArrow",()=>{const d=this._map.getBearing(),w=this._map.getPitch(),S=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(w*(Math.PI/180))**.5)}) rotateX(${Math.min(70,w)}deg) rotateZ(${-d}deg)`:`rotate(${-d}deg)`;this._compassIcon.style.transform=S}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",d=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:d}):this._map.resetNorth({},{originalEvent:d})}))}_createButton(a,d){const w=super._createButton(a,d);return w.clickFunction=d,w}}const av=xt.Marker,sv=xt.LngLat,tS=xt.LngLatBounds;class iS extends mw{constructor(){super(...arguments),mt(this,"lastUpdatedCenter",new sv(0,0)),mt(this,"_updateCamera",a=>{var d;const w=new sv(a.coords.longitude,a.coords.latitude),S=a.coords.accuracy,A={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},b=this._map.getZoom();b>(((d=this.options.fitBoundsOptions)==null?void 0:d.maxZoom)??30)&&(A.zoom=b),this._map.fitBounds(tS.fromLngLat(w,S),A,{geolocateSource:!0});let s=!1;const F=()=>{s=!0};this._map.once("click",F),this._map.once("dblclick",F),this._map.once("dragstart",F),this._map.once("mousedown",F),this._map.once("touchstart",F),this._map.once("wheel",F),this._map.once("moveend",()=>{this._map.off("click",F),this._map.off("dblclick",F),this._map.off("dragstart",F),this._map.off("mousedown",F),this._map.off("touchstart",F),this._map.off("wheel",F),!s&&(this.lastUpdatedCenter=this._map.getCenter())})}),mt(this,"_finishSetupUI",a=>{if(this._map){if(a===!1){const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ys("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new av({element:this._dotElement}),this._circleElement=Ys("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new av({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",d=>{const w=d.originalEvent&&d.originalEvent.type==="resize",S=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!d.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!w&&S>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),mt(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const a=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],d=this._map.project(a),w=this._map.unproject([d.x,d.y]),S=this._map.unproject([d.x+20,d.y]),A=w.distanceTo(S)/20,b=Math.ceil(2*this._accuracy/A);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var hu,Ao,pu,du,Nh;class rS{constructor(a,d,w){if(so(this,hu),so(this,Ao),so(this,pu),so(this,du),so(this,Nh),typeof a=="string"){const S=document.querySelector(a);if(!S)throw new Error(`No element has been found with selector "${a}" when creating an external control.`);Lo(this,Ao,S)}else Lo(this,Ao,a);d&&Lo(this,pu,S=>{d(bt(this,hu),bt(this,Ao),S)}),w&&Lo(this,du,S=>{w(bt(this,hu),bt(this,Ao),S)}),Lo(this,Nh,bt(this,Ao).parentElement)}onAdd(a){return Lo(this,hu,a),bt(this,pu)&&bt(this,Ao).addEventListener("click",bt(this,pu)),bt(this,du)&&bt(this,hu).on("render",bt(this,du)),Qh(bt(this,Ao)),bt(this,Ao)}onRemove(){bt(this,pu)&&bt(this,Ao).removeEventListener("click",bt(this,pu)),bt(this,du)&&bt(this,hu).off("render",bt(this,du)),bt(this,Nh)?bt(this,Nh).appendChild(bt(this,Ao)):Qh(bt(this,Ao))}}hu=new WeakMap,Ao=new WeakMap,pu=new WeakMap,du=new WeakMap,Nh=new WeakMap;class nS{constructor(){mt(this,"map"),mt(this,"container"),mt(this,"projectionButton")}onAdd(a){return this.map=a,this.container=Ys("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Ys("button","maplibregl-ctrl-projection",this.container),Ys("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),a.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){Qh(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){B0(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function B0(h){h.getProjection()===void 0&&h.setProjection({type:"mercator"}),h.isGlobeProjection()?h.enableMercatorProjection():h.enableGlobeProjection()}const jh={"zoom-in":h=>h.zoomIn(),"zoom-out":h=>h.zoomOut(),"toggle-projection":B0,"toggle-terrain":F0,"reset-view":h=>{h.getPitch()===0?h.easeTo({pitch:Math.min(h.getMaxPitch(),80)}):h.resetNorthPitch()},"reset-bearing":h=>{h.rotateTo(0)},"reset-pitch":h=>{h.setPitch(0)},"reset-roll":h=>{h.setRoll(0)}};var hd,Vh;class Mm extends rS{constructor(a,d){if(d&&!(d in jh))throw new Error(`data-maptiler-control value "${d}" is invalid.`);super(a,d&&jh[d]),so(this,hd),so(this,Vh,new Map)}onAdd(a){return Lo(this,hd,a),super.onAdd(a)}onRemove(){for(const[a,d]of bt(this,Vh)){const w=a.deref();w&&w.removeEventListener("click",d)}bt(this,Vh).clear(),super.onRemove()}configureGroupItem(a,d){if(!d)return;if(!(d in jh))throw new Error(`data-maptiler-control value "${d}" is invalid.`);const w=S=>{jh[d](bt(this,hd),a,S)};a.addEventListener("click",w),bt(this,Vh).set(new WeakRef(a),w)}}hd=new WeakMap,Vh=new WeakMap,mt(Mm,"controlCallbacks",jh);var Co,ls,fu,mu,Ko,pd,Wn,O0,Jo,N0;class nm{constructor(a,d){so(this,Wn),so(this,Co),mt(this,"map"),so(this,ls),so(this,fu),so(this,mu),so(this,Ko,!1),so(this,pd),a.style!==void 0&&Lo(this,Ko,!0),Lo(this,Co,{zoomAdjust:-4,position:"top-right",...d,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...a,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...a.containerStyle??{}}}),a.lockZoom!==void 0&&(bt(this,Co).minZoom=a.lockZoom,bt(this,Co).maxZoom=a.lockZoom)}setStyle(a,d){bt(this,Ko)||this.map.setStyle(a,d),Eo(this,Wn,Jo).call(this)}addLayer(a,d){return bt(this,Ko)||this.map.addLayer(a,d),Eo(this,Wn,Jo).call(this),this.map}moveLayer(a,d){return bt(this,Ko)||this.map.moveLayer(a,d),Eo(this,Wn,Jo).call(this),this.map}removeLayer(a){return bt(this,Ko)||this.map.removeLayer(a),Eo(this,Wn,Jo).call(this),this}setLayerZoomRange(a,d,w){return bt(this,Ko)||this.map.setLayerZoomRange(a,d,w),Eo(this,Wn,Jo).call(this),this}setFilter(a,d,w){return bt(this,Ko)||this.map.setFilter(a,d,w),Eo(this,Wn,Jo).call(this),this}setPaintProperty(a,d,w,S){return bt(this,Ko)||this.map.setPaintProperty(a,d,w,S),Eo(this,Wn,Jo).call(this),this}setLayoutProperty(a,d,w,S){return bt(this,Ko)||this.map.setLayoutProperty(a,d,w,S),Eo(this,Wn,Jo).call(this),this}setGlyphs(a,d){return bt(this,Ko)||this.map.setGlyphs(a,d),Eo(this,Wn,Jo).call(this),this}onAdd(a){Lo(this,ls,a),Lo(this,fu,Ys("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[d,w]of Object.entries(bt(this,Co).containerStyle))bt(this,fu).style.setProperty(d,w);return bt(this,Co).container=bt(this,fu),bt(this,Co).zoom=a.getZoom()+bt(this,Co).zoomAdjust,this.map=new U0(bt(this,Co)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{Eo(this,Wn,O0).call(this,bt(this,Co).parentRect),Lo(this,pd,Eo(this,Wn,N0).call(this))}),bt(this,fu)}onRemove(){var a;(a=bt(this,pd))==null||a.call(this),Qh(bt(this,fu))}}Co=new WeakMap,ls=new WeakMap,fu=new WeakMap,mu=new WeakMap,Ko=new WeakMap,pd=new WeakMap,Wn=new WeakSet,O0=function(h){h===void 0||h.linePaint===void 0&&h.fillPaint===void 0||(Lo(this,mu,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:bt(this,mu)}),(h.lineLayout!==void 0||h.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...h.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...h.linePaint}}),h.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...h.fillPaint}}),Eo(this,Wn,Jo).call(this))},Jo=function(){if(bt(this,mu)===void 0)return;const{devicePixelRatio:h}=window,a=bt(this,ls).getCanvas(),d=a.width/h,w=a.height/h,S=bt(this,ls).unproject.bind(bt(this,ls)),A=S([0,0]),b=S([d,0]),s=S([0,w]),F=S([d,w]);bt(this,mu).geometry.coordinates=[[s.toArray(),F.toArray(),b.toArray(),A.toArray(),s.toArray()]];const $=this.map.getSource("parentRect");$!==void 0&&$.setData(bt(this,mu))},N0=function(){const{pitchAdjust:h}=bt(this,Co),a=()=>{A("parent")},d=()=>{A("minimap")},w=()=>{bt(this,ls).on("move",a),this.map.on("move",d)},S=()=>{bt(this,ls).off("move",a),this.map.off("move",d)},A=b=>{S();const s=b==="parent"?bt(this,ls):this.map,F=b==="parent"?this.map:bt(this,ls),$=s.getCenter(),Q=s.getZoom()+bt(this,Co).zoomAdjust*(b==="parent"?1:-1),oe=s.getBearing(),xe=s.getPitch();F.jumpTo({center:$,zoom:Q,bearing:oe,pitch:h?xe:0}),Eo(this,Wn,Jo).call(this),w()};return w(),()=>{S()}};class oS{constructor(a,d=2e3){mt(this,"map"),mt(this,"registeredModules",new Set),mt(this,"viewerType"),this.map=a,this.viewerType="Map",setTimeout(async()=>{if(!Tr.telemetry)return;const w=this.preparePayload();try{(await fetch(w,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(S){console.warn("The metrics could not be sent to MapTiler Cloud",S)}},Math.max(1e3,d))}registerModule(a,d){this.registeredModules.add(`${a}:${d}`)}registerViewerType(a="Map"){this.viewerType=a}preparePayload(){const a=new URL(Hn.telemetryURL);return a.searchParams.append("sdk",rx()),a.searchParams.append("key",Tr.apiKey),a.searchParams.append("mtsid",Om),a.searchParams.append("session",Tr.session?"1":"0"),a.searchParams.append("caching",Tr.caching?"1":"0"),a.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),a.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),a.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),a.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&a.searchParams.append("modules",Array.from(this.registeredModules).join("|")),a.href}}var ep=typeof Float32Array<"u"?Float32Array:Array;function Gh(){var h=new ep(16);return ep!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h}function aS(h,a,d,w,S,A,b,s,F,$,Q,oe,xe,ge,Me,be,me){return h[0]=a,h[1]=d,h[2]=w,h[3]=S,h[4]=A,h[5]=b,h[6]=s,h[7]=F,h[8]=$,h[9]=Q,h[10]=oe,h[11]=xe,h[12]=ge,h[13]=Me,h[14]=be,h[15]=me,h}function sS(h,a,d){var w=a[0],S=a[1],A=a[2],b=a[3],s=a[4],F=a[5],$=a[6],Q=a[7],oe=a[8],xe=a[9],ge=a[10],Me=a[11],be=a[12],me=a[13],nt=a[14],Ke=a[15],Je=d[0],Ue=d[1],ke=d[2],$e=d[3];return h[0]=Je*w+Ue*s+ke*oe+$e*be,h[1]=Je*S+Ue*F+ke*xe+$e*me,h[2]=Je*A+Ue*$+ke*ge+$e*nt,h[3]=Je*b+Ue*Q+ke*Me+$e*Ke,Je=d[4],Ue=d[5],ke=d[6],$e=d[7],h[4]=Je*w+Ue*s+ke*oe+$e*be,h[5]=Je*S+Ue*F+ke*xe+$e*me,h[6]=Je*A+Ue*$+ke*ge+$e*nt,h[7]=Je*b+Ue*Q+ke*Me+$e*Ke,Je=d[8],Ue=d[9],ke=d[10],$e=d[11],h[8]=Je*w+Ue*s+ke*oe+$e*be,h[9]=Je*S+Ue*F+ke*xe+$e*me,h[10]=Je*A+Ue*$+ke*ge+$e*nt,h[11]=Je*b+Ue*Q+ke*Me+$e*Ke,Je=d[12],Ue=d[13],ke=d[14],$e=d[15],h[12]=Je*w+Ue*s+ke*oe+$e*be,h[13]=Je*S+Ue*F+ke*xe+$e*me,h[14]=Je*A+Ue*$+ke*ge+$e*nt,h[15]=Je*b+Ue*Q+ke*Me+$e*Ke,h}function lS(h,a,d){var w=d[0],S=d[1],A=d[2];return h[0]=a[0]*w,h[1]=a[1]*w,h[2]=a[2]*w,h[3]=a[3]*w,h[4]=a[4]*S,h[5]=a[5]*S,h[6]=a[6]*S,h[7]=a[7]*S,h[8]=a[8]*A,h[9]=a[9]*A,h[10]=a[10]*A,h[11]=a[11]*A,h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15],h}function lv(h,a,d){var w=Math.sin(d),S=Math.cos(d),A=a[4],b=a[5],s=a[6],F=a[7],$=a[8],Q=a[9],oe=a[10],xe=a[11];return a!==h&&(h[0]=a[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[4]=A*S+$*w,h[5]=b*S+Q*w,h[6]=s*S+oe*w,h[7]=F*S+xe*w,h[8]=$*S-A*w,h[9]=Q*S-b*w,h[10]=oe*S-s*w,h[11]=xe*S-F*w,h}function uS(h,a,d){var w=Math.sin(d),S=Math.cos(d),A=a[0],b=a[1],s=a[2],F=a[3],$=a[8],Q=a[9],oe=a[10],xe=a[11];return a!==h&&(h[4]=a[4],h[5]=a[5],h[6]=a[6],h[7]=a[7],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=A*S-$*w,h[1]=b*S-Q*w,h[2]=s*S-oe*w,h[3]=F*S-xe*w,h[8]=A*w+$*S,h[9]=b*w+Q*S,h[10]=s*w+oe*S,h[11]=F*w+xe*S,h}function uv(h,a,d){var w=Math.sin(d),S=Math.cos(d),A=a[0],b=a[1],s=a[2],F=a[3],$=a[4],Q=a[5],oe=a[6],xe=a[7];return a!==h&&(h[8]=a[8],h[9]=a[9],h[10]=a[10],h[11]=a[11],h[12]=a[12],h[13]=a[13],h[14]=a[14],h[15]=a[15]),h[0]=A*S+$*w,h[1]=b*S+Q*w,h[2]=s*S+oe*w,h[3]=F*S+xe*w,h[4]=$*S-A*w,h[5]=Q*S-b*w,h[6]=oe*S-s*w,h[7]=xe*S-F*w,h}function cS(h,a,d,w,S){var A=1/Math.tan(a/2);if(h[0]=A/d,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=A,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,S!=null&&S!==1/0){var b=1/(w-S);h[10]=(S+w)*b,h[14]=2*S*w*b}else h[10]=-1,h[14]=-2*w;return h}var hS=cS;function dd(){var h=new ep(3);return ep!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function pS(h,a,d){var w=new ep(3);return w[0]=h,w[1]=a,w[2]=d,w}function om(h,a){var d=a[0],w=a[1],S=a[2],A=d*d+w*w+S*S;return A>0&&(A=1/Math.sqrt(A)),h[0]=a[0]*A,h[1]=a[1]*A,h[2]=a[2]*A,h}function cv(h,a,d){var w=a[0],S=a[1],A=a[2],b=d[0],s=d[1],F=d[2];return h[0]=S*F-A*s,h[1]=A*b-w*F,h[2]=w*s-S*b,h}(function(){var h=dd();return function(a,d,w,S,A,b){var s,F;for(d||(d=3),w||(w=0),S?F=Math.min(S*d+w,a.length):F=a.length,s=w;s<F;s+=d)h[0]=a[s],h[1]=a[s+1],h[2]=a[s+2],A(h,h,b),a[s]=h[0],a[s+1]=h[1],a[s+2]=h[2];return a}})();function dS(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var hv,pv;function fS(){return pv||(pv=1,hv={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),hv}var am,dv;function j0(){if(dv)return am;dv=1;const h=fS(),a={};for(const S of Object.keys(h))a[h[S]]=S;const d={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};am=d;for(const S of Object.keys(d)){if(!("channels"in d[S]))throw new Error("missing channels property: "+S);if(!("labels"in d[S]))throw new Error("missing channel labels property: "+S);if(d[S].labels.length!==d[S].channels)throw new Error("channel and label counts mismatch: "+S);const{channels:A,labels:b}=d[S];delete d[S].channels,delete d[S].labels,Object.defineProperty(d[S],"channels",{value:A}),Object.defineProperty(d[S],"labels",{value:b})}d.rgb.hsl=function(S){const A=S[0]/255,b=S[1]/255,s=S[2]/255,F=Math.min(A,b,s),$=Math.max(A,b,s),Q=$-F;let oe,xe;$===F?oe=0:A===$?oe=(b-s)/Q:b===$?oe=2+(s-A)/Q:s===$&&(oe=4+(A-b)/Q),oe=Math.min(oe*60,360),oe<0&&(oe+=360);const ge=(F+$)/2;return $===F?xe=0:ge<=.5?xe=Q/($+F):xe=Q/(2-$-F),[oe,xe*100,ge*100]},d.rgb.hsv=function(S){let A,b,s,F,$;const Q=S[0]/255,oe=S[1]/255,xe=S[2]/255,ge=Math.max(Q,oe,xe),Me=ge-Math.min(Q,oe,xe),be=function(me){return(ge-me)/6/Me+1/2};return Me===0?(F=0,$=0):($=Me/ge,A=be(Q),b=be(oe),s=be(xe),Q===ge?F=s-b:oe===ge?F=1/3+A-s:xe===ge&&(F=2/3+b-A),F<0?F+=1:F>1&&(F-=1)),[F*360,$*100,ge*100]},d.rgb.hwb=function(S){const A=S[0],b=S[1];let s=S[2];const F=d.rgb.hsl(S)[0],$=1/255*Math.min(A,Math.min(b,s));return s=1-1/255*Math.max(A,Math.max(b,s)),[F,$*100,s*100]},d.rgb.cmyk=function(S){const A=S[0]/255,b=S[1]/255,s=S[2]/255,F=Math.min(1-A,1-b,1-s),$=(1-A-F)/(1-F)||0,Q=(1-b-F)/(1-F)||0,oe=(1-s-F)/(1-F)||0;return[$*100,Q*100,oe*100,F*100]};function w(S,A){return(S[0]-A[0])**2+(S[1]-A[1])**2+(S[2]-A[2])**2}return d.rgb.keyword=function(S){const A=a[S];if(A)return A;let b=1/0,s;for(const F of Object.keys(h)){const $=h[F],Q=w(S,$);Q<b&&(b=Q,s=F)}return s},d.keyword.rgb=function(S){return h[S]},d.rgb.xyz=function(S){let A=S[0]/255,b=S[1]/255,s=S[2]/255;A=A>.04045?((A+.055)/1.055)**2.4:A/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,s=s>.04045?((s+.055)/1.055)**2.4:s/12.92;const F=A*.4124+b*.3576+s*.1805,$=A*.2126+b*.7152+s*.0722,Q=A*.0193+b*.1192+s*.9505;return[F*100,$*100,Q*100]},d.rgb.lab=function(S){const A=d.rgb.xyz(S);let b=A[0],s=A[1],F=A[2];b/=95.047,s/=100,F/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,s=s>.008856?s**(1/3):7.787*s+16/116,F=F>.008856?F**(1/3):7.787*F+16/116;const $=116*s-16,Q=500*(b-s),oe=200*(s-F);return[$,Q,oe]},d.hsl.rgb=function(S){const A=S[0]/360,b=S[1]/100,s=S[2]/100;let F,$,Q;if(b===0)return Q=s*255,[Q,Q,Q];s<.5?F=s*(1+b):F=s+b-s*b;const oe=2*s-F,xe=[0,0,0];for(let ge=0;ge<3;ge++)$=A+1/3*-(ge-1),$<0&&$++,$>1&&$--,6*$<1?Q=oe+(F-oe)*6*$:2*$<1?Q=F:3*$<2?Q=oe+(F-oe)*(2/3-$)*6:Q=oe,xe[ge]=Q*255;return xe},d.hsl.hsv=function(S){const A=S[0];let b=S[1]/100,s=S[2]/100,F=b;const $=Math.max(s,.01);s*=2,b*=s<=1?s:2-s,F*=$<=1?$:2-$;const Q=(s+b)/2,oe=s===0?2*F/($+F):2*b/(s+b);return[A,oe*100,Q*100]},d.hsv.rgb=function(S){const A=S[0]/60,b=S[1]/100;let s=S[2]/100;const F=Math.floor(A)%6,$=A-Math.floor(A),Q=255*s*(1-b),oe=255*s*(1-b*$),xe=255*s*(1-b*(1-$));switch(s*=255,F){case 0:return[s,xe,Q];case 1:return[oe,s,Q];case 2:return[Q,s,xe];case 3:return[Q,oe,s];case 4:return[xe,Q,s];case 5:return[s,Q,oe]}},d.hsv.hsl=function(S){const A=S[0],b=S[1]/100,s=S[2]/100,F=Math.max(s,.01);let $,Q;Q=(2-b)*s;const oe=(2-b)*F;return $=b*F,$/=oe<=1?oe:2-oe,$=$||0,Q/=2,[A,$*100,Q*100]},d.hwb.rgb=function(S){const A=S[0]/360;let b=S[1]/100,s=S[2]/100;const F=b+s;let $;F>1&&(b/=F,s/=F);const Q=Math.floor(6*A),oe=1-s;$=6*A-Q,(Q&1)!==0&&($=1-$);const xe=b+$*(oe-b);let ge,Me,be;switch(Q){default:case 6:case 0:ge=oe,Me=xe,be=b;break;case 1:ge=xe,Me=oe,be=b;break;case 2:ge=b,Me=oe,be=xe;break;case 3:ge=b,Me=xe,be=oe;break;case 4:ge=xe,Me=b,be=oe;break;case 5:ge=oe,Me=b,be=xe;break}return[ge*255,Me*255,be*255]},d.cmyk.rgb=function(S){const A=S[0]/100,b=S[1]/100,s=S[2]/100,F=S[3]/100,$=1-Math.min(1,A*(1-F)+F),Q=1-Math.min(1,b*(1-F)+F),oe=1-Math.min(1,s*(1-F)+F);return[$*255,Q*255,oe*255]},d.xyz.rgb=function(S){const A=S[0]/100,b=S[1]/100,s=S[2]/100;let F,$,Q;return F=A*3.2406+b*-1.5372+s*-.4986,$=A*-.9689+b*1.8758+s*.0415,Q=A*.0557+b*-.204+s*1.057,F=F>.0031308?1.055*F**(1/2.4)-.055:F*12.92,$=$>.0031308?1.055*$**(1/2.4)-.055:$*12.92,Q=Q>.0031308?1.055*Q**(1/2.4)-.055:Q*12.92,F=Math.min(Math.max(0,F),1),$=Math.min(Math.max(0,$),1),Q=Math.min(Math.max(0,Q),1),[F*255,$*255,Q*255]},d.xyz.lab=function(S){let A=S[0],b=S[1],s=S[2];A/=95.047,b/=100,s/=108.883,A=A>.008856?A**(1/3):7.787*A+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,s=s>.008856?s**(1/3):7.787*s+16/116;const F=116*b-16,$=500*(A-b),Q=200*(b-s);return[F,$,Q]},d.lab.xyz=function(S){const A=S[0],b=S[1],s=S[2];let F,$,Q;$=(A+16)/116,F=b/500+$,Q=$-s/200;const oe=$**3,xe=F**3,ge=Q**3;return $=oe>.008856?oe:($-16/116)/7.787,F=xe>.008856?xe:(F-16/116)/7.787,Q=ge>.008856?ge:(Q-16/116)/7.787,F*=95.047,$*=100,Q*=108.883,[F,$,Q]},d.lab.lch=function(S){const A=S[0],b=S[1],s=S[2];let F;F=Math.atan2(s,b)*360/2/Math.PI,F<0&&(F+=360);const $=Math.sqrt(b*b+s*s);return[A,$,F]},d.lch.lab=function(S){const A=S[0],b=S[1],s=S[2]/360*2*Math.PI,F=b*Math.cos(s),$=b*Math.sin(s);return[A,F,$]},d.rgb.ansi16=function(S,A=null){const[b,s,F]=S;let $=A===null?d.rgb.hsv(S)[2]:A;if($=Math.round($/50),$===0)return 30;let Q=30+(Math.round(F/255)<<2|Math.round(s/255)<<1|Math.round(b/255));return $===2&&(Q+=60),Q},d.hsv.ansi16=function(S){return d.rgb.ansi16(d.hsv.rgb(S),S[2])},d.rgb.ansi256=function(S){const A=S[0],b=S[1],s=S[2];return A===b&&b===s?A<8?16:A>248?231:Math.round((A-8)/247*24)+232:16+36*Math.round(A/255*5)+6*Math.round(b/255*5)+Math.round(s/255*5)},d.ansi16.rgb=function(S){let A=S%10;if(A===0||A===7)return S>50&&(A+=3.5),A=A/10.5*255,[A,A,A];const b=(~~(S>50)+1)*.5,s=(A&1)*b*255,F=(A>>1&1)*b*255,$=(A>>2&1)*b*255;return[s,F,$]},d.ansi256.rgb=function(S){if(S>=232){const $=(S-232)*10+8;return[$,$,$]}S-=16;let A;const b=Math.floor(S/36)/5*255,s=Math.floor((A=S%36)/6)/5*255,F=A%6/5*255;return[b,s,F]},d.rgb.hex=function(S){const A=(((Math.round(S[0])&255)<<16)+((Math.round(S[1])&255)<<8)+(Math.round(S[2])&255)).toString(16).toUpperCase();return"000000".substring(A.length)+A},d.hex.rgb=function(S){const A=S.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!A)return[0,0,0];let b=A[0];A[0].length===3&&(b=b.split("").map(oe=>oe+oe).join(""));const s=parseInt(b,16),F=s>>16&255,$=s>>8&255,Q=s&255;return[F,$,Q]},d.rgb.hcg=function(S){const A=S[0]/255,b=S[1]/255,s=S[2]/255,F=Math.max(Math.max(A,b),s),$=Math.min(Math.min(A,b),s),Q=F-$;let oe,xe;return Q<1?oe=$/(1-Q):oe=0,Q<=0?xe=0:F===A?xe=(b-s)/Q%6:F===b?xe=2+(s-A)/Q:xe=4+(A-b)/Q,xe/=6,xe%=1,[xe*360,Q*100,oe*100]},d.hsl.hcg=function(S){const A=S[1]/100,b=S[2]/100,s=b<.5?2*A*b:2*A*(1-b);let F=0;return s<1&&(F=(b-.5*s)/(1-s)),[S[0],s*100,F*100]},d.hsv.hcg=function(S){const A=S[1]/100,b=S[2]/100,s=A*b;let F=0;return s<1&&(F=(b-s)/(1-s)),[S[0],s*100,F*100]},d.hcg.rgb=function(S){const A=S[0]/360,b=S[1]/100,s=S[2]/100;if(b===0)return[s*255,s*255,s*255];const F=[0,0,0],$=A%1*6,Q=$%1,oe=1-Q;let xe=0;switch(Math.floor($)){case 0:F[0]=1,F[1]=Q,F[2]=0;break;case 1:F[0]=oe,F[1]=1,F[2]=0;break;case 2:F[0]=0,F[1]=1,F[2]=Q;break;case 3:F[0]=0,F[1]=oe,F[2]=1;break;case 4:F[0]=Q,F[1]=0,F[2]=1;break;default:F[0]=1,F[1]=0,F[2]=oe}return xe=(1-b)*s,[(b*F[0]+xe)*255,(b*F[1]+xe)*255,(b*F[2]+xe)*255]},d.hcg.hsv=function(S){const A=S[1]/100,b=S[2]/100,s=A+b*(1-A);let F=0;return s>0&&(F=A/s),[S[0],F*100,s*100]},d.hcg.hsl=function(S){const A=S[1]/100,b=S[2]/100*(1-A)+.5*A;let s=0;return b>0&&b<.5?s=A/(2*b):b>=.5&&b<1&&(s=A/(2*(1-b))),[S[0],s*100,b*100]},d.hcg.hwb=function(S){const A=S[1]/100,b=S[2]/100,s=A+b*(1-A);return[S[0],(s-A)*100,(1-s)*100]},d.hwb.hcg=function(S){const A=S[1]/100,b=1-S[2]/100,s=b-A;let F=0;return s<1&&(F=(b-s)/(1-s)),[S[0],s*100,F*100]},d.apple.rgb=function(S){return[S[0]/65535*255,S[1]/65535*255,S[2]/65535*255]},d.rgb.apple=function(S){return[S[0]/255*65535,S[1]/255*65535,S[2]/255*65535]},d.gray.rgb=function(S){return[S[0]/100*255,S[0]/100*255,S[0]/100*255]},d.gray.hsl=function(S){return[0,0,S[0]]},d.gray.hsv=d.gray.hsl,d.gray.hwb=function(S){return[0,100,S[0]]},d.gray.cmyk=function(S){return[0,0,0,S[0]]},d.gray.lab=function(S){return[S[0],0,0]},d.gray.hex=function(S){const A=Math.round(S[0]/100*255)&255,b=((A<<16)+(A<<8)+A).toString(16).toUpperCase();return"000000".substring(b.length)+b},d.rgb.gray=function(S){return[(S[0]+S[1]+S[2])/3/255*100]},am}var sm,fv;function mS(){if(fv)return sm;fv=1;const h=j0();function a(){const A={},b=Object.keys(h);for(let s=b.length,F=0;F<s;F++)A[b[F]]={distance:-1,parent:null};return A}function d(A){const b=a(),s=[A];for(b[A].distance=0;s.length;){const F=s.pop(),$=Object.keys(h[F]);for(let Q=$.length,oe=0;oe<Q;oe++){const xe=$[oe],ge=b[xe];ge.distance===-1&&(ge.distance=b[F].distance+1,ge.parent=F,s.unshift(xe))}}return b}function w(A,b){return function(s){return b(A(s))}}function S(A,b){const s=[b[A].parent,A];let F=h[b[A].parent][A],$=b[A].parent;for(;b[$].parent;)s.unshift(b[$].parent),F=w(h[b[$].parent][$],F),$=b[$].parent;return F.conversion=s,F}return sm=function(A){const b=d(A),s={},F=Object.keys(b);for(let $=F.length,Q=0;Q<$;Q++){const oe=F[Q];b[oe].parent!==null&&(s[oe]=S(oe,b))}return s},sm}var lm,mv;function gS(){if(mv)return lm;mv=1;const h=j0(),a=mS(),d={},w=Object.keys(h);function S(b){const s=function(...F){const $=F[0];return $==null?$:($.length>1&&(F=$),b(F))};return"conversion"in b&&(s.conversion=b.conversion),s}function A(b){const s=function(...F){const $=F[0];if($==null)return $;$.length>1&&(F=$);const Q=b(F);if(typeof Q=="object")for(let oe=Q.length,xe=0;xe<oe;xe++)Q[xe]=Math.round(Q[xe]);return Q};return"conversion"in b&&(s.conversion=b.conversion),s}return w.forEach(b=>{d[b]={},Object.defineProperty(d[b],"channels",{value:h[b].channels}),Object.defineProperty(d[b],"labels",{value:h[b].labels});const s=a(b);Object.keys(s).forEach(F=>{const $=s[F];d[b][F]=A($),d[b][F].raw=S($)})}),lm=d,lm}var _S=gS();const yS=dS(_S);function gv({gl:h,type:a,source:d}){const w=h.createShader(a);if(w===null)throw new Error("Cannot create shader");if(h.shaderSource(w,d),h.compileShader(w),!h.getShaderParameter(w,h.COMPILE_STATUS))throw console.error("Shader compilation error:",h.getShaderInfoLog(w)),h.deleteShader(w),new Error("Cannot compile shader");return w}function vS({gl:h,vertexShaderSource:a,fragmentShaderSource:d}){const w=gv({gl:h,type:h.VERTEX_SHADER,source:a}),S=gv({gl:h,type:h.FRAGMENT_SHADER,source:d}),A=h.createProgram();if(h.attachShader(A,w),h.attachShader(A,S),h.linkProgram(A),!h.getProgramParameter(A,h.LINK_STATUS))throw console.error("Error: ",h.getProgramInfoLog(A)),new Error("Cannot link shader program");return A}function xS(h,a,d){const w=h.getUniformLocation(a,d);if(w===null)throw new Error(`Cannot get uniform location for ${d}`);return w}function V0({gl:h,vertexShaderSource:a,fragmentShaderSource:d,attributesKeys:w,uniformsKeys:S,vertices:A,indices:b}){const s=vS({gl:h,vertexShaderSource:a,fragmentShaderSource:d}),F=w.reduce((ge,Me)=>(ge[Me]=h.getAttribLocation(s,`a_${Me}`),ge),{}),$=S.reduce((ge,Me)=>(ge[Me]=xS(h,s,`u_${Me}`),ge),{}),Q=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,Q),h.bufferData(h.ARRAY_BUFFER,new Float32Array(A),h.STATIC_DRAW);let oe,xe;return b!==void 0&&(oe=h.createBuffer(),xe=b.length,h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,oe),h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),h.STATIC_DRAW)),{shaderProgram:s,programInfo:{attributesLocations:F,uniformsLocations:$},positionBuffer:Q,indexBuffer:oe,indexBufferLength:xe}}function fd(h){if(!h)return[1,1,1,0];if(h==="transparent")return[1,1,1,0];try{const a=bS(h),d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(a);if(d!=null&&d.length){const S=!!d[4];return[...yS.hex.rgb(a).map(A=>A/255),S?parseInt(d[4],16)/255:1]}const w=a.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(a.includes("rgb")){const S=a.includes("rgba"),A=[...w.map(b=>parseFloat(b)).map((b,s)=>s<3?b/255:b)];return S||A.push(1),A}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${h} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}let Rh;function bS(h){return Rh=Rh??document.createElement("canvas").getContext("2d"),Rh?(Rh.fillStyle=h,Rh.fillStyle):"#000000"}const ag=1,lr=ag/2,ur=ag/2,cr=ag/2,wS=[-lr,-ur,cr,lr,-ur,cr,lr,ur,cr,-lr,ur,cr],TS=[-lr,-ur,-cr,-lr,ur,-cr,lr,ur,-cr,lr,-ur,-cr],SS=[-lr,ur,-cr,-lr,ur,cr,lr,ur,cr,lr,ur,-cr],PS=[-lr,-ur,-cr,lr,-ur,-cr,lr,-ur,cr,-lr,-ur,cr],MS=[lr,-ur,-cr,lr,ur,-cr,lr,ur,cr,lr,-ur,cr],IS=[-lr,-ur,-cr,-lr,-ur,cr,-lr,ur,cr,-lr,ur,-cr],AS=[...wS,...TS,...SS,...PS,...MS,...IS],ES=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],CS=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,_v=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,Tu={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var gu=(h=>(h.POSITIVE_X="pX",h.NEGATIVE_X="nX",h.POSITIVE_Y="pY",h.NEGATIVE_Y="nY",h.POSITIVE_Z="pZ",h.NEGATIVE_Z="nZ",h))(gu||{});const Ic=new Map;function LS(h){const a=Ic.get(h);a&&(Ic.delete(h),h.deleteTexture(a))}const yv=new Map;let vv;function kS({gl:h,faces:a,onReady:d,forceRefresh:w}){if(Ic.get(h)&&!w&&vv===JSON.stringify(a)){d(Ic.get(h),yv.get(h));return}vv=JSON.stringify(a);const S=Ic.get(h)??h.createTexture();if(h.bindTexture(h.TEXTURE_CUBE_MAP,S),!a){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}const A=Object.keys(a).length;if(A!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${A}`);return}const b=Object.entries(a).map(([s,F])=>new Promise(($,Q)=>{const oe=s;if(F===void 0){Q(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${s} is undefined`));return}const xe=new Image;xe.crossOrigin="anonymous";const ge=()=>{$({image:xe,key:oe})};xe.src=F,xe.complete&&xe.naturalWidth>0?ge():xe.onload=ge,xe.onerror=()=>{Q(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${F}`))}}));Promise.all(b).then(s=>{for(let $=0;$<s.length;$++){const Q=h.RGBA,oe=h.RGBA,xe=h.UNSIGNED_BYTE,{image:ge,key:Me}=s[$]??{};if(!ge||!Me){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const be=zS(h,Me);h.bindTexture(h.TEXTURE_CUBE_MAP,S),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texImage2D(be,0,Q,oe,xe,ge)}h.bindTexture(h.TEXTURE_CUBE_MAP,S),h.generateMipmap(h.TEXTURE_CUBE_MAP),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR);const F=s.map($=>$.image);d(S,F),yv.set(h,F),Ic.set(h,S)}).catch(s=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",s)})}function zS(h,a){if(a===gu.POSITIVE_X)return h.TEXTURE_CUBE_MAP_POSITIVE_X;if(a===gu.NEGATIVE_X)return h.TEXTURE_CUBE_MAP_NEGATIVE_X;if(a===gu.POSITIVE_Y)return h.TEXTURE_CUBE_MAP_POSITIVE_Y;if(a===gu.NEGATIVE_Y)return h.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(a===gu.POSITIVE_Z)return h.TEXTURE_CUBE_MAP_POSITIVE_Z;if(a===gu.NEGATIVE_Z)return h.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${a}`)}function DS(h,a,d){return[Cl(h[0],a[0],d),Cl(h[1],a[1],d),Cl(h[2],a[2],d),Cl(h[3],a[3],d)]}function Cl(h,a,d){return h+(a-h)*d}function Pd(h){if(!h)return{};const a=Object.keys(h).sort().map(d=>[d,h[d]]);return Object.fromEntries(a)}const Sc="https://api.maptiler.com/resources/space",RS=["vertexPosition"],FS=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],xv="%USE_TEXTURE_MACRO_MARKER%",BS="#define USE_TEXTURE",bv=Tu.stars;function OS(h,a){if(!Im(h))return{color:"transparent"};if(h===!0)return a;const d={...h};if(h.faces||h.path)return delete d.preset,d;const w=h.preset;if(w!==void 0&&!(w in Tu))throw new Error(`[CubemapLayer]: Invalid preset "${w}". Available presets: ${Object.keys(Tu).join(", ")}`);return{...d,color:d.color??Tu[w].color??"hsl(233,100%,92%)"}}class um{constructor(a){mt(this,"id","Cubemap Layer"),mt(this,"type","custom"),mt(this,"renderingMode","3d"),mt(this,"map"),mt(this,"faces"),mt(this,"useCubemapTexture",!0),mt(this,"currentFadeOpacity",0),mt(this,"cubeMapNeedsUpdate",!1),mt(this,"bgColor"),mt(this,"previousBgColor",[0,0,0,0]),mt(this,"targetBgColor",[0,0,0,0]),mt(this,"transitionDelta",0),mt(this,"gl"),mt(this,"cubemap"),mt(this,"texture"),mt(this,"currentFacesDefinitionKey",""),mt(this,"options"),mt(this,"animationActive",!0),mt(this,"imageIsAnimating",!1),mt(this,"imageFadeInDelta",0);const d=OS(a,bv);this.options=d,this.currentFacesDefinitionKey=JSON.stringify(d.faces??d.preset??d.path),this.bgColor=[0,0,0,0],this.targetBgColor=fd(d.color),this.faces=wv(d),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:a}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;const d=FS.filter(w=>w==="cubeSampler"||w==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=V0({gl:this.gl,vertexShaderSource:CS,fragmentShaderSource:this.useCubemapTexture?_v.replace(xv,BS):_v.replace(xv,""),attributesKeys:RS,uniformsKeys:d,vertices:AS,indices:ES}),this.cubeMapNeedsUpdate=a,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(a,d){this.map=a,this.gl=d,this.updateCubemap()}onRemove(a,d){this.cubemap&&(this.texture&&(LS(d),this.texture=void 0),d.deleteProgram(this.cubemap.shaderProgram),d.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(a,d){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;kS({gl:a,faces:d,onReady:w=>{this.texture=w,this.animateIn()}})}}prerender(a,d){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const a=()=>{this.transitionDelta<1&&(requestAnimationFrame(a),this.bgColor=DS(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(a)}async animateIn(){if(!this.imageIsAnimating){if(!this.animationActive){this.currentFadeOpacity=1,this.imageFadeInDelta=1,this.map.triggerRepaint();return}return new Promise(a=>{this.imageIsAnimating=!0;const d=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Cl(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(d);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0,a()};requestAnimationFrame(d)})}}async animateOut(){if(!(this.imageIsAnimating||!this.animationActive))return new Promise(a=>{const d=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Cl(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,a();return}requestAnimationFrame(d)};requestAnimationFrame(d)})}setAnimationActive(a){this.animationActive=a}render(a,d){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,a.disable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.DST_ALPHA),a.useProgram(this.cubemap.shaderProgram),a.bindBuffer(a.ARRAY_BUFFER,this.cubemap.positionBuffer),a.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,a.FLOAT,!1,0,0),a.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const w=.1,S=1e4,A=a.canvas,b=A.clientWidth/A.clientHeight,s=this.map.transform,F=s.fov*(Math.PI/180),$=Gh();hS($,F,b,w,S),uv($,$,s.rollInRadians),lv($,$,-s.pitchInRadians),uv($,$,s.bearingInRadians);const Q=s.center.lat*Math.PI/180,oe=s.center.lng*Math.PI/180;lv($,$,Q),uS($,$,-oe),a.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,$);const xe=Gh();if(a.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,xe),a.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),a.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,this.texture),a.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),a.drawElements(a.TRIANGLES,this.cubemap.indexBufferLength,a.UNSIGNED_SHORT,0)}setBgColor(a){this.targetBgColor=a,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}shouldUpdate(a){const d=this.getConfig();if(a===void 0&&d)return!0;const w=typeof a=="boolean"?a:Pd(a),S=Pd(d);return JSON.stringify(w)!==JSON.stringify(S)}async setCubemapFaces(a){if(await this.animateOut(),!a.faces&&!a.preset&&!a.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",await this.animateIn();return}this.faces=wv(a),this.currentFacesDefinitionKey=JSON.stringify(a.faces??a.preset??a.path)}async setCubemap(a){const d=typeof a=="boolean"?bv:a;this.options=d;const w=JSON.stringify(d.faces??d.preset??d.path),S=this.currentFacesDefinitionKey!==w;S&&(await this.setCubemapFaces(d),this.cubeMapNeedsUpdate=!0);const A=fd(d.color);if(d.color&&this.targetBgColor.toString()!==A.toString())this.setBgColor(A);else if(!d.color&&d.preset&&d.preset in Tu){const b=Tu[d.preset];this.setBgColor(fd(b.color))}this.updateCubemap({facesNeedUpdate:S})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}function Im(h){return h?typeof h=="boolean"?!0:!(!h.path&&!h.preset&&!h.faces&&!h.color||h.preset&&!(h.preset in Tu)||h.faces&&(!h.faces.pX||!h.faces.nX||!h.faces.pY||!h.faces.nY||!h.faces.pZ||!h.faces.nZ)):!1}function wv(h){if(h.faces)return h.faces;if(h.preset)return{pX:`${Sc}/${h.preset}/px.webp`,nX:`${Sc}/${h.preset}/nx.webp`,pY:`${Sc}/${h.preset}/py.webp`,nY:`${Sc}/${h.preset}/ny.webp`,pZ:`${Sc}/${h.preset}/pz.webp`,nZ:`${Sc}/${h.preset}/nz.webp`};if(h.path){const a=h.path.baseUrl,d=h.path.format??"png";return{pX:`${a}/px.${d}`,nX:`${a}/nx.${d}`,pY:`${a}/py.${d}`,nY:`${a}/ny.${d}`,pZ:`${a}/pz.${d}`,nZ:`${a}/nz.${d}`}}return null}const NS=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,jS=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

const float EPSILON = 0.000001;

vec2 center = vec2(0.0, 0.0);
void main() {
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastStopValue = u_stops[i - 1];
    float thisStopValue = u_stops[i];

    // this is to avoid blending errors when the stops are the same
    // eg when you would want a sharp edge between two stops.
    // \`numbersAreEqual\` will be 1.0 if the numbers are equal, 0.0 if they are not.
    // We then subtract EPSILON from the last stop making the stop value _almost_ equal
    // to the next stop but not enough to cause blending issues.
    // It's more efficient to do this than an if / else statement.
    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));
    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;

    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,Hs=2,VS=["position"],US=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],ZS=[-Hs,-Hs,0,Hs,-Hs,0,-Hs,Hs,0,Hs,Hs,0],od=[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]],ad=.9,Tv=.06;class cm{constructor(a){if(mt(this,"id","Halo Layer"),mt(this,"type","custom"),mt(this,"renderingMode","3d"),mt(this,"gradient"),mt(this,"scale",0),mt(this,"animationDelta",0),mt(this,"map"),mt(this,"plane"),mt(this,"animationActive",!0),typeof a=="boolean"){this.gradient={scale:ad,stops:od};return}const d=Sv(a);if(d.length>0)throw new Error(`[RadialGradientLayer]: Invalid Halo specification:
 - ${d.join(`
 - `)}
    `);this.gradient={scale:a.scale??ad,stops:a.stops??od}}onAdd(a,d){this.map=a,this.plane=V0({gl:d,vertexShaderSource:NS,fragmentShaderSource:jS,attributesKeys:VS,uniformsKeys:US,vertices:ZS}),this.animateIn()}getConfig(){return this.gradient}shouldUpdate(a){const d=this.getConfig();if(a===void 0&&d)return!0;const w=typeof a=="boolean"?a:Pd(a),S=Pd(d);return JSON.stringify(w)!==JSON.stringify(S)}async animateIn(){if(!this.animationActive){this.scale=this.gradient.scale,this.animationDelta=1,this.map.triggerRepaint();return}return new Promise(a=>{this.animationDelta=0;const d=()=>{if(this.animationDelta<=1){this.scale=Cl(0,this.gradient.scale,this.animationDelta),this.animationDelta+=Tv,this.map.triggerRepaint(),requestAnimationFrame(d);return}a()};requestAnimationFrame(d)})}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(a=>{const d=()=>{if(this.animationDelta<1){this.scale=Cl(this.gradient.scale,0,this.animationDelta),this.animationDelta+=Tv,this.map.triggerRepaint(),requestAnimationFrame(d);return}a()};d()})}onRemove(a,d){this.plane!==void 0&&(d.deleteProgram(this.plane.shaderProgram),d.deleteBuffer(this.plane.positionBuffer))}prerender(a,d){}render(a,d){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");a.disable(a.DEPTH_TEST),a.enable(a.BLEND),a.useProgram(this.plane.shaderProgram),a.bindBuffer(a.ARRAY_BUFFER,this.plane.positionBuffer);const w=this.plane.programInfo.attributesLocations.position;a.enableVertexAttribArray(w),a.vertexAttribPointer(w,3,a.FLOAT,!1,0,0);const S=Gh(),A=this.scale;lS(S,S,[A,A,A]);const b=Gh();sS(b,d.defaultProjectionData.mainMatrix,S);const s=this.plane.programInfo.uniformsLocations.matrix;a.uniformMatrix4fv(s,!1,b);const F=Gh(),$=this.map.transform.cameraPosition,Q=om(dd(),$),oe=pS(0,1,0),xe=dd();cv(xe,oe,Q),om(xe,xe);const ge=dd();cv(ge,Q,xe),om(ge,ge),aS(F,xe[0],xe[1],xe[2],0,ge[0],ge[1],ge[2],0,Q[0],Q[1],Q[2],0,0,0,0,1);const Me=this.plane.programInfo.uniformsLocations.rotationMatrix;a.uniformMatrix4fv(Me,!1,F);const be=this.gradient.stops.length,me=[],nt=[];for(let Ke=0;Ke<=be;Ke++)if(Ke<be){me[Ke]=this.gradient.stops[Ke][0];const Je=fd(this.gradient.stops[Ke][1]);nt.push(...Je)}a.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,be),a.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(me)),a.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(nt)),a.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,Hs),a.uniform1f(this.plane.programInfo.uniformsLocations.scale,A),a.drawArrays(a.TRIANGLE_STRIP,0,4)}async setGradient(a){if(a===!1){await this.animateOut();return}await this.animateOut();const d=Sv(a);if(d.length>0)throw new Error(`[RadialGradientLayer]: Invalid Halo specification:
 - ${d.join(`
 - `)}
    `);a===!0?(this.gradient.scale=ad,this.gradient.stops=od):(this.gradient.scale=a.scale??ad,this.gradient.stops=a.stops??od),await this.animateIn()}setAnimationActive(a){this.animationActive=a}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}}const GS=["scale","stops"];function Sv(h){var a;const d=[];if(typeof h=="boolean")return[];try{const w=Object.keys(h).filter(S=>!GS.includes(S));w.length>0&&d.push(`Properties ${w.map(S=>`\`${S}\``).join(", ")} are not supported.`)}catch{d.push("Halo specification is not an object.")}return typeof h.scale!="number"&&d.push("Halo `scale` property is not a number."),(!h.stops||h.stops.length===0)&&d.push("Halo `stops` property is not an array."),(a=h.stops)!=null&&a.some(w=>typeof w[0]!="number"||typeof w[1]!="string")&&d.push("Halo `stops` property is not an array of [number, string]"),d}function $S(){const h="color: #3A1888; background: white; padding: 5px 0; font-weight: bold;",a="color: #FBC935; background: white; padding: 5px; font-weight: bold;",d="color: #F1175D; background: white; padding: 5px 0; font-weight: bold;";console.info(`%c%c%c %cMapTiler SDK JS v${rx()} %c%c%c`,a+"padding-right: 0;",h,d,"color: #333; background: white; padding: 5px 0; font-weight: bold;",d,h,a+"padding-left: 0;")}const qS={POINT:"POINT",COUNTRY:"COUNTRY"};let U0=class Z0 extends xt.Map{constructor(a){a.logSDKVersion!==!1&&$S(),Cw(a.container),a.apiKey&&(Tr.apiKey=a.apiKey);const{style:d,requiresUrlMonitoring:w,isFallback:S}=ov(a.style);S&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),Tr.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const A=location.hash;let b={compact:!1};a.customAttribution?b.customAttribution=a.customAttribution:a.attributionControl&&typeof a.attributionControl=="object"&&(b={...b,...a.attributionControl});const s={...a,style:d,maplibreLogo:!1,transformRequest:By(a.transformRequest),attributionControl:a.forceNoAttributionControl===!0?!1:b};delete s.style,super(s),mt(this,"telemetry"),mt(this,"space"),mt(this,"halo"),mt(this,"options"),mt(this,"isTerrainEnabled",!1),mt(this,"terrainExaggeration",1),mt(this,"primaryLanguage"),mt(this,"terrainGrowing",!1),mt(this,"terrainFlattening",!1),mt(this,"minimap"),mt(this,"forceLanguageUpdate"),mt(this,"languageAlwaysBeenStyle"),mt(this,"isReady",!1),mt(this,"terrainAnimationDuration",1e3),mt(this,"monitoredStyleUrls"),mt(this,"styleInProcess",!1),mt(this,"curentProjection"),mt(this,"originalLabelStyle",new window.Map),mt(this,"isStyleLocalized",!1),mt(this,"languageIsUpdated",!1),mt(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1,styleLoadedCallbackFired:!1}),this.options=a,this.setStyle(d),w&&this.monitorStyleUrl(d);const F=()=>{let ge="The distant style could not be loaded.";this.getStyle()?ge+=" Leaving the style as is.":(this.setStyle(Cc.STREETS),ge+=`Loading default MapTiler Cloud style "${Cc.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(ge)};if(this.on("style.load",()=>{this.styleInProcess=!1,(typeof a.rtlTextPlugin=="string"||typeof a.rtlTextPlugin>"u")&&Mw(a.rtlTextPlugin)}),this.on("error",ge=>{if(ge.error instanceof xt.AJAXError){const Me=ge.error.url,be=new URL(Me);be.search="";const me=be.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(me)&&(this.monitoredStyleUrls.delete(me),F());return}if(this.styleInProcess){F();return}}),Tr.caching&&!_m&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),Tr.caching&&_m&&Pw(),typeof a.language>"u")this.primaryLanguage=Tr.primaryLanguage;else{const ge=Ay(a.language,ui);this.primaryLanguage=ge??Tr.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===ui.STYLE||this.primaryLanguage===ui.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===ui.STYLE,this.terrainExaggeration=a.terrainExaggeration??this.terrainExaggeration,this.curentProjection=a.projection,this.on("style.load",ge=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!a.geolocate||a.center||a.hash&&A)return;try{if(a.geolocate===qS.COUNTRY){await this.fitToIpBounds();return}}catch(Me){console.warn(Me.message)}let ge;try{await this.centerOnIpPoint(a.zoom),ge=this.getCameraHash()}catch(Me){console.warn(Me.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(Me=>{ge===this.getCameraHash()&&(this.terrain?this.easeTo({center:[Me.coords.longitude,Me.coords.latitude],zoom:a.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[Me.coords.longitude,Me.coords.latitude],zoom:a.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let ge={logo:null};try{const Me=Object.keys(this.style.tileManagers).map(me=>this.getSource(me)).filter(me=>me&&"url"in me&&typeof me.url=="string"&&me.url.includes("tiles.json")),be=new URL(Me[0].url);be.searchParams.has("key")||be.searchParams.append("key",Tr.apiKey),ge=await(await fetch(be.href)).json()}catch{}if(a.customControls){const Me="[data-maptiler-control-group]",be="[data-maptiler-control]",me=ke=>{let $e=ke.dataset.maptilerControl;return($e==="true"||$e==="")&&($e=void 0),$e},nt=ke=>ke.dataset.maptilerPosition;let Ke=[...this._container.ownerDocument.querySelectorAll(Me)],Je=[...this._container.ownerDocument.querySelectorAll(be)].filter(ke=>ke.closest(Me)===null);if(typeof a.customControls=="string"){const ke=a.customControls;Ke=Ke.filter($e=>$e.matches(ke)||$e.closest(ke)!==null),Je=Je.filter($e=>$e.matches(ke)||$e.closest(ke)!==null)}for(const ke of Ke){const $e=new Mm(ke);this.addControl($e,nt(ke));for(const ht of ke.querySelectorAll(be))$e.configureGroupItem(ht,me(ht))}for(const ke of Je)this.addControl(new Mm(ke,me(ke)),nt(ke));const Ue=()=>{const{lng:ke,lat:$e}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(ke)),this._container.style.setProperty("--maptiler-center-lat",String($e)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};Ue(),this.on("render",Ue)}if(a.forceNoAttributionControl!==!0)if("logo"in ge&&ge.logo){const Me=ge.logo;this.addControl(new zy({logoURL:Me}),a.logoPosition)}else a.maptilerLogo&&this.addControl(new zy,a.logoPosition);if(a.scaleControl){const Me=a.scaleControl===!0||a.scaleControl===void 0?"bottom-right":a.scaleControl,be=new _w({unit:Tr.unit});this.addControl(be,Me),Tr.on("unit",me=>{be.setUnit(me)})}if(a.navigationControl!==!1){const Me=a.navigationControl===!0||a.navigationControl===void 0?"top-right":a.navigationControl;this.addControl(new eS,Me)}if(a.geolocateControl!==!1){const Me=a.geolocateControl===!0||a.geolocateControl===void 0?"top-right":a.geolocateControl;this.addControl(new iS({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),Me)}if(a.terrainControl){const Me=a.terrainControl===!0||a.terrainControl===void 0?"top-right":a.terrainControl;this.addControl(new QT,Me)}if(a.projectionControl){const Me=a.projectionControl===!0||a.projectionControl===void 0?"top-right":a.projectionControl;this.addControl(new nS,Me)}if(a.fullscreenControl){const Me=a.fullscreenControl===!0||a.fullscreenControl===void 0?"top-right":a.fullscreenControl;this.addControl(new yw({}),Me)}this.isReady=!0,this.fire("ready",{target:this})});let $=!1,Q=!1,oe;this.once("ready",()=>{$=!0,Q&&this.fire("loadWithTerrain",oe)}),this.once("style.load",()=>{const{minimap:ge}=a;if(typeof ge=="object"){const{zoom:Me,center:be,style:me,language:nt,apiKey:Ke,maptilerLogo:Je,canvasContextAttributes:Ue,refreshExpiredTiles:ke,maxBounds:$e,scrollZoom:ht,minZoom:wt,maxZoom:Vt,boxZoom:Pt,locale:ei,fadeDuration:mi,crossSourceCollisions:Gr,clickTolerance:Pr,bounds:lo,fitBoundsOptions:gr,pixelRatio:hr,validateStyle:It}=a;this.minimap=new nm(ge,{zoom:Me,center:be,style:me,language:nt,apiKey:Ke,container:"null",maptilerLogo:Je,canvasContextAttributes:Ue,refreshExpiredTiles:ke,maxBounds:$e,scrollZoom:ht,minZoom:wt,maxZoom:Vt,boxZoom:Pt,locale:ei,fadeDuration:mi,crossSourceCollisions:Gr,clickTolerance:Pr,bounds:lo,fitBoundsOptions:gr,pixelRatio:hr,validateStyle:It}),this.addControl(this.minimap,ge.position??"bottom-left")}else ge===!0?(this.minimap=new nm({},a),this.addControl(this.minimap,"bottom-left")):ge!==void 0&&ge!==!1&&(this.minimap=new nm({},a),this.addControl(this.minimap,ge))});const xe=ge=>{ge.terrain&&(Q=!0,oe={type:"loadWithTerrain",target:this,terrain:ge.terrain},this.off("terrain",xe),$&&this.fire("loadWithTerrain",oe))};this.on("terrain",xe),a.terrain&&this.enableTerrain(a.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",Me=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",Me)});const ge=this.getLayersOrder()[0];a.space&&this.initSpace({options:a,before:ge}),a.halo&&this.initHalo({options:a,before:ge})}),this.telemetry=new oS(this)}getSpace(){return this.space}setSpace(a,d=!0){if(d&&(this.options.space=a),a===!1){this.space=void 0;return}if(this.space){this.space.setCubemap(a),this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]);return}this.space=new um(a),this.once("load",()=>{const w=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,w)})}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(a){this.halo?this.halo.setAnimationActive(a):this.once("load",()=>{var d;(d=this.halo)==null||d.setAnimationActive(a)})}setSpaceAnimationActive(a){this.space?this.space.setAnimationActive(a):this.once("load",()=>{var d;(d=this.space)==null||d.setAnimationActive(a)})}setSpaceFromStyle({style:a}){var d,w,S,A,b;if(this.options.space===!1)return;if(this.options.space!==!0&&Im(this.options.space)){this.setSpace(this.options.space);return}const s=(w=(d=a.metadata)==null?void 0:d.maptiler)==null?void 0:w.space,F=Im(s);if(JSON.stringify((S=this.space)==null?void 0:S.getConfig())===JSON.stringify(s)){if(this.space&&!this.getLayer(this.space.id)){const $=this.getLayersOrder()[0];this.addLayer(this.space,$)}return}if(F){this.setSpace(s,!1);return}if(this.options.space===!0){this.setSpace(!0);return}if((A=this.space)!=null&&A.getConfig()&&s===void 0){this.setSpace({color:"transparent"},!1),this.removeLayer(((b=this.space)==null?void 0:b.id)??"");return}if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const $=this.getLayersOrder()[0];this.addLayer(this.space,$)}this.space.setCubemap(s)}}setHaloFromStyle({style:a}){var d,w,S;if(this.options.halo===!1)return;const A=(d=a.metadata)==null?void 0:d.maptiler;if(JSON.stringify((w=this.halo)==null?void 0:w.getConfig())===JSON.stringify(A?.halo)){if(this.halo&&!this.getLayer(this.halo.id)){const b=this.getLayersOrder().indexOf(((S=this.space)==null?void 0:S.id)??"")+1,s=this.getLayersOrder()[b];this.addLayer(this.halo,s)}return}if(!(A!=null&&A.halo)&&!this.options.halo){this.setHalo({stops:[[0,"transparent"],[.01,"transparent"]],scale:1});return}(()=>{var b;if(this.halo){if(!this.getLayer(this.halo.id)){const F=this.getLayersOrder().indexOf(((b=this.space)==null?void 0:b.id)??"")+1,$=this.getLayersOrder()[F];this.addLayer(this.halo,$)}const s=A?.halo??this.options.halo;s&&this.halo.setGradient(s)}})()}initSpace({options:a=this.options,before:d,spec:w}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,d);return}if(a.space===!1)return;if(a.space){this.space=new um(a.space),this.addLayer(this.space,d);return}const S=w;S&&(this.space=new um(S),this.addLayer(this.space,d))}initHalo({options:a=this.options,before:d,spec:w}){if(this.halo&&this.getLayer(this.halo.id)||a.halo===!1)return;const S=w;if(a.halo){this.halo=new cm(a.halo),this.addLayer(this.halo,d);return}S&&(this.halo=new cm(S),this.addLayer(this.halo,d))}getHalo(){return this.halo}setHalo(a){if(this.options.halo=a,!!this.isGlobeProjection()){if(this.halo){this.halo.setGradient(a);return}this.halo=new cm(a),this.once("load",()=>{var d;const w=this.getLayersOrder(),S=w[0],A=w.indexOf(((d=this.space)==null?void 0:d.id)??"")+2,b=w[A];this.halo&&this.addLayer(this.halo,this.space?b:S)})}}recreate(){const a={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new Z0({...this.options})),this.once("load",()=>{this.jumpTo(a)})}setTerrainAnimationDuration(a){this.terrainAnimationDuration=Math.max(a,0)}async onLoadAsync(){return new Promise(a=>{if(this.loaded()){a(this);return}this.once("load",()=>{a(this)})})}async onReadyAsync(){return new Promise(a=>{if(this.isReady){a(this);return}this.once("ready",()=>{a(this)})})}async onLoadWithTerrainAsync(){return new Promise(a=>{if(this.isReady&&this.terrain){a(this);return}this.once("loadWithTerrain",()=>{a(this)})})}monitorStyleUrl(a){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const d=new URL(a);d.search="",this.monitoredStyleUrls.add(d.href)}setStyle(a,d){var w,S,A,b,s;this.originalLabelStyle.clear(),(w=this.minimap)==null||w.setStyle(a),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const F=ov(a);if(F.requiresUrlMonitoring&&this.monitorStyleUrl(F.style),F.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}this.spaceboxLoadingState.styleLoadedCallbackFired=!1,this.spaceboxLoadingState.styleLoadCallbackSet=!1;const $=this.getStyle(),Q=F.style;try{super.setStyle(F.style,{...d,diff:typeof F.style!="string"}),this.styleInProcess=!0}catch(ge){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",ge)}const oe=()=>{const ge=F.style;if(!ge.projection||ge.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:F.style}),this.setHaloFromStyle({style:F.style})},xe=ge=>{var Me,be,me,nt;const Ke=ge?.target.getStyle()??F.style;if(!this.spaceboxLoadingState.styleLoadedCallbackFired&&(this.spaceboxLoadingState.styleLoadedCallbackFired=!0,this.spaceboxLoadingState.styleLoadCallbackSet=!1,typeof Ke!="string"))try{const Je=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:Ke}):this.initSpace({before:Je,spec:(be=(Me=Ke.metadata)==null?void 0:Me.maptiler)==null?void 0:be.space}),this.halo?this.setHaloFromStyle({style:Ke}):this.initHalo({before:Je,spec:(nt=(me=Ke.metadata)==null?void 0:me.maptiler)==null?void 0:nt.halo})}catch(Je){console.error(Je)}};return typeof F.style=="string"||F.requiresUrlMonitoring?(this.once("style.load",xe),this):(requestIdleCallback(()=>{try{xe()}catch(ge){console.error(ge)}}),this.spaceboxLoadingState.styleLoadCallbackSet?((S=$?.terrain)==null?void 0:S.source)!==((A=Q?.terrain)==null?void 0:A.source)||((b=$?.terrain)==null?void 0:b.exaggeration)!==((s=Q?.terrain)==null?void 0:s.exaggeration)?(this.once("terrain",oe),this):this:(this.once("style.load",xe),this.once("projection.change",xe),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this))}addLayer(a,d){var w;return(w=this.minimap)==null||w.addLayer(a,d),super.addLayer(a,d)}moveLayer(a,d){var w;return(w=this.minimap)==null||w.moveLayer(a,d),super.moveLayer(a,d)}removeLayer(a){var d;return(d=this.minimap)==null||d.removeLayer(a),super.removeLayer(a)}setLayerZoomRange(a,d,w){var S;return(S=this.minimap)==null||S.setLayerZoomRange(a,d,w),super.setLayerZoomRange(a,d,w)}setFilter(a,d,w){var S;return(S=this.minimap)==null||S.setFilter(a,d,w),super.setFilter(a,d,w)}setPaintProperty(a,d,w,S){var A;return(A=this.minimap)==null||A.setPaintProperty(a,d,w,S),super.setPaintProperty(a,d,w,S)}setLayoutProperty(a,d,w,S){var A;return(A=this.minimap)==null||A.setLayoutProperty(a,d,w,S),super.setLayoutProperty(a,d,w,S)}setGlyphs(a,d){var w;return(w=this.minimap)==null||w.setGlyphs(a,d),super.setGlyphs(a,d)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?fm(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(a){var d;(d=this.minimap)==null||d.map.setLanguage(a),this.onStyleReady(()=>{this.setPrimaryLanguage(a)})}setPrimaryLanguage(a){const d=this.getStyleLanguage(),w=Ay(a,ui);if(!w){console.warn(`The language "${w}" is not supported.`);return}if(!(w.flag===ui.STYLE.flag&&d&&(d.flag===ui.AUTO.flag||d.flag===ui.VISITOR.flag))&&(w.flag!==ui.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===w&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===ui.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=w;let S=w;if(w.flag===ui.STYLE.flag){if(!d){console.warn("The style has no default languages or has an invalid one.");return}S=d}let A=ui.LOCAL.flag,b=["get",A];S.flag===ui.VISITOR.flag?(A=ky().flag,b=["case",["all",["has",A],["has",ui.LOCAL.flag]],["case",["==",["get",A],["get",ui.LOCAL.flag]],["get",ui.LOCAL.flag],["format",["get",A],{"font-scale":.8},`
`,["get",ui.LOCAL.flag],{"font-scale":1.1}]],["get",ui.LOCAL.flag]]):S.flag===ui.VISITOR_ENGLISH.flag?(A=ui.ENGLISH.flag,b=["case",["all",["has",A],["has",ui.LOCAL.flag]],["case",["==",["get",A],["get",ui.LOCAL.flag]],["get",ui.LOCAL.flag],["format",["get",A],{"font-scale":.8},`
`,["get",ui.LOCAL.flag],{"font-scale":1.1}]],["get",ui.LOCAL.flag]]):S.flag===ui.AUTO.flag?(A=ky().flag,b=["coalesce",["get",A],["get",ui.LOCAL.flag]]):S===ui.LOCAL?(A=ui.LOCAL.flag,b=["get",A]):(A=S.flag,b=["coalesce",["get",A],["get",ui.LOCAL.flag]]);const{layers:s}=this.getStyle(),F=this.originalLabelStyle.size===0;if(F){const $=Bw(s,this);this.isStyleLocalized=Object.keys($.localized).length>0}for(const $ of s){if($.type!=="symbol")continue;const Q=$,oe=this.getSource(Q.source);if(!oe||!("url"in oe&&typeof oe.url=="string")||new URL(oe.url).host!==Hn.maptilerApiHost)continue;const{id:xe,layout:ge}=Q;if(!ge||!("text-field"in ge))continue;let Me;if(F?(Me=this.getLayoutProperty(xe,"text-field"),this.originalLabelStyle.set(xe,Me)):Me=this.originalLabelStyle.get(xe),typeof Me=="string"){const{contains:be,exactMatch:me}=kw(Me,this.isStyleLocalized);if(!be)continue;if(me)this.setLayoutProperty(xe,"text-field",b);else{const nt=zw(Me,b,this.isStyleLocalized);this.setLayoutProperty(xe,"text-field",nt)}}else{const be=Lw(Me,b,this.isStyleLocalized);this.setLayoutProperty(xe,"text-field",be)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(a){if(!this.terrain)return;const d=performance.now(),w=this.terrain.exaggeration,S=a-w,A=()=>{if(!this.terrain||this.terrainFlattening)return;const b=(performance.now()-d)/this.terrainAnimationDuration;if(b<.99){const s=1-(1-b)**4,F=w+s*S;this.terrain.exaggeration=F,requestAnimationFrame(A)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=a,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(A)}enableTerrain(a=this.terrainExaggeration){if(a<0){console.warn("Terrain exaggeration cannot be negative.");return}const d=S=>{!this.terrain||S.type!=="data"||S.dataType!=="source"||!("source"in S)||S.sourceId!=="maptiler-terrain"||S.source.type!=="raster-dem"||S.isSourceLoaded&&(this.off("data",d),this.growTerrain(a))},w=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=a,this.on("data",d),this.addSource(Hn.terrainSourceId,{type:"raster-dem",url:Hn.terrainSourceURL}),this.setTerrain({source:Hn.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(a);return}if(this.loaded()||this.isTerrainEnabled)w();else{const S=()=>{this.getTerrain()&&this.getSource(Hn.terrainSourceId)||w()};this.once("load",()=>{S()}),this.once("moveend",()=>{S()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const a=performance.now(),d=this.terrain.exaggeration,w=()=>{if(!this.terrain||this.terrainGrowing)return;const S=(performance.now()-a)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,S<.99){const A=(1-S)**4,b=d*A;this.terrain.exaggeration=b,requestAnimationFrame(w)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(Hn.terrainSourceId)&&this.removeSource(Hn.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(w)}setTerrainExaggeration(a,d=!0){!d&&this.terrain?(this.terrainExaggeration=a,this.terrain.exaggeration=a,this.triggerRepaint()):this.enableTerrain(a)}onStyleReady(a){this.isStyleLoaded()?a():this.once("styledata",()=>{a()})}async fitToIpBounds(){const a=await Cy.info();this.fitBounds(a.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(a){const d=await Cy.info();this.jumpTo({center:[d.longitude??0,d.latitude??0],zoom:a||11})}getCameraHash(){const a=new Float32Array(5),d=this.getCenter();return a[0]=d.lng,a[1]=d.lat,a[2]=this.getZoom(),a[3]=this.getPitch(),a[4]=this.getBearing(),G1.fromUint8Array(new Uint8Array(a.buffer))}getSdkConfig(){return Tr}getMaptilerSessionId(){return Om}setTransformRequest(a){return super.setTransformRequest(By(a)),this}getProjection(){const a=this.style.getProjection();return!a===void 0&&this.style.projection?{type:this.style.projection.name}:a}isGlobeProjection(){const a=this.getProjection();return a?a.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}setProjection(a){return this.fire("projection.change",{target:this,projection:a}),super.setProjection(a)}isLanguageUpdated(){return this.languageIsUpdated}};const{Evented:kP}=xt,{Evented:zP}=xt;function sg(h){if(typeof DOMParser<"u"){const a=new DOMParser().parseFromString(h,"application/xml");if(a.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return a}throw new Error("No XML parser found")}function G0(h,a){if(!h.hasChildNodes())return!1;for(const d of Array.from(h.childNodes)){const w=d.nodeName;if(typeof w=="string"&&w.trim().toLowerCase()===a.toLowerCase())return!0}return!1}function Pv(h){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(h);throw new Error("No XML serializer found")}function $0(h){const a=typeof h=="string"?sg(h):h;if(!G0(a,"gpx"))throw new Error("The XML document is not valid GPX");const d=pn(a,"trk"),w=pn(a,"rte"),S=pn(a,"wpt"),A={type:"FeatureCollection",features:[]};for(const b of Array.from(d)){const s=YS(b);s&&A.features.push(s)}for(const b of Array.from(w)){const s=KS(b);s&&A.features.push(s)}for(const b of Array.from(S))A.features.push(JS(b));return A}function q0(h,a){let d=h;if(typeof d=="string"&&(d=sg(d)),!G0(d,"kml"))throw new Error("The XML document is not valid KML");const w={type:"FeatureCollection",features:[]},S={},A={},b={},s=pn(d,"Placemark"),F=pn(d,"Style"),$=pn(d,"StyleMap");for(const Q of Array.from(F)){const oe=Iv(Pv(Q)).toString(16);S[`#${Su(Q,"id")}`]=oe,A[oe]=Q}for(const Q of Array.from($)){S[`#${Su(Q,"id")}`]=Iv(Pv(Q)).toString(16);const oe=pn(Q,"Pair"),xe={};for(const ge of Array.from(oe))xe[Ei(Ut(ge,"key"))??""]=Ei(Ut(ge,"styleUrl"));b[`#${Su(Q,"id")}`]=xe}for(const Q of Array.from(s))w.features=w.features.concat(XS(Q,S,A,b));return w}function Mv(h){if(h===null)return["#000000",1];let a="",d=1,w=h;return w.startsWith("#")&&(w=w.substring(1)),(w.length===6||w.length===3)&&(a=w),w.length===8&&(d=Number.parseInt(w.substring(0,2),16)/255,a=`#${w.substring(6,8)}${w.substring(4,6)}${w.substring(2,4)}`),[a??"#000000",d??1]}function WS(h){return X0(h.split(" "))}function HS(h){let a=pn(h,"coord");const d=[],w=[];a.length===0&&(a=pn(h,"gx:coord"));for(const A of Array.from(a))d.push(WS(Ei(A)??""));const S=pn(h,"when");for(const A of Array.from(S))w.push(Ei(A));return{coords:d,times:w}}function md(h){const a=["Polygon","LineString","Point","Track","gx:Track"];let d,w,S,A,b;const s=[],F=[];if(Ut(h,"MultiGeometry")!==null)return md(Ut(h,"MultiGeometry"));if(Ut(h,"MultiTrack")!==null)return md(Ut(h,"MultiTrack"));if(Ut(h,"gx:MultiTrack")!==null)return md(Ut(h,"gx:MultiTrack"));for(S=0;S<a.length;S++)if(w=pn(h,a[S]),w){for(A=0;A<w.length;A++)if(d=w[A],a[S]==="Point")s.push({type:"Point",coordinates:Y0(Ei(Ut(d,"coordinates"))??"")});else if(a[S]==="LineString")s.push({type:"LineString",coordinates:Ev(Ei(Ut(d,"coordinates"))??"")});else if(a[S]==="Polygon"){const $=pn(d,"LinearRing"),Q=[];for(b=0;b<$.length;b++)Q.push(Ev(Ei(Ut($[b],"coordinates"))??""));s.push({type:"Polygon",coordinates:Q})}else if(a[S]==="Track"||a[S]==="gx:Track"){const $=HS(d);s.push({type:"LineString",coordinates:$.coords}),$.times.length&&F.push($.times)}}return{geoms:s,coordTimes:F}}function XS(h,a,d,w){const S=md(h),A={},b=Ei(Ut(h,"name")),s=Ei(Ut(h,"address")),F=Ei(Ut(h,"description")),$=Ut(h,"TimeSpan"),Q=Ut(h,"TimeStamp"),oe=Ut(h,"ExtendedData"),xe=Ut(h,"visibility");let ge,Me=Ei(Ut(h,"styleUrl")),be=Ut(h,"LineStyle"),me=Ut(h,"PolyStyle");if(!S.geoms.length)return[];if(b&&(A.name=b),s&&(A.address=s),Me){Me.startsWith("#")||(Me=`#${Me}`),A.styleUrl=Me,a[Me]&&(A.styleHash=a[Me]),w[Me]&&(A.styleMapHash=w[Me],A.styleHash=a[w[Me].normal??""]);const Ke=d[A.styleHash??""];if(Ke){be||(be=Ut(Ke,"LineStyle")),me||(me=Ut(Ke,"PolyStyle"));const Je=Ut(Ke,"IconStyle");if(Je){const Ue=Ut(Je,"Icon");if(Ue){const ke=Ei(Ut(Ue,"href"));ke&&(A.icon=ke)}}}}if(F&&(A.description=F),$){const Ke=Ei(Ut($,"begin")),Je=Ei(Ut($,"end"));Ke&&Je&&(A.timespan={begin:Ke,end:Je})}if(Q!==null&&(A.timestamp=Ei(Ut(Q,"when"))??new Date().toISOString()),be!==null){const Ke=Mv(Ei(Ut(be,"color"))),Je=Ke[0],Ue=Ke[1],ke=Number.parseFloat(Ei(Ut(be,"width"))??"");Je&&(A.stroke=Je),Number.isNaN(Ue)||(A["stroke-opacity"]=Ue),Number.isNaN(ke)||(A["stroke-width"]=ke)}if(me){const Ke=Mv(Ei(Ut(me,"color"))),Je=Ke[0],Ue=Ke[1],ke=Ei(Ut(me,"fill")),$e=Ei(Ut(me,"outline"));Je&&(A.fill=Je),Number.isNaN(Ue)||(A["fill-opacity"]=Ue),ke&&(A["fill-opacity"]=ke==="1"?A["fill-opacity"]||1:0),$e&&(A["stroke-opacity"]=$e==="1"?A["stroke-opacity"]||1:0)}if(oe){const Ke=pn(oe,"Data"),Je=pn(oe,"SimpleData");for(ge=0;ge<Ke.length;ge++)A[Ke[ge].getAttribute("name")??""]=Ei(Ut(Ke[ge],"value"))??"";for(ge=0;ge<Je.length;ge++)A[Je[ge].getAttribute("name")??""]=Ei(Je[ge])??""}xe!==null&&(A.visibility=Ei(xe)??""),S.coordTimes.length!==0&&(A.coordTimes=S.coordTimes.length===1?S.coordTimes[0]:S.coordTimes);const nt={type:"Feature",geometry:S.geoms.length===1?S.geoms[0]:{type:"GeometryCollection",geometries:S.geoms},properties:A};return Su(h,"id")&&(nt.id=Su(h,"id")??void 0),[nt]}function W0(h,a){const d=pn(h,a),w=[],S=[];let A=[];const b=d.length;if(!(b<2)){for(let s=0;s<b;s++){const F=K0(d[s]);w.push(F.coordinates),F.time&&S.push(F.time),(F.heartRate||A.length)&&(A.length===0&&(A=new Array(s).fill(null)),A.push(F.heartRate))}return{line:w,times:S,heartRates:A}}}function YS(h){const a=pn(h,"trkseg"),d=[],w=[],S=[];let A;for(let s=0;s<a.length;s++)if(A=W0(a[s],"trkpt"),A!==void 0&&(A.line&&d.push(A.line),A.times&&A.times.length&&w.push(A.times),S.length||A.heartRates&&A.heartRates.length)){if(!S.length)for(let F=0;F<s;F++)S.push(new Array(d[F].length).fill(null));A.heartRates&&A.heartRates.length?S.push(A.heartRates):S.push(new Array(A.line.length).fill(null))}if(d.length===0)return;const b={...lg(h),...H0(Ut(h,"extensions"))};return w.length!==0&&(b.coordTimes=d.length===1?w[0]:w),S.length!==0&&(b.heartRates=d.length===1?S[0]:S),d.length===1?{type:"Feature",properties:b,geometry:{type:"LineString",coordinates:d[0]}}:{type:"Feature",properties:b,geometry:{type:"MultiLineString",coordinates:d}}}function KS(h){const a=W0(h,"rtept");return a===void 0?void 0:{type:"Feature",properties:{...lg(h),...H0(Ut(h,"extensions"))},geometry:{type:"LineString",coordinates:a.line}}}function JS(h){return{type:"Feature",properties:{...lg(h),...Am(h,["sym"])},geometry:{type:"Point",coordinates:K0(h).coordinates}}}function H0(h){const a={};if(h){const d=Ut(h,"line");if(d){const w=Ei(Ut(d,"color")),S=Number.parseFloat(Ei(Ut(d,"opacity"))??"0"),A=Number.parseFloat(Ei(Ut(d,"width"))??"0");w&&(a.stroke=w),Number.isNaN(S)||(a["stroke-opacity"]=S),Number.isNaN(A)||(a["stroke-width"]=A*96/25.4)}}return a}function lg(h){const a=Am(h,["name","cmt","desc","type","time","keywords"]),d=pn(h,"link");if(d.length!==0){a.links=[];for(const w of Array.from(d)){const S={href:Su(w,"href"),...Am(w,["text","type"])};a.links.push(S)}}return a}function Iv(h){let a=0;if(!h||!h.length)return a;for(let d=0;d<h.length;d++)a=(a<<5)-a+h.charCodeAt(d)|0;return a}function pn(h,a){return h.getElementsByTagName(a)}function Su(h,a){return h.getAttribute(a)}function Av(h,a){return Number.parseFloat(Su(h,a)??"0")}function Ut(h,a){const d=pn(h,a);return d.length?d[0]:null}function QS(h){return h.normalize&&h.normalize(),h}function X0(h){return h.map(Number.parseFloat).map(a=>Number.isNaN(a)?null:a)}function Ei(h){return h&&QS(h),h&&h.textContent}function Am(h,a){const d={};let w,S;for(S=0;S<a.length;S++)w=Ut(h,a[S]),w&&(d[a[S]]=Ei(w)??"");return d}function Y0(h){return X0(h.replace(/\s*/g,"").split(","))}function Ev(h){const a=h.replace(/^\s*|\s*$/g,"").split(/\s+/),d=[];for(const w of a)d.push(Y0(w));return d}function K0(h){const a=[Av(h,"lon"),Av(h,"lat")],d=Ut(h,"ele"),w=Ut(h,"gpxtpx:hr")||Ut(h,"hr"),S=Ut(h,"time");let A;return d&&(A=Number.parseFloat(Ei(d)??"0"),Number.isNaN(A)||a.push(A)),{coordinates:a,time:S?Ei(S):null,heartRate:w!==null?Number.parseFloat(Ei(w)??"0"):null}}function eP(h){let a=h;try{typeof a=="string"&&(a=sg(a))}catch{return null}try{return $0(a)}catch{}try{return q0(a)}catch{}return null}async function tP(h,a={}){const d=a.download??!1,w=await iP(h);if(d){const S=a.filename??"maptiler_screenshot.png",A=document.createElement("a");A.style.display="none",document.body.appendChild(A),A.href=URL.createObjectURL(w),A.download=S,A.click(),setTimeout(()=>{document.body.removeChild(A),URL.revokeObjectURL(A.href)},0)}return w}function iP(h){return new Promise((a,d)=>{h.redraw(),h.once("idle",()=>{h.getCanvas().toBlob(w=>{if(!w){d(Error("Screenshot could not be created."));return}a(w)},"image/png")})})}const Em=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function Zd(){return Em[~~(Math.random()*Em.length)][~~(Math.random()*4)]}function op(){return`maptiler_source_${Kv()}`}function ap(){return`maptiler_layer_${Kv()}`}function Cm(h,a){if(a<=h[0].zoom)return h[0].value;if(a>=h[h.length-1].zoom)return h[h.length-1].value;for(let d=0;d<h.length-1;d+=1)if(a>=h[d].zoom&&a<h[d+1].zoom){const w=h[d+1].zoom-h[d].zoom,S=(a-h[d].zoom)/w;return S*h[d+1].value+(1-S)*h[d].value}return 0}function kl(h){return["interpolate",["linear"],["zoom"],...h.flatMap(a=>[a.zoom,a.value])]}function Pi(h){return["interpolate",["linear"],["zoom"],...h.flatMap(a=>[a.zoom,a.value])]}function J0(h,a){if(typeof a=="number"&&typeof h=="number")return 2*a+h;if(typeof a=="number"&&Array.isArray(h))return["interpolate",["linear"],["zoom"],...h.flatMap(d=>[d.zoom,2*a+d.value])];if(typeof h=="number"&&Array.isArray(a))return["interpolate",["linear"],["zoom"],...a.flatMap(d=>[d.zoom,2*d.value+h])];if(Array.isArray(h)&&Array.isArray(a)){const d=Array.from(new Set([...h.map(w=>w.zoom),...a.map(w=>w.zoom)])).sort((w,S)=>w<S?-1:1);return["interpolate",["linear"],["zoom"],...d.flatMap(w=>[w,2*Cm(a,w)+Cm(h,w)])]}return 0}function Q0(h,a){return["interpolate",["linear"],["get",a],...h.flatMap(d=>[d.propertyValue,d.value])]}function ug(h){const a=h.trimStart(),d=`${a}${" ".repeat(h.length-a.length)}`,w=Array.from(d);if(!w.every(A=>A===" "||A==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(w.some(A=>A==="_")&&w.some(A=>A===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const S=[1];for(let A=1;A<w.length;A+=1){const b=w[A-1],s=w[A];b===s?S[S.length-1]+=1:S.push(1)}return S}function Lm(h,a){return["interpolate",["linear"],["get",a],...h.flatMap(d=>[d.value,d.color])]}function km(h,a,d=!0){return d?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.value,w.pointRadius*.025])],2,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.value,w.pointRadius*.05])],4,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.value,w.pointRadius*.1])],8,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.value,w.pointRadius*.25])],16,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.value,w.pointRadius])]]:["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.value,w.pointRadius])]}function ex(h,a,d=!0){return d?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.propertyValue,w.value*.025])],2,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.propertyValue,w.value*.05])],4,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.propertyValue,w.value*.1])],8,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.propertyValue,w.value*.25])],16,["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.propertyValue,w.value])]]:["interpolate",["linear"],["get",a],...h.flatMap(w=>[w.propertyValue,w.value])]}function zm(h,a){return h.every(d=>d.color[3]===h[0].color[3])?h[0].color[3]?h[0].color[3]/255:1:["interpolate",["linear"],["get",a],...h.getRawColorStops().flatMap(d=>{const w=d.value,S=d.color;return[w,S.length===4?S[3]/255:1]})]}function tx(h,a=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:a+1},(d,w)=>{const S=w/a;return[S,h.getColorHex(S)]}).flat()]}function sd(h){const a=h.toString(16);return a.length===1?`0${a}`:a}function rP(h){return`#${sd(h[0])}${sd(h[1])}${sd(h[2])}${h.length===4?sd(h[3]):""}`}class Mt extends Array{constructor(a={}){super(),mt(this,"min",0),mt(this,"max",1),"min"in a&&(this.min=a.min),"max"in a&&(this.max=a.max),"stops"in a&&this.setStops(a.stops,{clone:!1})}static fromArrayDefinition(a){return new Mt({stops:a.map(d=>({value:d[0],color:d[1]}))})}setStops(a,d={clone:!0}){const w=d.clone?this.clone():this;w.length=0;let S=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY;for(let b=0;b<a.length;b+=1)S=Math.min(S,a[b].value),A=Math.max(A,a[b].value),w.push({value:a[b].value,color:a[b].color.slice()});return w.sort((b,s)=>b.value<s.value?-1:1),this.min=S,this.max=A,w}scale(a,d,w={clone:!0}){const S=w.clone,A=this[0].value,b=this.at(-1).value-A,s=d-a,F=[];for(let $=0;$<this.length;$+=1){const Q=(this[$].value-A)/b*s+a;S?F.push({value:Q,color:this[$].color.slice()}):this[$].value=Q}return S?new Mt({stops:F}):this}at(a){return a<0?this[this.length+a]:this[a]}clone(){return new Mt({stops:this.getRawColorStops()})}getRawColorStops(){const a=[];for(let d=0;d<this.length;d+=1)a.push({value:this[d].value,color:this[d].color});return a}reverse(a={clone:!0}){const d=a.clone?this.clone():this;for(let w=0;w<~~(d.length/2);w+=1){const S=d[w].color;d[w].color=d.at(-(w+1)).color,d.at(-(w+1)).color=S}return d}getBounds(){return{min:this.min,max:this.max}}getColor(a,d={smooth:!0}){if(a<=this[0].value)return this[0].color;if(a>=this.at(-1).value)return this.at(-1).color;for(let w=0;w<this.length-1;w+=1){if(a>this[w+1].value)continue;const S=this[w].color;if(!d.smooth)return S.slice();const A=this[w].value,b=this[w+1].value,s=this[w+1].color,F=(b-a)/(b-A);return S.map(($,Q)=>Math.round($*F+s[Q]*(1-F)))}return[0,0,0]}getColorHex(a,d={smooth:!0,withAlpha:!1}){return rP(this.getColor(a,d))}getColorRelative(a,d={smooth:!0}){const w=this.getBounds();return this.getColor(w.min+a*(w.max-w.min),d)}getCanvasStrip(a={horizontal:!0,size:512,smooth:!0}){const d=document.createElement("canvas");d.width=a.horizontal?a.size:1,d.height=a.horizontal?1:a.size;const w=d.getContext("2d");if(!w)throw new Error("Canvs context is missing");const S=w.getImageData(0,0,d.width,d.height),A=S.data,b=a.size,s=this[0].value,F=(this.at(-1).value-s)/b;for(let $=0;$<b;$+=1){const Q=this.getColor(s+$*F,{smooth:a.smooth});A[$*4]=Q[0],A[$*4+1]=Q[1],A[$*4+2]=Q[2],A[$*4+3]=Q.length>3?Q[3]:255}return w.putImageData(S,0,0),d}resample(a,d=15){const w=this.getBounds(),S=this.scale(0,1),A=1/(d-1);let b;if(a==="ease-in-square")b=Array.from({length:d},(s,F)=>{const $=F*A,Q=$**2,oe=S.getColor(Q);return{value:$,color:oe}});else if(a==="ease-out-square")b=Array.from({length:d},(s,F)=>{const $=F*A,Q=1-(1-$)**2,oe=S.getColor(Q);return{value:$,color:oe}});else if(a==="ease-out-sqrt")b=Array.from({length:d},(s,F)=>{const $=F*A,Q=$**.5,oe=S.getColor(Q);return{value:$,color:oe}});else if(a==="ease-in-sqrt")b=Array.from({length:d},(s,F)=>{const $=F*A,Q=1-(1-$)**.5,oe=S.getColor(Q);return{value:$,color:oe}});else if(a==="ease-out-exp")b=Array.from({length:d},(s,F)=>{const $=F*A,Q=1-2**(-10*$),oe=S.getColor(Q);return{value:$,color:oe}});else if(a==="ease-in-exp")b=Array.from({length:d},(s,F)=>{const $=F*A,Q=2**(10*$-10),oe=S.getColor(Q);return{value:$,color:oe}});else throw new Error("Invalid ressampling method.");return new Mt({stops:b}).scale(w.min,w.max)}transparentStart(){const a=this.getRawColorStops();a.unshift({value:a[0].value,color:a[0].color.slice()}),a[1].value+=.001;for(const d of a)d.color.length===3&&d.color.push(255);return a[0].color[3]=0,new Mt({stops:a})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}}const ix={NULL:new Mt({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new Mt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new Mt({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new Mt({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new Mt({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new Mt({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new Mt({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new Mt({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new Mt({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new Mt({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new Mt({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new Mt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new Mt({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new Mt({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new Mt({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new Mt({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new Mt({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new Mt({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new Mt({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new Mt({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new Mt({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new Mt({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new Mt({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new Mt({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new Mt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new Mt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new Mt({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new Mt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new Mt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new Mt({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new Mt({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new Mt({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new Mt({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new Mt({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new Mt({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new Mt({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new Mt({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new Mt({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new Mt({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new Mt({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new Mt({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new Mt({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new Mt({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new Mt({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new Mt({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new Mt({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new Mt({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new Mt({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new Mt({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};async function nP(h,a,d={}){var w,S;if(!a.sourceId&&!a.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let A=a.data;if(typeof A=="string"){if(Md(A))A=`https://api.maptiler.com/data/${a.data}/features.json?key=${Tr.apiKey}`;else if(((w=A.split(".").pop())==null?void 0:w.toLowerCase().trim())==="gpx"){const b=await(await fetch(A,d)).text();A=$0(b)}else if(((S=A.split(".").pop())==null?void 0:S.toLowerCase().trim())==="kml"){const b=await(await fetch(A,d)).text();A=q0(b)}else{const b=Aw(A)??eP(A);b&&(A=b)}if(!A)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return oP(h,{...a,data:A})}function oP(h,a){if(a.layerId&&h.getLayer(a.layerId))throw new Error(`A layer already exists with the layer id: ${a.layerId}`);const d=a.sourceId??op(),w=a.layerId??ap(),S={polylineLayerId:w,polylineOutlineLayerId:"",polylineSourceId:d};a.data&&!h.getSource(d)&&h.addSource(d,{type:"geojson",data:a.data});const A=a.lineWidth??3,b=a.lineColor??Zd(),s=a.lineOpacity??1,F=a.lineBlur??0,$=a.lineGapWidth??0;let Q=a.lineDashArray??null;const oe=a.outlineWidth??1,xe=a.outlineColor??"#FFFFFF",ge=a.outlineOpacity??1,Me=a.outlineBlur??0;if(typeof Q=="string"&&(Q=ug(Q)),a.outline===!0){const be=`${w}_outline`;S.polylineOutlineLayerId=be,h.addLayer({id:be,type:"line",source:d,layout:{"line-join":a.lineJoin??"round","line-cap":a.lineCap??"round"},minzoom:a.minzoom??0,maxzoom:a.maxzoom??23,paint:{"line-opacity":typeof ge=="number"?ge:Pi(ge),"line-color":typeof xe=="string"?xe:kl(xe),"line-width":J0(A,oe),"line-blur":typeof Me=="number"?Me:Pi(Me)}},a.beforeId)}return h.addLayer({id:w,type:"line",source:d,layout:{"line-join":a.lineJoin??"round","line-cap":a.lineCap??"round"},minzoom:a.minzoom??0,maxzoom:a.maxzoom??23,paint:{"line-opacity":typeof s=="number"?s:Pi(s),"line-color":typeof b=="string"?b:kl(b),"line-width":typeof A=="number"?A:Pi(A),"line-blur":typeof F=="number"?F:Pi(F),"line-gap-width":typeof $=="number"?$:Pi($),...Q&&{"line-dasharray":Q}}},a.beforeId),S}function aP(h,a){if(a.layerId&&h.getLayer(a.layerId))throw new Error(`A layer already exists with the layer id: ${a.layerId}`);const d=a.sourceId??op(),w=a.layerId??ap(),S={polygonLayerId:w,polygonOutlineLayerId:a.outline?`${w}_outline`:"",polygonSourceId:d};if(a.data&&!h.getSource(d)){let be=a.data;typeof be=="string"&&Md(be)&&(be=`https://api.maptiler.com/data/${be}/features.json?key=${Tr.apiKey}`),h.addSource(d,{type:"geojson",data:be})}let A=a.outlineDashArray??null;const b=a.outlineWidth??1,s=a.outlineColor??"#FFFFFF",F=a.outlineOpacity??1,$=a.outlineBlur??0,Q=a.fillColor??Zd(),oe=a.fillOpacity??1,xe=a.outlinePosition??"center",ge=a.pattern??null;typeof A=="string"&&(A=ug(A));const Me=(be=null)=>{if(h.addLayer({id:w,type:"fill",source:d,minzoom:a.minzoom??0,maxzoom:a.maxzoom??23,paint:{"fill-color":typeof Q=="string"?Q:kl(Q),"fill-opacity":typeof oe=="number"?oe:Pi(oe),...be&&{"fill-pattern":be}}},a.beforeId),a.outline===!0){let me;xe==="inside"?typeof b=="number"?me=.5*b:me=Pi(b.map(({zoom:nt,value:Ke})=>({zoom:nt,value:.5*Ke}))):xe==="outside"?typeof b=="number"?me=-.5*b:me=Pi(b.map(nt=>({zoom:nt.zoom,value:-.5*nt.value}))):me=0,h.addLayer({id:S.polygonOutlineLayerId,type:"line",source:d,layout:{"line-join":a.outlineJoin??"round","line-cap":a.outlineCap??"butt"},minzoom:a.minzoom??0,maxzoom:a.maxzoom??23,paint:{"line-opacity":typeof F=="number"?F:Pi(F),"line-color":typeof s=="string"?s:kl(s),"line-width":typeof b=="number"?b:Pi(b),"line-blur":typeof $=="number"?$:Pi($),"line-offset":me,...A&&{"line-dasharray":A}}},a.beforeId)}};return ge?h.hasImage(ge)?Me(ge):h.loadImage(ge).then(be=>{h.addImage(ge,be.data),Me(ge)}).catch(be=>{console.error("Could not load the pattern image.",be.message),Me()}):Me(),S}function sP(h,a){if(a.layerId&&h.getLayer(a.layerId))throw new Error(`A layer already exists with the layer id: ${a.layerId}`);const d=a.minPointRadius??10,w=a.maxPointRadius??50,S=a.cluster??!1,A=20,b=Array.isArray(a.pointColor)?a.pointColor:ix.TURBO.scale(10,a.cluster?1e4:1e3).resample("ease-out-square"),s=b.getBounds(),F=a.sourceId??op(),$=a.layerId??ap(),Q=a.showLabel??S,oe=a.alignOnViewport??!0,xe=a.outline??!1,ge=a.outlineOpacity??1,Me=a.outlineWidth??1,be=a.outlineColor??"#FFFFFF";let me;const nt=a.zoomCompensation??!0,Ke=a.minzoom??0,Je=a.maxzoom??23;typeof a.pointOpacity=="number"?me=a.pointOpacity:Array.isArray(a.pointOpacity)?me=Pi(a.pointOpacity):a.cluster?me=zm(b,"point_count"):a.property?me=zm(b,a.property):me=Pi([{zoom:Ke,value:0},{zoom:Ke+.25,value:1},{zoom:Je-.25,value:1},{zoom:Je,value:0}]);const Ue={pointLayerId:$,clusterLayerId:"",labelLayerId:"",pointSourceId:F};if(a.data&&!h.getSource(F)){let ke=a.data;typeof ke=="string"&&Md(ke)&&(ke=`https://api.maptiler.com/data/${ke}/features.json?key=${Tr.apiKey}`),h.addSource(F,{type:"geojson",data:ke,cluster:S})}if(S){Ue.clusterLayerId=`${$}_cluster`;const ke=Array.from({length:A},($e,ht)=>{const wt=s.min+ht*(s.max-s.min)/(A-1);return{value:wt,pointRadius:d+(w-d)*(ht/(A-1))**.5,color:b.getColorHex(wt)}});h.addLayer({id:Ue.clusterLayerId,type:"circle",source:F,filter:["has","point_count"],paint:{"circle-color":typeof a.pointColor=="string"?a.pointColor:Lm(ke,"point_count"),"circle-radius":typeof a.pointRadius=="number"?a.pointRadius:Array.isArray(a.pointRadius)?Pi(a.pointRadius):km(ke,"point_count",!1),"circle-pitch-alignment":oe?"viewport":"map","circle-pitch-scale":"map","circle-opacity":me,...xe&&{"circle-stroke-opacity":typeof ge=="number"?ge:Pi(ge),"circle-stroke-width":typeof Me=="number"?Me:Pi(Me),"circle-stroke-color":typeof be=="string"?be:kl(be)}},minzoom:Ke,maxzoom:Je},a.beforeId),h.addLayer({id:Ue.pointLayerId,type:"circle",source:F,filter:["!",["has","point_count"]],paint:{"circle-pitch-alignment":oe?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof a.pointColor=="string"?a.pointColor:b.getColorHex(b.getBounds().min),"circle-radius":typeof a.pointRadius=="number"?a.pointRadius:Array.isArray(a.pointRadius)?Pi(a.pointRadius):ke[0].pointRadius*.75,"circle-opacity":me,...xe&&{"circle-stroke-opacity":typeof ge=="number"?ge:Pi(ge),"circle-stroke-width":typeof Me=="number"?Me:Pi(Me),"circle-stroke-color":typeof be=="string"?be:kl(be)}},minzoom:Ke,maxzoom:Je},a.beforeId)}else{let ke=typeof a.pointColor=="string"?a.pointColor:Array.isArray(a.pointColor)?a.pointColor.getColorHex(a.pointColor.getBounds().min):Zd(),$e=typeof a.pointRadius=="number"?nt?Pi([{zoom:0,value:a.pointRadius*.025},{zoom:2,value:a.pointRadius*.05},{zoom:4,value:a.pointRadius*.1},{zoom:8,value:a.pointRadius*.25},{zoom:16,value:a.pointRadius*1}]):a.pointRadius:Array.isArray(a.pointRadius)?Pi(a.pointRadius):nt?Pi([{zoom:0,value:d*.05},{zoom:2,value:d*.1},{zoom:4,value:d*.2},{zoom:8,value:d*.5},{zoom:16,value:d*1}]):d;if(a.property&&Array.isArray(a.pointColor)){const ht=Array.from({length:A},(wt,Vt)=>{const Pt=s.min+Vt*(s.max-s.min)/(A-1);return{value:Pt,pointRadius:typeof a.pointRadius=="number"?a.pointRadius:d+(w-d)*(Vt/(A-1))**.5,color:typeof a.pointColor=="string"?a.pointColor:b.getColorHex(Pt)}});ke=Lm(ht,a.property),$e=km(ht,a.property,nt)}h.addLayer({id:Ue.pointLayerId,type:"circle",source:F,layout:{"circle-sort-key":a.property?["/",1,["get",a.property]]:0},paint:{"circle-pitch-alignment":oe?"viewport":"map","circle-pitch-scale":"map","circle-color":ke,"circle-opacity":me,"circle-radius":$e,...xe&&{"circle-stroke-opacity":typeof ge=="number"?ge:Pi(ge),"circle-stroke-width":typeof Me=="number"?Me:Pi(Me),"circle-stroke-color":typeof be=="string"?be:kl(be)}},minzoom:Ke,maxzoom:Je},a.beforeId)}if(Q!==!1&&(a.cluster||a.property)){Ue.labelLayerId=`${$}_label`;const ke=a.labelColor??"#fff",$e=a.labelSize??12;h.addLayer({id:Ue.labelLayerId,type:"symbol",source:F,filter:["has",a.cluster?"point_count":a.property],layout:{"text-field":a.cluster?"{point_count_abbreviated}":`{${a.property}}`,"text-font":["Noto Sans Regular"],"text-size":$e,"text-pitch-alignment":oe?"viewport":"map","symbol-sort-key":["/",1,["get",a.cluster?"point_count":a.property]]},paint:{"text-color":ke,"text-opacity":me},minzoom:Ke,maxzoom:Je},a.beforeId)}return Ue}function lP(h,a){if(a.layerId&&h.getLayer(a.layerId))throw new Error(`A layer already exists with the layer id: ${a.layerId}`);const d=a.sourceId??op(),w=a.layerId??ap(),S=a.minzoom??0,A=a.maxzoom??23,b=a.zoomCompensation??!0,s=a.opacity??[{zoom:S,value:0},{zoom:S+.25,value:1},{zoom:A-.25,value:1},{zoom:A,value:0}];let F=Array.isArray(a.colorRamp)?a.colorRamp:ix.TURBO.transparentStart();const $=F.getBounds();($.min!==0||$.max!==1)&&(F=F.scale(0,1)),F.hasTransparentStart()||(F=F.transparentStart());const Q=a.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],oe=a.property??null,xe=a.weight??1;let ge=1;oe?typeof xe=="number"?(ge=xe,typeof a.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(xe)?ge=Q0(xe,oe):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof xe=="number"?ge=xe:Array.isArray(xe)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const Me=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],be=a.radius??(b?Me:10);let me=1;typeof be=="number"?me=be:Array.isArray(be)&&"zoom"in be[0]?me=Pi(be):oe&&Array.isArray(be)&&"propertyValue"in be[0]?me=ex(be,oe,b):!oe&&Array.isArray(be)&&"propertyValue"in be[0]?(me=Pi(Me),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):me=Pi(Me);const nt={heatmapLayerId:w,heatmapSourceId:d};if(a.data&&!h.getSource(d)){let Ke=a.data;typeof Ke=="string"&&Md(Ke)&&(Ke=`https://api.maptiler.com/data/${Ke}/features.json?key=${Tr.apiKey}`),h.addSource(d,{type:"geojson",data:Ke})}return h.addLayer({id:w,type:"heatmap",source:d,minzoom:S,maxzoom:A,paint:{"heatmap-weight":ge,"heatmap-intensity":typeof Q=="number"?Q:Pi(Q),"heatmap-color":tx(F),"heatmap-radius":me,"heatmap-opacity":typeof s=="number"?s:Pi(s)}},a.beforeId),nt}const Fh=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:lP,addPoint:sP,addPolygon:aP,addPolyline:nP,colorDrivenByProperty:Lm,colorPalettes:Em,computeRampedOutlineWidth:J0,dashArrayMaker:ug,generateRandomLayerName:ap,generateRandomSourceName:op,getRandomColor:Zd,heatmapIntensityFromColorRamp:tx,lerpZoomNumberValues:Cm,opacityDrivenByProperty:zm,paintColorOptionsToPaintSpec:kl,radiusDrivenByProperty:km,radiusDrivenByPropertyHeatmap:ex,rampedOptionsToLayerPaintSpec:Pi,rampedPropertyValueWeight:Q0,takeScreenshot:tP},Symbol.toStringTag,{value:"Module"}));function rx(){return"3.10.2"}xt.Map;xt.Marker;xt.Popup;xt.Style;xt.CanvasSource;xt.GeoJSONSource;xt.ImageSource;xt.RasterTileSource;xt.RasterDEMTileSource;xt.VectorTileSource;xt.VideoSource;xt.NavigationControl;xt.GeolocateControl;xt.AttributionControl;xt.LogoControl;xt.ScaleControl;xt.FullscreenControl;xt.TerrainControl;xt.BoxZoomHandler;xt.ScrollZoomHandler;xt.CooperativeGesturesHandler;xt.KeyboardHandler;xt.TwoFingersTouchPitchHandler;xt.MapWheelEvent;xt.MapTouchEvent;xt.MapMouseEvent;xt.config;xt.getVersion;const{setRTLTextPlugin:DP,getRTLTextPluginStatus:RP,LngLat:FP,LngLatBounds:BP,MercatorCoordinate:OP,Evented:NP,AJAXError:jP,prewarm:VP,clearPrewarmedResources:UP,Hash:ZP,Point:GP,EdgeInsets:$P,DragRotateHandler:qP,DragPanHandler:WP,TwoFingersTouchZoomRotateHandler:HP,DoubleClickZoomHandler:XP,TwoFingersTouchZoomHandler:YP,TwoFingersTouchRotateHandler:KP,getWorkerCount:JP,setWorkerCount:QP,getMaxParallelImageRequests:eM,setMaxParallelImageRequests:tM,getWorkerUrl:iM,setWorkerUrl:rM,addSourceType:nM,importScriptInWorkers:oM,addProtocol:aM,removeProtocol:sM}=xt,uP="@maptiler/leaflet-maptilersdk",cP="4.1.1",nx=tr.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(h){tr.setOptions(this,h),this._throttledUpdate=tr.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(h){var a;this._container||this._initContainer();const d=this.getPaneName();(a=h.getPane(d))==null||a.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),h.options.zoomAnimation&&tr.DomEvent.on(h._proxy,tr.DomUtil.TRANSITION_END,this._transitionEnd,this),h.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(h){var a;this._map._proxy&&this._map.options.zoomAnimation&&tr.DomEvent.off(this._map._proxy,tr.DomUtil.TRANSITION_END,this._transitionEnd,this);const d=this.getPaneName();(a=h.getPane(d))==null||a.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const h=this.getSize().multiplyBy(.5),a=this._map.latLngToContainerPoint(this._map.getCenter());return tr.latLngBounds(this._map.containerPointToLatLng(a.subtract(h)),this._map.containerPointToLatLng(a.add(h)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(h){this._maptilerMap.setStyle(h)},setLanguage:function(h){this._maptilerMap.setLanguage(h)},_roundPoint:h=>({x:Math.round(h.x),y:Math.round(h.y)}),_initContainer:function(){this._container=tr.DomUtil.create("div","leaflet-gl-layer");const h=this.getSize(),a=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${h.x}px`,this._container.style.height=`${h.y}px`;const d=this._map.containerPointToLayerPoint([0,0]).subtract(a);tr.DomUtil.setPosition(this._container,this._roundPoint(d))},_initMaptilerSDK:function(){const h=this._map.getCenter(),a=this.options.maxBounds?this.options.maxBounds:[[Number.NEGATIVE_INFINITY,-90],[Number.POSITIVE_INFINITY,90]];this._map.setMaxBounds(tr.latLngBounds(tr.latLng(a[0][1],a[0][0]),tr.latLng(a[1][1],a[1][0])));const d={maxBounds:a,...this.options,projection:"mercator",container:this._container,center:[h.lng,h.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(d.center=void 0,d.zoom=void 0),this._maptilerMap=new U0(d),this._maptilerMap.telemetry.registerModule(uP,cP),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let S={logo:null};try{const A=Object.keys(this._maptilerMap.style.sourceCaches).map(s=>this._maptilerMap.getSource(s)).filter(s=>s&&"url"in s&&typeof s.url=="string"&&s?.url.includes("tiles.json")),b=new URL(A[0].url);b.searchParams.has("key")||b.searchParams.append("key",d.apiKey),S=await(await fetch(b.href)).json()}catch{}if(S.logo||d.maptilerLogo){const A=S.logo??"https://api.maptiler.com/resources/logo.svg",b=document.createElement("a");b.href="https://www.maptiler.com",b.style.setProperty("position","absolute"),b.style.setProperty("left","10px"),b.style.setProperty("bottom","2px"),b.style.setProperty("z-index","999");const s=document.createElement("img");s.src=A,s.alt="MapTiler logo",s.width=100,s.height=30,b.appendChild(s),this._map.getContainer().appendChild(b)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const w=this._maptilerMap._actualCanvas;tr.DomUtil.addClass(w,"leaflet-image-layer"),tr.DomUtil.addClass(w,"leaflet-zoom-animated"),this.options.interactive&&tr.DomUtil.addClass(w,"leaflet-interactive"),this.options.className&&tr.DomUtil.addClass(w,this.options.className),this.addHeatmap=S=>Fh.addHeatmap(this._maptilerMap,S),this.addPolygon=S=>Fh.addPolygon(this._maptilerMap,S),this.addPoint=S=>Fh.addPoint(this._maptilerMap,S),this.addPolyline=S=>Fh.addPolyline(this._maptilerMap,S),this.takeScreenshot=S=>Fh.takeScreenshot(this._maptilerMap,S)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const h=this.getSize(),a=this._map.getSize().multiplyBy(this.options.padding),d=this._map.containerPointToLayerPoint([0,0]).subtract(a);tr.DomUtil.setPosition(this._container,this._roundPoint(d)),this._transformGL(),this._maptilerMap.transform.width!==h.x||this._maptilerMap.transform.height!==h.y?(this._container.style.width=`${h.x}px`,this._container.style.height=`${h.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(h){const a=this._map.getZoomScale(h.zoom),d=this._map.getSize().multiplyBy(this.options.padding*a),w=this.getSize()._divideBy(2),S=this._map.project(h.center,h.zoom)._subtract(w)._add(this._map._getMapPanePos().add(d))._round(),A=this._map.project(this._map.getBounds().getNorthWest(),h.zoom)._subtract(S);tr.DomUtil.setTransform(this._maptilerMap.getCanvas(),A.subtract(this._offset),a)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const h=this._map.getZoomScale(this._map.getZoom());tr.DomUtil.setTransform(this._maptilerMap.getCanvas(),new tr.Point(0,0),h),this._zooming=!1,this._update()},_transitionEnd:function(){tr.Util.requestAnimFrame(()=>{const h=this._map.getZoom(),a=this._map.getCenter(),d=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());tr.DomUtil.setTransform(this._maptilerMap._actualCanvas,d,1),this._maptilerMap.once("moveend",tr.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:a,zoom:h-1})},this)},_resize:function(h){this._transitionEnd(h)}});function hP(h){return new nx(h)}const lM=Object.freeze(Object.defineProperty({__proto__:null,Language:ui,MapStyle:Cc,MaptilerLayer:nx,maptilerLayer:hP},Symbol.toStringTag,{value:"Module"})),uM=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{lM as a,uM as b,Dm as g,pP as l};
